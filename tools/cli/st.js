#!/usr/bin/env node
(function(e){var t={};function n(i){if(t[i]){return t[i].exports}var r=t[i]={i:i,l:false,exports:{}};e[i].call(r.exports,r,r.exports,n);r.l=true;return r.exports}n.m=e;n.c=t;n.d=function(e,t,i){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:i})}};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=6)})([function(e,t){e.exports=require("iotcloud-lib")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("bluebird")},function(e,t,n){const i=n(4);const r=n(0).FileSystemHandler;function o(){let e=__dirname;if(!r.existsSync(i.resolve(e,"package.json")))e=i.resolve(e,"..");return e}function s(){const e=i.resolve(o(),"package.json");return r.readJsonSync(e).version}function c(e){if(e.match(/^-?\d*(\.\d+)?$/)&&!isNaN(parseFloat(e))&&e%1!==0){return true}return false}e.exports={getRoot:o,getCLIVersion:s,isFloat:c}},function(e,t){e.exports=require("path")},function(e,t,n){const i=n(14);function r(e){console.log(e)}function o(e,t){const n=Array.isArray(t)?{columns:t}:{};n.preserveNewLines=true;r(i(e,n))}e.exports={printOutput:r,printColumn:o}},function(e,t,n){const i=n(0).StLogger;const r=n(7);const o=n(9);const s=n(5);const c=n(15).debug("debugLog");try{const e=new r("st");e.addCommands(o.getCommands());e.runCommand().catch(e=>{if(process.exitCode===undefined||process.exitCode===0){process.exitCode=1}s.printOutput(`Error: ${e.message}`);c(e.stack);c(`stderr: ${e.stderr}`);i.error(e.stack);i.error(`stderr: ${e.stderr}`)})}catch(e){if(process.exitCode===undefined||process.exitCode===0){process.exitCode=1}s.printOutput(`Error: ${e.message}`);c(e.stack);c(`stderr: ${e.stderr}`);i.error(e.stack);i.error(`stderr: ${e.stderr}`)}},function(e,t,n){const i=n(1);const r=n(8);const o=n(2);const s=n(0).StLogger;const c=n(0).StError;const{getLibVersion:p}=n(0).util;const{getCLIVersion:u}=n(3);const E=["array","boolean","count","number","string"];function l(e){const t=Object.keys(e.children);const n=`<${t.join(" | ")}>`;return n}function d(e){e.sort((e,t)=>{if(e.full<t.full){return-1}else if(e.full>t.full){return 1}return 0});const t={};e.forEach(e=>{const n={desc:e.description,alias:e.short,demandOption:false,full:false};if(e.required){n.demandOption=true}if(i.has(e,"type")&&E.indexOf(e.type)!==-1){n[e.type]=true}t[e.full]=n});return t}class a{constructor(e){this.filename=e;this.alias={};this.commands={};this.runner=Object}setCommand(e,t,n){if(!e.commands.length)throw new c("NO_COMMAND");if(!Array.isArray(e.options))throw new c("NO_COMMAND_OPTION");if(typeof e.description!=="string")throw new c("NO_COMMAND_DESCRIPTION");if(typeof e.runner!=="function")throw new c("NO_COMMAND_RUNNER");const i=t?t.children:this.commands;const r=e.commands.length===n+1;if(r&&i[e.commands[n]]){throw new c("COMMAND_ALREADY_ADDED",e.commands[n],e.commands)}let o;if(i[e.commands[n]]){o=i[e.commands[n]]}else{o={command:e.commands[n],fullCommand:e.commands.slice(0,n+1).join(" "),desc:r?e.description:"",options:r?e.options:"",runner:r?e.runner:"",children:{}};i[e.commands[n]]=o}if(!r){this.setCommand(e,o,n+1)}}applyCommand(e,t){if(i.isEmpty(t.children)){const n=d(t.options);e.command({command:t.command,describe:t.desc,builder:e=>{this.runner=t.runner;e.options(n).usage(`Usage\n$ st ${t.fullCommand.trim()} [options]\n\nDescription\n${t.desc}`).demandCommand(0,0,"","");return e}})}else{const n=l(t);e.command({command:t.command,describe:n,builder:e=>{const n=Object.keys(t.children).sort();n.forEach(n=>this.applyCommand(e,t.children[n]));e.usage(`Usage\n$ st ${t.fullCommand.trim()} <commands> [options]`).demandCommand(1,1,"","");return e}}).help()}}addCommands(e){e.forEach(e=>this.setCommand(e,null,0));const t=Object.keys(this.commands).sort();t.forEach(e=>this.applyCommand(r,this.commands[e]));r.demandCommand(1,1,"","")}runCommand(){return o.resolve().then(()=>{r.locale("en").strict(true).help().usage("Usage\n$ st <commands> [options]").version("version","Show version number of Smartthings SDK CLI and Lib",`Smartthings SDK Version\n CLI: ${u()}\n Library: ${p()}`).option("version",{alias:"v"});const e=r.argv;s.info(`[COMMAND] ${e.$0} ${e._.join(" ")}`);return this.runner(e)})}}e.exports=a},function(e,t){e.exports=require("yargs")},function(e,t,n){const i=n(4);const r=n(2);const o=n(10);const s=n(11);const c=n(1);const{spawn:p}=n(12);const u=n(13);const E=n(5);const l=n(0).Configurator;const d=n(0).Project;const a=n(0).ProjectManager;const O=n(0).ManifestManager;const C=n(0).LocationManager;const T=n(0).DeviceManager;const f=n(0).OcfDeviceManager;const I=n(0).DeviceProfileManager;const S=n(0).C2cDeviceProfileManager;const P=n(0).AuthManager;const _=n(0).FileSystemHandler;const g=n(0).OneAppController;const m=n(0).CapabilityManager;const D=n(0).ResourceTypeManager;const N=n(0).DevPortalManager;const R=n(0).OcfLogManager;const y=n(0).StLogManager;const A=n(0).MetaDataGenerator;const L=n(0).OcfGroupManager;const h=n(0).CertManager;const M=n(0).WebConsoleProjectManager;const U=n(0).PluginManager;const{getFlatKeys:w}=n(0).util;const{getText:v}=n(0).TextHandler;const b=n(0).StError;const G=n(0).StLogger;const{getRoot:F,isFloat:V}=n(3);let B;function J(){const e=B.get("refreshToken");const t=B.get("accessToken");if(!t)return r.reject(new b("SIGN_UP_NO_LOGIN","accessToken"));if(!e)return r.reject(new b("SIGN_UP_NO_LOGIN","refreshToken"));const n=new P(B);n.init();return n.refreshToken(true)}function j(e,t){const n=B.getConfig().iotConsole.uri;const r=i.resolve(F(),"assets/signIn.js");const o=i.resolve(e,"signIn.js");const s=i.resolve(F(),"assets/signIn.html");const p=i.resolve(e,"signIn.html");return _.readFile(r,"utf-8").then(e=>{const t=c.template(e);return _.writeFile(o,t({}),"utf-8")}).then(()=>_.readFile(s,"utf-8")).then(e=>{const i=c.template(e);const r=`?hash=${Date.now()}`;return _.writeFile(p,i({iotConsoleUri:n,purpose:t,hash:r}),"utf-8")}).then(()=>o)}function k(e){const t=s.dirSync();return j(t.name,e).then(e=>p(o,[e])).then(({stdout:e,stderr:t})=>{try{const n=JSON.parse(e.trim());if(n)return n;throw new Error("SDK configuration not found!")}catch(n){const i=e.trim()+t.trim();if(i){throw new b("LOGIN_ERROR",i)}else{throw new b("UI_CLOSED")}}},({stdout:e,stderr:t})=>r.reject(new b("LOGIN_ERROR",e+t))).finally(()=>{_.removeSync(t.name)})}function q(e="login"){if(e!=="login"&&!B.get("userId")){throw new b("NO_LOGIN")}E.printOutput(v("REQUEST_TOKEN.SIGNING_IN_SAMSUNG_ACCOUNT"));return k(e).then(e=>{Object.keys(e).forEach(t=>{if(!e[t])return;if(t==="authServerUrl"){B.set("authProvider.uri",e[t])}else{B.set(t,e[t])}})})}const Y=[{commands:["request-token"],options:[{full:"show-ui",type:"boolean",description:v("REQUEST_TOKEN.OPT.SHOW_UI")},{full:"authcode",type:"boolean",description:v("REQUEST_TOKEN.OPT.AUTH_CODE")}],description:v("REQUEST_TOKEN.DESC"),runner:({"show-ui":e,authcode:t})=>{return r.resolve().then(()=>{if(e){return q()}else if(t){B.set("authCode",t)}return r.resolve()}).then(()=>{const e=new P(B);e.init();e.on("progress",e=>E.printOutput(e));return e.requestTokenByAuthCode()}).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["refresh-token"],options:[],description:v("REFRESH_TOKEN.DESC"),runner:()=>{const e=new P(B);e.init();return e.refreshToken().then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["create","project"],options:[{short:"n",full:"name",type:"string",required:true,description:v("CREATE_PROJECT.OPT.NAME")},{full:"type",type:"string",description:v("CREATE_PROJECT.OPT.TYPE")},{full:"template",type:"string",description:v("CREATE_PROJECT.OPT.TEMPLATE")},{full:"device-profile",type:"string",description:v("CREATE_PROJECT.OPT.DEVICE_PROFILE")},{full:"main-state",type:"string",description:v("CREATE_PROJECT.OPT.MAIN_STATE")},{full:"main-action",type:"string",description:v("CREATE_PROJECT.OPT.MAIN_ACTION")},{full:"vid",type:"string",description:v("CREATE_PROJECT.OPT.VID")},{full:"import-things-sdk",type:"string",description:v("CREATE_PROJECT.OPT.IMPORT_THINGS_SDK")},{full:"app-name",type:"string",description:v("CREATE_PROJECT.OPT.APP_NAME")},{full:"app-type",type:"string",description:v("CREATE_PROJECT.OPT.APP_TYPE")},{full:"lambda-arn",type:"array",description:v("CREATE_PROJECT.OPT.LAMBDA_ARN")},{full:"target-url",type:"string",description:v("CREATE_PROJECT.OPT.TARGET_URL")},{full:"plugin-id",type:"string",description:v("CREATE_PROJECT.OPT.PLUGIN_ID")},{full:"generate-plugin",type:"boolean",description:v("CREATE_PROJECT.OPT.GENERATE_PLUGIN")},{full:"dashboard-card",type:"boolean",description:v("CREATE_PROJECT.OPT.DASHBOARD_CARD")}],description:v("CREATE_PROJECT.DESC"),runner:({name:e,type:t=d.PROJ_TYPE.OCF,template:n,"device-profile":i,"main-state":r,"main-action":o,vid:s,"import-things-sdk":c,"app-name":p,"app-type":u,"lambda-arn":l,"target-url":O,"plugin-id":C,"generate-plugin":T,"dashboard-card":f})=>{const I=new a(B.getConfig());I.init();E.printOutput(v("CREATE_PROJECT.CREATING",e));if(n){return I.createProjectByTemplate(e,process.cwd(),n,t).then(()=>E.printOutput(v("COMMON.SUCCESS")))}switch(t){case d.PROJ_TYPE.OCF:if(T&&!C){throw new b("CREATE_PROJECT_PLUGIN_ID_OPT_REQUIRED")}if(c){return I.createProjectFromThingsSDK(e,process.cwd(),c,r,o,s,C,T).then(()=>E.printOutput(v("COMMON.SUCCESS")))}return I.createOcfProject(e,process.cwd(),i,r,o,s,C,T).then(()=>E.printOutput(v("COMMON.SUCCESS")));case d.PROJ_TYPE.AUTOMATION:return I.createLambdaAutomationProject(e,process.cwd(),p,u,l,O).then(()=>E.printOutput(v("COMMON.SUCCESS")));case d.PROJ_TYPE.C2C:if(T&&!C){throw new b("CREATE_PROJECT_PLUGIN_ID_OPT_REQUIRED")}return I.createLambdaC2cProject(e,process.cwd(),i,r,o,s,C,T,p,u,l,O).then(()=>E.printOutput(v("COMMON.SUCCESS")));case d.PROJ_TYPE.SERVICE:if(T&&!C){throw new b("CREATE_PROJECT_PLUGIN_ID_OPT_REQUIRED")}return I.createDefaultServicePluginProject(e,process.cwd(),p,u,l,O,C,T,f).then(()=>E.printOutput(v("COMMON.SUCCESS")));default:if(T&&!C){throw new b("CREATE_PROJECT_PLUGIN_ID_OPT_REQUIRED")}return I.createOcfProject(e,process.cwd(),i,r,o,s,C,T).then(()=>E.printOutput(v("COMMON.SUCCESS")))}}},{commands:["list","project"],options:[],description:v("LIST_PROJECT.DESC"),runner:()=>{const e=new a;return e.retrieveProjectList(process.cwd()).then(e=>E.printColumn(e,["name","type"]))}},{commands:["build","project"],options:[{full:"project-path",type:"string",description:v("BUILD_PROJECT.OPT.PROJECT_PATH")},{full:"sign-ppk",type:"boolean",description:v("BUILD_PROJECT.OPT.SIGN_PPK")},{full:"passwd",type:"string",description:v("BUILD_PROJECT.OPT.PASSWD")}],description:v("BUILD_PROJECT.DESC"),runner:({"project-path":e,"sign-ppk":t,passwd:n})=>{const i=new a(B.getConfig());i.init();i.on("start",e=>E.printOutput(v("BUILD_PROJECT.BUILDING",e)));i.on("progress",e=>E.printOutput(e));return i.buildProject(e,{signPpk:t,passwd:n}).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["export","project"],options:[{full:"project-path",type:"string",description:v("EXPORT_PROJECT.OPT.PROJECT_PATH")},{full:"out",type:"string",description:v("EXPORT_PROJECT.OPT.OUT")},{full:"show",type:"boolean",description:v("EXPORT_PROJECT.OPT.SHOW")}],description:v("BUILD_PROJECT.DESC"),runner:({"project-path":e,out:t,show:n})=>{const r=new a(B.getConfig());r.init();r.on("progress",e=>E.printOutput(e));let o=null;if(t){o=i.resolve(t)}else{o=!n?`${process.cwd()}/device_def.json`:null}return r.exportToThingsSDK(e,o).then(e=>{if(n){E.printOutput(JSON.stringify(e,null,2))}else{E.printOutput(v("COMMON.SUCCESS"))}})}},{commands:["list","template"],options:[{full:"device-profile",type:"string",description:v("LIST_TEMPLATE.OPT.DEVICE_PROFILE")}],description:v("LIST_TEMPLATE.DESC"),runner:e=>{const t={deviceProfile:e["device-profile"]};const n=new a(B.getConfig());n.init();return n.retrieveTemplateList(t).then(e=>E.printColumn(e,["id","name","description"]))}},{commands:["verify","ppk"],options:[{full:"in",required:true,type:"string",description:v("VERIFY_PPK.OPT.IN")},{full:"verbose",type:"boolean",description:v("VERIFY_PPK.OPT.VERBOSE")}],description:v("VERIFY_PPK.DESC"),runner:({in:e,verbose:t=false})=>{if(!e)throw new b("VERIFY_PPK_NO_IN");E.printOutput(v("VERIFY_PPK.VERIFING",e));return(new a).verifyPackage(e,t).then(n=>{if(t)E.printOutput(n.stdout);if(n.code===0){E.printOutput(v("VERIFY_PPK.SUCCESS",e))}else{throw new b("VERIFY_PPK_FAIL",e)}})}},{commands:["sign","ppk"],options:[{full:"passwd",type:"string",description:v("SIGN_PPK.OPT.PASSWD")},{full:"in",type:"string",required:true,description:v("SIGN_PPK.OPT.IN")},{full:"out",type:"string",description:v("SIGN_PPK.OPT.OUT")}],description:v("SIGN_PPK.DESC"),runner:({passwd:e,in:t,out:n=t})=>{E.printOutput(v("SIGN_PPK.SIGNING",t));if(!e)throw new b("SIGN_PPK_NO_REQUIRED");return new a(B.getConfig()).signPackage(t,false,n,e).then(e=>{if(e.code===0){E.printOutput(v("SIGN_PPK.SUCCESS",n))}else{throw new b("SIGN_PPK_FAIL",t)}})}},{commands:["extract","ppk"],options:[{full:"in",required:true,type:"string",description:v("EXTRACT_PPK.OPT.IN")},{full:"out",type:"string",description:v("EXTRACT_PPK.OPT.OUT")}],description:v("EXTRACT_PPK.DESC"),runner:({in:e,out:t})=>{if(!t)throw new b("EXTRACT_PPK_NO_OUT");E.printOutput(v("EXTRACT_PPK.EXTRACTING",e));const n=new a;n.on("progress",e=>E.printOutput(e));return n.extractPackage(e,t).then(()=>{E.printOutput(v("COMMON.SUCCESS"))})}},{commands:["install","app"],options:[{full:"target",type:"boolean",description:v("INSTALL_APP.OPT.TARGET")},{full:"serial",type:"string",description:v("INSTALL_APP.OPT.SERIAL")},{full:"simulator",type:"boolean",description:v("INSTALL_APP.OPT.SIMULATOR")},{full:"sim-path",type:"string",description:v("INSTALL_APP.OPT.SIMULATOR_PATH")}],description:v("INSTALL_APP.DESC"),runner:({target:e,serial:t,simulator:n,"sim-path":i})=>{const r=new g(B.getConfig());if(e){return r.installApplicationToDevice(process.cwd(),t).then(()=>{E.printOutput(v("INSTALL_APP.SUCCESS"))}).catch(e=>{throw new b("INSTALL_APP_FAIL",e)})}else if(n){return r.installApplicationToSimulator("cli",process.cwd(),i).then(e=>{if(e.code===0)E.printOutput(v("INSTALL_APP.SUCCESS_ON_SIM"));else throw new b("INSTALL_APP_FAIL_ON_SIM")})}throw new b("INSTALL_APP_NO_OPT")}},{commands:["register","web-console-project"],options:[{short:"n",full:"name",type:"string",description:v("REGISTER_WEB_CONSOLE_PROJECT.OPT.NAME")},{full:"description",type:"string",description:v("REGISTER_WEB_CONSOLE_PROJECT.OPT.DESCRIPTION")}],description:v("REGISTER_WEB_CONSOLE_PROJECT.DESC"),runner:({name:e,description:t})=>{const n=new M(B.getConfig());n.init();n.on("progress",e=>E.printOutput(e));return n.createProject(process.cwd(),e,t).then(e=>{E.printOutput(v("COMMON.SUCCESS"));const t={id:e.id,name:e.name,description:e.description};if(e.oauthClientId)t.oauthClientId=e.oauthClientId;if(e.oauthClientSecret)t.oauthClientSecret=e.oauthClientSecret;E.printOutput(JSON.stringify(t,null,2))})}},{commands:["describe","web-console-project"],options:[{short:"i",full:"id",type:"string",description:v("DESCRIBE_WEB_CONSOLE_PROJECT.OPT.ID")}],description:v("DESCRIBE_WEB_CONSOLE_PROJECT.DESC"),runner:({id:e})=>{const t=new M(B.getConfig());t.init();return r.resolve().then(()=>e?t.readProject(e):t.readProjectInLocalProject(process.cwd())).then(e=>E.printOutput(JSON.stringify(e,null,2)))}},{commands:["list","web-console-project"],options:[],description:v("LIST_WEB_CONSOLE_PROJECT.DESC"),runner:()=>{const e=new M(B.getConfig());e.init();return e.readProjectList().then(e=>E.printColumn(e,["id","name","type","status","description"]))}},{commands:["update","web-console-project"],options:[{short:"i",full:"id",type:"string",description:v("UPDATE_WEB_CONSOLE_PROJECT.OPT.ID")},{short:"n",full:"name",type:"string",description:v("UPDATE_WEB_CONSOLE_PROJECT.OPT.NAME")},{full:"description",type:"string",description:v("UPDATE_WEB_CONSOLE_PROJECT.OPT.DESCRIPTION")}],description:v("UPDATE_WEB_CONSOLE_PROJECT.DESC"),runner:({id:e,name:t,description:n})=>{const i=new M(B.getConfig());i.init();i.on("progress",e=>E.printOutput(e));return i.updateProject(process.cwd(),e,t,n).then(()=>{E.printOutput(v("COMMON.SUCCESS"))})}},{commands:["unregister","web-console-project"],options:[{short:"i",full:"id",type:"string",description:v("UNREGISTER_WEB_CONSOLE_PROJECT.OPT.ID")},{full:"force",type:"boolean",description:v("UNREGISTER_WEB_CONSOLE_PROJECT.OPT.FORCE")}],description:v("UNREGISTER_WEB_CONSOLE_PROJECT.DESC"),runner:({id:e,force:t})=>{const n=new M(B.getConfig());n.init();return r.resolve().then(()=>{if(e){return n.deleteProject(e)}const i={force:t};return n.deleteProjectInLocalProject(process.cwd(),i)}).then(()=>{E.printOutput(v("COMMON.SUCCESS"))})}},{commands:["publish","web-console-project"],options:[{short:"i",full:"id",type:"string",description:v("PUBLISH_WEB_CONSOLE_PROJECT.OPT.ID")}],description:v("PUBLISH_WEB_CONSOLE_PROJECT.DESC"),runner:({id:e,force:t})=>{const n=new M(B.getConfig());n.init();return r.resolve().then(()=>{if(e){return n.publishProject(e)}const i={force:t};return n.publishProjectInLocalProject(process.cwd(),i)}).then(()=>{E.printOutput(v("COMMON.SUCCESS"))})}},{commands:["unpublish","web-console-project"],options:[{short:"i",full:"id",type:"string",description:v("UNPUBLISH_WEB_CONSOLE_PROJECT.OPT.ID")}],description:v("UNPUBLISH_WEB_CONSOLE_PROJECT.DESC"),runner:({id:e,force:t})=>{const n=new M(B.getConfig());n.init();return r.resolve().then(()=>{if(e){return n.unpublishProject(e)}const i={force:t};return n.unpublishProjectInLocalProject(process.cwd(),i)}).then(()=>{E.printOutput(v("COMMON.SUCCESS"))})}},{commands:["launch","simulator"],options:[],description:v("LAUNCH_ONEAPP_SIMULATOR.DESC"),runner:()=>{return r.resolve().then(()=>{const e=new g(B.getConfig());return e.launchSimulator()}).then(e=>{if(e.code===0)E.printOutput(v("LAUNCH_ONEAPP_SIMULATOR.SUCCESS"));else if(e.code===100)throw new b("LAUNCH_ONEAPP_SIM_FAIL_BY_MEMORY");else throw new b("LAUNCH_ONEAPP_SIM_FAIL",e.stderr)})}},{commands:["launch","virtual-device"],options:[{full:"config-name",type:"string",description:v("LAUNCH_VIRTUAL_DEVICE.OPT.CONFIG")},{full:"vd-path",type:"string",description:v("LAUNCH_VIRTUAL_DEVICE.OPT.PATH")}],description:v("LAUNCH_VIRTUAL_DEVICE.DESC"),runner:({"config-name":e,"vd-path":t})=>{return r.resolve().then(()=>{const n=new g(B.getConfig());return n.launchVirtualDevice(e,t)}).then(e=>{if(e.code===0)E.printOutput(v("LAUNCH_VIRTUAL_DEVICE.SUCCESS"));else throw new b("LAUNCH_VD_FAIL",e.stderr)})}},{commands:["register","plugin"],options:[{full:"in",required:true,type:"string",description:v("REGISTER_PLUGIN.OPT.IN")},{full:"plugin-type",required:true,type:"string",description:v("REGISTER_PLUGIN.OPT.PLGNTYPE")}],description:v("REGISTER_PLUGIN.DESC"),runner:({in:e,"plugin-type":t})=>J().then(()=>{const n=new U(B.getConfig());n.init();return n.registerPlugin(e,t).then(({pkgNm:e})=>E.printOutput(v("REGISTER_PLUGIN.SUCCESS",e)))})},{commands:["unregister","plugin"],options:[{short:"n",full:"package-name",required:true,type:"string",description:v("UNREGISTER_PLUGIN.OPT.PKGNM")}],description:v("UNREGISTER_PLUGIN.DESC"),runner:({"package-name":e})=>J().then(()=>{const t=new U(B.getConfig());t.init();return t.unregisterPlugin(e).then(()=>E.printOutput(v("UNREGISTER_PLUGIN.SUCCESS",e)))})},{commands:["list","plugin"],options:[{short:"n",full:"package-name",type:"string",description:v("LIST_PLUGIN.OPT.PKGNM")},{full:"plugin-type",type:"string",description:v("LIST_PLUGIN.OPT.PLGNTYPE")},{full:"status",type:"string",description:v("LIST_PLUGIN.OPT.STATUS")}],description:v("LIST_PLUGIN.DESC"),runner:({"package-name":e,"plugin-type":t,status:n})=>J().then(()=>{const i=new U(B.getConfig());i.init();return i.retrievePluginList(e,t,n)}).then(e=>{const t=e.map(e=>({pkgNm:e.pkgNm,plgnType:e.plgnType.substring(4),dvcType:e.dvcType,devStatCd:e.devStatCd.substring(4),verNm:e.verNm,verCd:e.verCd,projectLinked:!!e.pjtId}));E.printColumn(t,["pkgNm","plgnType","dvcType","devStatCd","verNm","verCd","projectLinked"])})},{commands:["describe","plugin"],options:[{short:"n",full:"package-name",type:"string",description:v("DESCRIBE_PLUGIN.OPT.PKGNM")}],description:v("DESCRIBE_PLUGIN.DESC"),runner:({"package-name":e})=>J().then(()=>{const t=new U(B.getConfig());t.init();return t.retrievePlugin(e)}).then(e=>E.printOutput(JSON.stringify(e,null,2)))},{commands:["list","manifest"],options:[{short:"i",full:"id",type:"string",description:v("LIST_MANIFEST.OPT.ID")},{full:"status",type:"string",description:v("LIST_MANIFEST.OPT.STATUS")},{full:"owner-id",type:"string",description:v("LIST_MANIFEST.OPT.OWNER_ID")},{full:"type",type:"string",description:v("LIST_MANIFEST.OPT.TYPE")}],description:v("LIST_MANIFEST.DESC"),runner:({id:e,status:t,"owner-id":n,type:i})=>J().then(()=>{const{mnid:e}=B.getConfig();if(!e){const e=new N(B);e.init();return e.requestMnid()}return e}).then(()=>{const r=new O(B.getConfig());r.init();return r.retrieveManifestList(e,t,n,i)}).then(e=>E.printColumn(e,["mnmn","vid","version","workflowId","uid","status","type"]))},{commands:["describe","manifest"],options:[{full:"type",type:"string",description:v("DESCRIBE_MANIFEST.OPT.TYPE")},{full:"mnmn",type:"string",description:v("DESCRIBE_MANIFEST.OPT.MNMN")},{full:"vid",type:"string",description:v("DESCRIBE_MANIFEST.OPT.VID")},{full:"ver",type:"string",description:v("DESCRIBE_MANIFEST.OPT.VERSION")},{short:"i",full:"id",type:"string",description:v("DESCRIBE_MANIFEST.OPT.ID")}],description:v("DESCRIBE_MANIFEST.DESC"),runner:({type:e,mnmn:t,vid:n,ver:i,id:r})=>J().then(()=>{const o=new O(B.getConfig());o.init();if(r){return o.retrieveManifestById(r)}if(!t||!n||!i||!e)throw new b("DESCRIBE_MANIFEST_FAIL");return o.retrieveManifest(t,n,i,e)}).then(e=>E.printOutput(JSON.stringify(e,null,2)))},{commands:["register","manifest"],options:[{full:"in",required:true,type:"string",description:v("REGISTER_MANIFEST.OPT.IN")},{full:"type",required:true,type:"string",description:v("REGISTER_MANIFEST.OPT.TYPE")}],description:v("REGISTER_MANIFEST.DESC"),runner:({in:e,type:t})=>J().then(()=>{const n=new O(B.getConfig());n.init();return n.registerManifest(e,t).then(e=>{if(e.workflowId)E.printOutput(v("REGISTER_MANIFEST.SUCCESS",e.vid,e.version));else throw new b("REGISTER_MANIFEST_FAIL",e.message,e.data)})})},{commands:["delete","manifest"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DELETE_MANIFEST.OPT.ID")}],description:v("DELETE_MANIFEST.DESC"),runner:({id:e})=>J().then(()=>{const t=new O(B.getConfig());t.init();return t.deleteManifest(e).then(e=>{if(e.code===2e6){const t=e.data;E.printOutput(v("DELETE_MANIFEST.SUCCESS",e.message,t.mnmn,t.vid,t.version))}else throw new b("DELETE_MANIFEST_FAIL",e.mag)})})},{commands:["update","manifest"],options:[{short:"i",full:"id",required:true,type:"string",description:v("UPDATE_MANIFEST.OPT.ID")},{full:"in",required:true,type:"string",description:v("UPDATE_MANIFEST.OPT.IN")}],description:v("UPDATE_MANIFEST.DESC"),runner:({id:e,in:t})=>J().then(()=>{const n=new O(B.getConfig());n.init();return n.updateManifest(e,t).then(e=>{if(e.code===2e6)E.printOutput(`${e.message}, ${e.data}`);else throw new b("UPDATE_MANIFEST_FAIL",e.message,e.data)})})},{commands:["list","device"],options:[{full:"resource-model",type:"boolean",description:v("LIST_DEVICE.OPT.RESOURCE_MODEL")},{full:"mnid",type:"string",description:v("LIST_DEVICE.OPT.MNID")},{full:"name",type:"string",description:v("LIST_DEVICE.OPT.NAME")},{full:"type",type:"string",description:v("LIST_DEVICE.OPT.TYPE")},{full:"vid",type:"string",description:v("LIST_DEVICE.OPT.VID")},{full:"client",type:"boolean",description:v("LIST_DEVICE.OPT.CLIENT")}],description:v("LIST_DEVICE.DESC"),runner:({"resource-model":e,mnid:t,name:n,type:i,vid:r,client:o})=>J().then(()=>{if(o){const e=new f(B.getConfig());e.init();return e.retrieveClientDeviceList().then(e=>E.printColumn(e,["id","type"]))}if(e){const e=new f(B.getConfig());e.init();const o={};if(t)o.mnmn=t;if(n)o.name=n;if(i)o.rt=i;if(r)o.vid=r;return e.retrieveDeviceList(true,o).then(e=>E.printColumn(e.map(e=>e.toListEntry()),["id","state","name","type","mnid","vid"]))}const s=new T(B.getConfig());s.init();return s.retrieveDeviceList().then(e=>E.printColumn(e,["name","deviceId"]))})},{commands:["describe","device"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DESCRIBE_DEVICE.OPT.ID")},{full:"resource-model",type:"boolean",description:v("DESCRIBE_DEVICE.OPT.RESOURCE_MODEL")},{full:"detail",type:"boolean",description:v("DESCRIBE_DEVICE.OPT.DETAIL")}],description:v("DESCRIBE_DEVICE.DESC"),runner:({id:e,"resource-model":t,detail:n})=>J().then(()=>{if(t){const t=new f(B.getConfig());t.init();return t.retrieveDevice(e).then(e=>{E.printOutput(JSON.stringify(n?e:e.toSimple(),null,2))})}const i=new T(B.getConfig());i.init();return i.retrieveDevice(e).then(e=>E.printOutput(JSON.stringify(e,null,2)))})},{commands:["describe","device-status"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DESCRIBE_DEVICE_STATUS.OPT.ID")},{full:"component",type:"string",description:v("DESCRIBE_DEVICE_STATUS.OPT.COMPONENT")},{full:"resource-model",type:"boolean",description:v("DESCRIBE_DEVICE_STATUS.OPT.RESOURCE_MODEL")},{short:"r",full:"resource",type:"string",description:v("DESCRIBE_DEVICE_STATUS.OPT.RESOURCE")}],description:v("DESCRIBE_DEVICE_STATUS.DESC"),runner:({id:e,component:t="main","resource-model":n,resource:i})=>J().then(()=>{if(n){if(!i)throw new b("NO_RESOURCE_OPTION");const t=new f(B.getConfig());t.init();return t.retrieveStatus(e,i).then(e=>E.printOutput(JSON.stringify(e,null,2)))}const r=new T(B.getConfig());r.init();return r.retrieveDeviceComponentStatus(e,t).then(e=>E.printOutput(JSON.stringify(e,null,2)))})},{commands:["delete","device"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DELETE_DEVICE.OPT.ID")},{full:"client",type:"boolean",description:v("DELETE_DEVICE.OPT.CLIENT")}],description:v("DELETE_DEVICE.DESC"),runner:({id:e,client:t})=>J().then(()=>{const n=new f(B.getConfig());n.init();return n.deleteDevice(e,t).catch(t=>{if(t.code==="IOT_CLOUD_DEVICE_NOT_FOUND"){const t=new T(B.getConfig());t.init();return t.deleteDevice(e).catch(e=>{if(e.code==="BAD_REQUEST")throw new b("DEVICE_NOT_FOUND");throw e})}throw t})}).then(()=>E.printOutput("Done."))},{commands:["command","device"],options:[{short:"i",full:"id",required:true,type:"string",description:v("COMMAND_DEVICE.OPT.ID")},{full:"capability",type:"string",description:v("COMMAND_DEVICE.OPT.CAPABILITY")},{full:"command",type:"string",description:v("COMMAND_DEVICE.OPT.COMMAND")},{full:"args",type:"string",description:v("COMMAND_DEVICE.OPT.ARGS")},{full:"component",type:"string",description:v("COMMAND_DEVICE.OPT.COMPONENT")},{full:"resource-model",type:"boolean",description:v("COMMAND_DEVICE.OPT.RESOURCE_MODEL")},{short:"r",full:"resource",type:"string",description:v("COMMAND_DEVICE.OPT.RESOURCE")},{full:"resource-type",type:"string",description:v("COMMAND_DEVICE.OPT.RESOURCE_TYPE")},{full:"interface",type:"string",description:v("COMMAND_DEVICE.OPT.INTERFACE")}],description:v("COMMAND_DEVICE.DESC"),runner:({id:e,capability:t,command:n,args:i,component:o="main","resource-model":s,resource:c,prefix:p,"resource-type":u,interface:l})=>J().then(()=>{if(s){let t={};try{t=JSON.parse(i)}catch(e){return r.reject(new b("CANNOT_PARSE_JSON"))}const n=new f(B.getConfig());n.init();return n.commandDevice(e,c,t,p,u,l)}const E=new T(B.getConfig());E.init();const d={component:o,capability:t,command:n};if(i){d.arguments=JSON.parse(i)}return E.commandDevice(e,d)}).then(()=>E.printOutput(v("COMMON.SUCCESS")))},{commands:["publish","device"],options:[{short:"i",full:"id",type:"string",description:v("PUBLISH_DEVICE.OPT.ID")},{full:"device-profile",type:"string",description:v("PUBLISH_DEVICE.OPT.DEVICE_PROFILE")},{full:"authcode",type:"string",description:v("PUBLISH_DEVICE.OPT.AUTH_CODE")},{full:"name",type:"string",description:v("PUBLISH_DEVICE.OPT.NAME")},{full:"device-profile-path",type:"string",description:v("PUBLISH_DEVICE.OPT.DEVICE_PROFILE_PATH")},{full:"device-key-path",type:"string",description:v("PUBLISH_DEVICE.OPT.DEVICE_KEY")},{full:"device-cert-path",type:"string",description:v("PUBLISH_DEVICE.OPT.DEVICE_CERT")}],description:v("PUBLISH_DEVICE.DESC"),runner:({id:e,"device-profile":t,authcode:n,name:i,"sso-token":o,"device-profile-path":s,"device-key-path":c,"device-cert-path":p})=>{if(t&&s)return r.reject(new b("AMBIGUOUS_DEVICE_PROFILE_OPT"));const u=new I(B.getConfig());let l;if(t){l=u.retrieveDeviceProfile(t)}else if(s){l=u.retrieveDeviceProfileFromFile(s)}else{l=u.retrieveDeviceProfileInProject(process.cwd())}return l.then(t=>{if(o){const n=new f(B.getConfig());n.init(null,c,p);return n.publishDeviceBySsoToken(o,e,t,i)}if(n){const r=new f(B.getConfig());r.init(null,c,p);return r.publishDevice(n,e,t,i)}return r.resolve().then(()=>q("authcode")).then(()=>{const n=B.get("authCode");if(!n)throw new b("PUBLISH_DEVICE_NO_TOKEN");const r=new f(B.getConfig());r.init(null,c,p);return r.publishDevice(n,e,t,i)})}).then(t=>{if(e){E.printOutput(v("COMMON.SUCCESS"))}else{E.printOutput(JSON.stringify(t,null,2))}})}},{commands:["list","location"],options:[],description:v("LIST_LOCATION.DESC"),runner:()=>J().then(()=>{const e=new C(B.getConfig());e.init();return e.retrieveLocationList()}).then(e=>E.printColumn(e,["name","locationId"]))},{commands:["describe","location"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DESCRIBE_LOCATION.OPT.ID")}],description:v("DESCRIBE_LOCATION.DESC"),runner:({id:e})=>J().then(()=>{const t=new C(B.getConfig());t.init();return t.retrieveLocation(e)}).then(e=>E.printOutput(JSON.stringify(e,null,2)))},{commands:["create","location"],options:[{short:"n",full:"name",required:true,type:"string",description:v("CREATE_LOCATION.OPT.NAME")},{full:"country-code",required:true,type:"string",description:v("CREATE_LOCATION.OPT.COUNTRY_CODE")},{full:"latitude",description:v("CREATE_LOCATION.OPT.LATITUDE")},{full:"longitude",description:v("CREATE_LOCATION.OPT.LONGITUDE")},{full:"radius",description:v("CREATE_LOCATION.OPT.RADIUS")},{full:"temperature-scale",type:"string",description:v("CREATE_LOCATION.OPT.TEMP_SCALE")}],description:v("CREATE_LOCATION.DESC"),runner:({name:e,"country-code":t,latitude:n,longitude:i,radius:r,"temperature-scale":o})=>{if(r&&V(r.toString()))throw new b("CREATE_LOCATION_NO_RADIUS_FLOAT");const s=parseInt(r,10);if(r&&!s)throw new b("CREATE_LOCATION_NO_RADIUS");return J().then(()=>{const r=new C(B.getConfig());r.init();return r.createLocation(e,t,n,i,s,o)}).then(e=>E.printOutput(JSON.stringify(e,null,2)))}},{commands:["update","location"],options:[{short:"i",full:"id",required:true,type:"string",description:v("UPDATE_LOCATION.OPT.ID")},{short:"n",full:"name",type:"string",description:v("UPDATE_LOCATION.OPT.NAME")},{full:"latitude",description:v("UPDATE_LOCATION.OPT.LATITUDE")},{full:"longitude",description:v("UPDATE_LOCATION.OPT.LONGITUDE")},{full:"radius",description:v("UPDATE_LOCATION.OPT.RADIUS")},{full:"temperature-scale",type:"string",description:v("UPDATE_LOCATION.OPT.TEMP_SCALE")}],description:v("UPDATE_LOCATION.DESC"),runner:({id:e,name:t,latitude:n,longitude:i,radius:r,"temperature-scale":o})=>{if(r&&V(r.toString()))throw new b("UPDATE_LOCATION_NO_RADIUS_FLOAT");const s=parseInt(r,10);if(r&&!s)throw new b("UPDATE_LOCATION_NO_RADIUS");return J().then(()=>{const r=new C(B.getConfig());r.init();return r.updateLocation(e,t,n,i,s,o)}).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["delete","location"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DELETE_LOCATION.OPT.ID")}],description:v("DELETE_LOCATION.DESC"),runner:({id:e})=>{if(!e)throw new b("DELETE_LOCATION_NO_ID");return J().then(()=>{const t=new C(B.getConfig());t.init();return t.deleteLocation(e)}).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["create","group"],options:[{short:"n",full:"name",required:true,type:"string",description:v("CREATE_GROUP.OPT.NAME")},{full:"parent",type:"string",description:v("CREATE_GROUP.OPT.PARENT")}],description:v("CREATE_GROUP.DESC"),runner:({name:e,parent:t})=>J().then(()=>{const n=new L(B.getConfig());n.init();return n.createGroup(e,t)}).then(e=>E.printOutput(`id: ${e.id}`))},{commands:["list","group"],options:[],description:v("LIST_GROUP.DESC"),runner:()=>J().then(()=>{const e=new L(B.getConfig());e.init();return e.retrieveGroupList()}).then(e=>{const t=u(e,(e,t)=>{if(Array.isArray(e)&&(t==="subgroups"||t==="members"||t==="devices")){return e.join("\n")}return undefined});E.printColumn(t,["id","name","owner","parent","members","devices"])})},{commands:["describe","group"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DESCRIBE_GROUP.OPT.ID")}],description:v("DESCRIBE_GROUP.DESC"),runner:({id:e})=>J().then(()=>{const t=new L(B.getConfig());t.init();return t.retrieveGroup(e)}).then(e=>{const t=`id: ${e.id}\nname: ${e.name}\nowner: ${e.owner}\nparent: ${e.parent||""}\nsubgroup: ${e.subGroups||""}\nmembers: ${e.members||""}\ndevices: ${e.devices||""}`;E.printOutput(t)})},{commands:["update","group"],options:[{short:"i",full:"id",required:true,type:"string",description:v("UPDATE_GROUP.OPT.ID")},{short:"o",full:"operation",required:true,type:"string",description:v("UPDATE_GROUP.OPT.OPERATION")},{full:"devices",type:"array",description:v("UPDATE_GROUP.OPT.DEVICES")},{full:"members",type:"array",description:v("UPDATE_GROUP.OPT.MEMBERS")}],description:v("UPDATE_GROUP.DESC"),runner:({id:e,operation:t,devices:n,members:i})=>J().then(()=>{const r=new L(B.getConfig());r.init();return r.updateGroup(e,t,i,null,n,null)}).then(()=>E.printOutput("Done."))},{commands:["delete","group"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DELETE_GROUP.OPT.ID")}],description:v("DELETE_GROUP.DESC"),runner:({id:e})=>J().then(()=>{const t=new L(B.getConfig());t.init();return t.deleteGroup(e)}).then(()=>E.printOutput("Done."))},{commands:["create","device-profile"],options:[{full:"in",required:true,type:"string",description:v("CREATE_DEVICE_PROFILE.OPT.IN")}],description:v("CREATE_DEVICE_PROFILE.DESC"),runner:({in:e})=>{const t=new I(B.getConfig());return _.exists(e).then(n=>{if(!n){throw new b("CREATE_DEVICE_PROFILE_NO_INPUT")}return _.readJson(e).then(e=>t.createDeviceProfile("capability",e)).then(()=>E.printOutput(v("COMMON.SUCCESS")))})}},{commands:["list","device-profile"],options:[{full:"built-in",type:"boolean",description:v("LIST_DEVICE_PROFILE.OPT.BUILT_IN")},{full:"category",type:"string",description:v("LIST_DEVICE_PROFILE.OPT.CATEGORY")},{full:"type",type:"string",description:v("LIST_DEVICE_PROFILE.OPT.TYPE")}],description:v("LIST_DEVICE_PROFILE.DESC"),runner:e=>{const t=e.type;const n=e.category;const i={builtIn:e["built-in"],type:t,category:n};const r=new I(B.getConfig());return r.retrieveDeviceProfileList(i).then(e=>{if(e.length){E.printColumn(e,["id","name","type","category"])}else{E.printOutput(v("COMMON.EMPTY"))}})}},{commands:["describe","device-profile"],options:[{short:"i",full:"id",type:"string",description:v("DESCRIBE_DEVICE_PROFILE.OPT.ID")},{full:"in",type:"string",description:v("DESCRIBE_DEVICE_PROFILE.OPT.IN")},{full:"resource-model",type:"boolean",description:v("DESCRIBE_DEVICE_PROFILE.OPT.RESOURCE_MODEL")}],description:v("DESCRIBE_DEVICE_PROFILE.DESC"),runner:({id:e,"resource-model":t,in:n})=>{if(e&&n)return r.reject(new b("DESCRIBE_DEVICE_PROFILE_NO_BOTH_OPTION"));const i=new I(B.getConfig());let o;if(e){o=i.retrieveDeviceProfile(e)}else if(n){o=i.retrieveDeviceProfileFromFile(n)}else{o=i.retrieveDeviceProfileInProject(process.cwd())}return o.then(e=>{let n=e;if(t){n=i.convertToResourceModelByDeviceProfile(e)}E.printOutput(JSON.stringify(n,null,2))})}},{commands:["update","device-profile"],options:[{full:"id",required:true,type:"string",description:v("UPDATE_DEVICE_PROFILE.OPT.ID")},{full:"in",required:true,type:"string",description:v("UPDATE_DEVICE_PROFILE.OPT.IN")}],description:v("UPDATE_DEVICE_PROFILE.DESC"),runner:({id:e,in:t})=>{const n=new I(B.getConfig());return _.exists(t).then(i=>{if(!i){throw new b("UPDATE_DEVICE_PROFILE_NO_INPUT")}return _.readJson(t).then(t=>n.updateDeviceProfile(e,t)).then(()=>E.printOutput(v("COMMON.SUCCESS")))})}},{commands:["delete","device-profile"],options:[{full:"id",required:true,type:"string",description:v("DELETE_DEVICE_PROFILE.OPT.ID")}],description:v("DELETE_DEVICE_PROFILE.DESC"),runner:({id:e})=>{const t=new I(B.getConfig());return t.deleteDeviceProfile(e).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["register","c2c-device-profile"],options:[{full:"device-profile",type:"string",description:v("REGISTER_C2C_DEVICE_PROFILE.OPT.DEVICE_PROFILE")},{full:"in",type:"string",description:v("REGISTER_C2C_DEVICE_PROFILE.OPT.IN")}],description:v("REGISTER_C2C_DEVICE_PROFILE.DESC"),runner:({"device-profile":e,in:t})=>{if(!t&&!e)throw new b("NO_DEVICE_PROFILE_OR_IN");const n=new S(B.getConfig());n.init();if(e){return n.registerDeviceProfile(e).then(()=>E.printOutput(v("COMMON.SUCCESS")))}return n.registerDeviceProfileByJsonFile(t).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["list","c2c-device-profile"],options:[],description:v("LIST_C2C_DEVICE_PROFILE.DESC"),runner:()=>{const e=new S(B.getConfig());e.init();return e.retrieveDeviceProfileList().then(e=>{if(e.length){E.printColumn(e,["id","name"])}else{E.printOutput(v("COMMON.SUCCESS"))}})}},{commands:["describe","c2c-device-profile"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DESCRIBE_C2C_DEVICE_PROFILE.OPT.ID")}],description:v("DESCRIBE_C2C_DEVICE_PROFILE.DESC"),runner:({id:e})=>{const t=new S(B.getConfig());t.init();return t.retrieveDeviceProfile(e).then(e=>{E.printOutput(JSON.stringify(e,null,2))})}},{commands:["update","c2c-device-profile"],options:[{short:"i",full:"id",required:true,type:"string",description:v("UPDATE_C2C_DEVICE_PROFILE.OPT.ID")},{full:"device-profile",type:"string",description:v("UPDATE_C2C_DEVICE_PROFILE.OPT.DEVICE_PROFILE")},{full:"in",type:"string",description:v("UPDATE_C2C_DEVICE_PROFILE.OPT.IN")}],description:v("UPDATE_C2C_DEVICE_PROFILE.DESC"),runner:({id:e,"device-profile":t,in:n})=>{if(!n&&!t)throw new b("NO_DEVICE_PROFILE_OR_IN");const i=new S(B.getConfig());i.init();if(t){return i.updateDeviceProfile(e,t).then(()=>E.printOutput(v("COMMON.SUCCESS")))}return i.updateDeviceProfileByJsonFile(e,n).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["delete","c2c-device-profile"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DELETE_C2C_DEVICE_PROFILE.OPT.ID")}],description:v("DELETE_C2C_DEVICE_PROFILE.DESC"),runner:({id:e})=>{const t=new S(B.getConfig());t.init();return t.deleteDeviceProfile(e).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["list","capability"],options:[{full:"main-state",type:"boolean",description:v("LIST_CAPABILITY.OPT.MAIN_STATE")},{full:"main-action",type:"boolean",description:v("LIST_CAPABILITY.OPT.MAIN_ACTION")},{full:"sdk-only",type:"boolean",description:v("LIST_CAPABILITY.OPT.SDK_ONLY")}],description:v("LIST_CAPABILITY.DESC"),runner:({"main-state":e,"main-action":t,"sdk-only":n})=>{const i={mainState:e,mainAction:t,sdkOnly:n};const r=new m(B.getConfig());r.init();return r.retrieveCapabilityList(i).then(e=>E.printColumn(e,["id","version","status","supportedComponents"]))}},{commands:["describe","capability"],options:[{full:"id",short:"i",required:true,type:"string",description:v("DESCRIBE_CAPABILITY.OPT.ID")},{full:"ver",type:"string",description:v("DESCRIBE_CAPABILITY.OPT.VERSION")},{full:"component",type:"string",description:v("DESCRIBE_CAPABILITY.OPT.COMPONENT")},{full:"resource-model",type:"boolean",description:v("DESCRIBE_CAPABILITY.OPT.RESOURCE_MODEL")}],description:v("DESCRIBE_CAPABILITY.DESC"),runner:({id:e,ver:t,component:n,"resource-model":i})=>{if(i){const t=new I(B.getConfig());const i=t.mapCapabilityToResources(e,n);E.printOutput(JSON.stringify(i,null,2));return r.resolve()}const o=new m(B.getConfig());o.init();return o.retrieveCapability(e,t).then(e=>E.printOutput(JSON.stringify(e,null,2)))}},{commands:["list","resource-type"],options:[],description:v("LIST_RESOURCE_TYPE.DESC"),runner:()=>{const e=new D;e.init();return e.retrieveResourceTypeList().then(e=>E.printColumn(e,["id"]))}},{commands:["describe","resource-type"],options:[{short:"i",full:"id",required:true,type:"string",description:v("DESCRIBE_RESOURCE_TYPE.OPT.ID")}],description:v("DESCRIBE_RESOURCE_TYPE.DESC"),runner:({id:e})=>{const t=new D;t.init();return t.retrieveResourceType(e).then(e=>E.printOutput(JSON.stringify(e,null,2)))}},{commands:["list","config"],options:[],description:v("LIST_CONFIG.DESC"),runner:()=>{const e=B.getConfig();const t=w(e);const n=t.map(e=>({key:e,value:B.get(e)}));E.printColumn(n,["key","value"]);return r.resolve()}},{commands:["set","config"],options:[{full:"key",type:"string",description:v("SET_CONFIG.OPT.KEY")},{full:"value",description:v("SET_CONFIG.OPT.VALUE")}],description:v("SET_CONFIG.DESC"),runner:({key:e,value:t,mode:n})=>{B.on("progress",e=>E.printOutput(e));if(n){B.changeMode(n);E.printOutput(v("COMMON.SUCCESS"));return r.resolve()}if(!l.isValidKey(e))throw new b("SET_CONFIG_NO_KEY",e);if(t===true){B.del(e);E.printOutput(v("COMMON.SUCCESS"));return r.resolve()}let i=t;if(t==="false"||t==="true")i=t==="true";if(/^\d+$/.test(t))i=parseInt(t,10);B.set(e,i);E.printOutput(v("COMMON.SUCCESS"));return r.resolve()}},{commands:["get","config"],options:[{full:"key",required:true,type:"string",description:v("GET_CONFIG.OPT.KEY")}],description:v("SET_CONFIG.DESC"),runner:({key:e})=>{const t=B.get(e);if(t===undefined)E.printOutput(v("SET_CONFIG.NO_KEY",e));else E.printOutput(t);return r.resolve()}},{commands:["generate","manifest"],options:[{full:"capability",type:"string",description:v("GENERATE_MANIFEST.OPT.CAPABILITY")},{full:"component",type:"string",description:v("GENERATE_MANIFEST.OPT.COMPONENT")},{full:"in",type:"string",description:v("GENERATE_MANIFEST.OPT.IN")},{full:"device-profile-path",type:"string",description:v("GENERATE_MANIFEST.OPT.DEVICE_PROFILE_PATH")},{full:"out-dir",type:"string",description:v("GENERATE_MANIFEST.OPT.OUT_DIR")},{full:"main-action",type:"string",description:v("GENERATE_MANIFEST.OPT.MAIN_ACTION")},{full:"main-state",type:"string",description:v("GENERATE_MANIFEST.OPT.MAIN_STATE")},{full:"device-plugin",type:"string",description:v("GENERATE_MANIFEST.OPT.DEVICE_PLUGIN")},{full:"vid",type:"string",description:v("GENERATE_MANIFEST.OPT.VID")},{full:"mnid",type:"string",description:v("GENERATE_MANIFEST.OPT.MNID")},{full:"ui-version",type:"string",description:v("GENERATE_MANIFEST.OPT.UI_VERSION")},{full:"voice-version",type:"string",description:v("GENERATE_MANIFEST.OPT.VOICE_VERSION")},{full:"capability-property-map",type:"string",description:v("GENERATE_MANIFEST.OPT.CAPABILITY_PROPERTY_MAP")}],description:v("GENERATE_MANIFEST.DESC"),runner:({capability:e,component:t="main",in:n,"device-profile-path":r,"out-dir":o=".","main-state":s,"main-action":c,"device-plugin":p,mnid:u,vid:l,"ui-version":d,"voice-version":a,"capability-property-map":O})=>{const C=new A(B.getConfig());if(e&&(n||r)){throw new b("ONLY_ONE_OF_CAPABILITY_AND_DEVICE_PROFILE_PATH_REQUIRED")}if(e){const n={capabilityPropertyMap:O?JSON.parse(O):{}};return C.generateUiMetaFromCapability(e,t,n).then(e=>{E.printOutput(JSON.stringify(e,null,2))})}if(r||n){const e=r||n;const t=_.readJsonSync(i.resolve(e));const T={msCapability:s,maCapability:c,devicePlugin:p,mnid:u,vid:l,uiVersion:d,voiceVersion:a,capabilityPropertyMap:O?JSON.parse(O):{}};return C.generateManifestFilesFromDeviceProfile(t,o,T).then(()=>{E.printOutput(v("COMMON.SUCCESS"))})}const T={msCapability:s,maCapability:c,devicePlugin:p,mnid:u,vid:l,uiVersion:d,voiceVersion:a};return C.generateManifestFilesFromProjectPath(T).then(()=>{E.printOutput(v("COMMON.SUCCESS"))})}},{commands:["get","log"],options:[{full:"device",type:"string",description:v("GET_LOG.OPT.DEVICE")},{full:"authcode",type:"string",description:v("GET_LOG.OPT.AUTH_CODE")},{full:"location",type:"array",description:v("GET_LOG.OPT.LOCATION")},{full:"smart-app",type:"array",description:v("GET_LOG.OPT.SMART_APP")},{full:"installed-smart-app",type:"array",description:v("GET_LOG.OPT.INSTALLED_SMART_APP")},{full:"st-device",type:"array",description:v("GET_LOG.OPT.ST_DEVICE")}],description:v("GET_LOG.DESC"),runner:({device:e,authcode:t,location:n,"smart-app":i,"installed-smart-app":o,"st-device":s})=>{if(!(e||n||i||o||s)){return r.reject(new b("NO_OPTIONS"))}if(e&&(n||i||o||s)){return r.reject(new b("MUTUALLY_EXCLUSIVE_OPTIONS"))}if(n&&(e||i||o||s)){return r.reject(new b("MUTUALLY_EXCLUSIVE_OPTIONS"))}if(i&&(n||e||o||s)){return r.reject(new b("MUTUALLY_EXCLUSIVE_OPTIONS"))}if(o&&(n||i||e||s)){return r.reject(new b("MUTUALLY_EXCLUSIVE_OPTIONS"))}if(s&&(n||i||o||e)){return r.reject(new b("MUTUALLY_EXCLUSIVE_OPTIONS"))}if(e){return J().then(()=>{const n=new R(B.getConfig());n.init();if(t){n.observeDeviceStateChangesByAuthCode(e,t,e=>E.printOutput(`${e.time} | ${e.di} | ${e.message}`),true)}else{q("authcode").then(()=>{const t=B.get("authCode");if(!t)throw new b("PUBLISH_DEVICE_NO_TOKEN");return n.observeDeviceStateChangesByAuthCode(e,t,e=>E.printOutput(`${e.time} | ${e.di} | ${e.message}`),true)})}})}if(n||i||o||s){return J().then(()=>{const e=new y(B.getConfig());e.init();e.on("log",(e,t)=>E.printOutput(t));if(n){e.createRealtimeLogs("LOCATIONIDS",n);return}if(i){e.createRealtimeLogs("SMARTAPPIDS",i);return}if(o){e.createRealtimeLogs("INSTALLEDSMARTAPPIDS",o);return}if(s){e.createRealtimeLogs("DEVICEIDS",s)}})}return r.resolve()}},{commands:["request","ppk-crt"],options:[{full:"passwd",required:true,type:"string",description:"Specify generated private key access password"},{full:"distributor-type",type:"string",description:"Specify type of the generated distributor certificate. Can be 'public' or 'partner'. If not specified, default is 'public'"},{full:"common-name",type:"string",description:"Specify common name attribute for generated certificates"},{full:"organizational-unit",type:"string",description:"Specify organizational unit attribute for generated certificates"},{full:"organization",type:"string",description:"Specify organization attribute for generated certificates"},{full:"locality",type:"string",description:"Specify locality attribute for generated certificates"},{full:"state",type:"string",description:"Specify state attribute for generated certificates"},{full:"country",type:"string",description:"Specify country attribute for generated certificates"}],description:"Request certificates for ppk signing.",runner:({passwd:e,"distributor-type":t="public","common-name":n,"organizational-unit":i,organization:o,locality:s,state:c,country:p})=>{if(!h.PASSWORD_REGEX.test(e)){return r.reject(new b("CERT_INVALID_PASSWORD"))}const u=new h(B.getConfig());return J().then(()=>{u.init();return u.createPpkCertPair(e,t,n,i,o,s,c,p).then(()=>E.printOutput(v("COMMON.SUCCESS")))})}},{commands:["request","device-crt"],options:[{full:"device-name",type:"string",required:true,description:"Specify device name for generated certificates"},{full:"access-token",type:"string",description:"Specify access token for generated certificate"},{full:"mnid",type:"string",description:"Specify mnid for generated certificates"},{full:"email",type:"string",description:"Specify email for generated certificates"},{full:"out-dir",type:"string",description:"Specify output for generated certificates"},{full:"common-name",type:"string",description:"Specify common name attribute for generated certificates"},{full:"organizational-unit",type:"string",description:"Specify organizational unit attribute for generated certificates"},{full:"organization",type:"string",description:"Specify organization attribute for generated certificates"},{full:"locality",type:"string",description:"Specify locality attribute for generated certificates"},{full:"state",type:"string",description:"Specify state attribute for generated certificates"},{full:"country",type:"string",description:"Specify country attribute for generated certificates"}],description:"Request certificates for product",runner:({"device-name":e,"access-token":t,mnid:n,email:i,"out-dir":o=".","common-name":s,"organizational-unit":c,organization:p,locality:u,state:l,country:d})=>{const a=t||B.get("accessToken");const O=n||B.get("mnid");const C=i||B.get("email");if(!a)return r.reject(new b("CERT_NO_LOGIN"));if(!O)return r.reject(new b("CERT_NO_LOGIN"));if(!C)return r.reject(new b("CERT_NO_LOGIN"));const T=B.getConfig();T.accessToken=a;const f=new h(T);f.init();return f.createDeviceCertForProduct(O,C,o,e,s,c,p,u,l,d).then(()=>E.printOutput(v("COMMON.SUCCESS")))}},{commands:["set","mnid"],options:[{full:"type",required:true,type:"string",description:v("SET_MNID.OPT.TYPE")}],description:v("SET_MNID.DESC"),runner:({type:e})=>r.resolve().then(()=>B.changeMnidType(e)).then(()=>E.printOutput(v("COMMON.SUCCESS")))}];e.exports={getCommands:()=>{B=l.getDefault();G.setLogLevel(B.get("logLevel"));return Y}}},function(e,t){e.exports=require("electron")},function(e,t){e.exports=require("tmp-promise")},function(e,t){e.exports=require("child-process-es6-promise")},function(e,t){e.exports=require("lodash/cloneDeepWith")},function(e,t){e.exports=require("columnify")},function(e,t){e.exports=require("debug")}]);
//# sourceMappingURL=st.js.map