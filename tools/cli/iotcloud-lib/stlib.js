module.exports=function(e){var t={};function n(i){if(t[i]){return t[i].exports}var r=t[i]={i:i,l:false,exports:{}};e[i].call(r.exports,r,r.exports,n);r.l=true;return r.exports}n.m=e;n.c=t;n.d=function(e,t,i){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:i})}};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=73)}([function(e,t,n){const i=n(14);const r=n(86).decycle;const s=n(12);function o(...e){return e.reduce((e,t)=>{let n=e;if(t instanceof Error||t!==Object(t))n+=e?`, ${t}`:t;else n+=e?`, ${s.EOL+JSON.stringify(r(t),null,2)}`:s.EOL+JSON.stringify(r(t),null,2);return n},"")}function c(e,t){const n={apply(t,n,r){i.trace(`call ${e}:${t.name}(${o(...r)})`);let s;try{s=Reflect.apply(t,n,r)}catch(n){i.error(`${e}:${t.name}() throws ${o(n)}`);throw n}if(s&&s.then){i.trace(`${e}:${t.name}() -> Promise`);s.then(n=>{i.trace(`${e}:${t.name}() is resolved with ${o(n)}`);return n},n=>{i.error(`${e}:${t.name}() is rejected with ${o(n)}`);return n})}else{i.trace(`${e}:${t.name}() -> ${o(s)}`)}return s}};return new Proxy(t,n)}function a(e){return{get(t,n,i){const r=Reflect.get(t,n,i);if(typeof r==="function"){if(!e||e&&e.includes(n)){return c(t.constructor.name,r)}}return r}}}function u(e){return{construct(t,n){const i=Reflect.construct(t,n);const r=new Proxy(i,a(e));return r},get(t,n,i){const r=Reflect.get(t,n,i);if(typeof r==="function"){if(!e||e&&e.includes(n)){return c(t.name,r)}}return r}}}e.exports=u},function(e,t,n){const i=n(12);const{getText:r}=n(25);const s=n(81);function o(e){let t;let n;let i;if(e.length===0){n=null;t="";i=[]}else if(e[e.length-1]instanceof Error){n=e[e.length-1];t=e[0];i=e.slice(1,e.length-1)}else{n=null;t=e[0];i=e.slice(1)}return{key:t,cause:n,argv:i}}class c extends Error{constructor(...e){const{key:t,cause:n,argv:c}=o(e);const a=s.getError(t);if(a){const e=r(a.MSG_KEY,...c);if(n){super(`${e}${i.EOL}Caused by: ${n.message}`)}else{super(e)}this.code=t;this.shortMessage=e}else{throw new Error(`undefined error: ${t}`)}}}e.exports=c},function(e,t,n){const i=n(4);const r=n(32);const s=n(18);function o(e){return Number(e)===e&&e%1===0}function c(e){return Number(e)===e&&e%1!==0}function a(){let e=__dirname;if(!r.existsSync(i.resolve(e,"package.json")))e=i.resolve(e,"..","..");return e}function u(e,t,n,i,r,...s){const o=n?i.get(t):i[r](...s);return o.then(({items:t,_links:n})=>{if(t)t.forEach(t=>e.push(t));if(n&&n.next&&n.next.href){return u(e,n.next.href,true,i,r,...s)}return e})}function l(){const e=["http_proxy","HTTP_PROXY","https_proxy","HTTPS_PROXY","no_proxy","NO_PROXY"];e.forEach(e=>delete process.env[e])}function h(e=10){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";let n="";for(let i=0;i<e;i+=1){const e=Math.floor(Math.random()*t.length);n+=t.substring(e,e+1)}return n}function p(e,t){const n=e.proxy;const i=e[t];const r=i?i.proxy:undefined;const s=r===false?false:r||n;if(s){const e=s.split("://").length>1?s:`http://${s}`;return e}return false}function d(e,t){const n=e[t]||{};n.proxy=p(e,t);return Object.assign({},n)}function E(e,t){const n=Object.keys(e);let i=[];n.forEach(n=>{const r=e[n];const s=t?`${t}.${n}`:`${n}`;if(typeof r==="object"&&r){const e=E(r,s);i=i.concat(e)}else{i.push(s)}});return i.sort()}function _(e){if(!e)return true;const t=/^[a-zA-Z0-9_-]{3,64}$/;if(!t.test(e)){return false}return true}function I(e){if(/^(-|\+)?([0-9]+(\.[0-9]+)?)$/.test(e))return Number(e);return NaN}function f(){const e=i.resolve(a(),"package.json");return s.readJsonSync(e).version}function P(e){return Buffer.from(e).toString("base64")}function T(e){return Buffer.from(e,"base64").toString()}function g(e){const t=/^arn:aws:/;let n=true;e.forEach(e=>{if(!t.test(e)){n=false}});return n}function A(e){const t=/^https?(?=:\/\/)/;return t.test(e)}e.exports={isInt:o,isFloat:c,getRoot:a,getListIterator:u,removeProxyEnv:l,getSmallUuid:h,getProxy:p,getServerConfig:d,getFlatKeys:E,isValidVid:_,filterFloat:I,getLibVersion:f,encodeBase64:P,decodeBase64:T,validLamdaARN:g,validWebhookUrl:A}},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("path")},function(e,t,n){const i=n(32);const r=n(18);const s=n(3).promisify;e.exports={makeDir:s(i.mkdir),readDir:s(i.readdir),readDirSync:i.readdirSync,writeFile:s(i.writeFile),readFile:s(i.readFile),readFileSync:i.readFileSync,existsSync:i.existsSync,deleteFile:s(i.unlink),stat:s(i.stat),statSync:i.statSync,createReadStream:i.createReadStream,exists:s(r.pathExists),readJsonSync:r.readJsonSync,readJson:r.readJson,ensureDir:s(r.ensureDir),writePath:s(r.outputFile),copy:s(r.copy),remove:s(r.remove),removeSync:r.removeSync,renameSync:r.renameSync}},function(e,t){e.exports=require("events")},function(e,t,n){const i=n(4);const r=n(5);const s=n(0);const o=".project.json";class c{static retrieveConfig(e){const t=i.join(e,o);return r.exists(t).then(e=>{if(!e)throw new Error(`Project config file not found... ${t}`);return r.readJson(t)})}static generateConfig(e,t){return c.updateConfig(e,t)}static updateConfig(e,t){const n=JSON.stringify(t,null,2);const s=i.join(e,o);return r.writeFile(s,n)}}c.CONFIG_FILE=o;c.OUT_IOS_DIR="out_iOS";c.SIDELOADING_DIR="sideloading";c.SMART_APP_FILE="smart-app.json";c.CATALOG_FILE="catalog.json";c.APP_CATALOG_FILE="app-catalog.json";c.PROD_CATALOG_FILE="prod-catalog.json";c.DEVICE_PROFILE_FILE="device-profile.json";c.MANIFEST_DIR="manifest";c.UI_MANIFEST_FILE="ui.json";c.VOICE_MANIFEST_FILE="voice.json";c.PLUGIN_DIR="plugin";c.PPKS_DIR="ppks";c.PLUGIN_MANIFEST_FILE="manifest.xml";c.PLUGIN_INDEX_FILE="index.html";c.PLUGIN_ICON_FILE="icon.png";c.PLUGIN_CSS_FILE="index.css";c.PLUGIN_JS_FILE="index.js";c.PLUGIN_CSS_DIR="css";c.PLUGIN_JS_DIR="js";c.PLUGIN_LIB_DIR="lib";c.SCPLUGINAPI_JS_FILE="SCPluginApi.js";c.ANDROID_GENERIC_DEVICE_PLUGIN_URI="plugin://com.samsung.android.plugin.stplugin";c.IOS_GENERIC_DEVICE_PLUGIN_URI="plugin://com.samsung.ios.plugin.stplugin/assets/files/index.html";c.DEFAULT_GENERIC_DEVICE_PLUGIN_URI="wwst://default.plugin";c.SMART_APP_DIR="lambda-app";c.LAMBDA_CONFIG_FILE="lambda.json";c.LAMBDA_PACKAGE_JSON_FILE="package.json";c.DEFAULT_LAMBDA_JS_FILE="index.js";e.exports=new Proxy(c,s())},function(e,t,n){const i=n(3);const r=n(5);const s=n(4);const o=n(2).getRoot;const c=n(26);const a=n(34);const u=n(1);const l=n(0);const h=n(6);const{getLibVersion:p}=n(2);const d={SDK_LOGIN:"/api/sdk-login",SDK_AUTHCODE:"/api/sdk-authcode",SIGN_IN:"/account/session",TEMPLATE:"/template",WORKFLOW:"/ide/api/v2/oic/generic/workflow",UIMANIFEST:"/ide/api/v2/oic/presentation",DELETEUIMANIFEST:"/ide/api/v2/oic/presentation/delete",UPDATEUIMANIFEST:"/ide/api/v2/oic/presentation/update/metadata",VOICEMANIFEST:"/ide/api/v2/oic/voice",DELETEVOICEMANIFEST:"/ide/api/v2/oic/voice/delete",UPDATEVOICEMANIFEST:"/ide/api/v2/oic/voice/update/metadata",AUTHOR_CERTIFICATE:"/ide/api/v2/csr/authors",DISTRIBUTOR_CERTIFICATE:"/ide/api/v2/csr/distributors",DEVICE_CERTIFICATE:"/ide/api/v2/csr/device",CLOUD_CONNECTED_PROJECT:"/api/sdk/v1/cloud-connected/projects",AUTOMATION_PROJECT:"/api/sdk/v1/automation/projects",SERVICE_PLUGIN_PROJECT:"/api/sdk/v1/service-plugin/projects",PLUGIN:"/api/sdk/v1/common/plugins",LOGIN_DONE:"/api/sdk/v1/auth/login-done",AUTHENTICATION_STATUS:"/ide/api/v3/authentication/status"};const E={GET:1,POST:2,PUT:3,DELETE:4};const _=s.join(o(),"assets","templates","local_list.json");function I(e,t){const n={payload:{}};if(t.startsWith(d.TEMPLATE)){if(t.length>d.TEMPLATE.length){return r.readFile(_).then(e=>{const r=t.split("/");const c=r[r.length-1];const a=JSON.parse(e).templates;const l=a.filter(e=>e.id===c);if(!l||l.length===0)return i.reject(new u("CANNOT_FIND_TEMPLATE"));l[0].templatePath=s.join(o(),"assets",l[0].path);n.payload.values=l[0];return n})}return r.readFile(_).then(e=>{n.payload.values=JSON.parse(e);return n})}return i.resolve(n)}function f(e){let t;const n=e?e.error:e;if(n){if(n.resultMsg){t=n.resultMsg;if(n.resultDetail){t+=`\n${JSON.stringify(n.resultDetail,null,2)}`}}else if(n.status&&n.error){t=`${n.status} ${n.error}`}else{try{t=JSON.parse(n).resultMsg}catch(e){t=n}}}return t}class P extends h{constructor(e,t){super();const{accessToken:n,userId:i,mnid:r,email:s}=e;const{uri:o,proxy:a,rejectUnauthorized:u}=t;this.accessToken=n;this.userId=i;this.email=s;this.mnid=r;this.requestManager=new c(o,a,u);this.requestManager.on("debug",e=>this.emit("debug",e));this.isInit=false}init(){this.isInit=true}finish(){this.isInit=false}getTemplateList(){if(!this.isInit){this.init()}const e=`${d.TEMPLATE}`;return I(E.GET,e)}getTemplate(e){if(!this.isInit){this.init()}const t=`${d.TEMPLATE}/${e}`;return I(E.GET,t)}getHeader(){return{Authorization:this.accessToken,"X-IOT-UID":this.userId,"X-IOT-MNID":this.mnid}}getManifestList(e,t,n,i){const r=c.METHODS.GET;const s={workflowid:e,workflowtype:t,status:n,ownerId:i};const o=this.getHeader();return this.requestManager.request(r,d.WORKFLOW,s,o)}getManifest(e,t,n,i){const r=c.METHODS.GET;const s={mnmn:e,vid:t,version:n};const o=this.getHeader();const a=i==="ui"||i==="presentation"?d.UIMANIFEST:d.VOICEMANIFEST;return this.requestManager.request(r,a,s,o)}deleteManifest(e,t){const n=c.METHODS.DELETE;const i={workflowId:e};const r=this.getHeader();const s=t==="ui"||t==="presentation"?d.DELETEUIMANIFEST:d.DELETEVOICEMANIFEST;return this.requestManager.request(n,s,i,r)}createManifest(e,t){const n=c.METHODS.POST;const i=this.getHeader();const r=t==="ui"||t==="presentation"?d.UIMANIFEST:d.VOICEMANIFEST;return this.requestManager.request(n,r,null,i,e)}updateManifest(e,t,n){const i=c.METHODS.PUT;const r={workflowId:e,type:n};const s=this.getHeader();const o=n==="ui"||n==="presentation"?d.UPDATEUIMANIFEST:d.UPDATEVOICEMANIFEST;return this.requestManager.request(i,o,r,s,t)}getDeviceCertificate(e,t="OCF Dev Device",n,i){const r=c.METHODS.POST;const s={Authorization:this.getHeader().Authorization};const o=d.DEVICE_CERTIFICATE;const l=e.split(/\r\n|\r|\n/);const h=l.slice(1,l.length-3).join("");const p={csr:h,deviceName:t,email:n||this.email,mnid:i||this.mnid,purpose:"Test",uuid:a()};return this.requestManager.request(r,o,null,s,p).catch(e=>{throw new u("IOT_CONSOLE_DEVICE_CRT_API_FAILED",f(e)||e)})}getAuthorCertificate(e){const t=c.METHODS.POST;const n={Authorization:this.getHeader().Authorization};const i=d.AUTHOR_CERTIFICATE;const r={userId:this.userId,platform:"PPK"};const s=e.split(/\r\n|\r|\n/);const o=s.slice(1,s.length-3).join("");return this.requestManager.request(t,i,r,n,o,false,{json:false}).then(e=>JSON.parse(e)).catch(e=>{throw new u("IOT_CONSOLE_PPK_AUTH_CRT_API_FAILED",f(e)||e)})}getDistributorCertificate(e,t="public"){const n=c.METHODS.POST;const i={Authorization:this.getHeader().Authorization};const r=d.DISTRIBUTOR_CERTIFICATE;const s=t==="public"?"Public":"Partner";const o={userId:this.userId,platform:"PPK",privilegeLevel:s};const a=e.split(/\r\n|\r|\n/);const l=a.slice(1,a.length-3).join("");return this.requestManager.request(n,r,o,i,l,false,{json:false}).then(e=>JSON.parse(e)).catch(e=>{throw new u("IOT_CONSOLE_PPK_DIST_CRT_API_FAILED",f(e)||e)})}requestProject(e,t,n,i,r){return this.requestManager.request(e,t,n,{Authorization:this.getHeader().Authorization},i,false,r).catch(e=>{throw new u("IOT_CONSOLE_PRJ_API_FAILED",f(e)||e)})}postServicePluginProject(e){return this.requestProject(c.METHODS.POST,d.SERVICE_PLUGIN_PROJECT,null,e,{json:true})}postServicePluginSelfPublish(e){return this.requestProject(c.METHODS.POST,`${d.SERVICE_PLUGIN_PROJECT}/${e}/selfpublish`,null,null,{json:true})}postServicePluginUnpublish(e){return this.requestProject(c.METHODS.POST,`${d.SERVICE_PLUGIN_PROJECT}/${e}/unpublish`,null,null,{json:true})}getServicePluginProjectList(e,t){return this.requestProject(c.METHODS.GET,d.SERVICE_PLUGIN_PROJECT,{pageSize:e,pageNum:t})}getServicePluginProject(e){return this.requestProject(c.METHODS.GET,`${d.SERVICE_PLUGIN_PROJECT}/${e}`,null)}putServicePluginProject(e,t){return this.requestProject(c.METHODS.PUT,`${d.SERVICE_PLUGIN_PROJECT}/${e}`,null,t,{json:true})}deleteServicePluginProject(e){return this.requestProject(c.METHODS.DELETE,`${d.SERVICE_PLUGIN_PROJECT}/${e}`,null)}postCloudConnectedProject(e){return this.requestProject(c.METHODS.POST,d.CLOUD_CONNECTED_PROJECT,null,e,{json:true})}postCloudConnectedPpkFile(e,t){const n={ppkFile:{value:r.createReadStream(t),options:{filename:s.basename(t),contentType:"application/x-binary"}}};return this.requestProject(c.METHODS.POST,`${d.CLOUD_CONNECTED_PROJECT}/${e}/ppkfile`,null,null,{json:true,formData:n})}postCloudConnectedSelfPublish(e){return this.requestProject(c.METHODS.POST,`${d.CLOUD_CONNECTED_PROJECT}/${e}/selfpublish`,null,null,{json:true})}postCloudConnectedUnpublish(e){return this.requestProject(c.METHODS.POST,`${d.CLOUD_CONNECTED_PROJECT}/${e}/unpublish`,null,null,{json:true})}getCloudConnectedProjectList(e,t){return this.requestProject(c.METHODS.GET,d.CLOUD_CONNECTED_PROJECT,{pageSize:e,pageNum:t})}getCloudConnectedProject(e){return this.requestProject(c.METHODS.GET,`${d.CLOUD_CONNECTED_PROJECT}/${e}`,null)}putCloudConnectedProject(e,t){return this.requestProject(c.METHODS.PUT,`${d.CLOUD_CONNECTED_PROJECT}/${e}`,null,t,{json:true})}deleteCloudConnectedProject(e){return this.requestProject(c.METHODS.DELETE,`${d.CLOUD_CONNECTED_PROJECT}/${e}`,null)}postAutomationProject(e){return this.requestProject(c.METHODS.POST,d.AUTOMATION_PROJECT,null,e,{json:true})}postAutomationSelfPublish(e){return this.requestProject(c.METHODS.POST,`${d.AUTOMATION_PROJECT}/${e}/selfpublish`,null,null,{json:true})}postAutomationUnpublish(e){return this.requestProject(c.METHODS.POST,`${d.AUTOMATION_PROJECT}/${e}/unpublish`,null,null,{json:true})}getAutomationProjectList(e,t){return this.requestProject(c.METHODS.GET,d.AUTOMATION_PROJECT,{pageSize:e,pageNum:t})}getAutomationProject(e){return this.requestProject(c.METHODS.GET,`${d.AUTOMATION_PROJECT}/${e}`,null)}putAutomationProject(e,t){return this.requestProject(c.METHODS.PUT,`${d.AUTOMATION_PROJECT}/${e}`,null,t,{json:true})}deleteAutomationProject(e){return this.requestProject(c.METHODS.DELETE,`${d.AUTOMATION_PROJECT}/${e}`,null)}requestAuthentication(e,t,n,i,r){return this.requestManager.request(e,t,n,{Authorization:this.getHeader().Authorization,"X-SDK-VER":p()},i,false,r).catch(e=>{throw new u("IOT_CONSOLE_AUTH_API_FAILED",f(e)||e)})}getLoginDone(e){return this.requestAuthentication(c.METHODS.GET,d.LOGIN_DONE,{state:e})}getAuthenticationStatus(){return this.requestAuthentication(c.METHODS.GET,d.AUTHENTICATION_STATUS,null)}getAuthentication(e,t,n){const i=c.METHODS.POST;const r=null;const s={"X-SDK-VER":p()};const o={deviceId:n};if(e)o.ssoToken=e;if(t)o.authCode=t;return this.requestManager.request(i,d.SDK_LOGIN,r,s,o).catch(e=>{throw new u("IOT_CONSOLE_SDK_LOGIN_API_FAILED",f(e)||e)})}getAuthCodeBySsoToken(e,t){const n=c.METHODS.POST;const i=null;const r={"X-SDK-VER":p()};const s={ssoToken:e,deviceId:t};return this.requestManager.request(n,d.SDK_AUTHCODE,i,r,s).catch(e=>{throw new u("IOT_CONSOLE_SDK_AUTHCODE_API_FAILED",f(e)||e)})}createPlugin(e,t,n){const i={ppkFile:{value:r.createReadStream(e),options:{filename:s.basename(e),contentType:"application/x-binary"}},plgnType:t,devStatCd:n};const o=c.METHODS.POST;const a={Authorization:this.getHeader().Authorization};return this.requestManager.request(o,d.PLUGIN,null,a,null,false,{json:true,formData:i}).catch(e=>{throw new u("IOT_CONSOLE_PLUGIN_API_FAILED",f(e)||e)})}removePlugin(e){const t=c.METHODS.DELETE;const n={Authorization:this.getHeader().Authorization};return this.requestManager.request(t,`${d.PLUGIN}/${e}`,null,n).catch(e=>{throw new u("IOT_CONSOLE_PLUGIN_API_FAILED",f(e)||e)})}getPluginList(e,t,n){const i=c.METHODS.GET;const r={pkgNm:e,plgnType:t,devStatCd:n};const s={Authorization:this.getHeader().Authorization};return this.requestManager.request(i,d.PLUGIN,r,s).catch(e=>{throw new u("IOT_CONSOLE_PLUGIN_API_FAILED",f(e)||e)})}getPlugin(e){const t=c.METHODS.GET;const n={Authorization:this.getHeader().Authorization};return this.requestManager.request(t,`${d.PLUGIN}/${e}`,null,n).catch(e=>{throw new u("IOT_CONSOLE_PLUGIN_API_FAILED",f(e)||e)})}}e.exports=new Proxy(P,l())},function(e,t){const n=Object.freeze({OCF:"ocf",AUTOMATION:"automation",C2C:"c2c",SERVICE:"service"});function i(e){return e===n.OCF||e===n.AUTOMATION||e===n.C2C||e===n.SERVICE}class r{constructor(e,t,n,i){this.name=e;this.type=t;this.outputPath="out";if(n)this.endpointApp=n;if(i)this.lambda=i}}r.PROJ_TYPE=n;r.isValidProjectType=i;e.exports=r},function(e,t){e.exports=require("lodash/cloneDeep")},function(e,t,n){const i=n(26);const r=n(1);const s=n(0);const o={APPS:"/apps",OAUTH:"/oauth",INSTALLED_APPS:"/installedapps",DEVICES:"/devices",CONFIGS:"/configs",SETTINGS:"/settings",LOCATIONS:"/locations",SUBSCRIPTIONS:"/subscriptions",SCHEDULES:"/schedules",DEVICE_PROFILES:"/deviceprofiles",CLIENT_SUBSCRIPTION:"/subscriptions",CAPABILITY:"/capabilities"};const c={400:"BAD_REQUEST",401:"NOT_AUTHENTICATED",403:"NOT_AUTHORIZED",404:"NOT_FOUND",422:"UNPROCESSABLE_ENTITY",429:"TOO_MANY_REQUESTS"};function a(e){const t=e;if(t&&t.statusCode&&c[t.statusCode]){if(t.error&&t.error.error&&t.error.error.details){let e="";t.error.error.details.forEach(t=>{if(t.message)e+=`${t.message} `});throw new r(c[t.statusCode],e)}throw new r(c[t.statusCode])}throw t}class u{constructor(e,t){this.accessToken=e;const{uri:n,proxy:r,rejectUnauthorized:s}=t;this.requestManager=new i(n,r,s)}getHeaders(){return{authorization:`Bearer ${this.accessToken}`}}get(e){const t=i.METHODS.GET;const n=this.getHeaders();return this.requestManager.request(t,e,null,n,null,true).catch(e=>a(e))}createApp(e){const t=i.METHODS.POST;const n=this.getHeaders();return this.requestManager.request(t,o.APPS,null,n,e).catch(e=>a(e))}getAppList(e){const t=i.METHODS.GET;const n={appType:e};const r=this.getHeaders();return this.requestManager.request(t,o.APPS,n,r).catch(e=>a(e))}getApp(e){const t=i.METHODS.GET;const n=`${o.APPS}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}updateApp(e,t){const n=i.METHODS.PUT;const r=`${o.APPS}/${e}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}deleteApp(e){const t=i.METHODS.DELETE;const n=`${o.APPS}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getAppSettings(e){const t=i.METHODS.GET;const n=`${o.APPS}/${e}${o.SETTINGS}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}updateAppSettings(e,t){const n=i.METHODS.PUT;const r=`${o.APPS}/${e}${o.SETTINGS}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}getAppOauth(e){const t=i.METHODS.GET;const n=`${o.APPS}/${e}${o.OAUTH}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}updateAppOauth(e,t){const n=i.METHODS.PUT;const r=`${o.APPS}/${e}${o.OAUTH}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}createAppOauth(e,t,n){const r=i.METHODS.POST;const s=`${o.APPS}/${e}${o.OAUTH}/generate`;const c={clientName:t,scope:n};const u=this.getHeaders();return this.requestManager.request(r,s,null,u,c).catch(e=>a(e))}createInstalledApp(e){const t=i.METHODS.POST;const n=this.getHeaders();return this.requestManager.request(t,o.INSTALLED_APPS,null,n,e).catch(e=>a(e))}getInstalledAppList(e,t){const n=i.METHODS.GET;const r={locationId:e};const s=this.getHeaders();if(t)r.installedAppStatus=t;return this.requestManager.request(n,o.INSTALLED_APPS,r,s).catch(e=>a(e))}getInstalledApp(e){const t=i.METHODS.GET;const n=`${o.INSTALLED_APPS}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}updateInstalledApp(e,t,n){const r=i.METHODS.PUT;const s=`${o.INSTALLED_APPS}/${e}`;const c=t?{locationId:t}:"";const u=this.getHeaders();return this.requestManager.request(r,s,c,u,n).catch(e=>a(e))}deleteInstalledApp(e){const t=i.METHODS.DELETE;const n=`${o.INSTALLED_APPS}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getInstalledAppConfigList(e,t,n){const r=i.METHODS.GET;const s=`${o.INSTALLED_APPS}/${e}${o.CONFIGS}`;const c=this.getHeaders();let u=t?{locationId:t}:"";if(n){if(!u)u={};u.configurationStatus=n}return this.requestManager.request(r,s,u,c).catch(e=>a(e))}updateInstalledAppConfig(e,t,n){const r=i.METHODS.PUT;const s=`${o.INSTALLED_APPS}/${e}${o.CONFIGS}`;const c={locationId:t};const u=this.getHeaders();return this.requestManager.request(r,s,c,u,n).catch(e=>a(e))}getInstalledAppConfig(e,t){const n=i.METHODS.GET;const r=`${o.INSTALLED_APPS}/${e}${o.CONFIGS}/${t}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s).catch(e=>a(e))}patchInstalledAppConfig(e,t,n,r){const s=i.METHODS.PATCH;const c=`${o.INSTALLED_APPS}/${e}${o.CONFIGS}/${n}`;const u={locationId:t};const l=this.getHeaders();return this.requestManager.request(s,c,u,l,r).catch(e=>a(e))}updateInstalledAppConfigDone(e,t,n){const r=i.METHODS.POST;const s=`${o.INSTALLED_APPS}/${e}${o.CONFIGS}/${t}/done`;const c=n?{locationId:n}:"";const u=this.getHeaders();return this.requestManager.request(r,s,c,u).catch(e=>a(e))}getLocationList(e=o.LOCATIONS){const t=i.METHODS.GET;const n=this.getHeaders();return this.requestManager.request(t,e,null,n).catch(e=>a(e))}getLocation(e){const t=i.METHODS.GET;const n=`${o.LOCATIONS}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}createLocation(e){const t=i.METHODS.POST;const n=this.getHeaders();return this.requestManager.request(t,o.LOCATIONS,null,n,e).catch(e=>a(e))}updateLocation(e,t){const n=i.METHODS.PUT;const r=`${o.LOCATIONS}/${e}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}deleteLocation(e){const t=i.METHODS.DELETE;const n=`${o.LOCATIONS}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getSubscriptionList(e){const t=i.METHODS.GET;const n=`${o.INSTALLED_APPS}/${e}${o.SUBSCRIPTIONS}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}createSubscription(e,t){const n=i.METHODS.POST;const r=`${o.INSTALLED_APPS}/${e}${o.SUBSCRIPTIONS}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}deleteAllSubscription(e){const t=i.METHODS.DELETE;const n=`${o.INSTALLED_APPS}/${e}${o.SUBSCRIPTIONS}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getSubscription(e,t){const n=i.METHODS.GET;const r=`${o.INSTALLED_APPS}/${e}${o.SUBSCRIPTIONS}/${t}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s).catch(e=>a(e))}deleteSubscription(e,t){const n=i.METHODS.DELETE;const r=`${o.INSTALLED_APPS}/${e}${o.SUBSCRIPTIONS}/${t}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s).catch(e=>a(e))}getScheduleList(e){const t=i.METHODS.GET;const n=`${o.INSTALLED_APPS}/${e}${o.SCHEDULES}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}createSchedule(e,t){const n=i.METHODS.POST;const r=`${o.INSTALLED_APPS}/${e}${o.SCHEDULES}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}deleteAllSchedule(e){const t=i.METHODS.DELETE;const n=`${o.INSTALLED_APPS}/${e}${o.SCHEDULES}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getSchedule(e,t){const n=i.METHODS.GET;const r=`${o.INSTALLED_APPS}/${e}${o.SCHEDULES}/${t}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s).catch(e=>a(e))}deleteSchedule(e,t){const n=i.METHODS.DELETE;const r=`${o.INSTALLED_APPS}/${e}${o.SCHEDULES}/${t}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s).catch(e=>a(e))}getDeviceList(){const e=i.METHODS.GET;const t=this.getHeaders();return this.requestManager.request(e,o.DEVICES,null,t).catch(e=>a(e))}getDevice(e){const t=i.METHODS.GET;const n=`${o.DEVICES}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getDeviceComponentList(e){const t=i.METHODS.GET;const n=`${o.DEVICES}/${e}/components`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getDeviceComponentStatus(e,t){const n=i.METHODS.GET;const r=`${o.DEVICES}/${e}/components/${t}/states`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s).catch(e=>a(e))}deleteDevice(e){const t=i.METHODS.DELETE;const n=`${o.DEVICES}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}commandDevice(e,t){const n=i.METHODS.POST;const r=`${o.DEVICES}/${e}/commands`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}createDeviceProfile(e){const t=i.METHODS.POST;const n=this.getHeaders();return this.requestManager.request(t,o.DEVICE_PROFILES,null,n,e).catch(e=>a(e))}getDeviceProfileList(){const e=i.METHODS.GET;const t=this.getHeaders();return this.requestManager.request(e,o.DEVICE_PROFILES,null,t).catch(e=>a(e))}getDeviceProfile(e){const t=i.METHODS.GET;const n=`${o.DEVICE_PROFILES}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}updateDeviceProfile(e,t){const n=i.METHODS.PUT;const r=`${o.DEVICE_PROFILES}/${e}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s,t).catch(e=>a(e))}deleteDeviceProfile(e){const t=i.METHODS.DELETE;const n=`${o.DEVICE_PROFILES}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}createClientSubscription(e,t){const n=i.METHODS.POST;const r=o.CLIENT_SUBSCRIPTION;const s=this.getHeaders();s.Accept="application/vnd.smartthings+json;v=20180705";s["Content-Type"]="application/json";const c={version:20180705,subscriptionFilters:[{type:e,value:t}]};return this.requestManager.request(n,r,null,s,c).catch(e=>a(e))}getCapability(e,t){const n=i.METHODS.GET;const r=`${o.CAPABILITY}/${e}/${t}`;const s=this.getHeaders();return this.requestManager.request(n,r,null,s).catch(e=>a(e))}getCapabilityVersionList(e){const t=i.METHODS.GET;const n=`${o.CAPABILITY}/${e}`;const r=this.getHeaders();return this.requestManager.request(t,n,null,r).catch(e=>a(e))}getCapabilityList(){const e=i.METHODS.GET;const t=o.CAPABILITY;const n=this.getHeaders();return this.requestManager.request(e,t,null,n).catch(e=>a(e))}}e.exports=new Proxy(u,s())},function(e,t){e.exports=require("os")},function(e,t,n){const i=n(1);const r=Object.freeze({LAMBDA:"LAMBDA_SMART_APP",WEBHOOK:"WEBHOOK_SMART_APP",BEHAVIOR:"BEHAVIOR"});function s(e){return e===r.LAMBDA||e===r.WEBHOOK||e===r.BEHAVIOR}class o{constructor({appName:e,appId:t,appType:n,displayName:s,description:o,singleInstance:c=false,owner:a,createdDate:u,lastUpdatedDate:l,lambdaSmartApp:h,webhookSmartApp:p,behavior:d,impl:E,ui:_,oauth:I}){this.appName=e;this.appId=t;this.appType=n;switch(this.appType){case r.LAMBDA:this.lambdaSmartApp=h||E;break;case r.WEBHOOK:this.webhookSmartApp=p||E;break;case r.BEHAVIOR:this.behavior=d||E;break;default:throw new i("INVALID_APP_TYPE",this.appType)}this.displayName=s;this.description=o;this.singleInstance=c;this.owner=a;this.createdDate=u;this.lastUpdatedDate=l;if(_){this.ui=_}if(I){this.oauth=I}else{this.oauth={clientName:"none",scope:[]}}}static createFromIotConsoleResp(e){const t=new o({appName:e.appNm,appId:e.appRefUuId,appType:e.appTypeCd==="SAT-LAMBDA"?r.LAMBDA:r.WEBHOOK,displayName:"",description:e.appDsc,singleInstance:e.multInstanceTypeCd!=="SAM-MULTI",owner:{ownerId:e.ownrId}});if(e.appScopeList){t.oauth={scope:e.appScopeList.map(e=>e.scopeNm)}}if(t.appType===r.LAMBDA){t.lambdaSmartApp={functions:e.tgtArnList.map(e=>e.tgtArn)}}else if(t.appType===r.WEBHOOK){t.webhookSmartApp={targetUrl:e.rgtUrl}}return t}toRequestBody(){const e={appName:this.appName,appType:this.appType};switch(this.appType){case r.LAMBDA:e.lambdaSmartApp=this.lambdaSmartApp;break;case r.WEBHOOK:e.webhookSmartApp=this.webhookSmartApp;break;case r.BEHAVIOR:e.behavior=this.behavior;break;default:}if(this.displayName!==undefined)e.displayName=this.displayName;if(this.description!==undefined)e.description=this.description;if(this.singleInstance!==undefined)e.singleInstance=this.singleInstance;return e}updateImpl(e){switch(this.appType){case r.LAMBDA:this.lambdaSmartApp=e;break;case r.WEBHOOK:this.webhookSmartApp=e;break;case r.BEHAVIOR:this.behavior=e;break;default:throw new i("INVALID_APP_TYPE",this.appType)}}toCreateRequestBodyIotConsole(){const e=this.singleInstance?"SAM-SINGLE":"SAM-MULTI";let t=null;let n=null;let i=null;if(this.appType===o.APP_TYPE.LAMBDA){t="SAT-LAMBDA";n=(this.lambdaSmartApp?this.lambdaSmartApp.functions:[]).map(e=>({tgtArn:e}))}else if(this.appType===o.APP_TYPE.WEBHOOK){t="SAT-WEBHOOK";i=this.webhookSmartApp?this.tgtUrl.targetUrl:""}const r={refAppId:this.appId,appNm:this.appName,appDsc:this.description,appTypeCd:t,multInstanceTypeCd:e,tgtArnList:n,tgtUrl:i,appScopeList:this.oauth.scope.map(e=>({scopeNm:e})),ownerId:this.owner.ownerId,publicKey:""};return r}toUpdateRequestBodyIotConsole(){return this.toCreateRequestBodyIotConsole()}}o.APP_TYPE=r;o.isValidAppType=s;e.exports=o},function(e,t,n){const i=n(12);const r=n(4);const s=n(32);const o=n(84);const c=n(85).SourceMapConsumer;const a={};const u="INFO";const l=["ALL","TRACE","DEBUG","INFO","WARN","ERROR","FATAL","OFF"];function h(e){return l.includes(e)}function p(e,t=2){const n=e.split(/[\r\n]+/)[t].trim().replace(/.*\(/,"").replace(/\).*/,"");const i=n.split(":");return{file:i[i.length-3],line:i[i.length-2],column:i[i.length-1]}}function d(e){const t=a[`${e.file}.map`]||new c(s.readFileSync(`${e.file}.map`,"utf8"));const n=t.originalPositionFor({line:parseInt(e.line,10),column:parseInt(e.column,10)});return n}function E(e){const t=`src${r.sep}`;const n=e.indexOf(t);if(n!==-1){return e.substring(n+t.length)}return e}function _(e){try{const t=p(e);if(!s.existsSync(`${t.file}.map`)){return`${E(t.file)}:${t.line}`}const n=d(t);return`${E(n.source)}:${n.line}`}catch(e){return e.message}}const I={appenders:{logfile:{type:"file",maxLogSize:1048576,filename:r.resolve(i.homedir(),".iotcloud/cli/log/cli.log"),layout:{type:"pattern",pattern:"%d %p %m"}}},categories:{default:{appenders:["logfile"],level:"info"}}};o.configure(I);class f{constructor(e=u){this.logLevel=h(e)?e:u;this.logger=o.getLogger();this.logger.level=this.logLevel}reconfigure(e){o.configure(e);this.logger=o.getLogger();this.logger.level=this.logLevel}setLogLevel(e){this.logLevel=h(e)?e:u;this.logger.level=this.logLevel;return this}}function P(e){const t=e.toLowerCase();f.prototype[t]=function n(...i){if(this.logger.isLevelEnabled(e)){const e=_((new Error).stack);const n=i;n[0]=`${e} - ${i[0]}`;this.logger[t](...n)}}}l.forEach(P);e.exports=new f},function(e,t,n){const i=n(27);const{getRoot:r}=n(2);const s=n(4);const o=n(5);const c=n(3);const a=n(8);const{getServerConfig:u,decodeBase64:l}=n(2);const h=n(34);const p=n(1);const d=n(91);const E=n(0);const _=s.resolve(r(),"assets/external_jars/CSRGenerator.jar");const I=s.resolve(r(),"assets/external_jars/DecryptPri.jar");class f{constructor(e){this.config=e;this.securityProfilesPath=s.resolve(l(e.securityPath),"security_profiles")}init(e){this.agent=e||new a(this.config,u(this.config,"iotConsole"))}getSecurityProfilesPath(){return this.securityProfilesPath}clearSecurityProfile(){const{userId:e,mnid:t}=this.config;const n=s.resolve(this.securityProfilesPath,`${e}${t}`);return o.remove(n)}createPpkCsrPair(e,t="public",n,r,a,u,l,h){if(!e)return c.reject(new p("CERT_NO_PASSWORD"));if(!f.PASSWORD_REGEX.test(e)){return c.reject(new p("CERT_INVALID_PASSWORD"))}const{userId:d,mnid:E,email:I}=this.config;const P=s.resolve(this.securityProfilesPath,`${d}${E}`);return c.resolve().then(()=>o.ensureDir(P)).then(()=>{const s=["-jar","-Dfile.encoding=UTF-8",_,"-t","ppk","-p",e,"-o",P,"-e",I,"-m",E,"-r",t];if(n)s.push("-n",n);if(r)s.push("-u",r);if(a)s.push("-g",a);if(u)s.push("-l",u);if(l)s.push("-s",l);if(h)s.push("-c",h);return i.spawn("java",s).catch(e=>{throw new Error(e.stderr)})})}createPpkCertPair(e,t="public",n,i,r,a,u,l){if(!e)return c.reject(new p("CERT_NO_PASSWORD"));if(!f.PASSWORD_REGEX.test(e)){return c.reject(new p("CERT_INVALID_PASSWORD"))}if(t!=="public"&&t!=="partner"){return c.reject(new p("CERT_INVALID_DISTRIBUTOR"))}const{userId:h,mnid:d}=this.config;return this.createPpkCsrPair(e,t,n,i,r,a,u,l).then(()=>{const e=s.resolve(this.securityProfilesPath,`${h}${d}`);const n=s.resolve(e,"author.csr");const i=s.resolve(e,"distributor.csr");const r=s.resolve(e,"author.crt");const a=s.resolve(e,"distributor.crt");return c.resolve().then(()=>o.readFile(n)).then(e=>this.agent.getAuthorCertificate(e.toString())).then(({certificate:e})=>o.writeFile(r,e)).then(()=>o.readFile(i)).then(e=>this.agent.getDistributorCertificate(e.toString(),t)).then(({certificate:e})=>o.writeFile(a,e)).then(()=>o.deleteFile(n)).then(()=>o.deleteFile(i))})}createDeviceCsr(e,t,n,r,a,u){const{userId:l,mnid:p,email:d}=this.config;const E=s.resolve(this.securityProfilesPath,`${l}${p}`);return c.resolve().then(()=>o.ensureDir(E)).then(()=>{const s=["-jar","-Dfile.encoding=UTF-8",_,"-t","device","-o",E,"-e",d,"-m",p,"-d",h()];if(e)s.push("-n",e);if(t)s.push("-u",t);if(n)s.push("-g",n);if(r)s.push("-l",r);if(a)s.push("-s",a);if(u)s.push("-c",u);return i.spawn("java",s).catch(e=>{throw new Error(e.stderr)})})}static createDeviceCsrForProduct(e,t,n,r,s,a,u,l,p){return c.resolve().then(()=>o.ensureDir(n)).then(()=>{const o=["-jar","-Dfile.encoding=UTF-8",_,"-t","device","-o",n,"-e",t,"-m",e,"-d",h()];if(r)o.push("-n",r);if(s)o.push("-u",s);if(a)o.push("-g",a);if(u)o.push("-l",u);if(l)o.push("-s",l);if(p)o.push("-c",p);return i.spawn("java",o).catch(e=>{throw new Error(e.stderr)})})}createDeviceCertForProduct(e,t,n,i,r,a,u,l,h,p){return f.createDeviceCsrForProduct(e,t,n,r,a,u,l,h,p).then(()=>{const r=s.resolve(n,"device.csr");const a=s.resolve(n,"device.crt");return c.resolve().then(()=>o.readFile(r)).then(n=>this.agent.getDeviceCertificate(n.toString(),i,t,e)).then(({certificate:e})=>o.writeFile(a,e)).then(()=>o.deleteFile(r))})}createDeviceCert(e,t,n,i,r,a){const{userId:u,mnid:l}=this.config;return this.createDeviceCsr(e,t,n,i,r,a).then(()=>{const e=s.resolve(this.securityProfilesPath,`${u}${l}`);const t=s.resolve(e,"device.csr");const n=s.resolve(e,"device.crt");return c.resolve().then(()=>o.readFile(t)).then(e=>this.agent.getDeviceCertificate(e.toString())).then(({certificate:e})=>o.writeFile(n,e)).then(()=>o.deleteFile(t))})}static checkKeyCert(e,t){return o.exists(t).then(t=>{if(!t)throw new p("CERT_NO_KEY",e);return o.exists(e)}).then(e=>{if(!e)throw new p("CERT_NO_CERT",t)})}checkPpkKeyCert(){const{userId:e,mnid:t}=this.config;const n=s.resolve(this.securityProfilesPath,`${e}${t}`,"author.pri");const i=s.resolve(this.securityProfilesPath,`${e}${t}`,"author.crt");const r=s.resolve(this.securityProfilesPath,`${e}${t}`,"distributor.pri");const c=s.resolve(this.securityProfilesPath,`${e}${t}`,"distributor.crt");return o.exists(n).then(e=>{if(!e)throw new p("CERT_NO_AUTHOR_KEY");return o.exists(i)}).then(e=>{if(!e)throw new p("CERT_NO_AUTHOR_CERT");return o.exists(r)}).then(e=>{if(!e)throw new p("CERT_NO_DISTRIBUTOR_KEY");return o.exists(c)}).then(e=>{if(!e)throw new p("CERT_NO_DISTRIBUTOR_CERT");return this.validatePpkCert()})}validatePpkCert(){const{userId:e,mnid:t}=this.config;const n=s.resolve(this.securityProfilesPath,`${e}${t}`,"author.crt");const i=s.resolve(this.securityProfilesPath,`${e}${t}`,"distributor.crt");let r;let c;let a;let u;try{r=o.readFileSync(n)}catch(e){throw new p("CERT_NO_AUTHOR_CERT")}try{c=o.readFileSync(i)}catch(e){throw new p("CERT_NO_DISTRIBUTOR_CERT")}try{a=d.parseCert(r);u=d.parseCert(c)}catch(e){throw new p("CERT_INVALID_CERTIFICATE")}if(new Date(a.notAfter)<new Date)throw new p("CERT_EXPIRED_CERTIFICATE");if(new Date(u.notAfter)<new Date)throw new p("CERT_EXPIRED_CERTIFICATE")}validateDeviceCert(){const{userId:e,mnid:t}=this.config;const n=s.resolve(this.securityProfilesPath,`${e}${t}`,"device.crt");let i;let r;try{i=o.readFileSync(n)}catch(e){throw new p("CERT_NO_DEVICE_CERT")}try{r=d.parseCert(i)}catch(e){throw new p("CERT_INVALID_CERTIFICATE")}if(new Date(r.notAfter)<new Date)throw new p("CERT_EXPIRED_CERTIFICATE")}checkDeviceKeyCert(){const{userId:e,mnid:t,iotCloud:n}=this.config;if(n&&n.clientKey&&n.clientCert)return c.resolve();const i=s.resolve(this.securityProfilesPath,`${e}${t}`,"device.pri");const r=s.resolve(this.securityProfilesPath,`${e}${t}`,"device.crt");return o.exists(r).then(e=>{if(!e)throw new p("CERT_NO_DEVICE_KEY");return o.exists(i)}).then(e=>{if(!e)throw new p("CERT_NO_DEVICE_CERT");return this.validateDeviceCert()})}static isValidPassword(e,t){return i.spawn("java",["-jar","-Dfile.encoding=UTF-8",I,"-p",e,"-i",t]).then(e=>e.code===0).catch(e=>{if(e.code===3)return false;throw new Error(e.stderr)})}isValidPpkKeyPassword(e){const{userId:t,mnid:n}=this.config;const i=s.resolve(this.securityProfilesPath,`${t}${n}`,"author.pri");const r=s.resolve(this.securityProfilesPath,`${t}${n}`,"distributor.pri");return f.isValidPassword(e,i).then(t=>{if(!t)return false;return f.isValidPassword(e,r)})}getDeviceKeyCertPath(){const{userId:e,mnid:t}=this.config;return e&&t?{keyPath:s.resolve(this.securityProfilesPath,`${e}${t}`,"device.pri"),certPath:s.resolve(this.securityProfilesPath,`${e}${t}`,"device.crt")}:{keyPath:null,certPath:null}}getDeviceKeyCert(){let e=this.config.iotCloud.clientKey;let t=this.config.iotCloud.clientCert;if(!e||!t){const{keyPath:n,certPath:i}=this.getDeviceKeyCertPath();if(n&&i){if(o.existsSync(n)&&o.existsSync(i)){e=o.readFileSync(n).toString();t=o.readFileSync(i).toString()}}}return{key:e,cert:t}}}f.PASSWORD_REGEX=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,128}$/;e.exports=new Proxy(f,E())},function(e,t,n){const i=n(4);const r=n(35);const s=n(10);const o=n(48);const c=n(18);const a=n(12);const u=n(5);const l=n(3);const h=n(7);const p=n(95);const{getRoot:d,isValidVid:E}=n(2);const _=n(19);const I=n(49);const f=n(20);const P=n(1);const T=n(100);const g=n(50);const A=n(51);const O=n(36);const N=n(0);const m=64;const C=100;const S=20;function D(e){return u.exists(e).then(t=>{if(t){return u.readFile(e,"utf8").then(e=>{const t=JSON.parse(e);const n=t.deviceProfiles||t.deviceTypes;return n}).map(e=>p.mapToDeviceProfileEntry(e))}return l.resolve([])})}function v(e,t){const n={deviceProfiles:t};return u.ensureDir(i.dirname(e)).then(()=>u.writeFile(e,JSON.stringify(n,null,2),{encoding:"utf8"}))}function L(e,t){return u.ensureDir(i.dirname(e)).then(()=>u.writeFile(e,JSON.stringify(t,null,2),{encoding:"utf8"}))}function R(e,t){const n=new I(t);n.init();return n.retrieveCapabilityList().then(t=>{const n=[];e.forEach(e=>e.capabilities.forEach(e=>n.push(e)));n.forEach(e=>{const n=t.find(t=>t.id===e.id);if(!n)throw new P("UNSUPPORTED_CAPABILITY",e.id)})})}class y{constructor(e){this.config=e||{};this.customDeviceProfileDirPath=i.resolve(a.homedir(),".iotcloud/device_profiles");this.baseDeviceProfileDirPath=i.resolve(d(),"assets/device_profiles");this.builtInListFilePath=i.resolve(this.baseDeviceProfileDirPath,"built_in_list.json");this.customListFilePath=i.resolve(this.customDeviceProfileDirPath,"custom_list.json");this.mapFilePath=i.resolve(d(),"assets/capabilities/mapToResources.json");const t=i.resolve(a.homedir(),".iotcloud/cli/device_profiles");if(c.existsSync(t)&&!c.existsSync(this.customDeviceProfileDirPath)){c.copySync(t,this.customDeviceProfileDirPath);c.removeSync(t)}this.dtypes=null}createDeviceProfile(e,t){const n=r();const s=i.resolve(this.customDeviceProfileDirPath,"custom",n);return y.validateDeviceProfile(e,t,this.config).then(()=>this.deleteMnid(t)).then(e=>L(s,e)).then(()=>D(this.customListFilePath)).then(i=>{let r=[];r=r.concat(i);r.push(p.createDeviceProfileEntry(n,t.deviceName||t.name,e,`custom/${n}`,"custom"));return v(this.customListFilePath,r).then(()=>this.retrieveDeviceProfile(n))})}retrieveDeviceProfileList(e={}){let t=[];return D(this.builtInListFilePath).then(n=>{let i=e.id?n.filter(t=>t.id===e.id):n;i=e.type?i.filter(t=>t.type===e.type):i;i=e.category?i.filter(t=>t.category===e.category):i;t=t.concat(i);if(e.builtIn){return[]}return D(this.customListFilePath)}).then(n=>{let i=e.id?n.filter(t=>t.id===e.id):n;i=e.type?i.filter(t=>t.type===e.type):i;i=e.category?i.filter(t=>t.category===e.category):i;t=t.concat(i);return t})}existsDeviceProfile(e){return this.retrieveDeviceProfileList({id:e}).then(e=>e.length>=0)}retrieveDeviceProfile(e){return this.retrieveDeviceProfileList().then(t=>{const n=t.filter(t=>t.id===e);if(n.length===0){throw new P("CANNOT_FIND_DEVICE_PROFILE")}const r=n[0];const s=r.category==="custom"?i.resolve(this.customDeviceProfileDirPath,r.path):i.resolve(this.baseDeviceProfileDirPath,r.path);return this.retrieveDeviceProfileFromFile(s,r)})}retrieveDeviceProfileFromFile(e,t){return u.exists(e).then(n=>{if(!n){throw new P("CANNOT_FIND_CUSTOM_DEVICE_PROFILE",e)}return u.readFile(e,"utf8").then(e=>JSON.parse(e)).then(e=>p.mapToDeviceProfile(t,e))})}retrieveDeviceProfileInProject(e){return h.retrieveConfig(e).then(()=>{const t=i.join(e,h.DEVICE_PROFILE_FILE);return this.retrieveDeviceProfileFromFile(t)})}updateDeviceProfile(e,t){const n=i.resolve(this.customDeviceProfileDirPath,"custom",e);let r;let s;return D(this.customListFilePath).then(n=>{s=n.find(t=>t.id===e);if(!s)throw new P("CANNOT_FIND_DEVICE_PROFILE");r=n.filter(t=>t.id!==e);return y.validateDeviceProfile(s.type,t,this.config)}).then(()=>{const n=p.createDeviceProfileEntry(e,t.deviceName||t.name,s.type,`custom/${e}`,"custom");r.push(n)}).then(()=>L(n,t)).then(()=>v(this.customListFilePath,r)).then(()=>this.retrieveDeviceProfile(e))}deleteDeviceProfile(e){const t=i.resolve(this.customDeviceProfileDirPath,"custom",e);let n=null;return D(this.customListFilePath).then(i=>{n=i.filter(t=>t.id!==e);if(i.length===n.length){throw new P("CANNOT_FIND_DEVICE_PROFILE")}return u.deleteFile(t)}).then(()=>v(this.customListFilePath,n))}isCapabilityModelType(e){return this.retrieveDeviceProfileList().then(t=>{const n=t.find(t=>t.id===e);if(!n)throw new P("CANNOT_FIND_DEVICE_PROFILE");return n.type==="capability"})}convertToResourceModelByDeviceProfileId(e,t=true){return this.isCapabilityModelType(e).then(n=>{if(!n)throw new P("NOT_CAPABILITY_MODEL");return this.retrieveDeviceProfile(e).then(e=>this.convertToResourceModelByDeviceProfile(e,t))})}convertToResourceModelByDeviceProfile(e,t=true){let n=[];e.components.forEach(e=>{e.capabilities.forEach(t=>{const i=this.mapCapabilityToResources(t.id,e.id,true);n=n.concat(i)})});const i=s(O.DEFAULT_OIC_D_RESOURCE);if(t){if(e.metadata.ocfDeviceType){i.rt.push(e.metadata.ocfDeviceType)}else{const t=e.metadata.deviceType;const n=f.retrieveDeviceType(t);i.rt.push(n?n.ocfDeviceType:e.name)}n.push(i);n.push(s(O.DEFAULT_OIC_P_RESOURCE))}const r=new g(e.name);r.rt=i.rt;r.icv="core.1.1.0";r.dmv="res.1.1.0";const o=new A(e.metadata.mnmn,e.metadata.vid);o.mnml=e.metadata.mnml||null;o.mnmo=e.metadata.mnmo||null;o.mndt=e.metadata.mndt||null;o.mnpv=e.metadata.mnpv||null;o.mnos=e.metadata.mnos||null;o.mnhw=e.metadata.mnhw||null;o.mnfv=e.metadata.mnfv||null;const c=new T;c.device=r;c.platform=o;c.resources=n;return c}mapCapabilityToResources(e,t="main",n=false){const i=u.readJsonSync(this.mapFilePath);const r=i[e];if(!r||o(r))throw new P("CANNOT_MAP_CAPABILITY");let s;s=r.find(e=>e.component===t);let c;if(s){c=s.href}else if(n){s=r.find(e=>e.component==="main");c=s.href.replace("/main/",`/${t}/`)}else{throw new P("NO_RESOURCES_TO_MAP",`${e}:${t}`)}const a=new O(c);a.rt=[s.rt];a.if=s.if;a.type=["application/json"];a.title=s.title;a.p={bm:3};return[a]}mapResourceToCapability(e){const t=u.readJsonSync(this.mapFilePath);let n=null;Object.keys(t).forEach(i=>{const r=t[i];const s=r.find(t=>t.href===e.href&&e.rt.indexOf(t.rt)>=0);if(s){n={id:i,component:s.component}}});return n}static validateDeviceProfile(e,t,n){if(e!=="capability"){return l.reject(new P("UNSUPPORTED_DEVICE_PROFILE_MODEL",e))}if(!t.name){return l.reject(new P("INVALID_DEVICE_PROFILE","name"))}if(t.name.length>C){return l.reject(new P("EXCEEDED_DEVICE_NAME"))}if(!t.components){return l.reject(new P("INVALID_DEVICE_PROFILE","components"))}if(!t.metadata){return l.reject(new P("INVALID_DEVICE_PROFILE","metadata"))}if(!t.metadata.vid){return l.reject(new P("INVALID_DEVICE_PROFILE","metadata.vid"))}if(typeof t.metadata.vid!=="string"){return l.reject(new P("INVALID_META_VID"))}if(t.metadata.vid.length>m){return l.reject(new P("EXCEEDED_META_VID"))}if(!E(t.metadata.vid)){return l.reject(new P("INVALID_META_VID_REGEX"))}const i=t.components.map(e=>{if(e.capabilities.length>S){return l.reject(new P("EXCEEDED_CAPABILITIES",e.id))}return l.resolve()});return l.all(i).then(()=>R(t.components,n)).then(()=>y.validateMetaDeviceType(t))}static validateMetaDeviceType(e){const t=f.retrieveDeviceTypeList();if(e&&e.metadata&&e.metadata.deviceType&&!t.find(t=>t.id===e.metadata.deviceType)){return l.reject(new P("UNSUPPORTED_METADATA_DEVICE_TYPE",e.metadata.deviceType))}return l.resolve()}static generateResources(e,t,n){return new l((i,r)=>{if(t instanceof _){let s;try{const e=new y;s=e.convertToResourceModelByDeviceProfile(t,true)}catch(e){r(e)}const o=n||t.name;i({di:e,n:o,links:s.resources})}else{r(new P("UNSUPPORTED_DEVICE_PROFILE_TYPE"))}})}static generateOcfDeviceTypeFromDeviceProfile(e,t){return l.resolve().then(()=>{if(!(e instanceof _)){throw new P("UNSUPPORTED_DEVICE_PROFILE_TYPE")}const n=new y;const i=n.convertToResourceModelByDeviceProfile(e,true);if(t)i.platform.mnmn=t;return i})}deleteMnid(e){const t=s(e);delete t.metadata.mnmn;return t}updateMnidIfNeeded(e){if(!e.metadata.mnmn&&!this.config.mnid){throw new P("NO_MNMN_OR_NO_MNID")}const t=s(e);t.metadata.mnmn=this.config.mnid;return t}}e.exports=new Proxy(y,N())},function(e,t,n){const i=n(6).EventEmitter;const r=n(43);const s=n(3);const o=n(75);const c=n(45);const a=n(1);const u=n(0);const l=n(89);const h={CREATE_TOKEN:"/oic/account/createtoken",SIGN_UP:"/oic/account",SIGN_IN:"/oic/account/session",REFRESH_TOKEN:"/oic/account/tokenrefresh",DEVICE_PROFILE:"/oic/account/profile/device",DEVICE_RESOURCE:"/oic/res",DEVICE_STATES:"/oic/prs",DEVICE_LIST:"oic/account",GROUP:"/oic/acl/group",DELETE_DEVICE:"/oic/account",PING:"/oic/ping",PUBLISH_DEVICE:"/oic/rd",OBSERVE_SERVICE:"/service/observe"};const p={GET:1,POST:2,PUT:3,DELETE:4,OBSERVE:1,UNOBSERVE:1};const d=new l;class E extends i{constructor(e,t,n){super();const{uri:i,proxy:r,rejectUnauthorized:s,useRedirection:c,redirecturi:a,serverCert:u}=e;const l=c?a||i:i;const h=c?u:null;this.config=e;this.connected=false;this.connector=new o(l,r,s,h,t,n);this.connector.on("close",()=>this.emit("close"));this.connector.on("debug",e=>this.emit("debug",e))}isConnected(){return!!this.connector.socket}connect(){if(!this.connected)return this.connector.connect();return s.resolve()}disconnect(){if(this.connector)this.connector.disconnect()}sendResponse(e){return this.connector.sendResponse(e)}signUp(e,t,n,i,r){const s={di:n,authprovider:t,accesstoken:e,clientid:c.CLIENT_ID,uid:i,devicetype:r?"device":"samsungconnect"};return this.connector.sendRequest(p.POST,h.SIGN_UP,null,s)}getAccessTokenByAuthCode(e,t,n){const i={di:n,authprovider:t,authcode:e,clientid:c.CLIENT_ID};return this.connector.sendRequest(p.POST,h.CREATE_TOKEN,null,i)}signUpWithAuthCode(e,t,n,i){let r;return this.getAccessTokenByAuthCode(e,t,n).then(e=>{const s={di:n,authprovider:t,accesstoken:e.accesstoken,clientid:c.CLIENT_ID,devicetype:i?"device":"samsungconnect",uid:e.uid};r=e;return this.connector.sendRequest(p.POST,h.SIGN_UP,null,s)}).then(e=>Object.assign({},e,r))}signIn(e,t,n){const i={uid:t,di:e,accesstoken:n,login:true};return this.connector.sendRequest(p.POST,h.SIGN_IN,null,i).catch(t=>{if(t.shortMessage.indexOf("DEVICE_NOT_FOUND")>0){return s.reject(new a("IOT_CLOUD_DEVICE_NOT_FOUND",e))}return s.reject(t)})}signOut(e,t,n){const i={uid:t,di:e,accesstoken:n,login:false};return this.connector.sendRequest(p.POST,h.SIGN_IN,null,i).catch(t=>{if(t.shortMessage.indexOf("DEVICE_NOT_FOUND")>0){return s.reject(new a("IOT_CLOUD_DEVICE_NOT_FOUND",e))}return s.reject(t)})}refreshToken(e,t,n){const i={uid:t,di:e,refreshtoken:n,granttype:"refresh_token"};return this.connector.sendRequest(p.POST,h.REFRESH_TOKEN,null,i)}getPing(){return this.connector.sendRequest(p.GET,h.PING,null,null)}setPing(e){const t={in:e};return this.connector.sendRequest(p.POST,h.PING,null,t)}getGroupList(e){const t=r.stringify({members:e},{delimiter:";"});return this.connector.sendRequest(p.GET,h.GROUP,t)}getGroup(e,t){const n=`${h.GROUP}/${e}`;const i=r.stringify({members:t},{delimiter:";"});return this.connector.sendRequest(p.GET,n,i)}createGroup(e,t,n,i){const r={gname:e};if(t)r.owner=t;if(n)r.parent=n;if(i)r.members=i;return this.connector.sendRequest(p.POST,h.GROUP,null,r)}updateGroup(e,t,n,i,s,o){const c=`${h.GROUP}/${e}`;const a=t?r.stringify({op:t},{delimiter:";"}):null;const u={members:n||[],masters:i||[],devices:s||[],resources:o||[]};return this.connector.sendRequest(p.POST,c,a,u)}deleteGroup(e,t){const n=`${h.GROUP}/${e}`;const i=r.stringify({owner:t},{delimiter:";"});return this.connector.sendRequest(p.DELETE,n,i)}commandDevice(e,t,n,i){const s=r.stringify({rt:n,interf:i},{delimiter:";"});return this.connector.sendRequest(p.POST,e,s,t)}deleteDevice(e,t){const n=r.stringify({di:e,accesstoken:t},{delimiter:";"});return this.connector.sendRequest(p.DELETE,h.DELETE_DEVICE,n,null)}publishResources(e,t){const n=r.stringify({rt:"oic.wk.rdpub"},{delimiter:";"});return this.connector.sendRequest(p.POST,h.PUBLISH_DEVICE,n,t)}createDeviceProfile(e){return this.connector.sendRequest(p.POST,h.DEVICE_PROFILE,null,e)}getDeviceProfile(e){const t=e?r.stringify({di:e},{delimiter:";"}):null;return this.connector.sendRequest(p.GET,h.DEVICE_PROFILE,t,null)}getDeviceResources(e){const t=r.stringify({di:e},{delimiter:";"});return this.connector.sendRequest(p.GET,h.DEVICE_RESOURCE,t,null)}getDeviceResource(e){return this.connector.sendRequest(p.GET,e,null,null)}getDeviceState(e){return d.acquire(e,()=>{const t=r.stringify({di:e},{delimiter:";"});return this.connector.observe(h.DEVICE_STATES,t).then(e=>this.connector.cancelObserve(h.DEVICE_STATES,t).then(()=>e))})}getDeviceList(){return this.connector.sendRequest(p.GET,h.DEVICE_LIST)}observeDeviceState(e,t){const n=r.stringify({di:e},{delimiter:";"});return this.connector.observe(h.DEVICE_STATES,n,t)}cancelObserveDeviceState(e){const t=r.stringify({di:e},{delimiter:";"});return this.connector.cancelObserve(h.DEVICE_STATES,t)}observeServiceEvent(e){return this.connector.observe(h.OBSERVE_SERVICE,null,e)}observeResource(e,t){return this.connector.observe(e,null,t)}cancelObserveResource(e){return this.connector.cancelObserve(e)}setRequestHandler(e){this.connector.setRequestHandler(e)}}e.exports=new Proxy(E,u())},function(e,t){e.exports=require("fs-extra")},function(e,t){class n{constructor(){this.id=null;this.name=null;this.components=[];this.metadata={}}}e.exports=n},function(e,t,n){const i=n(4);const r=n(5);const{getRoot:s}=n(2);const o=n(0);const c=i.resolve(s(),"assets","device_profiles","dtypes.json");const a=i.resolve(s(),"assets","device_profiles","device_resource_types.json");let u;let l;class h{constructor(e){this.config=e||{}}static retrieveDeviceResourceTypeList(){l=l||r.readJsonSync(a);return Object.keys(l).map(e=>({id:e,name:l[e].name,dtype:l[e].dtype}))}static retrieveDeviceResourceType(e){const t=h.retrieveDeviceResourceTypeList();return t.find(t=>t.id===e)}static isValidDeviceResourceType(e){return!!h.retrieveDeviceResourceType(e)}static retrieveDeviceTypeList(){u=u||r.readJsonSync(c).dtypes;return u}static retrieveDeviceType(e){const t=h.retrieveDeviceTypeList();return t.find(t=>t.id===e)}static retrieveDeviceTypeFromResourceType(e){const t=h.retrieveDeviceTypeList();return t.find(t=>t.ocfDeviceType===e)}}e.exports=new Proxy(h,o())},function(e,t,n){const i=n(4);const r=n(56);const s=n(3);const o=n(62);const c=n(10);const a=n(6);const u=n(41);const l=n(55);const h=n(7);const p=n(9);const d=n(5);const E=n(57);const _=n(61);const{getRoot:I}=n(2);const f=n(1);const P=n(0);const T=n(30);class g extends a{constructor(e,t,n){super();this.config=e.config;this.projPath=t;this.projConfig=n;this.outputPath=i.join(t,n.outputPath)}isUpdatedDeviceProfile(){const e=i.join(this.projPath,h.DEVICE_PROFILE_FILE);const t=i.join(this.projPath,h.MANIFEST_DIR,h.UI_MANIFEST_FILE);if(d.statSync(t).mtime<d.statSync(e).mtime)return false;return true}build(){const e=this.emit.bind(this);const t=this.projConfig.type;if(!this.config.mnid)throw new Error("Login or Requesting MNID required!");e("start",this.projConfig.name);return d.remove(this.outputPath).then(()=>d.makeDir(this.outputPath)).then(()=>{if(t===p.PROJ_TYPE.OCF){if(!this.isUpdatedDeviceProfile())e("progress","Warning: device-profile was updated, please generate manifest if you need");return this.buildOcfProject()}else if(t===p.PROJ_TYPE.C2C){if(!this.isUpdatedDeviceProfile())e("progress","Warning: device-profile was updated, please generate manifest if you need");return this.buildC2cProject()}else if(t===p.PROJ_TYPE.AUTOMATION){return this.buildAutomationProject()}throw new Error(`Invalid project type... ${t}`)})}buildOcfProject(){return this.buildDeviceProfileFile().then(e=>this.buildManifestFiles(e.metadata.vid)).then(()=>d.exists(i.join(this.projPath,h.PLUGIN_DIR))).then(e=>{if(e)return this.buildPluginFiles();return s.resolve()}).then(()=>this.buildCatalogFile(this.projPath,p.PROJ_TYPE.OCF))}buildC2cProject(){return this.buildDeviceProfileFile(this.projPath).then(e=>this.buildManifestFiles(e.metadata.vid)).then(()=>d.exists(i.join(this.projPath,h.PLUGIN_DIR))).then(e=>{if(e)return this.buildPluginFiles();return s.resolve()}).then(()=>this.buildCatalogFile())}buildAutomationProject(){return this.buildCatalogFile()}buildDeviceProfileFile(){const e=i.resolve(this.projPath,h.DEVICE_PROFILE_FILE);const t=i.resolve(this.outputPath,h.DEVICE_PROFILE_FILE);return d.readJson(e).then(e=>{const n=e;n.metadata.mnmn=this.config.mnid;const i=JSON.stringify(n,null,2);return d.writeFile(t,i).then(()=>n)})}buildManifestFiles(e){const t=this.emit.bind(this);const n=i.resolve(this.projPath,h.MANIFEST_DIR);const r=i.join(n,h.UI_MANIFEST_FILE);const o=i.join(n,h.VOICE_MANIFEST_FILE);t("progress","Processing Manifest files...");return d.exists(r).then(t=>{if(t)return this.buildUiManifestFile(r,e);throw new Error("No UI manifest file!")}).then(()=>d.exists(o)).then(t=>{if(t)return this.buildVoiceManifestFile(o,e);return s.resolve()})}buildUiManifestFile(e,t){const n=this.emit.bind(this);const s=this.config.mnid;const c=i.join(this.outputPath,`${s}_${t}_${h.UI_MANIFEST_FILE}`);n("progress",`> UI Manifest file: ${e}`);return d.readJson(e).then(e=>{const n=e;r.validate(n,E.uiSchema);if(r.error){const e=r.error.dataPath?` ${r.error.dataPath}`:"";throw Error(`Invalid UI manifest file, ${r.error.message}${e}`)}l.validatePoCodes(n);n.mnmn=s;n.vid=t;if(n.language&&n.language.length>0){n.language=n.language.map(e=>{const n=o(e);n.mnmn=s;n.vid=t;return n})}const i=JSON.stringify(n,null,2);return d.writeFile(c,i)})}buildVoiceManifestFile(e,t){const n=this.emit.bind(this);const s=this.config.mnid;const o=i.join(this.outputPath,`${s}_${t}_${h.VOICE_MANIFEST_FILE}`);n("progress",`> Voice Manifest file: ${e}`);return d.readJson(e).then(e=>{const n=e;r.validate(n,E.voiceSchema);if(r.error){const e=r.error.dataPath?` ${r.error.dataPath}`:"";throw Error(`Invalid VOICE manifest file, ${r.error.message}${e}`)}n.mnmn=s;n.vid=t;const i=JSON.stringify(n,null,2);return d.writeFile(o,i)})}buildPluginFiles(){const e=this.emit.bind(this);const t=this.config.mnid;const n=i.join(this.projPath,h.PLUGIN_DIR);const r=i.join(n,h.PLUGIN_MANIFEST_FILE);const o=i.join(this.outputPath,h.PLUGIN_DIR);const c=i.join(o,h.PLUGIN_LIB_DIR);const a=i.join(o,h.PLUGIN_MANIFEST_FILE);const u=i.join(I(),`assets/${h.SCPLUGINAPI_JS_FILE}`);const l=i.join(c,h.SCPLUGINAPI_JS_FILE);e("progress","Building Device Plugin...");return s.resolve().then(()=>{e("progress","> Checking package name...");return this.validatePackageName().then(()=>this.validatePackageNameInSmartApp())}).then(()=>{e("progress","> Copying files to output directory...");return d.copy(n,o)}).then(()=>{e("progress","> Rewriting manifest.xml...");return d.readFile(r,"utf8").then(e=>{const n=e.replace("default.manufacturer.id",t);return d.writeFile(a,n)})}).then(()=>{e("progress",`> Adding library... ${h.SCPLUGINAPI_JS_FILE}`);return d.exists(c).then(e=>e?s.resolve():d.makeDir(c)).then(()=>d.copy(u,l))}).then(()=>{e("progress","> Building PPK file...");const t=new _;t.on("progress",t=>e("progress",`>> ${t}`));return d.ensureDir(this.outputPath).then(()=>t.pack(o,this.outputPath))}).then(()=>{e("progress","> Checking manifest.xml file...");if(!d.existsSync(a)){throw new f("CANNOT_FIND_MANIFEST_XML")}e("progress","> Reading & Pasing manifest.xml file...");const t=d.readFileSync(a);const n=new T.Parser;const r=s.promisify(n.parseString);return r(t).then(t=>{e("progress","> Adding .plugin info...");if(!t||!t.manifest||!t.manifest.plugin){throw new f("INVALID_MANIFEST_XML",h.PLUGIN_DIR)}const n=t.manifest.$;const r=t.manifest.plugin[0].device[0].$;const s=`${n.package}_${n.versionName}.ppk`;const o=i.resolve(this.outputPath,`${n.package}.plugin`);const c={id:n.package,name:n.package,version:n.versionCode,versionName:n.versionName,url:`ppks/${s}`,deviceType:r.type,deviceSubType:r.subType,deviceManufacturer:r.manufacturer,platformVersion:n.minPluginSdkVersion};e("progress","> Adding .plugin file...");return d.writeFile(o,JSON.stringify(c,null,2))})}).finally(()=>{e("progress","> Cleaning up temporary files...");if(d.existsSync(o))return d.remove(o);return s.resolve()})}buildCatalogFile(){const e=this.emit.bind(this);const t=this.config.mnid;const n=this.projConfig.type;const r=i.join(this.projPath,h.CATALOG_FILE);const s=i.join(this.outputPath,h.CATALOG_FILE);e("progress","Processing Catalog file...");e("progress",`> Source file: ${r}`);return d.readJson(r).then(i=>{const r=i;if(n===p.PROJ_TYPE.OCF){r.items[0].versions[0].appData.setupAppData.ocf.mnId=t;const n=/^[0-9]{3}$/;e("progress","> Verifying catalog's setupId");const i=r.items[0].versions[0].appData.setupAppData.ocf.setupId;if(!i||!n.test(i)){throw new f("INVALID_CATALOG_SETUPID",i)}return r}e("progress","> Retrieving Smart-App ID...");const s=new u(this.config);s.init();return s.retrieveSmartAppInProject(this.projPath).then(e=>{if(n===p.PROJ_TYPE.AUTOMATION){r.items[0].versions[0].appData.automationAppData.endpointApp.endpointAppId=e.appId}else{r.items[0].versions[0].appData.setupAppData.endpointAppId=e.appId}return r})}).then(t=>{e("progress",`> Building Catalog file... ${s}`);return d.writeFile(s,JSON.stringify(t,null,2))})}buildOcfProdCatalogFile(){const e=this.emit.bind(this);const t=this.config.mnid;const n=i.join(this.projPath,h.PROD_CATALOG_FILE);const r=i.join(this.outputPath,h.CATALOG_FILE);e("progress","Processing Catalog file...");e("progress",`> Source file: ${n}`);return d.readJson(n).then(n=>{const i={items:[{name:n.modelCd,appType:"setupApp",versions:[{appData:{setupAppData:{type:"ocf",ocf:{mnId:t,setupId:n.easysetupId}}}}]}]};const r=/^[0-9]{3}$/;e("progress","> Verifying catalog's setupId");const s=i.items[0].versions[0].appData.setupAppData.ocf.setupId;if(!s||!r.test(s)){throw new f("INVALID_CATALOG_SETUPID",s)}return i}).then(t=>{e("progress",`> Building Catalog file... ${r}`);return d.writeFile(r,JSON.stringify(t,null,2))})}buildC2cCatalogFile(){const e=this.emit.bind(this);const t=this.projConfig.name;const n=i.join(this.projPath,h.CATALOG_FILE);const r=i.join(this.outputPath,h.CATALOG_FILE);e("progress","Processing Catalog file...");e("progress",`> Source file: ${n}`);const s=i.resolve(I(),"assets","project_gen_resources");const o=d.readJsonSync(i.resolve(s,"default.c2c.catalog.json"));const a=c(o);a.items[0].name=t;e("progress","> Retrieving Smart-App ID...");const l=new u(this.config);l.init();return l.retrieveSmartAppInProject(this.projPath).then(e=>{a.items[0].versions[0].appData.setupAppData.endpointAppId=e.appName}).then(()=>{e("progress",`> Building Catalog file... ${r}`);return d.writeFile(r,JSON.stringify(a,null,2))})}buildAutomationCatalogFile(){const e=this.emit.bind(this);const t=this.projConfig.name;const n=i.join(this.projPath,h.CATALOG_FILE);const r=i.join(this.outputPath,h.APP_CATALOG_FILE);e("progress","Processing Catalog file...");e("progress",`> Source file: ${n}`);const s=i.resolve(I(),"assets","project_gen_resources");const o=d.readJsonSync(i.resolve(s,"default.automation.catalog.json"));const a=c(o);a.items[0].name=t;e("progress","> Retrieving Smart-App ID...");const l=new u(this.config);l.init();return l.retrieveSmartAppInProject(this.projPath).then(e=>{a.items[0].versions[0].appData.automationAppData.endpointApp.endpointAppId=e.appId}).then(()=>{e("progress",`> Building Catalog file... ${r}`);return d.writeFile(r,JSON.stringify(a,null,2))})}validatePackageName(){const e=i.join(this.projPath,h.PLUGIN_DIR,h.PLUGIN_MANIFEST_FILE);const t=i.join(this.projPath,h.MANIFEST_DIR,h.UI_MANIFEST_FILE);return d.exists(t).then(n=>{if(!n)return s.resolve();return d.readJson(t).then(t=>_.readManifestXml(e).then(e=>{const n=e.manifest.$.package;const i=`wwst://${n}`;if(t.dpInfo.filter(e=>e.dpUri===i).length===0){throw new f("DEVICE_PLUGIN_PACKAGE_NAME_NOT_MATCHED",n)}}))})}validatePackageNameInSmartApp(){const e=i.join(this.projPath,h.PLUGIN_DIR,h.PLUGIN_MANIFEST_FILE);const t=i.join(this.projPath,h.SMART_APP_FILE);return d.exists(t).then(n=>{if(!n)return s.resolve();return d.readJson(t).then(t=>_.readManifestXml(e).then(e=>{const n=e.manifest.$.package;if(t.ui&&t.ui.pluginId&&n!==t.ui.pluginId){throw new f("PLUGIN_PACKAGE_NAME_NOT_MATCHED_SMART_APP_PLUGIN_ID",n)}}))})}isBuilt(){return s.resolve().then(()=>{if(!d.existsSync(this.outputPath))return false;const e=d.readDirSync(this.outputPath);const t=e.find(e=>e===h.CATALOG_FILE);const n=e.find(e=>e===h.PROD_CATALOG_FILE);const r=e.find(e=>e===h.DEVICE_PROFILE_FILE);const s=e.find(e=>e.includes(h.UI_MANIFEST_FILE));if(t||n){let e=i.resolve(this.projPath,h.CATALOG_FILE);const n=i.resolve(this.outputPath,t);if(!d.existsSync(e)){e=i.resolve(this.projPath,h.PROD_CATALOG_FILE)}if(d.existsSync(e)&&d.statSync(n).mtime<d.statSync(e).mtime){return false}}if(r){const e=i.resolve(this.projPath,h.DEVICE_PROFILE_FILE);const t=i.resolve(this.outputPath,r);if(d.existsSync(t)&&d.statSync(t).mtime<d.statSync(e).mtime){return false}}if(s){const e=s.split("_");if(r){const t=d.readFileSync(i.resolve(this.projPath,r));const n=JSON.parse(t).metadata.vid;if(this.config.mnid!==e[0]||n!==e[1]){return false}}const t=i.resolve(this.projPath,h.MANIFEST_DIR,h.UI_MANIFEST_FILE);const n=i.resolve(this.outputPath,s);if(d.existsSync(n)&&d.statSync(n).mtime<d.statSync(t).mtime){return false}}if(!d.exists(i.resolve(this.projPath,h.PLUGIN_DIR)))return true;const o=e.find(e=>e.includes(".ppk"));if(!o)return false;const c=i.resolve(this.projPath,h.PLUGIN_DIR,h.PLUGIN_MANIFEST_FILE);const a=i.resolve(this.outputPath,o);if(d.statSync(a).mtime<d.statSync(c).mtime){return false}return _.readManifestXml(c).then(e=>{const t=e.manifest.$.package;const n=e.manifest.$.versionName;const i=`${t}_${n}.ppk`;if(o!==i)return false;return true})})}}e.exports=new Proxy(g,P())},function(e,t,n){const i=n(4);const r=n(6);const s=n(3);const o=n(10);const c=n(40);const a=n(7);const u=n(16);const l=n(9);const h=n(13);const p=n(5);const{getRoot:d,getSmallUuid:E,isValidVid:_}=n(2);const I=n(1);const f=n(0);const P=64;const T=50;const g=/(\?+|\*+|\/+|\\+|:+|\|+|"+|<+|>+|!+|@+|\(+|\)+|`+|'+|&+)/g;const A=/^\.|^ /;const O=/\.$| $/;const N=/^(?:\w+|\w+\.\w+)+$/;const m=i.join(a.PLUGIN_LIB_DIR,a.SCPLUGINAPI_JS_FILE);const C=`<html>\n  <head>\n    \x3c!-- SAMSUNG CONNECT API --\x3e\n    <script type="text/javascript" src="${m}"><\/script>\n  </head>\n</html>\n`;const S="";const D="";const v=i.resolve(d(),"assets","project_gen_resources");const L=p.readFileSync(i.resolve(v,"default.manifest.xml"),"utf8");const R=p.readJsonSync(i.resolve(v,"default.automation.catalog.json"));const y=p.readJsonSync(i.resolve(v,"default.ocf.catalog.json"));const M=p.readJsonSync(i.resolve(v,"default.c2c.catalog.json"));const w=p.readJsonSync(i.resolve(v,"default.device.profile.json"));const F=p.readFileSync(i.resolve(v,"default.lambda.index.js"),"utf8");const U=p.readJsonSync(i.resolve(v,"default.lambda.package.json"));class b extends r{constructor(e){super();this.config=e.config;this.uiMetaGenerator=e.uiMetaGenerator;this.deviceProfileManager=e.deviceProfileManager}generateOcfProject(e,t,n,r,o,c,u,h,d){const E=new l(e,l.PROJ_TYPE.OCF);const _=i.join(t,e);try{this.validateProjectInfo(e,_,c,u,h)}catch(e){return s.reject(e)}return p.makeDir(_).then(()=>this.generateDeviceProfileFile(_,n,c)).then(e=>this.generateManifestFiles(_,e,r,o,u)).then(()=>h?this.generateDevicePluginFiles(_,u):null).then(()=>this.generateCatalogFile(_,e,l.PROJ_TYPE.OCF,d)).then(()=>a.generateConfig(_,E)).catch(e=>{if(p.existsSync(_))p.removeSync(_);throw e})}generateAutomationProject(e,t,n,r){const o=new l(e,l.PROJ_TYPE.AUTOMATION,n);const c=i.join(t,e);try{this.validateProjectInfo(e,c,null)}catch(e){return s.reject(e)}return p.makeDir(c).then(()=>this.generateCatalogFile(c,e,l.PROJ_TYPE.AUTOMATION)).then(()=>{if(r){return this.generateLambdaSmartAppFiles(c,r,F)}return s.resolve()}).then(()=>a.generateConfig(c,o)).catch(e=>{if(p.existsSync(c))p.removeSync(c);throw e})}generateC2cProject(e,t,n,r,o,c,u,h,d,E){const _=new l(e,l.PROJ_TYPE.C2C,n);const I=i.join(t,e);try{this.validateProjectInfo(e,I,u,h,d)}catch(e){return s.reject(e)}return p.makeDir(I).then(()=>this.generateDeviceProfileFile(I,r,u)).then(e=>this.generateManifestFiles(I,e,o,c,h)).then(()=>d?this.generateDevicePluginFiles(I,h):null).then(()=>this.generateCatalogFile(I,e,l.PROJ_TYPE.C2C)).then(()=>{if(E){return this.generateLambdaSmartAppFiles(I,E,F)}return s.resolve()}).then(()=>a.generateConfig(I,_)).catch(e=>{if(p.existsSync(I))p.removeSync(I);throw e})}generateProjectByTemplate(e,t,n){let r=null;const o=i.join(t,e);try{this.validateProjectInfo(e,o,null)}catch(e){return s.reject(e)}return s.resolve().then(()=>{const t=n.type;if(t===l.PROJ_TYPE.C2C||t===l.PROJ_TYPE.AUTOMATION){r=new l(e,t,n.smartApp)}else{r=new l(e,t)}if(n.sourceType==="zip"){return p.makeDir(o).then(()=>c.unzip(n.templatePath,o))}return p.copy(n.templatePath,o)}).then(()=>a.generateConfig(o,r)).catch(e=>{if(p.existsSync(o))p.removeSync(o);throw e})}generateDeviceProfileFile(e,t,n){return s.resolve().then(()=>{if(!t)return o(w);if(typeof t==="object")return t;const e=i.resolve(t);return p.exists(e).then(n=>{if(n&&p.statSync(e).isFile()){return this.deviceProfileManager.retrieveDeviceProfileFromFile(t)}return this.deviceProfileManager.retrieveDeviceProfile(t)})}).then(t=>{const r=t;if(n)r.metadata.vid=n;if(r.id)delete r.id;return u.validateDeviceProfile("capability",t,this.config).then(()=>{const n=i.resolve(e,a.DEVICE_PROFILE_FILE);return p.writeFile(n,JSON.stringify(t,null,2))}).then(()=>t)})}generateManifestFiles(e,t,n,r,o){const c=i.join(e,a.MANIFEST_DIR);return p.makeDir(c).then(()=>s.map([this.uiMetaGenerator.generateUiMetaFromDeviceProfile(t,{msCapability:n,maCapability:r,mnid:"",vid:"",devicePlugin:o})],e=>e)).then(([t])=>{const n=i.join(e,a.MANIFEST_DIR,a.UI_MANIFEST_FILE);const r=JSON.stringify(t,null,2);return s.all([p.writeFile(n,r)])})}generateDevicePluginFiles(e,t){const n=i.join(e,a.PLUGIN_DIR);const r=i.join(n,a.PLUGIN_LIB_DIR);const o=i.join(n,a.PLUGIN_JS_DIR);const c=i.join(n,a.PLUGIN_CSS_DIR);return p.makeDir(n).then(()=>s.all([p.makeDir(o),p.makeDir(c),p.makeDir(r)])).then(()=>{let e=L;if(t){e=e.replace("default.plugin",t)}return s.all([p.writeFile(i.join(n,a.PLUGIN_INDEX_FILE),C),p.writeFile(i.join(n,a.PLUGIN_MANIFEST_FILE),e),p.writeFile(i.join(o,a.PLUGIN_JS_FILE),S),p.writeFile(i.join(c,a.PLUGIN_CSS_FILE),D),p.writeFile(i.join(n,a.PLUGIN_ICON_FILE),"")])})}generateCatalogFile(e,t,n,r){const s=i.join(e,a.CATALOG_FILE);let c;if(n===l.PROJ_TYPE.C2C){c=o(M)}else if(n===l.PROJ_TYPE.AUTOMATION){c=o(R)}else{c=o(y);c.items[0].versions[0].appData.setupAppData.ocf.setupId=r||"001"}c.items[0].name=t;return p.writeFile(s,JSON.stringify(c,null,2))}generateSmartAppConfig(e,t,n=[],i=""){const r=`${e}_${E()}`.toLowerCase();return new h({appName:r,displayName:e,description:e,singleInstance:false,appType:t,impl:t===h.APP_TYPE.LAMBDA?{functions:n}:{targetUrl:i}})}generateLambdaConfig(e){return{name:e,runtime:"nodejs6.10",handler:"index.handle"}}generateLambdaSmartAppFiles(e,t,n){const r=i.join(e,a.SMART_APP_DIR);return p.makeDir(r).then(()=>{const e=i.join(r,a.LAMBDA_CONFIG_FILE);return p.writeFile(e,JSON.stringify(t,null,2))}).then(()=>{if(t.runtime&&t.runtime.indexOf("nodejs")>=0){const e=i.join(r,a.LAMBDA_PACKAGE_JSON_FILE);return p.writeFile(e,JSON.stringify(U,null,2))}return s.resolve()}).then(()=>{const e=i.join(r,a.DEFAULT_LAMBDA_JS_FILE);return p.writeFile(e,n)})}static validateProjectInput(e,t){if(!e)throw new I("PROJECT_NAME_EMPTY");if(e.length>T){throw new I("PROJECT_NAME_LENGTH_EXCEEDS_MAX_LENGTH",T)}if(g.test(e)){throw new I("PROJECT_NAME_INVALID_CHAR")}if(A.test(e)){throw new I("PROJECT_NAME_START_WITH_INVALID_CHAR")}if(O.test(e)){throw new I("PROJECT_NAME_END_WITH_INVALID_CHAR")}if(p.existsSync(t)){throw new I("CREATE_PROJECT_PRJ_ALREADY_EXISTS",t)}}validateProjectInfo(e,t,n,i,r){b.validateProjectInput(e,t);if(n&&n.length>P){throw new I("CREATE_PROJECT_VID_EXCEEDS_MAX_LENGTH",P)}if(!_(n)){throw new I("CREATE_PROJECT_INVAID_VID")}if(r&&!i){throw new I("CREATE_PROJECT_DEVICE_PLUGIN_OPTION_REQUIRED")}if(i){if(i.length>64)throw new I("INVALID_DEVICE_PLUGIN_ID_LONG");if(!N.test(i)){throw new I("INVALID_DEVICE_PLUGIN_ID_URI")}}}}e.exports=new Proxy(b,f())},function(e,t,n){const i=n(24);const r=n(1);const s=(1<<24)-1;const o=Object.freeze({"If-Match":1,"Uri-Host":3,ETag:4,"If-None-Match":5,Observe:6,"Uri-Port":7,"Location-Path":8,"Uri-Path":11,"Content-Format":12,"Max-Age":14,"Uri-Query":15,Accept:17,"Location-Query":20,Block2:23,Block1:27,"Proxy-Uri":35,"Proxy-Scheme":39,Size1:60});const c=Object.freeze(i.invert(o));const a=Object.freeze({"text/plain":0,"text/csv":2,"text/html":3,"image/gif":21,"image/jpeg":22,"image/png":23,"image/tiff":24,"application/link-format":40,"application/xml":41,"application/octet-stream":42,"application/rdf+xml":43,"application/soap+xml":44,"application/atom+xml":45,"application/xmpp+xml":46,"application/exi":47,"application/fastinfoset":48,"application/soap+fastinfoset":49,"application/json":50,"application/x-obix-binary":51,"application/cbor":60});const u=Object.freeze(i.invert(a));const l=Object.freeze({JSON:a["application/json"],CBOR:a["application/cbor"]});function h(e){let t=0;if(e<0){t=4}else{for(let n=0;n<4;n+=1){if(e>=1<<n*8){t+=1}else{break}}}const n=Buffer.alloc(t||1,0);for(let i=0;i<t;i+=1){const r=255&e>>i*8;n.writeUInt8(r,t-i-1)}return n}class p{constructor(e){const{observe:t,path:n,query:i,format:r}=e||{};if(t)this.setObserve(t);if(n)this.setUriPath(n);if(i)this.setUriQuery(i);if(typeof r==="number")this.setContentFormat(r)}setObserve(e){if(e.length<0||e.length>s)throw new r("INVALID_OBSERVE_OPTION");this.observe=e}setUriPath(e){if(typeof e!=="string")throw new r("INVALID_URI_PATH");this.uriPath=e}setContentFormat(e){if(e!==50&&e!==60)throw new r("UNSUPPORTED_CONTENT_FORMAT",e);this.contentFormat=e}setUriQuery(e){if(typeof e!=="string")throw new r("INVALID_URI_QUERY");this.uriQuery=e}toBytes(){const e=[];if(i.has(this,"observe")){const t=typeof this.observe==="number"?h(this.observe):this.observe;e.push({number:6,value:t})}if(i.has(this,"uriPath")){const t=this.uriPath;const n=t.startsWith("/")?t.slice(1):t;n.split("/").forEach(t=>{e.push({number:11,value:Buffer.from(t)})})}if(i.has(this,"contentFormat")){e.push({number:12,value:Buffer.alloc(1,this.contentFormat)})}if(i.has(this,"uriQuery")){this.uriQuery.split(";").forEach(t=>{if(t)e.push({number:15,value:Buffer.from(t)})})}const t=[];let n=0;let s=0;e.forEach(e=>{const i=e.number-s;s=e.number;const o=e.value.length;let c=0;let a=null;let u=null;if(i<=12){c|=i<<4}else if(i<=255+13){c|=13<<4;a=Buffer.alloc(1);a.writeUInt8(i-13,0)}else if(i<=65535+269){c|=14<<4;a=Buffer.alloc(2);a.writeUInt16BE(i-269,0)}else{throw new r("UNSUPPORTED_OPTION_DELTA")}if(o<=12){c|=o}else if(o<=255+13){c|=13;u=Buffer.alloc(1);u.writeUInt8(o-13,0)}else if(o<=65535+269){c|=14;u=Buffer.alloc(2);u.writeUInt16BE(o-269,0)}else{throw new r("UNSUPPORTED_OPTION_LENGTH")}t.push(Buffer.alloc(1,c));n+=1;if(a){t.push(a);n+=a.length}if(u){t.push(u);n+=u.length}t.push(e.value);n+=e.value.length});return Buffer.concat(t,n)}toString(){const e=[];if(this.uriPath)e.push(`  ${c[11]}: ${this.uriPath}`);if(this.uriQuery)e.push(`  ${c[15]}: ${this.uriQuery}`);const t=u[this.contentFormat];if(t)e.push(`  ${c[12]}: ${t}`);if(this.observe)e.push(`  ${c[6]}: ${this.observe.toString("hex")}`);return e.join("\n")}}p.CONTENT_FORMAT=l;p.fromRawOptions=(e=>{const t={};e.forEach(({number:e,value:n})=>{switch(e){case 11:t.path=`${t.path||""}/${n.toString()}`;break;case 15:t.query=`${t.query||""};${n.toString()}`;break;case 12:t.format=n.readUInt8(0);break;case 6:t.observe=n;break;default:throw new r("UNSUPPORTED_OPTION_NUMBER")}});return new p(t)});p.MAX_OBSERVE=s;p.numberTo4Bytes=h;e.exports=p},function(e,t){e.exports=require("lodash")},function(e,t,n){const i=n(2);const r=n(79);const s=n(80);r.use(s).init({lng:"en",fallbackLng:"en",debug:false,initImmediate:false,interpolation:{escapeValue:false},backend:{loadPath:`${i.getRoot()}/messages/{{lng}}/messages.json`}});function o(e,...t){return r.t(e,t)}e.exports={getText:o}},function(e,t,n){const i=n(87);const r=n(44);const s=n(0);const o=n(6);const c=r("RequestManager");class a extends o{constructor(e,t,n){super();this.baseUri=e;this.proxy=t;this.rejectUnauthorized=n}request(e,t,n,r,s,o,a={}){const u=o?t:`${this.baseUri}${t}`;const l=Object.assign({method:e,uri:u,json:true,proxy:this.proxy},a);if(n)l.qs=n;if(r)l.headers=r;if(s)l.body=s;if(this.rejectUnauthorized===false)l.rejectUnauthorized=false;const h=`REQUEST ${JSON.stringify(l,null,2)}`;c(h);this.emit("debug",h);return i(l).then(e=>{const t=`RESPONSE ${JSON.stringify(e,null,2)}`;c(t);this.emit("debug",t);return e},e=>{const t=`ERROR ${JSON.stringify(e,null,2)}`;c(t);this.emit("debug",t);return Promise.reject(e)})}}a.METHODS={GET:"GET",POST:"POST",DELETE:"DELETE",PUT:"PUT",PATCH:"PATCH"};e.exports=new Proxy(a,s())},function(e,t){e.exports=require("child-process-es6-promise")},function(e,t,n){const i=n(4);const r=n(3);const s=n(4);const o=n(24);const c=n(5);const a=n(2).getRoot;const u=n(29);const l=n(7);const h=n(20);const p=n(1);const d=n(0);const E=n(14);const _=i.resolve(a(),"assets","project_gen_resources");const I=c.readJsonSync(i.resolve(_,"default.ui.json"));const f=c.readJsonSync(i.resolve(_,"default.voice.json"));function P(e,t){if(o.isArray(e)){const n=o.mergeWith(e,t,P);return e.length>t.length?n.slice(0,t.length):n}return undefined}function T(e,t,n,i={}){return e.map((e,r)=>{let s=o.cloneDeep(e);if(s.group===null)delete s.group;if(s.iconUrl===null)delete s.iconUrl;if(s.label&&s.label.n===null)delete s.label.n;if(s.label&&s.label.arguments===null)delete s.label.arguments;if(s.range===null)delete s.range;if(s.valueType===null)delete s.valueType;if(s.visible===null)delete s.visible;if(s.alternatives===null)delete s.alternatives;if(s.controlType===null)delete s.controlType;const c=i.capabilityPropertyMap?i.capabilityPropertyMap[`${n}:${t}`]:{};if(c&&c.ms&&c.ms[r]){s=o.mergeWith(s,c.ms[r],P)}const a=`/capability/${t}/${n}/`;if(s.label&&s.label.arguments){s.label.arguments.forEach(e=>{const t=e;if(t.href&&t.href.indexOf(a)<0){const e=t.href.split("/").pop();t.href=`${a}${e}`}})}return s})}function g(e,t,n,i={}){return e.map((e,r)=>{let s=o.cloneDeep(e);if(s.group===null)delete s.group;if(s.iconUrl===null)delete s.iconUrl;if(s.label&&s.label.n===null)delete s.label.n;if(s.label&&s.label.arguments===null)delete s.label.arguments;if(s.range===null)delete s.range;if(s.valueType===null)delete s.valueType;if(s.visible===null)delete s.visible;if(s.alternatives===null)delete s.alternatives;if(s.controlType===null)delete s.controlType;const c=i.capabilityPropertyMap?i.capabilityPropertyMap[`${n}:${t}`]:{};if(c&&c.ma&&c.ma[r]){s=o.mergeWith(s,c.ma[r],P)}const a=`/capability/${t}/${n}/`;if(s.link&&s.link.href&&s.link.href.indexOf(a)<0){const e=s.link.href.split("/").pop();s.link.href=`${a}${e}`}if(s.label&&s.label.arguments){s.label.arguments.forEach(e=>{const t=e;if(t.href&&t.href.indexOf(a)<0){const e=t.href.split("/").pop();t.href=`${a}${e}`}})}return s})}function A(e,t,n,i,r,s){let c=o.cloneDeep(e);c.order=t;if(c.group===null)delete c.group;if(c.iconUrl===null)delete c.iconUrl;if(c.label&&c.label.n===null)delete c.label.n;if(c.label&&c.label.arguments===null)delete c.label.arguments;if(c.range===null)delete c.range;if(c.valueType===null)delete c.valueType;if(c.visible===null)delete c.visible;if(c.alternatives===null)delete c.alternatives;if(c.controlType===null)delete c.controlType;const a=s.capabilityPropertyMap?s.capabilityPropertyMap[`${r}:${i}`]:{};if(a&&a.dpResources&&a.dpResources[n]){c=o.mergeWith(c,a.dpResources[n],P)}const u=`/capability/${i}/${r}/`;if(c.link&&c.link.href&&c.link.href.indexOf(u)<0){const e=c.link.href.split("/").pop();c.link.href=`${u}${e}`}return c}class O{constructor(e){this.config=e||{};this.resourceTypeMgr=new u(this.config);this.baseDir=s.resolve(a(),"assets","meta_gen_resources");this.mapToResourcesFile=s.resolve(a(),"assets","capabilities","mapToResources.json");this.capabilityMap={};this.poCodeResources=[]}generateUiMetaFromDeviceProfile(e,t={}){const n=o.cloneDeep(I);n.n=e.name;n.version=t.uiVersion||t.version||"0.0.1";n.mnmn=t.mnid!==null&&t.mnid!==undefined?t.mnid:e.metadata.mnmn||this.config.mnid;n.vid=t.vid!==null&&t.vid!==undefined?t.vid:e.metadata.vid;if(t.devicePlugin){n.dpInfo=[{os:"android",dpType:"vendorPlugIn",dpUri:`wwst://${t.devicePlugin}`},{os:"ios",dpType:"vendorPlugIn",dpUri:`wwst://${t.devicePlugin}`}]}else{n.dpInfo=[{os:"android",dpType:"vendorPlugIn",dpUri:l.ANDROID_GENERIC_DEVICE_PLUGIN_URI},{os:"ios",dpType:"vendorPlugIn",dpUri:l.IOS_GENERIC_DEVICE_PLUGIN_URI}]}let i=t.msCapability;if(i&&typeof i==="string"){i=i.indexOf(":")<0?{id:i,componentId:"main"}:{id:i.split(":")[1],componentId:i.split(":")[0]}}let r=t.maCapability;if(r&&typeof r==="string"){r=r.indexOf(":")<0?{id:r,componentId:"main"}:{id:r.split(":")[1],componentId:r.split(":")[0]}}if(!i&&e.metadata.mainState){const t=e.metadata.mainState.split(":");i={id:t[1],componentId:t[0]}}if(!r&&e.metadata.mainAction){const t=e.metadata.mainAction.split(":");r={id:t[1],componentId:t[0]}}return this.generateMainStateFromDeviceProfile(e,i,t).then(i=>{n.ms=i;return this.generateMainActionFromDeviceProfile(e,r,t)}).then(i=>{n.ma=i;return this.generateDisplayResourcesFromDeviceProfile(e,t)}).then(t=>{n.dpResources=t;return this.generateLanguageFromDeviceProfile(e,n.mnmn,n.vid)}).then(e=>{n.language=e;return n})}generateVoiceMetaFromDeviceProfile(e,t={}){const n=o.cloneDeep(f);n.n=e.name;n.version=t.voiceVersion||t.version||"0.0.1";n.mnmn=t.mnid!==null&&t.mnid!==undefined?t.mnid:e.metadata.mnmn||this.config.mnid;n.vid=t.vid!==null&&t.vid!==undefined?t.vid:e.metadata.vid;n.dalias=e.name;const i=e.metadata.deviceType;if(i){n.dtype=i}else{const t=e.metadata.ocfDeviceType;const i=t?h.retrieveDeviceResourceType(t):null;n.dtype=i?i.dtype:e.name}return this.generateVoiceSmlFromDeviceProfile(e).then(e=>{n.sml=e;return n})}generateManifestFilesFromDeviceProfile(e,t,n={}){const r=i.resolve(t,l.UI_MANIFEST_FILE);const s=i.resolve(t,l.VOICE_MANIFEST_FILE);return this.generateUiMetaFromDeviceProfile(e,n).then(e=>c.writeFile(r,JSON.stringify(e,null,2))).then(()=>this.generateVoiceMetaFromDeviceProfile(e,n)).then(e=>c.writeFile(s,JSON.stringify(e,null,2)))}generateManifestFilesFromProjectPath(e={},t=process.cwd()){const n=i.join(t,l.DEVICE_PROFILE_FILE);const r=i.join(t,l.MANIFEST_DIR);if(!c.existsSync(n)||!c.existsSync(r))throw new p("NOT_IN_PROJECT_DIRECTORY");const s=c.readJsonSync(n);const o=i.resolve(l.MANIFEST_DIR,l.UI_MANIFEST_FILE);const a=i.resolve(l.MANIFEST_DIR,l.VOICE_MANIFEST_FILE);return this.generateUiMetaFromDeviceProfile(s,e).then(e=>c.writeFile(o,JSON.stringify(e,null,2))).then(()=>this.generateVoiceMetaFromDeviceProfile(s,e)).then(e=>c.writeFile(a,JSON.stringify(e,null,2)))}generateUiMetaFromCapability(e,t,n={}){const i=o.cloneDeep(I);i.n="NoDeviceName";i.version="0.0.1";i.mnmn=this.config.mnid;i.vid="NoVid";return this.retrieveCapabilityMapperFile(e,t,true).then(r=>{if(r.ms&&r.ms.length>0){i.ms=T(r.ms,e,t,n)}if(r.ma&&r.ma.length>0){i.ma=g(r.ma,e,t,n)}if(r.dpResources&&r.dpResources.length>0){i.dpResources=[];let s=1;r.dpResources.forEach((r,o)=>{const c=A(r,s,o,e,t,n);s+=1;i.dpResources.push(c)})}return i})}generateVoiceMetaFromCapability(e,t){const n=o.cloneDeep(f);n.n="NoDeviceName";n.version="0.0.1";n.mnmn=this.config.mnid;n.vid="NoVid";n.dalias="NoDeviceAlias";n.dtype="NoDeviceType";return this.generateVoiceSmlFromCapability(e,t).then(e=>{n.sml=e;return n})}static getMainAction(e){if(!e.ma||!e.ma[0]||!e.ma[0].link||!e.ma[0].link.href)return null;const t=e.ma[0].link.href.split("/");if(!t[2]||!t[3])return null;return{id:t[2],componentId:t[3]}}static getMainState(e){if(!e.ms||!e.ms[0]||!e.ms[0].label||!e.ms[0].label.arguments[0]||!e.ms[0].label.arguments[0].href)return null;const t=e.ms[0].label.arguments[0].href.split("/");if(!t[2]||!t[3])return null;return{id:t[2],componentId:t[3]}}generateMainStateFromDeviceProfile(e,t,n={}){if(!t){return r.resolve([])}if(!t.id){return r.reject(new p("INVALID_CAPABILITY"))}const i=e.components.find(e=>e.id===t.componentId);if(!i){return r.reject(new p("INVALID_COMPONENT_ID",t.componentId))}const s=i.capabilities.find(e=>e.id===t.id);if(!s){return r.reject(new p("INVALID_COMPONENT_ID",`${t.componentId}:${t.id}`))}return this.retrieveCapabilityMapperFile(t.id,i.id,true).then(e=>{if(!e.ms||e.ms.length===0){throw new p("INVALID_MAIN_STATE_CAPABILITY",t.id)}return T(e.ms,t.id,i.id,n)})}generateMainActionFromDeviceProfile(e,t,n={}){if(!t||!t.id){return r.resolve([])}const i=e.components.find(e=>e.id===t.componentId);if(!i){return r.reject(new p("INVALID_COMPONENT_ID",t.componentId))}const s=i.capabilities.find(e=>e.id===t.id);if(!s){return r.reject(new p("INVALID_COMPONENT_ID",`${t.componentId}:${t.id}`))}return this.retrieveCapabilityMapperFile(t.id,i.id,true).then(e=>{if(!e.ma||e.ma.length===0){throw new p("INVALID_MAIN_ACTION_CAPABILITY",t.id)}return g(e.ma,t.id,i.id,n)})}generateDisplayResourcesFromDeviceProfile(e,t={}){const n=e.components.find(e=>e.id==="main");const i=e.components.filter(e=>e.id!=="main");const s=[];let o=1;return r.each(n.capabilities,e=>this.retrieveCapabilityMapperFile(e.id,"main",false).then(n=>n.dpResources.forEach((n,i)=>{const r=A(n,o,i,e.id,"main",t);o+=1;s.push(r)}))).then(()=>r.each(i,e=>r.each(e.capabilities,n=>this.retrieveCapabilityMapperFile(n.id,e.id,true).then(i=>i.dpResources.forEach((i,r)=>{const c=A(i,o,r,n.id,e.id,t);o+=1;s.push(c)}))))).then(()=>s)}generateLanguageFromDeviceProfile(e,t,n){const i=[];return r.each(e.components,s=>r.each(s.capabilities,r=>this.retrieveCapabilityMapperFile(r.id,s.id,true).then(r=>r.language.forEach(r=>{const s=i.find(e=>e.locale===r.locale);if(s){s.poCodes=o.unionWith(s.poCodes,r.poCodes,o.isEqual)}else{const s=o.cloneDeep(r);s.mnmn=t!==null&&t!==undefined?t:e.metadata.mnmn||this.config.mnid;s.vid=n!==null&&n!==undefined?n:e.metadata.vid;i.push(s)}})))).then(()=>{const e=i[0];if(!e)return r.resolve();return this.retrieveAllPoCodeResources().each(t=>{if(t.locale===e.locale)return;const n={locale:t.locale,poCodes:e.poCodes.map(e=>({po:e.po,label:t.poCodes[e.po]||e.label})),version:e.version,mnmn:e.mnmn,vid:e.vid};i.push(n)})}).then(()=>i)}generateVoiceSmlFromDeviceProfile(e){const t=[];const n={};const i=e.components.find(e=>e.id==="main");const s=e.components.filter(e=>e.id!=="main");return r.each(i.capabilities,e=>this.retrieveCapabilityMapperFile(e.id,"main",false).then(i=>{if(i.voiceCapability&&!n[e.id]&&Object.keys(i.voiceCapability).length>0){if(Array.isArray(i.voiceCapability)){i.voiceCapability.forEach(e=>t.push(e))}else{t.push(i.voiceCapability)}n[e.id]=true}})).then(()=>r.each(s,e=>r.each(e.capabilities,i=>this.retrieveCapabilityMapperFile(i.id,e.id,true).then(e=>{if(e.voiceCapability&&!n[i.id]&&Object.keys(e.voiceCapability).length>0){const r=e.voiceCapability;if(Array.isArray(r)){r.forEach(e=>t.push(e))}else{t.push(r)}n[i.id]=true}})))).then(()=>t)}generateVoiceSmlFromCapability(e,t){const n=[];const i={};return this.retrieveCapabilityMapperFile(e,t,true).then(t=>{if(t.voiceCapability&&!i[e]&&Object.keys(t.voiceCapability).length>0){const r=t.voiceCapability;if(Array.isArray(r)){r.forEach(e=>n.push(e))}else{n.push(r)}i[e]=true}}).then(()=>n)}retrieveCapabilityMapperFile(e,t="main",n){if(this.capabilityMap[e]&&this.capabilityMap[e][t]){return r.resolve(this.capabilityMap[e][t])}let i;return this.getMapperFileFromCapability(e,t).then(e=>{i=e;return c.exists(i)}).then(n=>{if(!n)throw new p("CANNOT_FIND_MAPPER_FILE",i);return c.readFile(i,"utf8").then(n=>{const i=JSON.parse(n);if(!this.capabilityMap[e])this.capabilityMap[e]={};this.capabilityMap[e][t]=i;return i})}).catch(i=>{if(!n)throw i;E.warn(`Mapping capability to resource failed... ${t}:${e}`);E.info('Retrying resource mapping with "main" component...');return this.retrieveCapabilityMapperFile(e,"main",false).then(n=>{const i=`/capability/${e}/main/`;const r=`/capability/${e}/${t}/`;return JSON.parse(JSON.stringify(n).split(i).join(r))}).then(n=>{if(!this.capabilityMap[e])this.capabilityMap[e]={};this.capabilityMap[e][t]=n;return n})})}getMapperFileFromCapability(e,t){if(!this.capability2MapperFile){return c.readFile(this.mapToResourcesFile,"utf8").then(n=>{const i=JSON.parse(n);this.capability2MapperFile={};Object.keys(i).forEach(e=>{this.capability2MapperFile[e]={};i[e].forEach(t=>{const n=this.getResourceFilePathFromTitle(t.title);this.capability2MapperFile[e][t.component]=n})});return this.getMapperFileFromCapability(e,t)})}if(this.capability2MapperFile[e]&&this.capability2MapperFile[e][t]){return r.resolve(this.capability2MapperFile[e][t])}return r.reject(new p("CANNOT_FIND_CAPABILITY_MAPPER_FILE",`${e}:${t}`))}getResourceFilePathFromTitle(e){const t=e.split(" ").map(e=>`${e.charAt(0).toUpperCase()}${e.substr(1)}`).join("");return s.resolve(this.baseDir,"resource-names",`${t}.json`)}retrieveAllPoCodeResources(){if(this.poCodeResources.length>0)return r.resolve(this.poCodeResources);return c.readFile(s.resolve(this.baseDir,"po-code-resources","newLocale.json"),"utf8").then(e=>{const t=JSON.parse(e);return Object.keys(t).map(e=>({locale:e,poCodes:t[e]}))}).then(e=>{this.poCodeResources=e;return e})}}e.exports=new Proxy(O,d())},function(e,t,n){const i=n(2).getRoot;const r=n(5);const s=n(4);const o=n(97);const c=n(3);const a=n(1);const u=n(0);let l;function h(){l=n(98)}function p(e){const t={};e.forEach(e=>{const n=Object.keys(e)[0];if(e[n].queryParameters.if){t[n]=e[n].queryParameters.if.enum}});return t}function d(e,t){let n={};e.forEach(e=>{const i=e.$ref.split("#/definitions/");if(!i||i.length<2)return;const r=i[0];const s=i[1];if(!t[r]||!t[r].definitions||!t[r].definitions[s])return;const o=t[r].definitions[s];if(o.properties){n=Object.assign(n,o.properties)}else if(o.allOf){n=Object.assign(n,d(o.allOf,t))}});return n}function E(e,t,n){const i=e.toJSON();const r=i.resources[0].displayName;const s=i.resources[0].description;const c=p(i.traits);let u=[];i.resources[0].is.forEach(e=>{u=o(u,c[e])});const l={};i.resources[0].methods.forEach(e=>{let r;let s;let o;if(e.body){r=e.body["application/json"].schema;o=e.body["application/json"].example}else if(e.responses["200"].body){r=e.responses["200"].body["application/json"].schema;o=e.responses["200"].body["application/json"].example}if(r){try{s=JSON.parse(r)}catch(e){if(i.schemas){const e=i.schemas.find(e=>Object.keys(e)[0]===r);const t=Object.keys(e)[0];s=JSON.parse(e[t])}}if(s){const e=s.definitions[t];if(e&&!e.properties&&e.allOf){e.properties=d(e.allOf,n)}}else{throw new a("CANNOT_PARSE_SCHEMA")}}l[e.method]={};if(e.body){l[e.method].body=s.definitions[t].properties}else{l[e.method].response=s.definitions[t].properties}if(o){try{l[e.method].example=JSON.parse(o)}catch(e){throw new a("CANNOT_PARSE_EXAMPLE")}}l[e.method].required=s.required});return{rt:t,displayName:r,description:s,is:u,methods:l}}class _{constructor(){this.refJsonFileMap=null}init(){h();this.resourceTypeDirPath=s.resolve(i(),"assets/resource_types/")}retrieveResourceTypeList(e=false){return(e?this.initRefJsonFileMap():c.resolve()).then(()=>r.readDir(this.resourceTypeDirPath)).then(e=>{const t=e.filter(e=>s.extname(e)===".raml");const n=t.map(e=>({id:s.basename(e,".raml")}));return n}).then(t=>{if(!e)return t;return c.map(t,e=>this.retrieveResourceType(e.id)).then(e=>e.map(e=>Object.assign({},e,{id:e.rt})))})}retrieveResourceType(e){const t=this.resourceTypeDirPath;return this.initRefJsonFileMap().then(()=>r.readFile(s.resolve(t,`${e}.raml`))).then(e=>l.parseRAML(e.toString(),{httpResolver:{getResourceAsync:()=>c.reject(new a("AVOID_TIME_OUT"))},fsResolver:{contentAsync:e=>{const n=s.basename(e);const i=this.refJsonFileMap[n];if(i)return c.resolve(JSON.stringify(i));const o=s.resolve(t,n);return r.readFile(o,"utf8")}}})).catch(e=>{throw new a("CANNOT_PARSE_RAML",e.message)}).then(t=>E(t,e,this.refJsonFileMap))}initRefJsonFileMap(){const e=this.resourceTypeDirPath;if(this.refJsonFileMap)return c.resolve();this.refJsonFileMap={};return r.readDir(this.resourceTypeDirPath).then(t=>{const n=t.filter(e=>s.extname(e)===".json");return c.each(n,t=>r.readJson(s.resolve(e,t)).then(e=>{this.refJsonFileMap[s.basename(t)]=e}))})}}e.exports=new Proxy(_,u())},function(e,t){e.exports=require("xml2js")},function(e,t,n){const i=n(65);const r=n(120);const s=n(66);const o=n(67);const c=n(121);const a=Object.freeze({CLOUD_CONNECTED:"Cloud-Connected",AUTOMATION:"Automation",C2C:"Cloud-to-Cloud",SERVICE:"Service Plugin"});const u=Object.freeze({ALPHA:"Self-Published",RC:"Certification-Requested"});class l{constructor(e,t,n,i){this.id=e;this.name=t;this.description=n;this.type=i||a.CLOUD_CONNECTED;switch(this.type){case a.AUTOMATION:this.status=null;this.connectorApp=null;this.appCatalog=null;break;case a.SERVICE:this.status=null;this.connectorApp=null;this.plugin=null;this.appCatalog=null;break;case a.CLOUD_CONNECTED:default:this.status=null;this.deviceProfile=null;this.uiManifest=null;this.voiceManifest=null;this.devicePlugin=null;this.prodCatalog=null}}static createFromResp(e){const t=new l(e.pjtId,e.pjtNm,e.pjtDsc,a.CLOUD_CONNECTED);t.status=t.certificated?u.RC:u.ALPHA;return t}static createFromCloudConnectedResp(e){const t=new l(e.pjtId,e.pjtNm,e.pjtDsc,a.CLOUD_CONNECTED);t.status=e.devStatNm;t.deviceProfile=i.createFromCloudConnectedResp(e.deviceProfile);if(e.prodCatalog){t.prodCatalog={id:e.prodCatalog.ctlgId,modelCd:e.prodCatalog.modelCd,easysetupId:e.prodCatalog.easysetupId,status:e.prodCatalog.devStatNm,whProdId:e.prodCatalog.refProdUuid,whGrpId:e.prodCatalog.refGrpUuid,refWhAppId:e.prodCatalog.refAppUuid}}if(e.uiManifest){t.uiManifest=c.createFromCloudConnectedResp(e.uiManifest)}if(e.voiceManifest){t.voiceManifest=c.createFromCloudConnectedResp(e.voiceManifest)}if(e.devicePlugin){t.devicePlugin=s.createFromResp(e.devicePlugin)}return t}static createListFromCloudConnectedResp(e){return e.rows.map(e=>{const t=new l(e.pjtId,e.pjtNm,"",a.CLOUD_CONNECTED);t.status=e.devStatNm||"Unknown";return t})}static createFromAutomationResp(e){const t=new l(e.pjtId,e.pjtNm,e.pjtDsc,a.AUTOMATION);t.status=e.devStatNm;t.connectorApp=r.createFromResp(e.connectorApp);t.appCatalog=o.createFromAutomationResp(e.appCatalog);return t}static createListFromAutomationResp(e){return e.rows.map(e=>{const t=new l(e.pjtId,e.pjtNm,e.pjtDsc,a.AUTOMATION);t.status=e.devStatNm;return t})}static createFromSvcPlgnResp(e,t=false){const n=new l(e.pjtId,e.pjtNm,e.pjtDsc,a.SERVICE);n.status=e.devStatNm;n.connectorApp=r.createFromResp(e.connectorApp);if(e.plugin){n.plugin=s.createFromResp(e.plugin)}n.appCatalog=o.createFromServicePluginResp(e.appCatalog);if(t){n.oauthClientId=e.connectorApp.clntId;n.oauthClientSecret=e.connectorApp.clntSec}return n}static createListFromSvcPlgnResp(e){return e.rows.map(e=>{const t=new l(e.pjtId,e.pjtNm,e.pjtDsc,a.SERVICE);t.status=e.devStatNm;return t})}toCreateRequestBody(){return{pjtNm:this.name,pjtDsc:this.description}}toUpdateRequestBody(){return{pjtNm:this.name,pjtDsc:this.description}}}l.TYPE=a;l.STATUS=u;e.exports=l},function(e,t){e.exports=require("fs")},function(e,t,n){const i=n(24);const r=n(82);const s=n(83);const o=n(23);const c=n(1);const a=255;const u=Buffer.alloc(1,a);const l=Object.freeze({CREATED:65,DELETED:66,VALID:67,CHANGED:68,CONTENT:69,BAD_REQUEST:128,UNAUTHORIZED:129,BAD_OPTION:130,FORBIDDEN:131,NOT_FOUND:132,METHOD_NOT_ALLOWED:133,NOT_ACCEPTABLE:134,PRECONDITION_FAILED:140,REQUEST_ENTITY_TOO_LARGE:141,UNSUPPORTED_CONTENT_FORMAT:143,INTERNAL_SERVER_ERROR:160,NOT_IMPLEMENTED:161,BAD_GATEWAY:162,SERVICE_UNAVAILABLE:163,GATEWAY_TIMEOUT:164,PROXYING_NOT_SUPPORTED:165});const h=Object.freeze({1:"GET",2:"POST",3:"PUT",4:"DELETE",65:"Created",66:"Deleted",67:"Valid",68:"Changed",69:"Content",128:"Bad Request",129:"Unauthorized",130:"Bad Option",131:"Forbidden",132:"Not Found",133:"Method Not Allowed",134:"Not Acceptable",140:"Precondition Failed",141:"Request Entity Too Large",143:"Unsupported Content-Format",160:"Internal Server Error",161:"Not Implemented",162:"Bad Gateway",163:"Service Unavailable",164:"Gateway Timeout",165:"Proxying Not Supported",225:"CSM",226:"Ping",227:"Pong",228:"Release",229:"Abort"});function p(e,t){const n=i.mapValues(e,e=>e===undefined?"":e);switch(t){case undefined:case o.CONTENT_FORMAT.CBOR:return s.encode(n);case o.CONTENT_FORMAT.JSON:return Buffer.from(JSON.stringify(n));default:throw new c("UNSUPPORTED_CONTENT_FORMAT",t)}}class d{constructor({code:e,token:t,options:n,payload:i}){this.code=e;if(t)this.token=t;else this.token=r.randomBytes(8);this.options=n;this.payload=i}makeBody(){const e=[];let t=0;const n=this.options;const i=this.payload;if(n){const i=n.toBytes();e.push(i);t+=i.length}if(i){const n=p(i,this.options.contentFormat);e.push(u);t+=1;e.push(n);t+=n.length}return Buffer.concat(e,t)}toTcpMessage(){const e=1;const t=Buffer.alloc(e,this.code);const n=this.token;const i=n.length;const r=this.makeBody();const s=r.length;let o;let a;let u;if(s<13){u=1;a=Buffer.alloc(u,0);o=s<<4|i;a.writeUInt8(o,0)}else if(s<(1<<8)+13){u=2;a=Buffer.alloc(u,0);o=13<<4|i;a.writeUInt8(o,0);a.writeUInt8(s-13,1)}else if(s<(1<<16)+269){u=3;a=Buffer.alloc(u,0);o=14<<4|i;a.writeUInt8(o,0);a.writeUInt16BE(s-269,1)}else if(s<(1<<32)+65805){u=5;a=Buffer.alloc(u,0);o=15<<4|i;a.writeUInt8(o,0);a.writeUInt32BE(s-65805,1)}else{throw new c("TOO_LARGE_TCP_BODY")}const l=u+e+i+s;return Buffer.concat([a,t,n,r],l)}toString(){const e=[];e.push(`code : ${h[this.code]}`);if(this.token)e.push(`token: ${this.token.toString("hex")}`);const t=this.options?this.options.toString():null;if(t)e.push(`options\n${t}`);e.push(`payload\n${JSON.stringify(this.payload,null,2)}`);return e.join("\n")}}d.decodeTcpMessage=(e=>{let t=0;const n=e.readUInt8(t);t+=1;let i=n>>4;const r=n&15;if(i===13){i=e.readUInt8(t)+13;t+=1}else if(i===14){i=e.readUInt16BE(t)+269;t+=2}else if(i===15){i=e.readUInt32BE(t)+65805;t+=4}const u=e.readUInt8(t);t+=1;const l=e.slice(t,t+r);t+=r;if(t+i>e.length)throw new Error("sliced packet");const h=[];let p=0;while(t<e.length){const n=e.readUInt8(t);if(n===a)break;t+=1;const i=n;let r=i>>4;let s=i&15;if(r===13){r=e.readUInt8(t)+13;t+=1}else if(r===14){r=e.readUInt16BE(t)+269;t+=2}else if(r>14){throw new c("INVALID_OPTION_DELTA",r)}p+=r;if(s===13){s=e.readUInt8(t)+13;t+=1}else if(s===14){s=e.readUInt16BE(t)+269;t+=2}else if(s>14){throw new c("INVALID_OPTION_LENGTH")}const o=e.slice(t,t+s);t+=s;h.push({number:p,value:o})}const E=h.length?o.fromRawOptions(h):null;let _=null;if(t<e.length){const n=e.readUInt8(t);t+=1;if(n!==a)throw new c("INVALID_PAYLOAD");_=e.slice(t);if(_&&_.length!==0){if(!E)_=s.decodeFirstSync(_);else{switch(E.contentFormat){case undefined:case o.CONTENT_FORMAT.CBOR:_=s.decodeFirstSync(_);break;case o.CONTENT_FORMAT.JSON:_=JSON.parse(_);break;default:_=`Unsupported Content Format: ${this.options.contentFormat}`}}}else{_={}}}return new d({code:u,token:l,options:E,payload:_})});d.STATUS_CODE=l;e.exports=d},function(e,t){e.exports=require("uuid")},function(e,t){e.exports=require("uuid/v4")},function(e,t){class n{constructor(e){this.href=e}toSimple(e){const t=new n(this.href.slice(this.href.indexOf(e)+e.length));t.rt=this.rt;return t}}const i=new n("/oic/d");i.rt=["oic.wk.d"];i.p={bm:1};i.type=["application/json"];i.if=["oic.if.baseline","oic.if.r"];const r=new n("/oic/p");r.rt=["oic.wk.p"];r.p={bm:1};r.type=["application/json"];r.if=["oic.if.baseline","oic.if.r"];n.DEFAULT_OIC_D_RESOURCE=i;n.DEFAULT_OIC_P_RESOURCE=r;e.exports=n},function(e,t,n){const i=n(3);const r=n(38);const{getServerConfig:s}=n(2);const o=n(15);const c=n(1);const a=n(0);class u{constructor(e){this.config=e}init(e){if(e){this.client=e;return}const t=s(this.config,"iotCloud");const n=s(this.config,"iotConsole");const i=s(this.config,"authProvider");const c=new o(this.config);c.init();const{key:a,cert:u}=c.getDeviceKeyCert();t.clientKey=a;t.clientCert=u;const l={iotCloud:t,authProvider:i,iotConsole:n,ssoToken:this.config.ssoToken,authCode:this.config.authCode,accessToken:this.config.accessToken,userId:this.config.userId,deviceId:this.config.deviceId};this.client=new r(l)}createGroup(e,t,n){return this.client.connect().then(()=>this.client.createGroup(e,t,n)).finally(()=>this.client.disconnect())}retrieveGroupList(){return this.client.connect().then(()=>this.client.retrieveGroupList()).finally(()=>this.client.disconnect())}retrieveGroup(e){return this.client.connect().then(()=>this.client.retrieveGroup(e)).finally(()=>this.client.disconnect())}updateGroup(e,t,n,i,r,s){return this.client.connect().then(()=>{if(t==="delete"&&r&&r.length>0){return this.validateDeletableDevices(e,r).then(()=>this.client.updateGroup(e,t,n,i,r,s))}return this.client.updateGroup(e,t,n,i,r,s)}).finally(()=>this.client.disconnect())}deleteGroup(e){return this.client.connect().then(()=>this.client.deleteGroup(e)).finally(()=>this.client.disconnect())}validateDeletableDevices(e,t){return this.client.retrieveGroup(e).then(n=>{const r=n.type==="Private";const s=Array.isArray(t)?t:[t];const o=false;return i.map(s.map(e=>this.client.retrieveDevice(e,o)),t=>{if(t.group.length===1&&t.group[0]===e&&r){throw new c("CANNOT_DELETE_DEVICE_FROM_GROUP",t.id,e)}})})}}e.exports=new Proxy(u,a())},function(e,t,n){const i=n(6);const r=n(17);const s=n(106);const o=n(39);const c=n(53);const a=n(8);const u=n(29);const l=n(3);const h=n(1);const p=n(14);const d=n(0);class E extends i{constructor(e){super();this.config=e;const t=e.iotCloud;const{clientKey:n,clientCert:i}=t;this.agent=new r(t,n,i);this.agent.on("close",()=>this.emit("close"));this.agent.on("debug",e=>this.emit("debug",e))}connect(){return this.agent.connect()}disconnect(){this.signedIn=false;if(this.intervalId)clearInterval(this.intervalId);return this.agent.disconnect()}isConnected(){return this.agent.isConnected()}validateCommandArgs(e,t,n){return this.agent.getDeviceResources(e).then(e=>{const n=e[0].links;const i=n.find(e=>e.href===t);if(!i)throw new h("CANNOT_FIND_RESOURCE_IN_DEVICE",t);const r=i.rt[0];if(!r)throw new h("CANNOT_FIND_TYPE_OF_RESOURCE");const s=new u;s.init();return s.retrieveResourceType(r)}).then(e=>{if(!e||!e.methods||!e.methods.post||!e.methods.post.body)throw new h("CANNOT_FIND_PROPERTY_DEFINITION");const t=Object.keys(e.methods.post.body);const i=Object.keys(n);const r=i.find(e=>!t.find(t=>t===e));if(r)throw new h("INVALID_PROPERTY",r)})}signIn(e,t,n){const i=this.signedIn?l.resolve():this.agent.signIn(e,t,n).then(()=>this.getPing()).then(()=>this.setPing()).then(()=>{this.signedIn=true;this.intervalId=setInterval(()=>{if(this.agent.isConnected())this.setPing().catch(e=>p.error("setPing() throws an error",e));else clearInterval(this.intervalId)},1e3*60*7)}).catch(e=>{if(e instanceof h&&e.code==="IOT_CLOUD_DEVICE_NOT_FOUND"){throw new h("IOT_CLOUD_CLIENT_DEVICE_NOT_FOUND",e)}throw e});return i}ensureSignIn(){const{deviceId:e,authProvider:t,iotConsole:n,userId:i,accessToken:r,ssoToken:s,authCode:o}=this.config;let c=l.resolve();if(!i||!r){if(o){c=l.resolve(o)}else{const t=new a(this.config,n);t.init();t.on("debug",e=>this.emit("debug",e));c=t.getAuthCodeBySsoToken(s,e)}return c.then(n=>this.agent.signUpWithAuthCode(n,t.uri,e,true).then(e=>{this.config.userId=e.uid;this.config.accessToken=e.accesstoken;return this.disconnect()})).then(()=>this.connect())}return c.then(()=>this.signIn(e,this.config.userId,this.config.accessToken))}commandDevice(e,t,n,i="/oic/route/",r,s,o=true){const c=t.charAt(0)==="/"?t:`/${t}`;const a=`${i}${e}${c}`;return this.ensureSignIn().then(()=>{if(!o)return l.resolve();return this.agent.getDeviceState(e).then(e=>{if(!e.prslist||e.prslist.length<=0||e.prslist[0].state!=="on"){throw new h("DEVICE_TURNED_OFF")}})}).then(()=>this.validateCommandArgs(e,a,n)).then(()=>this.agent.commandDevice(a,n,r,s))}retrieveDevice(e,t=true){return this.ensureSignIn().then(()=>l.join(t?this.agent.getDeviceState(e):l.resolve(),this.agent.getDeviceProfile(e),this.agent.getDeviceResources(e),this.agent.getGroupList(this.config.userId),(e,t,n,i)=>c.createFromResp(t,n,e,i)))}retrieveDeviceList(e=true,t){return this.ensureSignIn().then(()=>this.agent.getDeviceProfile()).then(({devices:e})=>{let n=e.filter(e=>e.rt||e.vid);if(t&&t.mnmn){n=n.filter(e=>e.mnmn===t.mnmn)}if(t&&t.rt){n=n.filter(e=>e.rt===t.rt)}if(t&&t.vid){n=n.filter(e=>e.vid===t.vid)}if(t&&t.name){n=n.filter(e=>e.n&&e.n.includes(t.name)||e.nick&&e.nick.includes(t.name))}return n}).then(e=>e.sort((e,t)=>{const n=e.nick||e.n||"";const i=t.nick||t.n||"";return n.localeCompare(i)||e.di.localeCompare(t.di)})).map(t=>(e?this.agent.getDeviceState(t.di):l.resolve()).then(e=>c.createListEntryFromResp(t,e)))}retrieveClientDeviceList(){let e;return this.retrieveDeviceList(false).then(t=>{e=t.map(e=>e.id);return this.agent.getDeviceList()}).then(({dilist:t})=>t.filter(t=>!e.includes(t)))}deleteDevice(e,t){return this.ensureSignIn().then(()=>{if(t)return this.agent.deleteDevice(e,this.config.accessToken);return this.retrieveDeviceList(false).then(t=>{const n=t.find(t=>t.id===e);if(n)return this.agent.deleteDevice(e,this.config.accessToken);throw new h("IOT_CLOUD_DEVICE_NOT_FOUND")})})}retrieveStatus(e,t,n=true){return this.ensureSignIn().then(()=>{const i=t.charAt(0)==="/"?t:`/${t}`;if(i==="/oic/p"||i==="/oic/d")return l.resolve();if(!n)return l.resolve();return this.agent.getDeviceState(e).then(e=>{if(!e.prslist||e.prslist.length<=0||e.prslist[0].state!=="on"){throw new h("DEVICE_TURNED_OFF")}})}).then(()=>this.agent.getDeviceResources(e)).then(e=>e[0].links.filter(e=>e.href.match(t))).then(e=>{if(!e||e.length<1)throw new h("CANNOT_FIND_RESOURCE");if(e.length>1)throw new h("TOO_MANY_RESOURCES");return this.agent.getDeviceResource(e[0].href)}).catch(e=>{if(e.message==="DEVICE_NOT_FOUND"){return l.reject(new h("DEVICE_TURNED_OFF"))}return l.reject(e)})}createGroup(e,t,n){if(!e)return l.reject(new h("NO_GROUP_NAME"));if(n&&!Array.isArray(n))return l.reject(new h("INVALID_MEMBERS_TYPE"));return this.ensureSignIn().then(()=>this.agent.createGroup(e,this.config.userId,t,n)).then(e=>s.mapToGroup(e))}getAllSubGroups(e,t){return this.agent.getGroup(t,this.config.userId).then(t=>{const n=s.mapToGroup(t);e.push(n);return l.reduce(n.subGroups,this.getAllSubGroups.bind(this),e)})}retrieveGroupList(){return this.ensureSignIn().then(()=>this.agent.getGroupList(this.config.userId)).then(({groups:e})=>{const t=s.mapToGroupList(e);let n=[];t.forEach(e=>{n=n.concat(e.subGroups)});return l.reduce(n,this.getAllSubGroups.bind(this),t)})}retrieveGroup(e){if(!e)return l.reject(new h("NO_GROUP_ID"));return this.ensureSignIn().then(()=>this.agent.getGroup(e,this.config.userId)).then(e=>s.mapToGroup(e))}updateGroup(e,t,n,i,r,s){if(!e)return l.reject(new h("NO_GROUP_ID"));const o=t||"";if(o!=="add"&&o!=="delete"&&o!==""){return l.reject(new h("INVALID_OPERATION"))}const c=r&&!Array.isArray(r)?[r]:r;const a=n&&!Array.isArray(n)?[n]:n;const u=i&&!Array.isArray(i)?[i]:i;const p=s&&!Array.isArray(s)?[s]:s;return this.ensureSignIn().then(()=>this.agent.updateGroup(e,o,a,u,c,p))}deleteGroup(e){if(!e)return l.reject(new h("NO_GROUP_ID"));return this.ensureSignIn().then(()=>this.agent.getGroup(e,this.config.userId)).then(e=>s.mapToGroup(e)).then(t=>{if(t.type===o.TYPE.PRIVATE)throw new h("CANNOT_DELETE_DEFAULT_GROUP",t.name);return this.agent.deleteGroup(e,this.config.userId)})}getDeviceResources(e){if(!e)return l.reject(new h("NO_DEVICE_ID"));return this.ensureSignIn().then(()=>this.agent.getDeviceResources(e))}subscribeDevicePresence(e){if(!e)throw new h("NO_DEVICE_ID");return this.ensureSignIn().then(()=>this.agent.observeDeviceState(e,t=>{if(t.prslist&&t.prslist[0]&&t.prslist[0].state){this.emit(e,t.prslist[0].state)}}))}unsubscribeDevicePresence(e){if(!e)throw new h("NO_DEVICE_ID");return this.ensureSignIn().then(()=>this.agent.cancelObserveDeviceState(e))}subscribeServiceEvent(e){return this.ensureSignIn().then(()=>this.agent.observeServiceEvent(t=>{if(e){if(!Array.isArray(e))throw new h("INVALID_EVENT_TYPES");if(e.includes(t.observeresponsetype)){this.emit(t.observeresponsetype,t)}}else{this.emit(t.observeresponsetype,t)}}))}subscribeDeviceResource(e){if(!e)throw new h("NO_RESOURCE_HREF");return this.ensureSignIn().then(()=>this.agent.observeResource(e,t=>this.emit(e,t)))}unsubscribeDeviceResource(e){if(!e)throw new h("NO_RESOURCE_HREF");return this.ensureSignIn().then(()=>this.agent.cancelObserveResource(e))}getPing(){return this.agent.getPing()}setPing(){return this.agent.setPing(8)}}e.exports=new Proxy(E,d())},function(e,t){const n=Object.freeze({PRIVATE:"Private",PUBLIC:"Public"});class i{constructor(e){this.id=e.gid;this.name=e.gname;this.latitude=e.latitude;this.longitude=e.longitude;this.radius=e.radius;this.backgroundImage=e.backgroundImage;this.gacl=e.gacl;this.createTime=e.createTime;this.updateTime=e.updateTime;this.owner=e.owner;this.type=e.type;this.members=e.members;this.masters=e.masters;this.parent=e.parent;this.subGroups=e.subGroups;this.devices=e.devices;this.resources=e.response}}i.TYPE=n;e.exports=i},function(e,t,n){const i=n(3);const r=n(18);const s=n(117);const o=n(4);const c=o.join;const a=o.basename;function u(e,t){return i.each(t,t=>{const n=a(t);return r.stat(t).then(i=>{if(i.isDirectory()){return r.readdir(t).then(i=>{const r=i.map(e=>c(t,e));return u(e.folder(n),r)})}return r.readFile(t).then(t=>{if(i.mode){return e.file(n,t,{unixPermissions:i.mode})}return e.file(n,t)})})})}function l(e,t,n){if(!t)throw Error("Invalid archive file name");const i=new s;return u(i,n).then(()=>i.generateAsync({type:"nodebuffer",platform:process.platform,compression:"DEFLATE",compressionOptions:{level:5}})).then(n=>r.outputFile(c(e,t),n))}function h(e,t){return r.readFile(e).then(e=>s.loadAsync(e)).then(e=>{const n=e.files;const s=Object.keys(n);return i.each(s,e=>{const i=n[e];const s=c(t,e);if(i.dir){return r.ensureDir(s)}return i.async("nodebuffer").then(e=>{r.outputFile(s,e)})})})}e.exports={zip:l,unzip:h}},function(e,t,n){const i=n(3);const r=n(10);const s=n(4);const o=n(6);const{getServerConfig:c}=n(2);const a=n(5);const u=n(11);const l=n(7);const h=n(47);const p=n(118);const d=n(9);const E=n(13);const _=n(1);const I=n(0);class f extends o{constructor(e){super();this.config=e}init(e){const{accessToken:t}=this.config;const n=c(this.config,"stCloud");this.agent=e||new u(t,n);this.awsManager=new h(this.config);this.awsManager.init()}registerSmartApp(e){const t=e;return this.validateSmartAppConfig(t).then(()=>{const e=t.appType===E.APP_TYPE.LAMBDA?t.lambdaSmartApp:t.webhookSmartApp;return this.createApp(t.appName,t.appType,e,t.displayName,t.description,t.singleInstance)})}registerLambdaSmartApp(e,t,n,r,s){if(!s||!s.length||s.length===0){return i.reject(new Error("Need Lambda ARNs"))}const o={};o.appName=e;o.appType=E.APP_TYPE.LAMBDA;o.displayName=t||"";o.description=n||"";o.singleInstance=r!==undefined?r:false;o.lambdaSmartApp={functions:Array.isArray(s)?s:[s]};return this.registerSmartApp(o)}registerWebhookSmartApp(e,t,n,r,s){if(!s){return i.reject(new Error("Need target URL of Webhook service"))}const o={};o.appName=e;o.appType=E.APP_TYPE.WEBHOOK;o.displayName=t||"";o.description=n||"";o.singleInstance=r!==undefined?r:false;o.webhookSmartApp={targetUrl:s};return this.registerSmartApp(o)}registerSmartAppInProject(e){let t;return this.validateProjectConfig(e).then(n=>{t=n.endpointApp;if(t.appType===E.APP_TYPE.LAMBDA){if(t.lambdaSmartApp.functions.length===0){this.emit("progress","Registering Lambda Function on AWS...");return this.registerLambdaFunction(e)}return t.lambdaSmartApp.functions}throw new Error(`Invalid Smart-App type... ${t.appType}`)}).then(n=>{const s=r(t);if(s.appType===E.APP_TYPE.LAMBDA){s.lambdaSmartApp={functions:Array.isArray(n)?n:[n]}}return this.registerSmartApp(s).catch(n=>{if(t.appType===E.APP_TYPE.LAMBDA&&t.lambdaSmartApp.functions.length===0){return this.cleanUpLambdaFunction(e).then(()=>i.reject(n))}throw n})})}retrieveSmartAppList(e){if(!e)return i.reject(new _("NO_APP_TYPE_PARAM"));if(!E.isValidAppType(e))return i.reject(new _("INVALID_APP_TYPE",e));const t=this.agent;function n(i,r,s){const o=s?t.get(r):t.getAppList(e);return o.then(({items:e,_links:t})=>{if(e){e.forEach(e=>i.push(new E(e)))}if(t&&t.next&&t.next.href){return n(i,t.next.href,true)}return i})}return n([])}retrieveSmartApp(e){if(!e)return i.reject(new _("NO_APP_NAME_OR_NO_APP_ID"));return this.agent.getApp(e).then(e=>new E(e)).catch(t=>{if(t.statusCode===403){throw new _("APP_NOT_FOUND",e)}throw t})}retrieveSmartAppInProject(e){return this.validateProjectConfig(e).then(e=>this.retrieveSmartApp(e.endpointApp.appName))}existsSmartApp(e){if(!e)return i.reject(new Error("needs app name or ID"));return this.agent.getApp(e).then(()=>true).catch(()=>false)}updateSmartApp(e){return this.validateSmartAppConfig(e).then(()=>this.updateApp(e))}updateLambdaSmartApp(e,t,n,i,s){return this.retrieveSmartApp(e).then(o=>{const c=r(o);if(t)c.displayName=t;if(n)c.description=n;if(i!==undefined)c.singleInstance=i;if(s){c.lambdaSmartApp={functions:Array.isArray(s)?s:[s]}}this.emit("progress",`Updating Lambda Smart-App... ${e}`);return this.updateSmartApp(c)})}updateSmartAppInProject(e,t){let n;return this.validateProjectConfig(e).then(i=>{n=i;return this.updateSmartAppInternalInProject(e,t)}).then(i=>{n.endpointApp=t;return l.updateConfig(e,n).then(()=>i)})}updateLambdaSmartAppInProject(e,t,n,i,s){return l.retrieveConfig(e).then(o=>{const c=r(o.endpointApp);if(t)c.displayName=t;if(n)c.description=n;if(i!==undefined)c.singleInstance=i;if(s){c.lambdaSmartApp={functions:Array.isArray(s)?s:[s]}}return this.updateSmartAppInProject(e,c)})}deleteSmartApp(e){if(!e)return i.reject(new _("NO_APP_NAME_OR_NO_APP_ID"));return this.agent.deleteApp(e)}deleteLambdaSmartApp(e,t=false){if(!e)return i.reject(new _("NO_APP_NAME_OR_NO_APP_ID"));if(t){return this.retrieveSmartApp(e).then(t=>i.each(t.lambdaSmartApp.functions,e=>{const t=e.split(":").slice(-1)[0];return this.awsManager.deleteLambdaFunction(t)}).then(()=>this.agent.deleteApp(e)))}return this.agent.deleteApp(e)}deleteSmartAppInProject(e){return this.validateProjectConfig(e).then(e=>this.deleteSmartApp(e.endpointApp.appName))}deleteLambdaSmartAppInProject(e,t){const n=s.join(e,l.SMART_APP_DIR);return this.validateProjectConfig(e).then(e=>a.exists(n).then(n=>this.deleteLambdaSmartApp(e.endpointApp.appName,t||n)))}updateSmartAppOauth(e,t,n){if(!e)return i.reject(new _("NO_APP_NAME_OR_NO_APP_ID"));if(n&&!Array.isArray(n))return i.reject(new _("INVALID_SCOPE"));const r={clientName:t,scope:n};return this.agent.updateAppOauth(e,r).then(e=>({clientName:e.clientName||"",scope:e.scope}))}updateSmartAppOauthInProject(e,t,n){return this.validateProjectConfig(e).then(e=>this.updateSmartAppOauth(e.endpointApp.appName,t,n))}retrieveSmartAppOauth(e){if(!e)return i.reject(new _("NO_APP_NAME_OR_NO_APP_ID"));return this.agent.getAppOauth(e)}retrieveSmartAppOauthInProject(e){return this.validateProjectConfig(e).then(e=>this.retrieveSmartAppOauth(e.endpointApp.appName))}updateSmartAppSettings(e,t){if(!e)return i.reject(new _("NO_APP_NAME_OR_NO_APP_ID"));if(t&&!Array.isArray(t))return i.reject(new _("INVALID_SETTINGS"));const n=this.config.stCloud.uri;const r={settings:{baseUrl:n}};t.forEach(e=>{const t=e.split(":")[0];const n=e.split(":").slice(1).join("");r.settings[t]=n});return this.agent.updateAppSettings(e,r)}updateSmartAppSettingsInProject(e,t){return this.validateProjectConfig(e).then(e=>this.updateSmartAppSettings(e.endpointApp.appName,t))}retrieveSmartAppSettings(e){if(!e)return i.reject(new _("NO_APP_NAME_OR_NO_APP_ID"));return this.agent.getAppSettings(e)}retrieveSmartAppSettingsInProject(e){return this.validateProjectConfig(e).then(e=>this.retrieveSmartAppSettings(e.endpointApp.appName))}retrieveLambdaConfig(e){const t=s.join(e,l.SMART_APP_DIR,l.LAMBDA_CONFIG_FILE);return a.exists(t).then(e=>{if(!e){throw new Error(`Lambda configuration file not found... ${t}`)}return a.readJson(t)}).then(e=>{const t=e;t.role=this.config.aws.role;return t})}validateSmartAppConfig(e){if(e.appType===E.APP_TYPE.LAMBDA&&!e.lambdaSmartApp){return i.reject(new Error('Missing "lambdaSmartApp" configuration'))}if(e.appType===E.APP_TYPE.WEBHOOK&&!e.webhookSmartApp){return i.reject(new Error('Missing "webhookSmartApp" configuration'))}return i.resolve()}validateProjectConfig(e){return l.retrieveConfig(e).then(e=>{if(e.type!==d.PROJ_TYPE.AUTOMATION&&e.type!==d.PROJ_TYPE.C2C){throw new Error("Project type is not Automation or C2C")}if(!e.endpointApp)throw new _("REGISTER_ENDPOINT_APP_NO_CONFIG");return e})}createApp(e,t,n,r,s,o){if(!e)return i.reject(new Error("needs app name"));if(!t)return i.reject(new Error("needs app type"));if(!n)return i.reject(new Error("needs app implementation"));if(!r)return i.reject(new Error("needs app display name"));if(!s)return i.reject(new Error("needs app description"));const c=new E({appName:e,appType:t,impl:n,displayName:r,description:s});if(o!==undefined)c.singleInstance=o;return this.agent.createApp(c.toRequestBody()).then(({app:e,oauthClientId:t,oauthClientSecret:n})=>{const i=new E(e);i.oauthClientId=t;i.oauthClientSecret=n;return i})}updateSmartAppInternalInProject(e,t){const n=s.join(e,l.SMART_APP_DIR);const o=t.appName;return a.exists(n).then(n=>{if(!n)throw new Error(`Smart-App not found... ${o}`);if(t.appType===E.APP_TYPE.LAMBDA&&t.lambdaSmartApp.functions.length===0){return this.updateLambdaFunction(e)}return i.resolve()}).then(e=>{const n=r(t);if(t.appType===E.APP_TYPE.LAMBDA&&e){n.lambdaSmartApp.functions=Array.isArray(e)?e:[e]}return this.updateApp(n)})}updateApp(e){const t=new E(e);const n=t.toRequestBody();delete n.appName;return this.agent.updateApp(t.appName,n).then(e=>new E(e))}registerLambdaFunction(e){const t=s.join(e,l.SMART_APP_DIR);const n=s.join(e,".lambda-out");return a.exists(t).then(e=>{if(!e)throw new _("REGISTER_ENDPOINT_APP_NO_LAMBDA")}).then(()=>this.retrieveLambdaConfig(e)).then(e=>this.awsManager.existsLambdaFunction(e.name).then(i=>{if(i)throw new Error(`Lambda Function already exists... ${e.name}`);this.emit("progress",`> Function name: ${e.name}`);const r=new p(this,t,n);r.on("progress",e=>this.emit("progress",`> ${e}`));return r.build().then(()=>{this.emit("progress","> Calling AWS API to create Lambda Function...");const t=s.join(n,p.LAMBDA_ZIP_FILE_NAME);return this.awsManager.createLambdaFunction(t,e)}).then(e=>e.FunctionArn).finally(()=>{r.clean()})}))}cleanUpLambdaFunction(e){return this.retrieveLambdaConfig(e).then(e=>this.awsManager.existsLambdaFunction(e.name).then(t=>{if(!t)return i.resolve();return this.awsManager.deleteLambdaFunction(e.name)}))}updateLambdaFunction(e){const t=s.join(e,l.SMART_APP_DIR);const n=s.join(e,".lambda-out");return a.exists(t).then(e=>{if(!e)throw new _("REGISTER_ENDPOINT_APP_NO_LAMBDA")}).then(()=>this.retrieveLambdaConfig(e)).then(e=>this.awsManager.existsLambdaFunction(e.name).then(i=>{if(!i)throw new Error(`Lambda Function not found... ${e.name}`);this.emit("progress",`> Function name: ${e.name}`);const r=new p(this,t,n);r.on("progress",e=>this.emit("progress",`> ${e}`));return r.build().then(()=>{this.emit("progress","> Calling AWS API to update Lambda Function...");const t=s.join(n,p.LAMBDA_ZIP_FILE_NAME);return this.awsManager.updateLambdaFunction(t,e)}).then(e=>e.FunctionArn).finally(()=>{r.clean()})}))}}e.exports=new Proxy(f,I())},function(e,t){const n=Object.freeze({SETUP:"setupApp",SERVICE:"serviceApp",AUTOMATION:"automationApp"});function i(e){return e===n.SETUP||e===n.SERVICE||e===n.AUTOMATION}class r{constructor({appInternalName:e,appType:t,localizations:n}){this.appInternalName=e;this.appType=t;this.localizations=n}}r.APP_TYPE=n;r.isValidAppType=i;e.exports=r},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("debug")},function(e,t,n){const i=n(26);const{StatusCodeError:r}=n(88);const s=n(43);const o=n(1);const c=n(0);const a=n(6);const u="AUT_1882";class l extends a{constructor(e){super();const{uri:t,proxy:n,rejectUnauthorized:r}=e;this.requestManager=new i(t,n,r);this.requestManager.on("debug",e=>this.emit("debug",e))}getAuthCodeBySsoToken(e,t){const n=i.METHODS.GET;const c="/auth/oauth2/authorize";const a={response_type:"code",sso_token:e,physical_address_text:t,service_type:"W",client_id:l.CLIENT_ID,scope:"iot.client iot.device iot.dev",redirect_uri:"https://get.authcode.from.ssotoken"};const h={followRedirect:false};return this.requestManager.request(n,c,a,null,null,false,h).catch(r,e=>{if(!e.response.headers.location){let t=e.message.replace(/\\/g,"");const n=t.indexOf("{");t=t.substring(n,t.length).trim();const i=JSON.parse(t);if(i.error_code===u){throw new o("INVALID_SSO_TOKEN")}throw e}return Promise.resolve(s.parse(e.response.headers.location.split("?")[1]).code)}).catch(e=>{if(e instanceof o)throw e;throw new o("CANNOT_GET_AUTH_CODE",e)})}}l.CLIENT_ID="3694457r8f";e.exports=new Proxy(l,c())},function(e,t,n){const i=n(90);const{getServerConfig:r}=n(2);const s=n(1);const o=n(0);const c="a05c000000MPRri";const a="a0G11000004qqOD";class u{constructor(e){this.configurator=e}init(e){const t=this.configurator.getConfig();const n=r(t,"devPortal");this.agent=e||new i(n)}requestEnrollmentData(){const e=this.configurator.get("devPortal");const t=this.configurator.get("userId");if(!e)throw new s("NO_DEV_PORTAL");if(!t)throw new s("NO_USER_ID");let{programId:n}=e;if(!n)throw new s("NO_PROGRAM_ID");if(n===c){this.configurator.set("devPortal.programId",a);n=a}return this.agent.requestAccount(t,n).then(e=>{const t=e.data.Contact.Email;this.configurator.set("email",t);const n=e.data.Contact.Name;const i=e.data.Contact.MNid__c;const r=e.data.Account.Name;const s=e.data.Account.MNid__c;const o=this.configurator.get("mnid");const c=this.configurator.get("mnnm");const a=o===i&&c===n||o===s&&c===r;if(!a){const e=r!=="Individual";if(e){this.configurator.set("mnid",s);this.configurator.set("mnnm",r)}else{this.configurator.set("mnid",i);this.configurator.set("mnnm",n)}}this.configurator.set("companyMnnm",r);this.configurator.set("companyMnid",s);this.configurator.set("individualMnid",i);this.configurator.set("individualMnnm",n)})}}e.exports=new Proxy(u,o())},function(e,t,n){const i=n(3);const r=n(92);const s=n(5);const{getProxy:o}=n(2);const c=n(1);const a=n(0);const u=["us-east-1","us-east-2","eu-west-1","ap-northeast-2"];const l="lambda:InvokeFunction";const h="smartthings";let p;function d(){p=n(93)}class E{constructor(e){this.config=e}init(){d();const e=this.config.aws&&this.config.aws.region;if(e&&u.indexOf(e)<0){throw new c("UNSUPPORTED_REGION",e,u.join(","))}const t=this.config.aws&&this.config.aws.accessKeyId;const n=this.config.aws&&this.config.aws.secretAccessKey;const i={region:e,accessKeyId:t,secretAccessKey:n};const s=o(this.config,"aws");if(s)i.httpOptions={agent:new r(s)};p.config.update(i)}createLambdaFunction(e,t){let n;return s.readFile(e).then(e=>{const{name:n,runtime:r,role:s,handler:o}=t;if(!n)throw new c("NO_LAMBDA_NAME");if(!r)throw new c("NO_LAMBDA_RUNTIME");if(!s)throw new c("NO_LAMBDA_ROLE");if(!o)throw new c("NO_LAMBDA_HANDLER");const a=new p.Lambda({region:this.config.aws.region,apiVersion:"2015-03-31"});const u=i.promisify(a.createFunction,{context:a});const l={FunctionName:n,Runtime:r,Role:s,Handler:o,Code:{ZipFile:e}};return u(l)}).then(e=>{n=e}).then(()=>this.addStInvokePermission(t.name)).then(()=>n)}listLambdaFunctions(){const e=new p.Lambda({region:this.config.aws.region,apiVersion:"2015-03-31"});const t=i.promisify(e.listFunctions,{context:e});const n={};return t(n)}existsLambdaFunction(e){return this.listLambdaFunctions().then(t=>t.Functions&&t.Functions.filter(t=>t.FunctionName===e).length>0)}updateLambdaFunction(e,t){const n=new p.Lambda({region:this.config.aws.region,apiVersion:"2015-03-31"});const r=i.promisify(n.updateFunctionCode,{context:n});const o=i.promisify(n.updateFunctionConfiguration,{context:n});let a;return s.readFile(e).then(e=>{const{name:n}=t;if(!n)throw new c("NO_LAMBDA_NAME");const i={FunctionName:n,ZipFile:e};return r(i)}).then(()=>{const{name:e,runtime:n,role:i,handler:r}=t;if(!e)throw new c("NO_LAMBDA_NAME");if(!n)throw new c("NO_LAMBDA_RUNTIME");if(!i)throw new c("NO_LAMBDA_ROLE");if(!r)throw new c("NO_LAMBDA_HANDLER");const s={FunctionName:e,Runtime:n,Role:i,Handler:r};return o(s)}).then(e=>{a=e}).then(()=>this.getLambdaPolicy(t.name)).then(e=>{const n=JSON.parse(e.Policy);if(n.Statement&&n.Statement.find(e=>e.Sid==="smartthings")){return this.removeStInvokePermission(t.name)}return i.resolve()}).then(()=>this.addStInvokePermission(t.name)).then(()=>a)}deleteLambdaFunction(e){return this.existsLambdaFunction(e).then(t=>{if(!t)throw new Error(`Lambda Function not found... ${e}`);const n=new p.Lambda({region:this.config.aws.region,apiVersion:"2015-03-31"});const r=i.promisify(n.deleteFunction,{context:n});const s={FunctionName:e};return r(s)})}addStInvokePermission(e){const t=new p.Lambda({region:this.config.aws.region,apiVersion:"2015-03-31"});const n=i.promisify(t.addPermission,{context:t});const r={Action:l,FunctionName:e,Principal:this.config.stCloud.awsAccount,StatementId:h};return n(r)}removeStInvokePermission(e){const t=new p.Lambda({region:this.config.aws.region,apiVersion:"2015-03-31"});const n=i.promisify(t.removePermission,{context:t});const r={FunctionName:e,StatementId:h};return n(r)}getLambdaPolicy(e){const t=new p.Lambda({region:this.config.aws.region,apiVersion:"2015-03-31"});const n=i.promisify(t.getPolicy,{context:t});const r={FunctionName:e};return n(r)}}e.exports=new Proxy(E,a())},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t,n){const i=n(4);const{getRoot:r}=n(2);const s=n(5);const o=n(28);const c=n(3);const a=n(99);const u=n(1);const l=n(0);const h=n(11);const{getServerConfig:p}=n(2);function d(e,t){return e.sort((e,n)=>{const i=e.version;const r=n.version;let s=0;if(i>r){s=1}else if(i<r){s=-1}if(!t||t.tolowercase()==="desc"){return s}return s*-1})}class E{constructor(e){this.config=e||{}}init(e){this.capabilitiesFilePath=i.resolve(r(),"assets/capabilities/capabilities.json");this.mapToResourcesFilePath=i.resolve(r(),"assets/capabilities/mapToResources.json");this.metaDataGenerator=new o;const{accessToken:t}=this.config;const n=p(this.config,"stCloud");this.agent=e||new h(t,n)}retrieveCapabilityList(e){let t={};let n={};const i=[];return s.readFile(this.capabilitiesFilePath).then(e=>{t=JSON.parse(e.toString());return s.readFile(this.mapToResourcesFilePath)}).then(e=>{n=JSON.parse(e.toString());return Object.keys(t)}).map(e=>{let t;let r;const s=n[e];if(!s)throw new u("CANNOT_FIND_MAP_TO_RESOURCES",e);const o=s.map(e=>e.component);if(o.length===0)throw new u("CANNOT_FIND_COMPONENTS",e);return c.resolve().then(()=>{const t=o.map(t=>this.canBeUsedAsMainState(e,t));return c.reduce(t,(e,t)=>{if(t)return true;return e},false)}).then(n=>{t=n;const i=o.map(t=>this.canBeUsedAsMainAction(e,t));return c.reduce(i,(e,t)=>{if(t)return true;return e},false)}).then(n=>{r=n;const c=new a(e,r,t,s,o);i.push(c)})}).then(()=>{if(e){if(e.mainState&&e.mainAction){return i.filter(e=>e.mainState&&e.mainAction)}else if(e.mainState&&!e.mainAction){return i.filter(e=>e.mainState)}else if(!e.mainState&&e.mainAction){return i.filter(e=>e.mainAction)}}return null}).then(()=>{if(e&&e.sdkOnly){return i}return this.retrieveCapabilityListFromSTCloud().then(e=>{const t=[];e.forEach(e=>{i.forEach(n=>{const i=n;if(n.id===e.id){i.status=e.status;i.version=e.version;t.push(i)}});const n=i.find(t=>t.id===e.id);if(!n){t.push(new a(e.id,null,null,null,null,e.version,e.status))}});return t})}).then(e=>e.sort((e,t)=>{if(e.id<t.id)return-1;if(e.id>t.id)return 1;return 0}))}canBeUsedAsMainAction(e,t){return this.metaDataGenerator.retrieveCapabilityMapperFile(e,t,true).then(e=>{if(!e.ma||e.ma.length===0)return false;return true})}canBeUsedAsMainState(e,t){return this.metaDataGenerator.retrieveCapabilityMapperFile(e,t,true).then(e=>{if(!e.ms||e.ms.length===0)return false;return true})}retrieveCapabilityToResourcesMapping(){return s.readFile(this.mapToResourcesFilePath,"utf8").then(e=>JSON.parse(e))}retrieveCapability(e,t){if(!t){return this.retrieveCapabilityVersionList(e,"asc").then(t=>this.agent.getCapability(e,t[0].version))}return this.agent.getCapability(e,t)}retrieveCapabilityVersionList(e,t){return this.agent.getCapabilityVersionList(e,t).then(e=>d(e.items))}retrieveCapabilityListFromSTCloud(){return this.agent.getCapabilityList().then(e=>e.items.sort((e,t)=>{if(e.id.toLowerCase()<t.id.toLowerCase())return-1;if(e.id.toLowerCase()>t.id.toLowerCase())return 1;return 0}))}}e.exports=new Proxy(E,l())},function(e,t){class n{constructor(e){this.n=e}}e.exports=n},function(e,t){class n{constructor(e,t){this.mnmn=e;this.vid=t}}e.exports=n},function(e,t,n){const i=n(12);const r=n(18);const s=n(4);const o=n(102);const c=n(35);const a=n(6);const u=n(103);const{merge:l,has:h,get:p,set:d,unset:E}=n(24);const{getFlatKeys:_,getServerConfig:I,encodeBase64:f,decodeBase64:P}=n(2);const T=n(1);const g=n(14);const A=n(0);const O=n(15);const N=["accessToken","accessTokenExpireDate","adbPath","authCode","authState","authProvider.proxy","authProvider.rejectUnauthorized","authProvider.uri","aws.accessKeyId","aws.proxy","aws.region","aws.role","aws.secretAccessKey","deviceId","devPortal.programId","devPortal.proxy","devPortal.rejectUnauthorized","devPortal.uri","iotCloud.proxy","iotCloud.redirecturi","iotCloud.rejectUnauthorized","iotCloud.serverCert","iotCloud.uri","iotCloud.useRedirection","iotConsole.proxy","iotConsole.rejectUnauthorized","iotConsole.uri","mnid","mnnm","individualMnid","individualMnnm","companyMnid","companyMnnm","proxy","refreshToken","refreshTokenExpireDate","securityPath","ssoToken","stCloud.awsAccount","stCloud.proxy","stCloud.rejectUnauthorized","stCloud.uri","userId","email","logLevel"];const m=["accessToken","accessTokenExpireDate","authCode","authState","aws.accessKeyId","aws.proxy","aws.region","aws.role","aws.secretAccessKey","mnid","mnnm","individualMnid","individualMnnm","companyMnid","companyMnnm","refreshToken","refreshTokenExpireDate","ssoToken","userId","email"];const C=".iotcloud";const S=s.resolve(i.homedir(),C);const D=S;const v="security";class L extends a{constructor(e,t){super();this.toolConfigFilePath=e;this.toolConfigDirPath=s.dirname(this.toolConfigFilePath);this.toolConfigDirName=s.basename(this.toolConfigDirPath);this.toolConfigFileName=s.basename(this.toolConfigFilePath,".json");this.systemConfigFilePath=t||s.resolve(S,"system/config.json");this.systemConfigDirPath=s.dirname(this.systemConfigFilePath);this.systemConfigFileName=s.basename(this.systemConfigFilePath,".json");this.oldProxyInToolConfig=null}static getServerConfig(e,t){return I(e,t)}static getDefault(){const e=s.resolve(S,"cli/config.json");const t=new L(e);t.init();return t}static isValidKey(e){if(typeof e!=="string")return false;return N.includes(e)}static getDefaultToolConfig(){return{deviceId:c(),logLevel:"INFO"}}static getDefaultSystemConfig(){return{proxy:"",adbPath:"",securityPath:f(D),authProvider:{uri:"https://us-auth2.samsungosp.com",rejectUnauthorized:true},devPortal:{uri:"https://devportalapi.developer.samsung.com:7020",programId:"a0Df40000002PHv",rejectUnauthorized:true},iotCloud:{uri:"coaps+tcp://connect.samsungiotcloud.com:443",useRedirection:true,rejectUnauthorized:true},iotConsole:{uri:"https://devworkspace.developer.samsung.com/smartthingsconsole/iotdev",rejectUnauthorized:true},stCloud:{uri:"https://api.smartthings.com/v1",awsAccount:"906037444270",rejectUnauthorized:true}}}static getDefaultSecurityConfig(){return{accessToken:"",accessTokenExpireDate:"",authCode:"",authState:"",companyMnid:"",companyMnnm:"",email:"",individualMnid:"",individualMnnm:"",mnid:"",mnnm:"",refreshToken:"",refreshTokenExpireDate:"",ssoToken:"",userId:""}}static getDefaultConfig(){const e=L.getDefaultToolConfig();const t=L.getDefaultSystemConfig();const n=L.getDefaultSecurityConfig();const i=l({},t,e,n);return new u(i)}static isStageMode(e){const{iotCloud:t,stCloud:n}=L.getDefaultConfig();const{iotCloud:i,stCloud:r}=e;return!(i.uri===t.uri&&r.uri===n.uri)}static isProductionMode(e){const{iotCloud:t,stCloud:n}=L.getDefaultConfig();const{iotCloud:i,stCloud:r}=e;return i.uri===t.uri&&r.uri===n.uri}static getMode(e){const t=e.iotConsole.uri;if(t.startsWith("https://d-"))return"develop";if(t.startsWith("https://s-"))return"stage";if(t.startsWith("https://dev"))return"production";if(t.startsWith("http://local"))return"local";return"develop"}changeMode(e){if(e==="stage"){this.set("authProvider.uri","https://us-auth2.samsungosp.com");this.set("devPortal.uri","https://s-devportalapi.developer.samsung.com:7020");this.set("devPortal.programId","a0G11000004qqOD");this.set("iotCloud.uri","coaps+tcp://connects.samsungiots.com:443");this.set("iotConsole.uri","https://s-devworkspace.developer.samsung.com/smartthingsconsole/iotdev");this.set("stCloud.uri","https://apis.smartthingsgdev.com");this.set("stCloud.awsAccount","084870046141");this.save()}else if(e==="production"){this.set("authProvider.uri","https://us-auth2.samsungosp.com");this.set("devPortal.uri","https://devportalapi.developer.samsung.com:7020");this.set("devPortal.programId","a0Df40000002PHv");this.set("iotCloud.uri","coaps+tcp://connect.samsungiotcloud.com:443");this.set("iotConsole.uri","https://devworkspace.developer.samsung.com/smartthingsconsole/iotdev");this.set("stCloud.uri","https://api.smartthings.com/v1");this.set("stCloud.awsAccount","906037444270");this.save()}else if(e==="develop"){this.set("authProvider.uri","https://stg-us-auth2.samsungosp.com");this.set("devPortal.uri","http://d-devportalapi.developer.samsung.com:7020");this.set("devPortal.programId","a05c000000MPWdo");this.set("iotCloud.uri","coaps+tcp://connectd.samsungiots.com:443");this.set("iotConsole.uri","https://d-devworkspace.developer.samsung.com/smartthingsconsole/iotdev");this.set("stCloud.uri","https://apid.smartthingsgdev.com");this.set("stCloud.awsAccount","084870046141");this.save()}else{throw new T("UNSUPPORTED_MODE",e)}const t=new O(this.getConfig());t.init();t.clearSecurityProfile()}changeMnidType(e){if(e!=="company"&&e!=="individual"){return Promise.reject(new T("UNSUPPORTED_MNID_TYPE"))}const t=this.get("mnid");const n=this.get("mnnm");if(e==="company"){const e=this.get("companyMnid");const i=this.get("companyMnnm");if(!e||!i)return Promise.reject(new T("NO_COMPANY_INFORMATION"));if(i.toLowerCase()==="individual"){return Promise.reject(new T("CANNOT_CHANGE_COMPANY_MNID"))}const r=t!==e||n!==i;if(r){this.set("mnid",e);this.set("mnnm",i);return this.issueNewDeviceCert().catch(e=>{this.set("mnid",t);this.set("mnnm",n);throw e})}}else{const e=this.get("individualMnid");const i=this.get("individualMnnm");if(!e||!i){return Promise.reject(new T("NO_INDIVIDUAL_INFORMATION"))}const r=t!==e||n!==i;if(r){this.set("mnid",e);this.set("mnnm",i);return this.issueNewDeviceCert().catch(e=>{this.set("mnid",t);this.set("mnnm",n);throw e})}}return Promise.resolve()}issueNewDeviceCert(){const e=new O(this.getConfig());e.init();return e.checkDeviceKeyCert().then(()=>{},()=>e.createDeviceCert()).catch(e=>{throw new T("REQUESTING_DEVICE_CERT_FAILED",e)})}setToolConfig(e){const t=L.filterToolConfig(e);this.toolConfig.clear();this.toolConfig.set(t)}setSystemConfig(e){const t=L.filterSystemConfig(e);this.systemConfig.set(t)}setSecurityConfig(e){const t=L.filterSecurityConfig(e);this.securityConfig.set(t)}static filterToolConfig(e){const t=_(e);const n=t.filter(e=>!L.isSystemProperty(e)&&!L.isSecurityProperty(e));const i={};n.reduce((t,n)=>{const i=p(e,n);d(t,n,i);return t},i);return i}static filterSystemConfig(e){const t=_(e);const n=t.filter(e=>L.isSystemProperty(e));const i={};n.reduce((t,n)=>{const i=n==="securityPath"?f(p(e,n)):p(e,n);d(t,n,i);return t},i);return i}static filterSecurityConfig(e){const t=_(e);const n=t.filter(e=>L.isSecurityProperty(e));const i={};n.reduce((t,n)=>{d(t,n,p(e,n));return t},i);return i}static isSystemProperty(e){return h(L.getDefaultSystemConfig(),e)||e.endsWith(".proxy")}static isSecurityProperty(e){return m.includes(e)}initToolConfig(){const e={};let t={};e.cwd=this.toolConfigDirPath;this.toolConfig=new o(this.toolConfigFileName,e);const n=L.getDefaultToolConfig();if(r.pathExistsSync(this.toolConfigFilePath)){try{t=r.readJsonSync(this.toolConfigFilePath);if(h(t,"proxy")){E(t,"proxy");this.toolConfig.del("proxy")}}catch(e){throw new T("CANNOT_LOAD_CONFIGURATION_FILE",this.toolConfigFilePath)}t=l({},n,t)}else{t=n}this.toolConfig.set(t);g.setLogLevel(this.toolConfig.get("logLevel"))}initSystemConfig(){const e={};let t={};e.cwd=this.systemConfigDirPath;this.systemConfig=new o(this.systemConfigFileName,e);const n=L.getDefaultSystemConfig();if(r.pathExistsSync(this.systemConfigFilePath)){try{t=r.readJsonSync(this.systemConfigFilePath);if(h(t,"iotCloud.redirecturi")){E(t,"iotCloud.redirecturi");this.systemConfig.del("iotCloud.redirecturi")}if(h(t,"iotCloud.serverCert")){E(t,"iotCloud.serverCert");this.systemConfig.del("iotCloud.serverCert")}}catch(e){throw new T("CANNOT_LOAD_CONFIGURATION_FILE",this.systemConfigFilePath)}t=l({},n,t)}else{t=n;if(this.oldProxyInToolConfig){t.proxy=this.oldProxyInToolConfig}}this.systemConfig.set(t)}initSecurityConfig(){const e=this.get("securityPath");const t=s.resolve(e,this.toolConfigDirName);const n=s.resolve(t,`${v}.json`);this.securityConfig=new o(v,{cwd:t});let i=L.getDefaultSecurityConfig();if(r.pathExistsSync(n)){try{i=r.readJsonSync(n)}catch(e){throw new T("CANNOT_LOAD_CONFIGURATION_FILE",n)}}this.securityConfig.set(i);const c=this.securityConfig.get("aws.role");if(!c)this.securityConfig.set("aws.role","")}changeSecurityPath(e){let t;try{L.validateSecurityPath(e);const n=e;const i=s.resolve(n,this.toolConfigDirName);t=new o(v,{cwd:i});t.set(L.getDefaultSecurityConfig())}catch(t){throw new T("CANNOT_CREATE_SECURITY",e,t.message)}this.emit("progress",`Change securityPath to ${e}. Please log-in again.`);this.securityConfig=t}static validateSecurityPath(e){if(!e)throw new T("PATH_IS_EMPTY");if(e.length&&e.length>255)throw new T("PATH_LENGTH_EXCEEDED");let t;if(i.platform()==="win32"){const n=/^[a-zA-Z]:\\/;const i=/^[a-zA-Z]:\//;if(n.test(e))t="\\";else if(i.test(e))t="/";else throw new T("PATH_WITHOUT_VOLUME");if(L.hasDisAllowedChar(e,t))throw new T("PATH_INCLUDES_ILLEGAL_CHAR")}else{t="/";const n=/^\//;if(!n.test(e))throw new T("PATH_IS_NOT_AN_ABSOLUTE_PATH");if(L.hasDisAllowedChar(e,t))throw new T("PATH_INCLUDES_ILLEGAL_CHAR")}}static hasDisAllowedChar(e,t){const n=["*","?",'"',"'",":","/","\\","\r","\n"];n.splice(n.indexOf(t),1);const r=e.split(t);if(i.platform()==="win32")r.splice(0,1);let s=false;r.forEach(e=>n.forEach(t=>{if(e.includes(t))s=true}));return s}init(){this.initToolConfig();this.initSystemConfig();this.initSecurityConfig()}getConfig(){const e=this.toolConfig.get();const t=this.systemConfig.get();const n=this.securityConfig.get();if(n.securityPath){n.securityPath=P(n.securityPath)}const i=l({},t,e,n);return new u(i)}setConfig(e){if(e.securityPath&&e.securityPath!==this.get("securityPath")){this.changeSecurityPath(e.securityPath)}this.setToolConfig(e);this.setSystemConfig(e);this.setSecurityConfig(e)}get(e){if(L.isSecurityProperty(e))return this.securityConfig.get(e);if(L.isSystemProperty(e)){if(e==="securityPath"){return P(this.systemConfig.get(e))}return this.systemConfig.get(e)}return this.toolConfig.get(e)}set(e,t){if(L.isSecurityProperty(e)){this.securityConfig.set(e,t);return}if(L.isSystemProperty(e)){if(e==="securityPath"){this.changeSecurityPath(t);this.systemConfig.set(e,f(s.resolve(t)))}else{this.systemConfig.set(e,t)}return}this.toolConfig.set(e,t)}save(){this.toolConfig.save();this.systemConfig.save();this.securityConfig.save()}del(e){const t={force:true};if(L.isSecurityProperty(e)){this.securityConfig.del(e,t);return}if(L.isSystemProperty(e)){this.systemConfig.del(e,t);return}this.toolConfig.del(e,t)}}e.exports=new Proxy(L,A())},function(e,t,n){const i=n(50);const r=n(51);const s=n(36);class o{constructor(){this.id="-";this.nick=null;this.state="-";this.group=[];this.device=null;this.platform=null;this.resources=null}toSimple(){return{id:this.id,nick:this.nick,state:this.state,group:this.group,device:this.device,platform:this.platform,resources:this.resources.map(e=>e.toSimple(this.id))}}toListEntry(){let e=this.device.rt.find(e=>e!=="oic.wk.d");if(!e){e="oic.wk.d"}return{id:this.id,name:this.device.n||this.nick,nick:this.nick,state:this.state,type:e,mnid:this.platform.mnmn,vid:this.platform.vid}}toCreateDeviceProfileBody(){let e=this.device.rt.find(e=>e!=="oic.wk.d");if(!e){e="oic.wk.d"}return{devices:[{di:this.id,n:this.device.n,nick:this.nick,mnmn:this.platform.mnmn,vid:this.platform.vid,rt:e}]}}toPublishDeviceBody(){return{di:this.id,n:this.device.n,links:this.resources}}static createFromResp(e,t,n,c){const a=n;const u=e.devices[0];const l=t[0];const h=c.groups;const p=new o;p.id=l.di;p.nick=u.nick;if(a&&a.prslist&&a.prslist.length>0){p.state=a.prslist[0].state}p.group=h.filter(e=>{const t=e.devices;if(t===undefined||t===null){return false}return e.devices.indexOf(p.id)>-1}).map(e=>e.gid);const d=l.links.find(e=>e.rt.indexOf("oic.wk.d")>-1);p.device=new i(l.n||u.n);p.device.icv=u.icv;p.device.dmv=u.dmv;p.device.rt=d?d.rt:null;p.platform=new r(u.mnmn,u.vid);p.platform.mnml=u.mnml||undefined;p.platform.mnmo=u.mnmo;p.platform.mndt=u.mndt||undefined;p.platform.mnpv=u.mnpv;p.platform.mnos=u.mnos;p.platform.mnhw=u.mnhw;p.platform.mnfv=u.mnfv;p.resources=l.links.map(e=>{const t=new s(e.href);t.title=e.title;t.rt=e.rt;t.p=e.p;t.type=e.type;t.if=e.if;return t});return p}static createListEntryFromResp(e,t){const n=t;const s=e;const c=new o;c.id=s.di;c.nick=s.nick;if(n&&n.prslist&&n.prslist.length>0){c.state=n.prslist[0].state}c.device=new i(s.n);c.device.icv=s.icv;c.device.dmv=s.dmv;c.device.rt=["oic.wk.d",s.rt];c.platform=new r(s.mnmn,s.vid);c.platform.mnml=s.mnml||undefined;c.platform.mnmo=s.mnmo;c.platform.mndt=s.mndt||undefined;c.platform.mnpv=s.mnpv;c.platform.mnos=s.mnos;c.platform.mnhw=s.mnhw;c.platform.mnfv=s.mnfv;c.resources=undefined;return c}}e.exports=o},function(e,t,n){const i=n(6).EventEmitter;const r=n(10);const s=n(8);const o=n(17);const c=n(33);const a=n(23);const u=n(53);const l=n(14);const h=n(3);const p=n(0);const d=Object.freeze({GET:1,POST:2,PUT:3,DELETE:4,SUBSCRIBE:5,UNSUBSCRIBE:6,NOTIFY:c.STATUS_CODE.CONTENT});const E=5e3;const _=2e3;class I extends i{constructor(e,t){super();if(e instanceof u){this.deviceId=e.id;this.ocfDeviceProfile=e.toCreateDeviceProfileBody();this.resources=e.toPublishDeviceBody()}else{this.deviceId=e.deviceId;if(e.ocfDeviceType){this.ocfDeviceProfile=e.ocfDeviceType.toCreateDeviceProfileBody(e.deviceId,e.nick);this.resources=e.ocfDeviceType.toPublishDeviceBody(e.deviceId)}else{this.ocfDeviceProfile=e.ocfDeviceProfile;this.resources=e.resources}}this.config=t;this.handlers=new Map;this.handlers.set(d.GET,new Map);this.handlers.set(d.POST,new Map);this.handlers.set(d.PUT,new Map);this.handlers.set(d.DELETE,new Map);this.handlers.set(d.SUBSCRIBE,new Map);this.handlers.set(d.UNSUBSCRIBE,new Map);this.subscribers=new Map;const{clientKey:n,clientCert:i}=t.iotCloud;this.agent=new o(t.iotCloud,n,i);this.agent.setRequestHandler(this.handleRequest.bind(this));this.agent.on("close",()=>this.emit("close"));this.agent.on("debug",e=>this.emit("debug",e))}handleRequest(e){let t=e.code;const n=e.options.observe;const i=e.options.uriPath;if(e.code===d.GET&&!!n&&n[0]===0)t=d.SUBSCRIBE;if(e.code===d.GET&&!!n&&n[0]===1)t=d.UNSUBSCRIBE;let r;if(t===d.SUBSCRIBE){r=this.handlers.get(t).get(i)||this.handlers.get(d.GET).get(i);const n=this.subscribers.get(i)||new Map;n.set(e.token,1);if(!this.subscribers.has(i))this.subscribers.set(i,n)}else if(t===d.UNSUBSCRIBE){r=this.handlers.get(t).get(i)||this.handlers.get(d.GET).get(i);const n=this.subscribers.get(i)||new Map;n.delete(e.token)}else{r=this.handlers.get(t).get(i)}const s=new c({code:c.STATUS_CODE.INTERNAL_SERVER_ERROR,token:e.token,options:new a});if(r){h.resolve().then(()=>r(e)).then(e=>{if(!(e instanceof c))this.agent.sendResponse(s);else this.agent.sendResponse(e)})}else{const t=new c({code:c.STATUS_CODE.NOT_IMPLEMENTED,token:e.token,options:new a});this.agent.sendResponse(t)}}addHandler(e,t,n){this.handlers.get(t).set(e,n)}ensureSignUp(){const{authProvider:e,iotConsole:t,userId:n,accessToken:i,ssoToken:o,authCode:c}=this.config;const a=this.deviceId;let u=h.resolve();if(!n||!i){if(c){u=h.resolve(c)}else{const e=new s(this.config,t);e.init();e.on("debug",e=>this.emit("debug",e));u=e.getAuthCodeBySsoToken(o,a)}return u.then(t=>this.agent.connect().then(()=>this.agent.signUpWithAuthCode(t,e.uri,a,true)).then(e=>{const t=r(this.config);t.userId=e.uid;t.accessToken=e.accesstoken;t.iotCloud.redirecturi=e.redirecturi;t.iotCloud.serverCert=e.certificate;this.agent.disconnect();return t}))}return u}ensurePublish(){const{userId:e,accessToken:t}=this.config;if(!e||!t)return this.publish();return this.agent.connect().then(()=>this.agent.signIn(this.deviceId,e,t)).then(()=>this.agent.getDeviceProfile(this.deviceId)).then(()=>{},()=>{this.agent.disconnect();return this.publish()})}publish(){return this.ensureSignUp().then(e=>{const{userId:t,accessToken:n}=e;const{clientKey:i,clientCert:r}=e.iotCloud;this.agent=new o(e.iotCloud,i,r);this.agent.setRequestHandler(this.handleRequest.bind(this));return this.agent.connect().then(()=>this.agent.signIn(this.deviceId,t,n)).then(()=>this.agent.createDeviceProfile(this.ocfDeviceProfile)).then(()=>new h(e=>{let t;const n=this.resources.links.find(e=>e.href==="/oic/d");const i={"/oic/p":false,"/oic/d":false};this.get("/oic/p",n=>{if(i["/oic/d"]){if(t)clearTimeout(t);t=setTimeout(e,_)}i["/oic/p"]=true;const r=this.ocfDeviceProfile.devices[0].vid;const s=this.ocfDeviceProfile.devices[0].mnmn;const o=new c({code:c.STATUS_CODE.CONTENT,token:n.token,payload:{vid:r,mnmn:s},options:new a({format:a.CONTENT_FORMAT.CBOR})});return o});this.get("/oic/d",r=>{if(i["/oic/p"]){if(t)clearTimeout(t);t=setTimeout(e,_)}i["/oic/d"]=true;const s=this.ocfDeviceProfile.devices[0].di;const o=this.ocfDeviceProfile.devices[0].n;const u=new c({code:c.STATUS_CODE.CONTENT,token:r.token,payload:{rt:n.rt,di:s,if:n.if,n:o},options:new a({format:a.CONTENT_FORMAT.CBOR})});return u});this.agent.publishResources(this.deviceId,this.resources);t=setTimeout(()=>{if(!i["/oic/p"]||!i["/oic/d"])l.info("Publish response time is over");e()},E)}))})}start(){return this.ensurePublish().then(()=>this.getPing()).then(()=>this.setPing()).then(()=>{this.intervalId=setInterval(()=>{if(this.agent.isConnected())this.setPing().catch(e=>l.error("setPing() throws an error",e));else clearInterval(this.intervalId)},1e3*60*7)})}stop(){const{userId:e,accessToken:t}=this.config;if(this.intervalId)clearInterval(this.intervalId);return this.agent.signOut(this.deviceId,e,t).then(()=>this.agent.disconnect())}get(e,t){this.addHandler(e,d.GET,t)}post(e,t){this.addHandler(e,d.POST,t)}put(e,t){this.addHandler(e,d.PUT,t)}delete(e,t){this.addHandler(e,d.DELETE,t)}subscribe(e,t){this.addHandler(e,d.SUBSCRIBE,t)}unsubscribe(e,t){this.addHandler(e,d.UNSUBSCRIBE,t)}notify(e,t){const n=this.getSubscribers(e);if(n){n.forEach((n,i)=>{const r=new c({code:c.STATUS_CODE.CONTENT,token:i,options:new a({observe:a.numberTo4Bytes(n),path:e,format:a.CONTENT_FORMAT.CBOR}),payload:t});this.agent.sendResponse(r);this.countNextSequence(e,i)})}}send(e){this.agent.sendResponse(e)}getSubscribers(e){return this.subscribers.get(e)}countNextSequence(e,t){const n=this.getSubscribers(e);const i=n.get(t);const r=i<a.MAX_OBSERVE?i+1:1;n.set(t,r)}getPing(){return this.agent.getPing()}setPing(){return this.agent.setPing(8)}}e.exports=new Proxy(I,p())},function(e,t,n){const i=n(8);const r=n(109);const{getServerConfig:s}=n(2);const o=n(5);const c=n(4);const a=n(56);const u=n(57);const l=n(1);const h=n(0);class p{constructor(e){this.config=e}init(e){this.agent=e||new i(this.config,s(this.config,"iotConsole"));this.workflowtype=`${this.config.mnid}_Metadata_Approval`}registerManifest(e,t){const n=t.toLowerCase();return o.readJson(c.resolve(e)).then(e=>{if(n==="ui"||n==="presentation")a.validate(e,u.uiSchema);if(a.error){const e=a.error.dataPath?` ${a.error.dataPath}`:"";throw Error(`Invalid metadata, ${a.error.message}${e}`)}return this.agent.createManifest(e,n)})}retrieveManifestList(e,t,n=this.config.userId,i){const s=["ALPHA","RC","GOLD","PUBLISHED","DELETED","ALL"];if(t&&s.indexOf(t)===-1){return Promise.reject(new l("INVALID_STATUS",t))}let o;if(i)o=i.toLowerCase();let c=t;let a="DELETED";if(t==="ALL"){a=null;c=null}if(t==="DELETED"){a=null}return this.agent.getManifestList(e,this.workflowtype,c,n).then(e=>{if(!e)throw new l("INVALID_RESPONSE");if(e.code===2e6&&e.data){return r.mapToManifestResourceList(e.data,o,a)}if(e.code===404e4&&e.data==="No workflows found")return null;throw new l("FAILED_TO_RETRIEVE_MANIFEST",`${e.code} : ${e.data||""} : ${e.message||""}`)}).catch(e=>{if(e&&e.statusCode===404){return null}throw e})}retrieveManifest(e,t,n,i){const s=i.toLowerCase();return this.agent.getManifest(e,t,n,s).then(e=>{if(s==="presentation"||s==="ui")return r.mapToPresentationManifest(e);return r.mapToVoiceResource(e)})}retrieveManifestById(e){let t="";return this.agent.getManifestList(e,this.workflowtype).then(e=>{if(!e)throw new l("INVALID_RESPONSE");if(e.code===2e6&&e.data){return r.mapToManifestResourceList(e.data,null,"DELETED")}throw new l("FAILED_TO_RETRIEVE_MANIFEST_LIST",`${e.code} ${e.data||""} ${e.message||""}`)}).then(n=>{if(!n||n.length<1)throw new l("CANNOT_FIND_MANIFEST",e);t=n[0].type;return this.agent.getManifest(n[0].mnmn,n[0].vid,n[0].version,n[0].type)}).then(e=>{if(t==="presentation")return r.mapToPresentationManifest(e);return r.mapToVoiceResource(e)})}updateManifest(e,t){let n="presentation";return this.getManifestTypebyId(e).then(e=>{n=e;return o.readJson(c.resolve(t))}).then(t=>{if(n==="ui"||n==="presentation")a.validate(t,u.uiSchema);if(a.error){const e=a.error.dataPath?` ${a.error.dataPath}`:"";throw Error(`Invalid metadata, ${a.error.message}${e}`)}return this.agent.updateManifest(e,t,n)})}deleteManifest(e){return this.getManifestTypebyId(e).then(t=>this.agent.deleteManifest(e,t))}getManifestTypebyId(e){return this.agent.getManifestList(e,this.workflowtype).then(t=>{if(t&&t.code===2e6&&t.data){return r.mapToManifestResourceList(t.data,null,"DELETED")}throw new l("CANNOT_FIND_MANIFEST",e)}).then(t=>{if(!t||t.length<1)throw new l("CANNOT_FIND_MANIFEST",e);return t[0].type})}static validatePoCodes(e){const t=/^(_)+PO_CODE_/;function n(e,n,i){e.language.forEach(e=>{if(e.poCodes&&e.poCodes.length>0){const r=t.test(n)?!!e.poCodes.find(e=>e.po===n):true;if(!r)throw new l("UNDEFINED_PO_CODE",n,i,e.locale)}})}function i(e){if(e.ma&&Array.isArray(e.ma)&&e.ma.length>0){e.ma.forEach((t,i)=>{if(t.alternatives&&Array.isArray(t.alternatives)&&t.alternatives.length>0){t.alternatives.forEach((t,r)=>{const s=`ma.${i}.alternatives.${r}.value`;if(t.value)n(e,t.value,s)})}})}}function r(e){if(e.ms&&Array.isArray(e.ms)&&e.ms.length>0){e.ms.forEach((t,i)=>{if(t.label&&Array.isArray(t.label.arguments)&&t.label.arguments.length>0){t.label.arguments.forEach((t,r)=>{if(t.alternatives&&Array.isArray(t.alternatives)&&t.alternatives.length>0){t.alternatives.forEach((t,s)=>{const o=`ms.${i}.label.arguments.${r}.alternatives.${s}.value`;if(t.value)n(e,t.value,o)})}})}})}}function s(e){if(e.dpResources&&Array.isArray(e.dpResources)&&e.dpResources.length>0){e.dpResources.forEach((t,i)=>{if(t.alternatives&&Array.isArray(t.alternatives)&&t.alternatives.length>0){t.alternatives.forEach((t,r)=>{const s=`dpResources.${i}.alternatives.${r}.value`;if(t.value)n(e,t.value,s)})}if(t.label&&t.label.label){const r=`dpResources.${i}.label.label`;n(e,t.label.label,r)}})}}i(e);r(e);s(e)}}e.exports=new Proxy(p,h())},function(e,t){e.exports=require("tv4")},function(e,t){const n={$schema:"http://json-schema.org/draft-04/schema#",title:"Presentation Resource",type:"object",definitions:{detailPageLinkObject:{type:"object",properties:{os:{description:"OS (android, ios, etc.)",type:"string"},dpType:{description:"Type cathe detail page of the device",type:"string",enum:["vendorPlugIn","defaultPlugIn","vendorApp"]},dpUri:{description:"Link to the detail page",type:"string",format:"uri"}},required:["os","dpType","dpUri"]},conditionObject:{description:"Set visibility option",type:"object",properties:{n:{description:"name of this condition",type:"string"},id:{description:"ID of this unit condition object",type:"string"},source:{description:'Used to distinguish this object from ExternalCondition. Fixed "RESOURCE_SERVER" for presentation resousrce',type:"string"},did:{description:"Device ID",type:"string"},href:{description:"URI to the target resource",type:"string"},property:{description:"The name of the target property",type:"string"},operand:{description:"Value to compare with"},operator:{description:"Operator that will be used to test the property",type:"string",enum:["=","!=",">",">=","<","<=","startWith","endWith","contain","notContain","exists","changed"]},type:{description:"Type (boolean, number, string, object)",type:"string",enum:["boolean","number","string","object"]}},required:["source","href","property","operator"]},iconUrlObject:{type:"object",properties:{small:{description:"Small size icon URL (no larger than 100 X 100 pixels)",type:"string",format:"uri"},large:{description:"Large size icon URL (larger than 300 X 300 pixels)",type:"string",format:"uri"},mid:{description:"Middle size icon URL (other sizes)",type:"string",format:"uri"},vector:{description:"Vector type icon URL (SPR format only)",type:"string",format:"uri"}},required:["mid"]},alternativeArray:{type:"array",items:{title:"Argument for each variable value",type:"object",properties:{key:{description:"Value of the target property",type:"string"},value:{description:"Display text of the value",type:"string"}},required:["key","value"]}},valueTypeObject:{description:"Type of the value",type:"string",enum:["string","boolean","integer","float","data","datetime","time"]},controlTypeObject:{description:"Control type. Used for binary value or enum value control",type:"string",enum:["StandbyPowerSwitch","OffPowerSwitch","ToggleSwitch","List","PlayPause","PlayStop","PushButton","slider","Image","Button"]},argumentObject:{type:"object",properties:{n:{description:"Variable name",type:"string"},href:{description:"URI of the target resource",type:"string"},property:{description:"Property name of the target resource",type:"string"},valueType:{$ref:"#/definitions/valueTypeObject"},alternatives:{description:"Arguments for the variables",$ref:"#/definitions/alternativeArray"}},required:["n","href","property"]},labelObject:{type:"object",properties:{n:{description:"Label name",type:"string"},label:{description:"Display string. Variables must be expressed as <var1>, <var2>.",type:"string"},argements:{$ref:"#/definitions/argumentObject"}},required:["label"]},linkObject:{type:"object",properties:{href:{description:"link to the resorouce",type:"string"},if:{description:"interface",type:"string"},rt:{description:"Resource type",type:"string"}},required:["href","if","rt"]},mainStateObject:{type:"object",properties:{name:{description:"Name of the state object",type:"string"},group:{description:"Group that this main state belongs to",type:"string"},iconUrl:{$ref:"#/definitions/iconUrlObject"},type:{description:'Type of this state. ("device", "job", "content")',type:"string",enum:["device","job","content"]},order:{description:"Order of this state object in the array",type:"integer"},label:{description:"Label of this main state",$ref:"#/definitions/labelObject"},visible:{$ref:"#/definitions/conditionObject"},emphasis:{description:"Emphasize this state",type:"boolean"}},required:["type","order","label"]},mainActionObject:{type:"object",properties:{name:{description:"Name of the action object",type:"string"},group:{description:"Group that this main state belongs to",type:"string"},type:{description:'Type of this state. ("main", "sub", "content")',type:"string",enum:["main","sub","content"]},order:{description:"Order of this state object in the array",type:"integer"},link:{description:"The resource to control",$ref:"#/definitions/linkObject"},property:{description:"Property name of the target resource",type:"string"},valueType:{$ref:"#/definitions/valueTypeObject"},controlType:{$ref:"#/definitions/controlTypeObject"},alternatives:{description:"Arguments for the variables",type:"array",$ref:"#/definitions/alternativeArray"},range:{description:"Range of the value. Used only when the property has a numuric value type",type:"array",items:{type:"number"},minItems:2,maxItems:3},step:{description:"Step to increase/decrease a value. Used only when the property has a numuric value type",type:"number"},iconUrl:{$ref:"#/definitions/iconUrlObject"},label:{$ref:"#/definitions/labelObject"},visible:{$ref:"#/definitions/conditionObject"},emphasis:{description:"Emphasize this state",type:"boolean"}},required:["type","order","link","label"]},ResourcePresentationObject:{type:"object",properties:{name:{description:"Name of the action object",type:"string"},group:{description:"Group that this main state belongs to",type:"string"},controllable:{description:"Controllable or not",type:"boolean"},order:{description:"Order of this state object in the array",type:"integer"},link:{description:"The resource to control",$ref:"#/definitions/linkObject"},property:{description:"Property name of the target resource",type:"string"},valueType:{$ref:"#/definitions/valueTypeObject"},controlType:{$ref:"#/definitions/controlTypeObject"},alternatives:{description:"Arguments for the variables",$ref:"#/definitions/alternativeArray"},range:{description:"Range of the value. Used only when the property has a numuric value type",type:"array",items:{type:"number"},minItems:2,maxItems:3},step:{description:"Step to increase/decrease a value. Used only when the property has a numuric value type",type:"number"},iconUrl:{$ref:"#/definitions/iconUrlObject"},label:{description:"Label of this main action",$ref:"#/definitions/labelObject"},visible:{$ref:"#/definitions/conditionObject"},emphasis:{description:"Emphasize this state",type:"boolean"},ruleEvent:{description:"Use this resource for rule event",type:"boolean"},ruleAction:{description:"Use this resource for rule/scene action",type:"boolean"}},required:["controllable","order","link","label"]},languageObject:{type:"object",properties:{po:{description:"po code",type:"string"},label:{description:"Translated text",type:"string"}},required:["po","label"]},LanguageResource:{type:"object",properties:{locale:{description:"ICU locale",type:"string"},version:{description:"Version of this resource.",type:"string"},mnmn:{description:"Manufacturer name",type:"string"},vid:{description:"Metadata ID",type:"string",maxLength:64},poCodes:{type:"array",items:{$ref:"#/definitions/languageObject"}}},required:["locale","poCodes"]}},properties:{n:{description:"Human readably name",type:"string"},version:{description:"Version of this presentation resource.",type:"string"},mnmn:{description:"Manufacturer name",type:"string"},vid:{description:"Metadata ID",type:"string",maxLength:64},iconUrl:{$ref:"#/definitions/iconUrlObject"},ms:{type:"array",items:{title:"Main states",$ref:"#/definitions/mainStateObject"}},ma:{type:"array",items:{title:"Main states",$ref:"#/definitions/mainActionObject"}},dpResources:{type:"array",items:{title:"Main states",type:"object",$ref:"#/definitions/ResourcePresentationObject"}},dpInfo:{type:"array",items:{$ref:"#/definitions/detailPageLinkObject"}},language:{type:"array",items:{$ref:"#/definitions/LanguageResource"}}},required:["n","mnmn","vid","ms","ma","dpInfo","language"]};const i={$schema:"http://json-schema.org/draft-04/schema#",title:"Presentation Resource",type:"object",definitions:{enumerationObject:{type:"object",properties:{name:{description:"Predefined action name for each capability.",type:"string"},payload:{description:"The payload of a POST request to send to IOT Cloud. Mandatory if the mothod is POST method.",type:"object"}},required:["name"]},voiceActionObject:{type:"object",properties:{action:{description:"Predefined action name for each capability.",type:"string"},href:{description:"URI to the target resource",type:"string"},enumerations:{type:"array",items:{$ref:"#/definitions/enumerationObject"}}}},capabilityObject:{type:"object",properties:{capability:{description:"Predefined capability name",type:"string"},voiceActions:{description:"Display string. Variables must be expressed as <var1>, <var2>.",type:"array",items:{$ref:"#/definitions/voiceActionObject"}}},required:["capability","voiceActions"]}},properties:{n:{description:"Human readably name",type:"string"},version:{description:"Version of this presentation resource.",type:"string"},mnmn:{description:"Manufacturer name",type:"string"},vid:{description:"Metadata ID",type:"string",maxLength:64},dalias:{description:"Manufacturer name",type:"string"},dtype:{description:"Manufacturer name",type:"string"},cts:{description:"Manufacturer name",type:"string",enum:["s2s","a2a"]},sml:{type:"array",items:{$ref:"#/definitions/capabilityObject"}}},required:["n","mnmn","vid","dalias","dtype","sml"]};const r={$schema:"http://json-schema.org/draft-04/schema#",title:"Language Resource",type:"object",definitions:{languageObject:{type:"object",properties:{po:{description:"po code",type:"string"},label:{description:"Translated text",type:"string"}},required:["po","label"]}},properties:{locale:{description:"ICU locale",type:"string"},version:{description:"Version of this resource.",type:"string"},mnmn:{description:"Manufacturer name",type:"string"},vid:{description:"Metadata ID",type:"string",maxLength:64},poCodes:{type:"array",items:{$ref:"#/definitions/languageObject"}}},required:["locale","mnmn","vid","poCodes"]};const s=`<?xml version="1.0" encoding="UTF-8"?>\n<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified" targetNamespace="http://samsung.com/ns/plugin" xmlns:packages="http://samsung.com/ns/plugin">\n\n  <xs:element name="manifest">\n    <xs:complexType>\n      <xs:sequence>\n        <xs:choice maxOccurs="unbounded">\n          <xs:element ref="packages:application"/>\n          <xs:element ref="packages:privilege"/>\n          <xs:element ref="packages:allowedURL"/>\n          <xs:element ref="packages:supportResolution"/>\n          <xs:element ref="packages:metadata"/>\n        </xs:choice>\n        <xs:any minOccurs="0" maxOccurs="unbounded" namespace="##any" processContents="lax"/>\n      </xs:sequence>\n      <xs:attribute name="manifestVersionCode" use="required" type="xs:integer"/>\n      <xs:attribute name="package" use="required" type="xs:string"/>\n      <xs:attribute name="versionCode" use="required" type="xs:integer"/>\n      <xs:attribute name="versionName" use="required" type="xs:string"/>\n      <xs:attribute name="minPluginSdkVersion" type="xs:integer"/>\n      <xs:anyAttribute namespace="##any" processContents="lax"/>\n    </xs:complexType>\n  </xs:element>\n\n  <xs:element name="application">\n    <xs:complexType>\n      <xs:attribute name="label" use="required" type="xs:string"/>\n      <xs:attribute name="icon" use="required" type="xs:string"/>\n      <xs:attribute name="deviceType" use="required" type="xs:string"/>\n      <xs:attribute name="deviceSubType" use="required" type="xs:string"/>\n      <xs:attribute name="deviceManufacturer" use="required" type="xs:string"/>\n      <xs:attribute name="model" type="xs:string"/>\n      <xs:attribute name="firmwareVersion" type="xs:string"/>\n      <xs:anyAttribute namespace="##any" processContents="lax"/>\n    </xs:complexType>\n  </xs:element>\n\n  <xs:element name="privilege">\n    <xs:complexType>\n      <xs:attribute name="name" use="required" type="xs:string"/>\n    </xs:complexType>\n  </xs:element>\n\n  <xs:element name="allowedURL">\n    <xs:complexType>\n      <xs:attribute name="URL" use="required" type="xs:string"/>\n    </xs:complexType>\n  </xs:element>\n\n  <xs:element name="supportResolution">\n    <xs:complexType>\n      <xs:attribute name="resolution" use="required" type="xs:string"/>\n    </xs:complexType>\n  </xs:element>\n\n  <xs:element name="metadata">\n    <xs:complexType>\n      <xs:attribute name="name" use="required" type="xs:string"/>\n      <xs:attribute name="value" type="xs:string"/>\n      <xs:anyAttribute processContents="lax"/>\n    </xs:complexType>\n  </xs:element>\n</xs:schema>`;e.exports={uiSchema:n,voiceSchema:i,languageSchema:r,manifestSchema:s}},function(e,t,n){const{getServerConfig:i}=n(2);const r=n(15);const s=n(6);const o=n(5);const c=n(17);const a=n(113);const u=n(12);const l=n(4);const h=n(3);const p=n(1);const d=n(34);const E=n(0);function _(){const e=new Date;return`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`}const I=l.resolve(u.homedir(),".iotcloud/log_devices");class f extends s{constructor(e){super();this.config=e;this.observingResource=[];this.intervalId="";this.targetDeviceId=""}static getLogDeviceList(e){const t=l.resolve(I,e,"logger.json");return o.exists(t).then(e=>{if(!e)return[];return o.readJson(t)})}init(e){const t=i(this.config,"iotCloud");const n=new r(this.config);n.init();const{key:s,cert:o}=n.getDeviceKeyCert();this.agent=e||new c(t,s,o);this.deviceId="";this.accessToken=""}addLogDeviceToFile(){const e=l.resolve(I,this.config.userId,"logger.json");return h.resolve().then(()=>o.exists(e)).then(t=>{if(!t)return o.ensureDir(l.dirname(e)).then(()=>[]);return o.readFile(e)}).then(e=>{const t=e.toString();if(!t)return[];return JSON.parse(t)}).then(t=>{t.push(this.deviceId);return o.writeFile(e,JSON.stringify(t,null,2))})}deleteLogDevice(){const e=this.deviceId;const t=this.accessToken;return this.agent.deleteDevice(e,t)}deleteLogDeviceFromFile(){const{userId:e}=this.config;const t=l.resolve(I,e,"logger.json");return h.resolve().then(()=>o.exists(t)).then(e=>{if(!e){return o.ensureDir(l.dirname(t)).then(()=>[])}return o.readFile(t)}).then(e=>{const t=e.toString();if(!t)return[];return JSON.parse(t)}).then(e=>{if(e.length>0)e.splice(e.indexOf(this.deviceId),1);let n=JSON.stringify(e,null,2);if(e.length===0)n="[]";return o.writeFile(t,n)}).finally(()=>{this.agent.disconnect()})}handleSignal(){this.deleteLogDevice().then(()=>this.deleteLogDeviceFromFile()).then(()=>process.exit())}signUpLogDevice(e,t=false){const{userId:n,deviceId:r}=this.config;const s=i(this.config,"authProvider");this.deviceId=d();return this.agent.connect().then(()=>this.agent.getAccessTokenByAuthCode(e,s.uri,r)).then(({accesstoken:e})=>{this.accessToken=e;return this.agent.signUp(e,s.uri,this.deviceId,n,false)}).then(()=>{if(t)process.on("SIGINT",()=>this.handleSignal());return this.addLogDeviceToFile()}).finally(()=>this.agent.disconnect())}onResourceChangeHandler(e,t){Object.keys(t).forEach(e=>{this.emit("log",new a(_(),this.targetDeviceId,`${e}: ${JSON.stringify(t[e],null,2)}`))})}onStateChangeHandler(e){const t=e.prslist[0].state;this.emit("log",new a(_(),this.targetDeviceId,`state: ${t}`));if(t==="on"){this.agent.getDeviceResources(this.targetDeviceId).then(e=>{e[0].links.forEach(e=>{const t=e.p.bm;const n=t>>1&1;const i=e.href;if(n){this.observingResource.push(i);this.agent.observeResource(i,e=>this.onResourceChangeHandler(i,e))}})})}else if(t==="off"){this.observingResource=[]}}observeRealtimeLogs(e,t){if(!e)throw new p("NO_DEVICE_ID");const{userId:n,accessToken:i}=this.config;const r=new h((r,s)=>{this.observingPromise=h.resolve().then(()=>this.clearObservation()).then(()=>this.on("log",t)).then(()=>this.agent.connect()).then(()=>this.agent.signIn(this.config.deviceId,n,i)).then(()=>this.agent.getPing()).then(()=>this.agent.setPing(8)).then(()=>{this.intervalId=setInterval(()=>this.agent.setPing(8),1e3*60*7)}).then(()=>this.agent.observeDeviceState(e,e=>this.onStateChangeHandler(e))).then(()=>r()).catch(e=>{s(e);throw e})});return r}observeDeviceStateChangesByAuthCode(e,t,n,i=false){if(!e)throw new p("NO_DEVICE_ID");if(!t)throw new p("NO_AUTHCODE");const{userId:r,accessToken:s}=this.config;const o=new h((o,c)=>{this.observingPromise=h.resolve().then(()=>this.clearObservation()).then(()=>this.on("log",n)).then(()=>{this.targetDeviceId=e;return this.signUpLogDevice(t,i)}).then(()=>this.agent.connect()).then(()=>this.agent.signIn(this.deviceId,r,s)).then(()=>this.agent.getPing()).then(()=>this.agent.setPing(8)).then(()=>{this.intervalId=setInterval(()=>this.agent.setPing(8),1e3*60*7)}).then(()=>this.agent.observeDeviceState(e,e=>this.onStateChangeHandler(e))).then(()=>o()).catch(e=>{c(e);throw e})});return o}clearObservation(){this.removeAllListeners("log");let e=h.resolve();if(this.targetDeviceId){e=e.then(()=>this.deleteLogDevice())}if(this.observingPromise){this.observingPromise.cancel();this.observingPromise=null}return e.then(()=>{this.targetDeviceId="";if(this.intervalId){clearInterval(this.intervalId);this.intervalId="";this.agent.disconnect()}this.observingResource=[]})}}e.exports=new Proxy(f,E())},function(e,t){e.exports=require("adbkit")},function(e,t,n){const i=n(4);const r=n(6);const s=n(3);const o=n(27);const c=n(9);const a=n(116);const u=n(5);const l=n(61);const h=n(21);const p=n(22);const d=n(63);const E=n(68);const _=n(69);const I=n(122);const f=n(7);const P=n(8);const T=n(16);const{getRoot:g,getServerConfig:A}=n(2);const O=n(28);const N=n(15);const m=n(70);const C=n(1);const S=n(0);const{validLamdaARN:D,validWebhookUrl:v}=n(2);function L(e,t){if(e&&!D(e)){return s.reject(new C("CREATE_PROJECT_INVALID_LAMBDA_ARN",e))}if(t&&!v(t)){return s.reject(new C("CREATE_PROJECT_INVALID_WEBHOOK_URL",t))}return s.resolve()}class R extends r{constructor(e){super();this.config=e||{}}init(e){const t=A(this.config,"iotConsole");this.agent=e||new P(this.config,t);this.uiMetaGenerator=new O(this.config);this.deviceProfileManager=new T(this.config);this.projectGenerator=new p(this);this.thingsSdkConverter=new m(this)}initForOneAppController(e,t){this.projectBuilder=new h(this,e,t)}createOcfProject(e,t,n,i,r,s,o,c,a="001"){const u=new d(this);return u.createProject(e,t,n,i,r,s,o,c,a)}createAutomationProject(e,t,n,i){return this.projectGenerator.generateAutomationProject(e,t,n,i)}createC2cProject(e,t,n,i,r,s,o,c,a,u){return this.projectGenerator.generateC2cProject(e,t,n,i,r,s,o,c,a,u)}createProjectByTemplate(e,t,n){return this.retrieveTemplate(n).then(n=>this.projectGenerator.generateProjectByTemplate(e,t,n))}createLambdaAutomationProject(e,t,n,i,r,s){const o=new _(this);return L(r,s).then(()=>o.createDefaultProject(e,t,n,i,r,s))}createLambdaC2cProject(e,t,n,i,r,s,o,c,a,u,l,h){const p=new I(this);return L(l,h).then(()=>p.createDefaultProject(e,t,n,i,r,s,o,c,a,u,l,h))}createDefaultServicePluginProject(e,t,n,i,r,s,o,c,a){const u=new E(this);return L(r,s).then(()=>u.createDefaultProject(e,t,n,i,r,s,o,c,a))}retrieveProjectList(e){return u.readDir(e).reduce((t,n)=>{const r=i.join(e,n);return f.retrieveConfig(r).then(e=>{if(e.name&&e.type){const n=new c(e.name,e.type);if(e.outputPath)n.outputPath=e.outputPath;t.push(n)}return t}).catch(()=>t)},[])}buildProject(e=process.cwd(),t={}){let n=null;return f.retrieveConfig(e).then(t=>{n=t;if(n.type===c.PROJ_TYPE.OCF){const t=new d(this);t.on("progress",e=>this.emit("progress",e));return t.buildProject(e,n)}else if(n.type===c.PROJ_TYPE.SERVICE){const t=new E(this);t.on("progress",e=>this.emit("progress",e));return t.buildProject(e,n)}else if(n.type===c.PROJ_TYPE.AUTOMATION){const t=new _(this);t.on("progress",e=>this.emit("progress",e));return t.buildProject(e,n)}else if(n.type===c.PROJ_TYPE.C2C){const t=new I(this);t.on("progress",e=>this.emit("progress",e));return t.buildProject(e,n)}const i=new h(this,e,n);i.on("progress",e=>this.emit("progress",e));return i.build()}).then(()=>{const r=i.join(e,n.outputPath);const o=u.readDirSync(r);let c=o.find(e=>e.endsWith(".ppk"));c=c?i.join(r,c):c;if(!t.signPpk||!t.passwd||!c)return s.resolve();this.emit("progress","> Signing ppk file...");return this.signPackage(c,false,c,t.passwd)}).then(()=>this.generateIosOutput(e,n))}isbuiltProject(){return this.projectBuilder.isBuilt()}retrieveTemplate(e){const t=this.agent;return t.getTemplate(e).then(({payload:{values:e}})=>e).finally(()=>this.agent.finish())}retrieveTemplateList(e={}){const t=this.agent;return t.getTemplateList().then(({payload:{values:{templates:t}}})=>{const n=t.filter(t=>{if(typeof e.deviceProfile==="boolean"){if(e.deviceProfile&&!t.deviceProfile){return false}}else if(e.deviceProfile){if(!t.deviceProfile)return false;const n=e.deviceProfile.toString();if(t.deviceProfile!==n)return false}return true}).map(e=>new a(e.id,e.name,e.description,e.deviceProfile));return n}).finally(()=>this.agent.finish())}signPackage(e,t,n=e,r){let c=i.resolve(g(),"assets/security_profiles/author.pri");let a=i.resolve(g(),"assets/security_profiles/author.crt");let l=i.resolve(g(),"assets/security_profiles/distributor.pri");let h=i.resolve(g(),"assets/security_profiles/distributor.crt");let p="12345678";let d="12345678";let E=s.resolve();if(!t){if(!r)return s.reject(new C("SIGN_PPK_NO_PASSWD"));const e=new N(this.config);e.init();c=i.resolve(`${e.getSecurityProfilesPath()}/${this.config.userId}${this.config.mnid}/author.pri`);a=i.resolve(`${e.getSecurityProfilesPath()}/${this.config.userId}${this.config.mnid}/author.crt`);l=i.resolve(`${e.getSecurityProfilesPath()}/${this.config.userId}${this.config.mnid}/distributor.pri`);h=i.resolve(`${e.getSecurityProfilesPath()}/${this.config.userId}${this.config.mnid}/distributor.crt`);p=r;d=r;E=e.checkPpkKeyCert(this.config.userId,this.config.mnid)}if(!u.existsSync(e))return s.reject(new C("SIGN_PPK_FILE_NOTFOUND",e));if(!u.existsSync(c))return s.reject(new C("SIGN_PPK_NO_AUTH_KEY"));if(!u.existsSync(a))return s.reject(new C("SIGN_PPK_NO_AUTH_CERT"));if(!u.existsSync(l))return s.reject(new C("SIGN_PPK_NO_DIST_KEY"));if(!u.existsSync(h))return s.reject(new C("SIGN_PPK_NO_DIST_CERT"));if(e===n){E=E.then(()=>u.copy(e,`${e}.orig`))}return E.then(()=>o.spawn("java",["-Dfile.encoding=UTF-8","-jar",i.resolve(g(),"assets/external_jars/ppksigner.jar"),"sign","--author-signer","--key",c,"--cert",a,"--key-pass",`pass:${p}`,"--dist-signer","--key",l,"--cert",h,"--key-pass",`pass:${d}`,"--in",e,"--out",n])).catch(t=>{if(u.existsSync(`${e}.orig`)){u.removeSync(e);u.renameSync(`${e}.orig`,e)}const n=t.stderr;if(n&&n.includes("InvalidKeyException"))throw new C("SIGN_PPK_INVALID_KEY");throw new C(n)})}verifyPackage(e,t){if(!e)return s.reject(new C("VERIFY_PPK_NO_IN"));let n=["-jar","-Dfile.encoding=UTF-8",i.resolve(g(),"assets/external_jars/ppksigner.jar"),"verify"];if(t){n=n.concat(["--print-certs","--verbose"])}n=n.concat([e]);return o.spawn("java",n).catch(e=>{if(e.stderr.includes("Signature not found from package file"))throw new C("VERIFY_PPK_VERIFY_FAIL");if(e.stderr.includes("FileNotFoundException"))throw new C("VERIFY_PPK_FILE_NOT_FOUND_FAIL");if(e.stderr.includes("ZipFormatException"))throw new C("VERIFY_PPK_ZIP_FORMAT_FAIL");throw new C("VERIFY_PPK_UNKNOWN_FAIL",e.stderr)})}extractPackage(e,t){const n=new l;const i=this.emit.bind(this);n.on("progress",e=>i("progress",e));return n.unpack(e,t)}createProjectFromThingsSDK(e,t,n,i,r,o,c,a){return s.resolve().then(()=>{if(typeof n==="string")return u.readJson(n);return n}).then(n=>this.thingsSdkConverter.convertToDeviceProfile(n).then(s=>{const u=n.configuration.easySetup.connectivity.softAP.setupId;return this.createOcfProject(e,t,s,i,r,o,c,a,u)}))}exportToThingsSDK(e=process.cwd(),t){const n=i.resolve(e,f.DEVICE_PROFILE_FILE);let r=i.resolve(e,f.CATALOG_FILE);if(!u.existsSync(r)){r=i.resolve(e,f.PROD_CATALOG_FILE)}return s.join(u.readJson(n),u.readJson(r),(e,t)=>this.thingsSdkConverter.convertFromDeviceProfile(e,t)).then(e=>{if(t){this.emit("progress",`Generating Things SDK file... ${t}`);const n=JSON.stringify(e,null,2);return u.writeFile(t,n).then(()=>e)}return e})}generateIosOutput(e,t){const n=i.join(e,f.OUT_IOS_DIR);const r=i.join(n,f.SIDELOADING_DIR);const o=i.join(r,f.PLUGIN_DIR);const c=i.join(o,f.PPKS_DIR);const a=i.join(r,f.MANIFEST_DIR);this.emit("progress","> Copying files to iOS output folder...");const l=i.join(e,t.outputPath);const h=u.readDirSync(l);let p=h.find(e=>e.endsWith(".ppk"));p=p?i.join(l,p):p;let d=h.find(e=>e.endsWith(f.UI_MANIFEST_FILE));d=d?i.join(l,d):d;let E=h.find(e=>e.endsWith(f.VOICE_MANIFEST_FILE));E=E?i.join(l,E):E;let _=h.find(e=>e.endsWith(".plugin"));_=_?i.join(l,_):_;return s.resolve().then(()=>u.remove(n)).then(()=>{if(!p)return s.resolve();return u.ensureDir(c).then(()=>u.copy(p,i.join(c,i.basename(p))))}).then(()=>{if(!_)return s.resolve();return u.ensureDir(o).then(()=>u.copy(_,i.join(o,i.basename(_))))}).then(()=>{if(!d)return s.resolve();return u.ensureDir(a).then(()=>u.copy(d,i.join(a,i.basename(d))))}).then(()=>{if(!E)return s.resolve();return u.ensureDir(a).then(()=>u.copy(E,i.join(a,i.basename(E))))})}}e.exports=new Proxy(R,S())},function(e,t,n){const i=n(6);const r=n(4);const s=n(3);const o=n(30);const c=n(7);const a=n(5);const u=n(40);const l=n(0);const h=r.join;const p="ppk";function d(e){const t=e.manifest.$;const n=t.package;const i=t.versionName;if(!n)throw Error(`'${c.PLUGIN_MANIFEST_FILE}' needs package attribute`);if(!i)throw Error(`'${c.PLUGIN_MANIFEST_FILE}' needs versionName attribute`)}function E(e){const t=h(e,c.PLUGIN_MANIFEST_FILE);const n=h(e,c.PLUGIN_INDEX_FILE);const i=h(e,c.PLUGIN_ICON_FILE);const r=h(e,c.PLUGIN_CSS_DIR);const o=h(e,c.PLUGIN_JS_DIR);return s.join(a.exists(t),a.exists(n),a.exists(i),a.exists(r),a.exists(o),(e,t,n,i,r)=>{if(!e)throw Error(`'${c.PLUGIN_MANIFEST_FILE}' does not exist`);if(!t)throw Error(`'${c.PLUGIN_INDEX_FILE}' does not exist`);if(!n)throw Error(`'${c.PLUGIN_ICON_FILE}' does not exist`);if(!i)throw Error(`'${c.PLUGIN_CSS_DIR}' directory does not exist`);if(!r)throw Error(`'${c.PLUGIN_JS_DIR}' directory does not exist`)}).then(()=>s.join(a.stat(o).then(e=>e.isDirectory()),a.stat(r).then(e=>e.isDirectory()),(e,t)=>{if(!e)throw Error(`'${c.PLUGIN_JS_DIR}' is not directory`);if(!t)throw Error(`'${c.PLUGIN_CSS_DIR}' is not directory`);return true}))}class _ extends i{static readManifestXml(e){return a.readFile(e).then(e=>{const t=new o.Parser;const n=s.promisify(t.parseString);return n(e)})}pack(e,t){const n=h(e,c.PLUGIN_MANIFEST_FILE);this.emit("progress","Validating plugin...");return E(e).then(()=>_.readManifestXml(n)).then(n=>{d(n);const i=n.manifest.$;const r=i.package;const s=i.versionName;const o=`${r}_${s}.${p}`;this.emit("progress",`Packing plugin... ${o}`);return a.readDir(e).then(n=>u.zip(t,o,n.map(t=>h(e,t))))})}unpack(e,t){this.emit("progress","Extracting plugin...");return u.unzip(e,t)}}e.exports=new Proxy(_,l())},function(e,t){e.exports=require("lodash/clone")},function(e,t,n){const i=n(4);const r=n(6);const s=n(3);const o=n(7);const c=n(22);const a=n(21);const u=n(64);const l=n(9);const h=n(31);const p=n(5);const d=n(0);function E(e,t,n){const i={pjtNm:t||e.name,prodType:"CPT-OCF",pjtDsc:n||"",deviceProfile:{dvcPrflNm:e.deviceProfile.name,dvcPrflDsc:e.deviceProfile.description,components:e.deviceProfile.components,metadata:e.deviceProfile.metadata},catalog:{modelCd:e.prodCatalog.modelCd,easysetupId:e.prodCatalog.easysetupId}};if(e.uiManifest){i.uiManifest={mtdtTypeCd:"CIT-UI",mtdtJson:JSON.stringify(e.uiManifest,null,2)}}if(e.voiceManifest){i.voiceManifest={mtdtTypeCd:"CIT-VOICE",mtdtJson:JSON.stringify(e.voiceManifest,null,2)}}return i}function _(e){const t={pjtNm:e.name,pjtDsc:"",deviceProfile:{dvcPrflNm:e.deviceProfile.name,dvcPrflDsc:e.deviceProfile.description,components:e.deviceProfile.components,metadata:e.deviceProfile.metadata},catalog:{modelCd:e.prodCatalog.modelCd,easysetupId:e.prodCatalog.easysetupId}};if(e.uiManifest){t.uiManifest={mtdtTypeCd:"CIT-UI",mtdtJson:JSON.stringify(e.uiManifest,null,2)}}if(e.voiceManifest){t.voiceManifest={mtdtTypeCd:"CIT-VOICE",mtdtJson:JSON.stringify(e.voiceManifest,null,2)}}return t}class I extends r{constructor(e){super();this.config=e.config;this.projectGenerator=e.projectGenerator;this.agent=e.agent}createProject(e,t,n,r,c,a,u,h,d){const E=new l(e,l.PROJ_TYPE.OCF);const _=i.join(t,e);try{this.validateProjectInfo(e,_)}catch(e){return s.reject(e)}return p.makeDir(_).then(()=>this.projectGenerator.generateDeviceProfileFile(_,n,a)).then(e=>this.projectGenerator.generateManifestFiles(_,e,r,c,u)).then(()=>h?this.projectGenerator.generateDevicePluginFiles(_,u):null).then(()=>this.generateCatalogFile(_,e,d)).then(()=>o.generateConfig(_,E)).catch(e=>{if(p.existsSync(_))p.removeSync(_);throw e})}buildProject(e,t){const n=this.emit.bind(this);const r=i.join(e,t.outputPath);const c=i.join(e,o.PROD_CATALOG_FILE);const u=new a(this,e,t);u.on("progress",e=>n("progress",e));if(!this.config.mnid)throw new Error("Login or Requesting MNID required!");n("start",t.name);if(!u.isUpdatedDeviceProfile())n("progress","Warning: device-profile was updated, please generate manifest if you need");return p.remove(r).then(()=>p.ensureDir(r)).then(()=>u.buildDeviceProfileFile()).then(e=>u.buildManifestFiles(e.metadata.vid)).then(()=>p.exists(i.join(e,o.PLUGIN_DIR))).then(e=>{if(e)return u.buildPluginFiles();return s.resolve()}).then(()=>{if(p.existsSync(c)){return u.buildOcfProdCatalogFile(e)}return u.buildCatalogFile(e,l.PROJ_TYPE.OCF)})}readProject(e){let t=null;return o.retrieveConfig(e).then(n=>{const r=i.join(e,n.outputPath);const c=i.join(r,o.DEVICE_PROFILE_FILE);const a=i.join(e,o.CATALOG_FILE);const h=i.join(e,o.PROD_CATALOG_FILE);const d=i.join(e,o.PLUGIN_DIR,o.PLUGIN_MANIFEST_FILE);t=new l(n.name,n.type);return p.readJson(c).then(e=>{t.deviceProfile=e}).then(()=>this.readUiManifestFile(r)).then(e=>{t.uiManifest=e}).then(()=>this.readVoiceManifestFile(r)).then(e=>{t.voiceManifest=e}).then(()=>{if(p.existsSync(h)){return p.readJson(h).then(e=>{t.prodCatalog=e})}return p.readJson(a).then(e=>{t.prodCatalog={modelCd:e.items[0].name,easysetupId:e.items[0].versions[0].appData.setupAppData.ocf.setupId}})}).then(()=>p.exists(d)).then(e=>{if(!e)return s.resolve();return u.readPluginManifestXml(d).then(e=>{t.plugin=e}).then(()=>{const e=i.resolve(r,`${t.plugin.package}_${t.plugin.versionName}.ppk`);if(p.existsSync(e)){t.output={ppkFile:e}}})})}).then(()=>t)}createWebConsoleProject(e,t,n,i){this.emit("progress","Registering project to Web Console...");let r=null;const s=E(e,t,n);return this.agent.postCloudConnectedProject(s).then(t=>{r=t;if(e.output&&e.output.ppkFile){return this.agent.postCloudConnectedPpkFile(t.pjtId,e.output.ppkFile)}return t}).then(e=>{if(!i)return h.createFromCloudConnectedResp(e);return this.publishWebConsoleProject(e.pjtId)}).catch(e=>{if(!r)throw e;return this.deleteWebConsoleProject(r.pjtId,true).then(()=>{throw e})})}readWebConsoleProjectList(){return this.agent.getCloudConnectedProjectList(999,1).then(e=>h.createListFromCloudConnectedResp(e))}readWebConsoleProject(e){return this.agent.getCloudConnectedProject(e).then(e=>h.createFromCloudConnectedResp(e))}existsWebConsoleProject(e){return this.agent.getCloudConnectedProject(e).then(()=>true).catch(e=>{if(e.message.includes("not found...")){return false}throw e})}updateWebConsoleProject(e,t){this.emit("progress","Updating Web Console project...");return this.agent.putCloudConnectedProject(e,_(t)).then(e=>{if(t.output&&t.output.ppkFile){return this.agent.postCloudConnectedPpkFile(e.pjtId,t.output.ppkFile)}return e}).then(e=>h.createFromCloudConnectedResp(e))}deleteWebConsoleProject(e,t){if(!t){this.emit("progress",`Deleting Web Console project... ${e}`)}return this.agent.deleteCloudConnectedProject(e)}publishWebConsoleProject(e){this.emit("progress",`Publishing project(self-publish)... ${e}`);return this.agent.postCloudConnectedSelfPublish(e).then(e=>h.createFromCloudConnectedResp(e))}unpublishWebConsoleProject(e){this.emit("progress",`Unpublishing project... ${e}`);return this.agent.postCloudConnectedUnpublish(e).then(e=>h.createFromCloudConnectedResp(e))}validateProjectInfo(e,t){c.validateProjectInput(e,t)}generateCatalogFile(e,t,n){const r=i.join(e,o.PROD_CATALOG_FILE);const s={modelCd:t,easysetupId:n};return p.writeFile(r,JSON.stringify(s,null,2))}readUiManifestFile(e){return p.readDir(e).then(e=>e.find(e=>e.endsWith(o.UI_MANIFEST_FILE))).then(t=>{if(!t)return null;const n=i.join(e,t);return p.readJson(n)})}readVoiceManifestFile(e){return p.readDir(e).then(e=>e.find(e=>e.endsWith(o.VOICE_MANIFEST_FILE))).then(t=>{if(!t)return null;const n=i.join(e,t);return p.readJson(n)})}}e.exports=new Proxy(I,d())},function(e,t,n){const i=n(30);const r=n(3);const s=n(5);const o=n(119);const c=n(0);class a{static readPluginManifestXml(e){return s.readFile(e).then(e=>{const t=new i.Parser;const n=r.promisify(t.parseString);return n(e)}).then(e=>o.createFromManifestDoc(e))}}e.exports=new Proxy(a,c())},function(e,t){class n{constructor(e,t){this.id=e;this.name=t;this.components=[];this.metadata={}}static createFromCloudConnectedResp(e){const t=new n(e.dvcPrflId,e.dvcPrflNm);t.components=e.components;t.metadata=e.metadata;return t}toCreateRequestBody(){return{dvcPrflNm:this.name,components:this.components,vid:this.metadata.vid,dvcType:this.metadata.deviceType,ocfSpecVer:"OCF1.1",mainAction:this.mainAction?`${this.mainAction.componentId}:${this.mainAction.id}`:null,mainState:this.mainState?`${this.mainState.componentId}:${this.mainState.id}`:null}}toUpdateRequestBody(){return{dvcPrflNm:this.name,components:this.components,vid:this.metadata.vid,dvcType:this.metadata.deviceType,ocfSpecVer:"OCF1.1",mainAction:this.mainAction?`${this.mainAction.componentId}:${this.mainAction.id}`:null,mainState:this.mainState?`${this.mainState.componentId}:${this.mainState.id}`:null}}}e.exports=n},function(e,t){class n{constructor(e){this.id=e}static createFromResp(e){const t=new n(e.plgnId);t.packageName=e.pkgNm;t.version=e.verNm;return t}static createFromCloudConnectedResp(e){const t=new n(e.plgnId);t.status=e.devStatNm;return t}}e.exports=n},function(e,t){class n{constructor(e,t){this.id=e;this.name=t}static createFromCloudConnectedResp(e){const t=new n(e.ctlgId,e.modelCd);t.setupId=e.easysetupId;t.status=e.devStatNm;return t}static createFromServicePluginResp(e){const t=new n(e.ctlgId,e.dispNm);t.status=e.devStatNm;t.whAppId=e.whAppId;t.whGrpId=e.whGrpId;return t}static createFromAutomationResp(e){const t=new n(e.ctlgId,e.dispNm);t.status=e.devStatNm;t.whAppId=e.refAppUuid;t.whGrpId=e.refGrpUuid;return t}}e.exports=n},function(e,t,n){const i=n(4);const r=n(6);const s=n(3);const o=n(1);const{getRoot:c}=n(2);const a=n(7);const u=n(22);const l=n(21);const h=n(64);const p=n(9);const d=n(13);const E=n(42);const _=n(31);const I=n(5);const f=n(0);const P=i.join(a.PLUGIN_LIB_DIR,a.SCPLUGINAPI_JS_FILE);const T=`<html>\n  <head>\n    \x3c!-- SAMSUNG CONNECT API --\x3e\n    <script type="text/javascript" src="${P}"><\/script>\n  </head>\n</html>\n`;const g="";const A="";const O=i.resolve(c(),"assets","project_gen_resources");const N=I.readFileSync(i.resolve(O,"default.manifest.xml"),"utf8");const m=/^[a-zA-Z._]{1,99}$/;function C(e,t,n,i){return{pjtNm:t||e.name,prodType:"CPT-SVCPLGN",pjtDsc:n||"",connectorApp:{appInfoTypeCd:"SAI-SVCENDPOINT",appNm:e.smartApp.appName,dispNm:e.smartApp.displayName,appDsc:e.smartApp.description,appTypeCd:e.smartApp.appType===d.APP_TYPE.LAMBDA?"SAT-LAMBDA":"SAT-WEBHOOK",multInstanceTypeCd:e.smartApp.singleInstance?"SAM-SINGLE":"SAM-MULTI",tgtUrl:e.smartApp.appType===d.APP_TYPE.WEBHOOK?e.smartApp.webhookSmartApp.targetUrl:null,tgtArnList:e.smartApp.appType===d.APP_TYPE.LAMBDA?e.smartApp.lambdaSmartApp.functions.map(e=>({tgtArn:e})):null,appScopeList:e.smartApp.oauth.scope.map(e=>({scopeNm:e})),appSettingList:Object.keys(e.smartApp.settings||[]).map(t=>({settingKey:t,settingValue:e.smartApp.settings[t]})),appUi:{plgnId:e.smartApp.ui.pluginId,dasbdCardYn:e.smartApp.ui.dashboardCardsEnabled?"Y":"N"}},appCatalog:{dispNm:e.appCatalog.appInternalName},plgnId:i}}function S(e,t,n,i){return{pjtNm:t||e.name,pjtDsc:n||"",connectorApp:{appTypeCd:e.smartApp.appType===d.APP_TYPE.LAMBDA?"SAT-LAMBDA":"SAT-WEBHOOK",appNm:e.smartApp.appName,dispNm:e.smartApp.displayName,appDsc:e.smartApp.description,tgtUrl:e.smartApp.appType===d.APP_TYPE.WEBHOOK?e.smartApp.webhookSmartApp.targetUrl:null,tgtArnList:e.smartApp.appType===d.APP_TYPE.LAMBDA?e.smartApp.lambdaSmartApp.functions.map(e=>({tgtArn:e})):null,appScopeList:e.smartApp.oauth.scope.map(e=>({scopeNm:e})),appSettingList:Object.keys(e.smartApp.settings||[]).map(t=>({settingKey:t,settingValue:e.smartApp.settings[t]})),appUi:{plgnId:e.smartApp.ui.pluginId,dasbdCardYn:e.smartApp.ui.dashboardCardsEnabled?"Y":"N"}},appCatalog:{dispNm:e.appCatalog.appInternalName},plgnId:i}}class D extends r{constructor(e){super();this.config=e.config;this.uiMetaGenerator=e.uiMetaGenerator;this.deviceProfileManager=e.deviceProfileManager;this.agent=e.agent}createProject(e,t,n,r,o){const c=new p(e,p.PROJ_TYPE.SERVICE);const u=i.join(t,e);try{this.validateProjectInfo(e,u,n,r)}catch(e){return s.reject(e)}return I.makeDir(u).then(()=>this.generateSmartAppFile(u,n)).then(()=>this.generateCatalogFile(u,n.appName)).then(()=>o?D.generateServicePluginFiles(u,r):null).then(()=>a.generateConfig(u,c)).catch(e=>{if(I.existsSync(u))I.removeSync(u);throw e})}createDefaultProject(e,t,n,i,r,s,c,a,u=false){D.validateProjectOptions(n,i,r,s,c,a);let l=null;if(i===d.APP_TYPE.LAMBDA){l=new d({appName:n,displayName:n,description:n,singleInstance:false,appType:i,lambdaSmartApp:{functions:r},ui:{pluginId:c||"",dashboardCardsEnabled:u},oauth:{clientName:"none",scope:["r:locations:*","w:schedules","w:installedapps:*","r:installedapps:*","r:schedules","x:devices:*","l:devices","r:devices:*","w:devices:*","i:deviceprofiles"]}})}else if(i===d.APP_TYPE.WEBHOOK){l=new d({appName:n,displayName:n,description:n,singleInstance:false,appType:d.APP_TYPE.WEBHOOK,webhookSmartApp:{targetUrl:s},ui:{pluginId:c||"",dashboardCardsEnabled:u},oauth:{clientName:"none",scope:["r:locations:*","w:schedules","w:installedapps:*","r:installedapps:*","r:schedules","x:devices:*","l:devices","r:devices:*","w:devices:*","i:deviceprofiles"]}})}else{throw new o("INVALID_APP_TYPE",i)}return this.createProject(e,t,l,c,a)}buildProject(e,t){const n=this.emit.bind(this);const r=i.join(e,t.outputPath);const o=new l(this,e,t);o.on("progress",e=>n("progress",e));if(!this.config.mnid)throw new Error("Login or Requesting MNID required!");n("start",t.name);return I.remove(r).then(()=>I.makeDir(r)).then(()=>I.exists(i.join(e,a.PLUGIN_DIR))).then(e=>{if(e)return o.buildPluginFiles();return s.resolve()})}readProject(e){let t=null;const n=i.join(e,a.SMART_APP_FILE);const r=i.join(e,a.APP_CATALOG_FILE);const o=i.join(e,a.PLUGIN_DIR,a.PLUGIN_MANIFEST_FILE);return a.retrieveConfig(e).then(c=>{t=new p(c.name,c.type);return I.readJson(n).then(e=>{t.smartApp=e}).then(()=>I.readJson(r)).then(e=>{t.appCatalog=e}).then(()=>I.exists(o)).then(n=>{if(!n)return s.resolve();return h.readPluginManifestXml(o).then(e=>{t.plugin=e}).then(()=>{const n=i.resolve(e,"out",`${t.plugin.package}_${t.plugin.versionName}.ppk`);if(I.existsSync(n)){t.output={ppkFile:n}}})})}).then(()=>t)}createWebConsoleProject(e,t,n,i){this.emit("progress","Registering project to Web Console...");let r=null;return s.resolve().then(()=>{if(e.output&&e.output.ppkFile){return this.agent.createPlugin(e.output.ppkFile,"PTC-SERVICE","CDS-DRAFT")}return null}).then(i=>this.agent.postServicePluginProject(C(e,t,n,i?i.plgnId:null))).then(e=>{r=e;return e}).then(e=>{if(!i)return _.createFromSvcPlgnResp(e);return this.publishWebConsoleProject(e.pjtId)}).catch(e=>{if(!r)throw e;return this.deleteWebConsoleProject(r.pjtId,true).then(()=>{throw e})})}readWebConsoleProjectList(){return this.agent.getServicePluginProjectList(999,1).then(e=>_.createListFromSvcPlgnResp(e))}readWebConsoleProject(e){return this.agent.getServicePluginProject(e).then(e=>_.createFromSvcPlgnResp(e))}existsWebConsoleProject(e){return this.agent.getServicePluginProject(e).then(()=>true).catch(e=>{if(e.message.includes("not found...")){return false}throw e})}updateWebConsoleProject(e,t,n,i){this.emit("progress","Updating Web Console project...");return s.resolve().then(()=>{if(t.output&&t.output.ppkFile){return this.agent.createPlugin(t.output.ppkFile,"PTC-SERVICE","CDS-DRAFT")}return null}).then(r=>this.agent.putServicePluginProject(e,S(t,n,i,r?r.plgnId:null))).then(e=>_.createFromSvcPlgnResp(e))}deleteWebConsoleProject(e,t){if(!t){this.emit("progress",`Deleting Web Console project... ${e}`)}return this.agent.deleteServicePluginProject(e)}publishWebConsoleProject(e){this.emit("progress",`Publishing project(self-publish)... ${e}`);return this.agent.postServicePluginSelfPublish(e).then(e=>_.createFromSvcPlgnResp(e,true))}unpublishWebConsoleProject(e){this.emit("progress",`Unpublishing project... ${e}`);return this.agent.postServicePluginUnpublish(e).then(e=>_.createFromSvcPlgnResp(e))}generateSmartAppFile(e,t){const n=i.join(e,a.SMART_APP_FILE);return I.writeFile(n,JSON.stringify(t,null,2))}generateCatalogFile(e,t){const n=i.join(e,a.APP_CATALOG_FILE);const r=new E({appInternalName:t,appType:E.APP_TYPE.SERVICE,localizations:{"en-US":{metadataDisplayName:t}}});return I.writeFile(n,JSON.stringify(r,null,2))}static validateProjectOptions(e,t,n,i,r,s){if(!e){throw new o("CREATE_PROJECT_APP_NAME_OPT_REQUIRED")}if(!t){throw new o("CREATE_PROJECT_APP_TYPE_OPT_REQUIRED")}if(!d.isValidAppType(t)){throw new o("INVALID_APP_TYPE",t)}if(t===d.APP_TYPE.LAMBDA&&!n){throw new o("CREATE_PROJECT_LAMBDA_ARN_OPT_REQUIRED")}if(t===d.APP_TYPE.WEBHOOK&&!i){throw new o("CREATE_PROJECT_TARGET_URL_OPT_REQUIRED")}if(s&&!r){throw new o("CREATE_PROJECT_PLUGIN_ID_OPT_REQUIRED")}}validateProjectInfo(e,t,n,i){u.validateProjectInput(e,t);if(i&&!m.test(i)){throw new o("INVALID_PLUGIN_ID_REGEX",i)}}static generateServicePluginFiles(e,t){const n=i.join(e,a.PLUGIN_DIR);const r=i.join(n,a.PLUGIN_LIB_DIR);const o=i.join(n,a.PLUGIN_JS_DIR);const c=i.join(n,a.PLUGIN_CSS_DIR);return I.makeDir(n).then(()=>s.all([I.makeDir(o),I.makeDir(c),I.makeDir(r)])).then(()=>{let e=N;if(t){e=e.replace("default.plugin",t)}return s.all([I.writeFile(i.join(n,a.PLUGIN_INDEX_FILE),T),I.writeFile(i.join(n,a.PLUGIN_MANIFEST_FILE),e),I.writeFile(i.join(o,a.PLUGIN_JS_FILE),g),I.writeFile(i.join(c,a.PLUGIN_CSS_FILE),A),I.writeFile(i.join(n,a.PLUGIN_ICON_FILE),"")])})}}e.exports=new Proxy(D,f())},function(e,t,n){const i=n(4);const r=n(6);const s=n(3);const o=n(1);const c=n(7);const a=n(22);const u=n(21);const l=n(9);const h=n(13);const p=n(42);const d=n(31);const E=n(5);const _=n(0);function I(e){return{pjtNm:e.name,prodType:"CPT-AUTOMATION",pjtDsc:"",connectorApp:{appInfoTypeCd:"SAI-AUTOMATION",appNm:e.smartApp.appName,dispNm:e.smartApp.displayName,appDsc:e.smartApp.description,appTypeCd:e.smartApp.appType===h.APP_TYPE.LAMBDA?"SAT-LAMBDA":"SAT-WEBHOOK",multInstanceTypeCd:e.smartApp.singleInstance?"SAM-SINGLE":"SAM-MULTI",tgtUrl:e.smartApp.appType===h.APP_TYPE.WEBHOOK?e.smartApp.webhookSmartApp.targetUrl:null,tgtArnList:e.smartApp.appType===h.APP_TYPE.LAMBDA?e.smartApp.lambdaSmartApp.functions.map(e=>({tgtArn:e})):null,appScopeList:e.smartApp.oauth.scope.map(e=>({scopeNm:e})),appSettingList:Object.keys(e.smartApp.settings||[]).map(t=>({settingKey:t,settingValue:e.smartApp.settings[t]}))},appCatalog:{dispNm:e.appCatalog.appInternalName}}}function f(e){return{pjtNm:e.name,pjtDsc:"",connectorApp:{appNm:e.smartApp.appName,dispNm:e.smartApp.displayName,appDsc:e.smartApp.description,tgtUrl:e.smartApp.appType===h.APP_TYPE.WEBHOOK?e.smartApp.webhookSmartApp.targetUrl:null,tgtArnList:e.smartApp.appType===h.APP_TYPE.LAMBDA?e.smartApp.lambdaSmartApp.functions.map(e=>({tgtArn:e})):null,appScopeList:e.smartApp.oauth.scope.map(e=>({scopeNm:e})),appSettingList:Object.keys(e.smartApp.settings||[]).map(t=>({settingKey:t,settingValue:e.smartApp.settings[t]}))},appCatalog:{dispNm:e.appCatalog.appInternalName}}}class P extends r{constructor(e){super();this.config=e.config;this.agent=e.agent}createProject(e,t,n){const r=new l(e,l.PROJ_TYPE.AUTOMATION);const o=i.join(t,e);try{this.validateProjectInfo(e,o,n)}catch(e){return s.reject(e)}return E.makeDir(o).then(()=>this.generateSmartAppFile(o,n)).then(()=>this.generateCatalogFile(o,n.appName)).then(()=>c.generateConfig(o,r)).catch(e=>{if(E.existsSync(o))E.removeSync(o);throw e})}createDefaultProject(e,t,n,i,r,s){P.validateProjectOptions(n,i,r,s);let c=null;if(i===h.APP_TYPE.LAMBDA){c=new h({appName:n,displayName:n,description:n,singleInstance:false,appType:i,lambdaSmartApp:{functions:r}})}else if(i===h.APP_TYPE.WEBHOOK){c=new h({appName:n,displayName:n,description:n,singleInstance:false,appType:h.APP_TYPE.WEBHOOK,webhookSmartApp:{targetUrl:s}})}else{throw new o("INVALID_APP_TYPE",i)}return this.createProject(e,t,c)}buildProject(e,t){const n=this.emit.bind(this);const r=i.join(e,t.outputPath);const s=new u(this,e,t);s.on("progress",e=>n("progress",e));if(!this.config.mnid)throw new Error("Login or Requesting MNID required!");n("start",t.name);return E.remove(r).then(()=>E.makeDir(r))}readProject(e){let t=null;const n=i.join(e,c.SMART_APP_FILE);const r=i.join(e,c.APP_CATALOG_FILE);return c.retrieveConfig(e).then(e=>{t=new l(e.name,e.type);return E.readJson(n).then(e=>{t.smartApp=e}).then(()=>E.readJson(r)).then(e=>{t.appCatalog=e})}).then(()=>t)}createWebConsoleProject(e,t){this.emit("progress","Registering project to Web Console...");let n=null;return this.agent.postAutomationProject(I(e)).then(e=>{n=e;return e}).then(e=>{if(!t)return d.createFromAutomationResp(e);return this.publishWebConsoleProject(e.pjtId)}).catch(e=>{if(!n)throw e;return this.deleteWebConsoleProject(n.pjtId,true).then(()=>{throw e})})}readWebConsoleProjectList(){return this.agent.getAutomationProjectList(999,1).then(e=>d.createListFromAutomationResp(e))}readWebConsoleProject(e){return this.agent.getAutomationProject(e).then(e=>d.createFromAutomationResp(e))}existsWebConsoleProject(e){return this.agent.getAutomationProject(e).then(()=>true).catch(()=>false)}updateWebConsoleProject(e,t){this.emit("progress","Updating Web Console project...");return this.agent.putAutomationProject(e,f(t)).then(e=>d.createFromAutomationResp(e))}deleteWebConsoleProject(e,t){if(!t){this.emit("progress",`Deleting Web Console project... ${e}`)}return this.agent.deleteAutomationProject(e)}publishWebConsoleProject(e){this.emit("progress",`Publishing project(self-publish)... ${e}`);return this.agent.postAutomationSelfPublish(e).then(e=>d.createFromAutomationResp(e))}unpublishWebConsoleProject(e){this.emit("progress",`Unpublishing project... ${e}`);return this.agent.postAutomationUnpublish(e).then(e=>d.createFromAutomationResp(e))}generateSmartAppFile(e,t){const n=i.join(e,c.SMART_APP_FILE);return E.writeFile(n,JSON.stringify(t,null,2))}generateCatalogFile(e,t){const n=i.join(e,c.APP_CATALOG_FILE);const r=new p({appInternalName:t,appType:p.APP_TYPE.AUTOMATION,localizations:{"en-US":{metadataDisplayName:t}}});return E.writeFile(n,JSON.stringify(r,null,2))}static validateProjectOptions(e,t,n,i){if(!e){throw new o("CREATE_PROJECT_APP_NAME_OPT_REQUIRED")}if(!t){throw new o("CREATE_PROJECT_APP_TYPE_OPT_REQUIRED")}if(!h.isValidAppType(t)){throw new o("INVALID_APP_TYPE",t)}if(t===h.APP_TYPE.LAMBDA&&!n){throw new o("CREATE_PROJECT_LAMBDA_ARN_OPT_REQUIRED")}if(t===h.APP_TYPE.WEBHOOK&&!i){throw new o("CREATE_PROJECT_TARGET_URL_OPT_REQUIRED")}}validateProjectInfo(e,t,n){a.validateProjectInput(e,t)}}e.exports=new Proxy(P,_())},function(e,t,n){const i=n(3);const r=n(0);const s=n(1);const o=n(29);const c=n(20);const a=n(19);const u=n(36);function l(e){switch(e.type){case"boolean":return 0;case"integer":return 1;case"double":case"number":return 2;case"string":return 3;case"object":return 4;case"bytes":return 5;case"array":{const t=e.items?e.items.type:"none";if(t==="integer")return 6;if(t==="double"||t==="number")return 7;if(t==="string")return 8;if(t==="string")return 9;throw new s("THINGS_SDK_PROPERTY_TYPE_MAPPING_NOT_FOUND",`array:${t}`)}default:throw new s("THINGS_SDK_PROPERTY_TYPE_MAPPING_NOT_FOUND",e.type)}}class h{constructor(e){this.config=e.config;this.deviceProfileMgr=e.deviceProfileManager;this.resourceTypeMgr=new o;this.resourceTypeMgr.init()}convertToDeviceProfile(e){const t=new a;const n=e.device[0].specification;const r=e.device[0].resources;t.name=n.device.deviceName;t.components=[];r.single.map(e=>this.mapToOcfResourceFromResource(e)).forEach(e=>{const n=this.deviceProfileMgr.mapResourceToCapability(e);if(!n){throw new s("CAPABILITY_MAPPING_NOT_FOUND",`[${e.rt.join(", ")}]:${e.href}`)}const i=n.component;let r=t.components.find(e=>e.id===i);if(!r){r={id:i,capabilities:[]};t.components.push(r)}else if(r.capabilities.find(e=>e.id===n.id)){throw new s("CAPABILITY_MAPPING_ALREADY_EXISTS",`${n.component}:${n.id}`)}r.capabilities.push({id:n.id})});const o=n.device.deviceType;const u=c.retrieveDeviceTypeFromResourceType(o);if(!u)throw new s("DEVICE_TYPE_MAPPING_NOT_FOUND",o);t.metadata={deviceType:u.id,vid:n.platform.vendorId};delete t.id;return i.resolve(t)}convertFromDeviceProfile(e,t){const n=this.deviceProfileMgr.convertToResourceModelByDeviceProfile(e,true);const i=this.mapToResourcesFromOcfResources(n.resources);return this.generateResourceTypesFromOcfResources(n.resources).then(e=>{const r=n.device.rt.find(e=>e!=="oic.wk.d");let s="001";if(t){if(!t.items)s=t.easysetupId;else s=t.items[0].versions[0].appData.setupAppData.ocf.setupId}return{device:[{specification:{device:{deviceType:r,deviceName:n.device.n,specVersion:n.device.icv,dataModelVersion:n.device.dmv},platform:{manufactuererName:this.config.mnid||n.platform.mnmn,manufacturerUrl:n.platform.mnml,manufacturingDate:n.platform.mndt,modelNumber:n.platform.mnmo,platformVersion:n.platform.mnpv,osVersion:n.platform.mnos,hardwareVersion:n.platform.mnhw,firmwareVersion:n.platform.mnfv,vendorId:n.platform.vid}},resources:{single:i}}],resourceTypes:e,configuration:{easySetup:{connectivity:{type:1,softAP:{setupId:s,artik:false}},ownershipTransferMethod:2},wifi:{interfaces:15,frequency:1},filePath:{svrdb:"artikserversecured.dat",provisioning:"provisioning.dat",certificate:"certificate.pem",privateKey:"privateKey.der"}}}})}mapToResourcesFromOcfResources(e){return e.filter(e=>e.href!=="/oic/d"&&e.href!=="/oic/p").map(e=>({uri:e.href,types:e.rt,interfaces:e.if,policy:e.p.bm}))}mapToOcfResourceFromResource(e){const t=new u(e.uri);t.rt=e.types;t.if=e.interfaces;t.type=["application/json"];t.p={bm:e.policy};return t}generateResourceTypesFromOcfResources(e){const t=[];e.filter(e=>e.href!=="/oic/d"&&e.href!=="/oic/p").forEach(e=>{const n=e.rt.find(e=>e!=="oic.wk.d");if(n&&t.indexOf(n)<0){t.push(n)}});return i.map(t,e=>this.resourceTypeMgr.retrieveResourceType(e)).then(e=>e.map(e=>{const t=[];if(e.methods&&e.methods.get&&e.methods.get.response){Object.keys(e.methods.get.response).forEach(n=>{const i=e.methods.get.response[n];let r=t.find(e=>e.key===n);if(!r){r={key:n,type:l(i),rw:1,mandatory:false};t.push(r)}r.rw|=1})}if(e.methods&&e.methods.post&&e.methods.post.body){Object.keys(e.methods.post.body).forEach(n=>{const i=e.methods.post.body[n];let r=t.find(e=>e.key===n);if(!r){r={key:n,type:l(i),rw:2,mandatory:false};t.push(r)}r.rw|=2;if(e.methods.post.required&&e.methods.post.required.indexOf(n)>=0){r.mandatory=true}})}return{type:e.rt,properties:t}}))}}e.exports=new Proxy(h,r())},function(e,t,n){const i=n(1);const r=Object.freeze({STAGED:"STAGED",DONE:"DONE",AUTHORIZED:"AUTHORIZED",REVOKED:"REVOKED"});function s(e){return e===r.STAGED||e===r.DONE||e===r.AUTHORIZED||e===r.REVOKED}class o{constructor({installedAppId:e,configurationId:t,configurationStatus:n,config:r,createdDate:o,lastUpdatedDate:c}){if(n&&!s(n)){throw new i("INVALID_CONFIGURATION_STATUS",n)}this.installedAppId=e;this.configurationId=t;this.configurationStatus=n;this.config=r;this.createdDate=o;this.lastUpdatedDate=c}}o.CONFIG_STATUS=r;o.isValidConfigStatus=s;e.exports=o},function(e,t,n){const i=n(1);const r=Object.freeze({DEVICE:"DEVICE",CAPABILITY:"CAPABILITY"});function s(e){return e===r.DEVICE||e===r.CAPABILITY}class o{constructor({id:e,installedAppId:t,sourceType:n,device:o,capability:c,details:a}){if(n&&!s(n)){throw new i("INVALID_SOURCE_TYPE",n)}this.installedAppId=t;this.sourceType=n;if(e)this.id=e;switch(n){case r.DEVICE:if(o)this.device=o;else if(a)this.device=a;else throw new i("NO_SUBSCRIPTION_DETAIL");break;case r.CAPABILITY:if(c)this.capability=c;else if(a)this.capability=a;else throw new i("NO_SUBSCRIPTION_DETAIL");break;default:}}toCreateRequestBody(){const e={sourceType:this.sourceType};switch(this.sourceType){case r.DEVICE:e.device=this.device;break;case r.CAPABILITY:e.capability=this.capability;break;default:}return e}}o.SOURCE_TYPE=r;o.isValidSourceType=s;e.exports=o},function(e,t,n){const i=n(74);const r=n(47);const s=n(94);const o=n(49);const c=n(15);const a=n(33);const u=n(23);const l=n(52);const h=n(104);const p=n(19);const d=n(16);const E=n(20);const _=n(46);const I=n(5);const f=n(37);const P=n(17);const T=n(38);const g=n(54);const A=n(107);const O=n(55);const N=n(28);const m=n(112);const C=n(37);const S=n(58);const D=n(114);const v=n(9);const L=n(60);const R=n(29);const y=n(13);const M=n(123);const w=n(41);const F=n(125);const U=n(127);const b=n(128);const G=n(72);const j=n(1);const V=n(14);const Y=n(129);const x=n(25);const K=n(2);const k=n(131);const $=n(70);const B={StLogger:V,TextHandler:x,util:K,StError:j,AuthManager:i,AwsManager:r,C2cDeviceProfileManager:s,CapabilityManager:o,CertManager:c,Configurator:l,DeviceManager:h,DeviceProfileManager:d,DeviceResourceManager:E,DevPortalManager:_,FileSystemHandler:I,GroupManager:f,IotCloudAgent:P,IotCloudClient:T,IotCloudServer:g,LocationManager:A,ManifestManager:O,MetaDataGenerator:N,OcfDeviceManager:m,OcfGroupManager:C,OcfLogManager:S,OneAppController:D,ProjectManager:L,ResourceTypeManager:R,SmartAppInstManager:M,SmartAppManager:w,SmartAppSchManager:F,SmartAppSubManager:U,StLogManager:Y,WebConsoleProjectManager:k,ThingsSdkConverter:$,PluginManager:b,CoapMessage:a,CoapOptions:u,Project:v,SmartApp:y,SmartAppSubscription:G,DeviceProfile:p};e.exports=B},function(e,t,n){const i=n(6);const r=n(3);const s=n(17);const o=n(8);const c=n(45);const a=n(46);const{getServerConfig:u}=n(2);const{getText:l}=n(25);const h=n(15);const p=n(1);const d=n(0);class E extends i{constructor(e){super();this.configurator=e}init(e,t,n){const i=this.configurator.getConfig();const r=u(i,"iotCloud");const a=u(i,"authProvider");const l=u(i,"iotConsole");const p=new h(i);p.init();const{key:d,cert:E}=p.getDeviceKeyCert(i);this.iotCloudAgent=e||new s(r,d,E);this.iotCloudAgent.on("debug",e=>this.emit("debug",e));this.authProviderAgent=t||new c(a);this.authProviderAgent.on("debug",e=>this.emit("debug",e));this.authProviderUri=a.uri;this.iotConsoleAgent=n||new o(i,l);this.iotConsoleAgent.on("debug",e=>this.emit("debug",e))}requestToken(e){const t=this.configurator.get("deviceId");return this.signUpDeviceWithProgress(e,t).then(()=>this.loginDoneFromIotConsole()).then(()=>this.ensureDeviceKeyCertWithProgress()).then(()=>{this.configurator.del("authCode");this.configurator.del("authState")})}requestTokenForServer(e){const t=this.configurator.get("deviceId");return this.signUpDeviceWithProgress(e,t).then(()=>{this.configurator.del("authCode");this.configurator.del("authState")})}requestTokenBySsoToken(){const e=this.configurator.get("ssoToken");const t=this.configurator.get("deviceId");return this.getAuthenticationByIotConsole(e,null,t).catch(()=>this.issueAccessTokenFromIotCloud(e,null,t).then(()=>this.loginDoneFromIotConsole())).then(()=>this.ensureDeviceKeyCertWithProgress()).then(()=>this.signUpWithProgress())}requestTokenByAuthCode(){const e=this.configurator.get("authCode");return this.requestToken(e)}requestTokenBySsoTokenWithoutSignUp(){return e=>this.requestTokenWithoutSignUp(e)}requestTokenWithoutSignUp(e){const t=this.configurator.get("deviceId");return this.getAuthenticationByIotConsole(null,e,t).catch(()=>this.issueAccessTokenFromIotCloud(null,e,t).then(()=>this.loginDoneFromIotConsole()))}signUpClientDevice(){this.emit("progress",l("REQUEST_TOKEN.SIGNING_UP_TO_IOT_CLOUD"));const e=this.configurator.getConfig();const{accessToken:t,deviceId:n,userId:i}=e;if(!t)return r.reject(new p("SIGN_UP_NO_LOGIN","accessToken"));if(!n)return r.reject(new p("SIGN_UP_NO_LOGIN","deviceId"));if(!i)return r.reject(new p("SIGN_UP_NO_LOGIN","userId"));const o=u(e,"iotCloud");o.redirecturi=null;o.serverCert=null;o.useRedirection=false;const c=new s(o,null,null);c.on("debug",e=>this.emit("debug",e));return c.connect().then(()=>c.signUp(t,this.authProviderUri,n,i)).then(e=>{this.configurator.set("iotCloud.redirecturi",e.redirecturi);this.configurator.set("iotCloud.serverCert",e.certificate);this.configurator.save()}).finally(()=>{if(c)c.disconnect()})}signUp(){const e=this.configurator.getConfig();const{accessToken:t,deviceId:n,userId:i}=e;if(!t)return r.reject(new p("SIGN_UP_NO_LOGIN","accessToken"));if(!n)return r.reject(new p("SIGN_UP_NO_LOGIN","deviceId"));if(!i)return r.reject(new p("SIGN_UP_NO_LOGIN","userId"));const o=u(e,"iotCloud");o.redirecturi=null;o.serverCert=null;o.useRedirection=false;const c=new h(e);c.init();const{key:a,cert:l}=c.getDeviceKeyCert(e);const d=new s(o,a,l);d.on("debug",e=>this.emit("debug",e));return c.checkDeviceKeyCert().then(()=>d.connect()).then(()=>d.signUp(t,this.authProviderUri,n,i)).then(e=>{this.configurator.set("iotCloud.redirecturi",e.redirecturi);this.configurator.set("iotCloud.serverCert",e.certificate);this.configurator.save()}).finally(()=>{if(d)d.disconnect()})}signIn(){const e=this.configurator.getConfig();const{accessToken:t,deviceId:n,userId:i}=e;if(!t)return r.reject(new p("SIGN_IN_NO_LOGIN","accessToken"));if(!n)return r.reject(new p("SIGN_IN_NO_LOGIN","deviceId"));if(!i)return r.reject(new p("SIGN_IN_NO_LOGIN","userId"));const o=u(e,"iotCloud");if(!o.redirecturi)return r.reject(new p("SIGN_IN_NO_SIGN_UP","redirecturi"));if(!o.serverCert)return r.reject(new p("SIGN_IN_NO_SIGN_UP","serverCert"));const c=new h(e);c.init();const{key:a,cert:l}=c.getDeviceKeyCert(e);const d=new s(o,a,l);d.on("debug",e=>this.emit("debug",e));return c.checkDeviceKeyCert().then(()=>d.connect()).then(()=>d.signIn(n,i,t)).catch(e=>{if(e instanceof p&&e.code==="IOT_CLOUD_DEVICE_NOT_FOUND"){throw new p("IOT_CLOUD_CLIENT_DEVICE_NOT_FOUND",e)}throw e}).finally(()=>d.disconnect())}refreshToken(e=false){const t=this.configurator.get("deviceId");const n=this.configurator.get("userId");const i=this.configurator.get("refreshToken");if(e){const e=Date.parse(this.configurator.get("accessTokenExpireDate"));if(e&&Date.now()<=e-E.EXPIRE_DATE_THRESHOLD){return r.resolve()}}const s=Date.parse(this.configurator.get("refreshTokenExpireDate"));if(s&&Date.now()>s-E.EXPIRE_DATE_THRESHOLD){return r.reject(new p("REFRESH_TOKEN_EXPIRED"))}return this.iotCloudAgent.connect().then(()=>this.iotCloudAgent.refreshToken(t,n,i)).then(e=>{const{accesstoken:t,expiresin:n,refreshtoken:i,refreshtoken_expiresin:r}=e;this.configurator.set("accessToken",t);this.configurator.set("refreshToken",i);this.configurator.set("accessTokenExpireDate",new Date(Date.now()+n*1e3));this.configurator.set("refreshTokenExpireDate",new Date(Date.now()+r*1e3));this.configurator.save()}).finally(()=>this.iotCloudAgent.disconnect())}getAuthCodeBySsoToken(e,t){return this.iotConsoleAgent.getAuthCodeBySsoToken(e,t).catch(e=>{throw new p("REQUESTING_AUTH_CODE_FAILED",e)})}getAuthenticationByIotConsole(e,t,n){return this.iotConsoleAgent.getAuthentication(e,t,n).then(({userId:e,email:t,accessToken:n,accessTokenExpiresIn:i,refreshToken:r,refreshTokenExpiresIn:s,mnid:o,mnnm:c,companyMnid:a,companyMnnm:u,individualMnid:l,individualMnnm:h})=>{this.configurator.set("userId",e);this.configurator.set("email",t);this.configurator.set("accessToken",n);this.configurator.set("accessTokenExpireDate",new Date(Date.now()+i*1e3));this.configurator.set("refreshToken",r);this.configurator.set("refreshTokenExpireDate",new Date(Date.now()+s*1e3));this.configurator.set("mnid",o);this.configurator.set("mnnm",c);this.configurator.set("companyMnid",a);this.configurator.set("companyMnnm",u);this.configurator.set("individualMnid",l);this.configurator.set("individualMnnm",h)})}signUpDeviceWithProgress(e,t){this.emit("progress",l("REQUEST_TOKEN.REQUESTING_ACCESS_TOKEN"));const n=this.configurator.getConfig();const i=u(n,"iotCloud");i.redirecturi=null;i.serverCert=null;i.useRedirection=false;const o=new s(i);o.on("debug",e=>this.emit("debug",e));return r.resolve().then(()=>o.connect()).then(()=>o.getAccessTokenByAuthCode(e,this.authProviderUri,t)).catch(e=>{throw new p("REQUESTING_ACCESS_TOKEN_FAILED",e)}).then(e=>{const{accesstoken:t,expiresin:n,refreshtoken:i,refreshtoken_expiresin:r,uid:s}=e;this.configurator.set("accessToken",t);this.configurator.set("refreshToken",i);this.configurator.set("accessTokenExpireDate",new Date(Date.now()+n*1e3));this.configurator.set("refreshTokenExpireDate",new Date(Date.now()+r*1e3));if(this.configurator.get("userId")!==s){this.configurator.del("mnid");this.configurator.del("mnnm");this.configurator.del("individualMnid");this.configurator.del("individualMnnm");this.configurator.del("companyMnid");this.configurator.del("companyMnnm")}this.configurator.set("userId",s)}).then(()=>{this.emit("progress",l("REQUEST_TOKEN.SIGNING_UP_TO_IOT_CLOUD"));const e=this.configurator.getConfig();const{accessToken:n,userId:i}=e;return o.signUp(n,this.authProviderUri,t,i)}).then(e=>{this.configurator.set("iotCloud.redirecturi",e.redirecturi);this.configurator.set("iotCloud.serverCert",e.certificate);this.configurator.save()}).finally(()=>o.disconnect())}issueAccessTokenFromIotCloud(e,t,n){let i=t;const s=t?r.resolve():this.getAuthCodeBySsoToken(e,n).then(e=>{i=e});this.emit("progress",l("REQUEST_TOKEN.REQUESTING_ACCESS_TOKEN"));return s.then(()=>this.iotCloudAgent.connect()).then(()=>this.iotCloudAgent.getAccessTokenByAuthCode(i,this.authProviderUri,n)).catch(e=>{throw new p("REQUESTING_ACCESS_TOKEN_FAILED",e)}).then(e=>{const{accesstoken:t,expiresin:n,refreshtoken:i,refreshtoken_expiresin:r,uid:s}=e;this.configurator.set("accessToken",t);this.configurator.set("refreshToken",i);this.configurator.set("accessTokenExpireDate",new Date(Date.now()+n*1e3));this.configurator.set("refreshTokenExpireDate",new Date(Date.now()+r*1e3));if(this.configurator.get("userId")!==s){this.configurator.del("mnid");this.configurator.del("mnnm");this.configurator.del("individualMnid");this.configurator.del("individualMnnm");this.configurator.del("companyMnid");this.configurator.del("companyMnnm")}this.configurator.set("userId",s)}).finally(()=>this.iotCloudAgent.disconnect())}loginDoneFromIotConsole(){this.emit("progress",l("REQUEST_TOKEN.GETTING_MNID"));const e=this.configurator.getConfig();const t=u(e,"iotConsole");const n=new o(e,t);n.on("debug",e=>this.emit("debug",e));return n.getLoginDone(this.configurator.get("authState")).then(e=>{this.configurator.set("email",e.email);this.configurator.set("mnid",e.mnid);this.configurator.set("mnnm",e.mnnm);this.configurator.set("companyMnid",e.companyMnid);this.configurator.set("companyMnnm",e.companyMnnm);this.configurator.set("individualMnid",e.individualMnid);this.configurator.set("individualMnnm",e.individualMnnm)}).catch(e=>{throw new p("GETTING_MNID_FAILED",e)})}getMnidWithProgress(){this.emit("progress",l("REQUEST_TOKEN.GETTING_MNID"));const e=new a(this.configurator);e.init();return e.requestEnrollmentData().catch(e=>{throw new p("GETTING_MNID_FAILED",e)})}ensureDeviceKeyCertWithProgress(){this.emit("progress",l("REQUEST_TOKEN.REQUESTING_DEVICE_CERT"));const e=new h(this.configurator.getConfig());e.init();return e.checkDeviceKeyCert().then(()=>{},()=>e.createDeviceCert()).catch(e=>{throw new p("REQUESTING_DEVICE_CERT_FAILED",e)})}signUpWithProgress(){this.emit("progress",l("REQUEST_TOKEN.SIGNING_UP_TO_IOT_CLOUD"));return this.signUp().catch(e=>{throw new p("SIGNING_UP_TO_IOT_CLOUD_FAILED",e)})}}E.EXPIRE_DATE_THRESHOLD=60*1e3;e.exports=new Proxy(E,d())},function(e,t,n){const i=n(6).EventEmitter;const r=n(76);const s=n(77);const o=n(78);const c=n(3);const a=n(23);const u=n(33);const{removeProxyEnv:l}=n(2);const h=n(44);const p=n(1);const d=n(0);const E=n(14);const _=h("CoapTcpConnector");const I={GET:1,POST:2,PUT:3,DELETE:4,OBSERVE:1,UNOBSERVE:1};function f({code:e,path:t,query:n,payload:i,token:r,observe:s}){const o=i?a.CONTENT_FORMAT.CBOR:undefined;const c=new a({path:t,query:n,format:o,observe:s});const l=new u({code:e,token:r,options:c,payload:i});return l}class P extends i{constructor(e,t,n,i,r,s){super();if(e.startsWith("coaps+tcp://")){this.tlsMode=true;this.serverAddr=e.substring("coaps+tcp://".length);this.rejectUnauthorized=n}else if(e.startsWith("coap+tcp://")){this.tlsMode=false;this.serverAddr=e.substring("coap+tcp://".length)}else{throw new p("UNSUPPORTED_PROTOCOL",e)}this.proxy=t||null;this.socket=null;this.observeTokenMap={};this.callbackMap={};this.errorCallbackMap={};this.isObserveMap={};this.serverCert=i;this.clientKey=r;this.clientCert=s}setRequestHandler(e){this.requestHandler=e}resetSocket(){this.socket=null;this.observeTokenMap={};this.callbackMap={};this.errorCallbackMap={};this.isObserveMap={}}connect(){return new c((e,t)=>{if(this.proxy){const n=this.proxy.split("://").length-1;const i=this.proxy.split("://")[n].split(":");this.proxyOptions={host:i[0],port:i[1],method:"CONNECT",path:this.serverAddr};_(`COAP REQUEST PROXY SOCKET ${JSON.stringify(this.proxyOptions,null,2)}`);const s=r.request(this.proxyOptions);s.on("error",e=>t(e));s.on("connect",(t,n)=>{_("COAP RECEIVE PROXY SOCKET");e(n)});s.end()}else{l();e(null)}}).then(e=>{const t=this.serverAddr.split(":");const n={host:t[0],port:t[1]};if(this.serverCert)n.ca=this.serverCert;if(this.clientKey)n.key=this.clientKey;if(this.clientCert)n.cert=this.clientCert;_(`COAP CONNECT OPTION: ${JSON.stringify(n)}`);let i;if(e&&this.tlsMode){n.socket=e;_("COAP CONNECT PROXY SECURE");if(this.rejectUnauthorized===false){n.rejectUnauthorized=false;_(`IGNORE SECURE ERROR(rejectUnauthorized:${n.rejectUnauthorized})`)}i=s.connect(n)}else if(e){_("COAP CONNECT PROXY INSECURE");i=e}else if(this.tlsMode){_(`COAP CONNECT SECURE ${JSON.stringify(n,null,2)}`);if(this.rejectUnauthorized===false){n.rejectUnauthorized=false;_(`IGNORE SECURE ERROR(rejectUnauthorized:${n.rejectUnauthorized})`)}i=s.connect(n)}else{_(`COAP CONNECT INSECURE ${JSON.stringify(n,null,2)}`);i=o.connect(n)}return new c((e,t)=>{const n=this.tlsMode?"secureConnect":"connect";i.on(n,()=>{_(`COAP CONNECTED ${i.remoteAddress}:${i.remotePort}`);if(n==="secureConnect"){_(`authorized: ${i.authorized}`);_(`encrypted: ${i.encrypted}`);const e=i.getCipher();_(`cipher name: ${e.name}, version: ${e.version}`);_("server certificate");_(i.getPeerCertificate())}this.resetSocket();this.socket=i;e()});let r=null;i.on("data",e=>{let t;let n=e;if(r){n=Buffer.concat([r,e]);r=null}try{t=u.decodeTcpMessage(n)}catch(e){if(e.message==="sliced packet")r=Buffer.from(n);return}const s=t.code;const o=t.token.toString("hex");const c=t.payload;_(`COAP RECEIVE ${i.remoteAddress}:${i.remotePort}`);_(`${t.toString()}\n`);this.emit("debug",`COAP RECEIVE: ${t.toString()}`);const a=this.errorCallbackMap[o];const l=this.callbackMap[o];if(!this.isObserveMap[o]){delete this.callbackMap[o];delete this.errorCallbackMap[o]}if(a&&(s>=128&&s<192)){const e=c?c.message||JSON.stringify(c,null,2):t;const n=new p("COAP_API_FAILED",e);n.coapCode=s;n.coapPayload=c;a(n)}else if(l){l(c)}else if(this.requestHandler&&s<5){this.requestHandler(t)}});i.on("error",e=>{_(`COAP ERROR ${JSON.stringify(e,null,2)}`);E.error(`COAP ERROR ${JSON.stringify(e,null,2)}`);const n=Object.keys(this.errorCallbackMap).map(e=>this.errorCallbackMap[e]);n.forEach(t=>t(e));this.errorCallbackMap={};t(e)});i.on("close",()=>{E.info("COAP TCP/IP SOCKET CLOSED");this.emit("close");this.resetSocket()})})})}disconnect(){if(this.socket){E.info("COAP TCP/IP SOCKET DESTROYED");this.socket.destroy();this.resetSocket()}}send(e,t){if(!this.socket)throw new p("NOT_CONNECTED");return new c((n,i)=>{const r=e.token.toString("hex");this.callbackMap[r]=t||n;this.errorCallbackMap[r]=i;_(`COAP SEND ${this.socket.remoteAddress}:${this.socket.remotePort}`);_(`${e.toString()}\n`);this.emit("debug",`COAP SEND: ${e.toString()}`);this.socket.write(e.toTcpMessage());if(t)n()})}sendResponse(e){return this.send(e)}sendRequest(e,t,n,i){return this.send(f({code:e,path:t,query:n,payload:i}))}observe(e,t,n){const i=Buffer.alloc(0);const r=f({code:I.OBSERVE,path:e,query:t,observe:i});const s=`${e}${t||""}`;const o=r.token.toString("hex");this.observeTokenMap[s]=o;this.isObserveMap[o]=true;return this.send(r,n)}cancelObserve(e,t){const n=Buffer.alloc(1,1);const i=`${e}${t||""}`;const r=this.observeTokenMap[i];if(r){delete this.observeTokenMap[i];delete this.callbackMap[r];delete this.errorCallbackMap[r];delete this.isObserveMap[r];const s=f({code:I.UNOBSERVE,path:e,query:t,observe:n,token:Buffer.from(r,"hex")});return this.send(s)}return c.resolve()}}e.exports=new Proxy(P,d())},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("i18next")},function(e,t){e.exports=require("i18next-sync-fs-backend")},function(e,t){const n={ADB_CONTROLLER_NO_DEVICE:{MSG_KEY:"ADB_CONTROLLER.NO_DEVICE"},ADB_CONTROLLER_NO_DEVICE_SERIAL:{MSG_KEY:"ADB_CONTROLLER.NO_DEVICE_SERIAL"},ADB_CONTROLLER_MANY_DEVICE:{MSG_KEY:"ADB_CONTROLLER.MANY_DEVICE"},CERT_NO_KEY:{MSG_KEY:"CERT.NO_KEY"},CERT_NO_CERT:{MSG_KEY:"CERT.NO_CERT"},CERT_NO_AUTHOR_KEY:{MSG_KEY:"CERT.NO_AUTHOR_KEY"},CERT_NO_AUTHOR_CERT:{MSG_KEY:"CERT.NO_AUTHOR_CERT"},CERT_NO_DISTRIBUTOR_KEY:{MSG_KEY:"CERT.NO_DISTRIBUTOR_KEY"},CERT_NO_DISTRIBUTOR_CERT:{MSG_KEY:"CERT.NO_DISTRIBUTOR_CERT"},CERT_NO_DEVICE_KEY:{MSG_KEY:"CERT.NO_DEVICE_KEY"},CERT_NO_DEVICE_CERT:{MSG_KEY:"CERT.NO_DEVICE_CERT"},CERT_NO_PASSWORD:{MSG_KEY:"CERT.NO_PASSWORD"},CERT_INVALID_PASSWORD:{MSG_KEY:"CERT.INVALID_PASSWORD"},CERT_NO_LOGIN:{MSG_KEY:"CERT.NO_LOGIN"},CERT_NO_DEVICE_NAME:{MSG_KEY:"CERT.NO_DEVICE_NAME"},DEVICE_TURNED_OFF:{MSG_KEY:"DEVICE.TURNED_OFF"},IOT_CONSOLE_DEVICE_CRT_API_FAILED:{MSG_KEY:"IOT_CONSOLE.DEVICE_CRT_API_FAILED"},IOT_CONSOLE_PPK_AUTH_CRT_API_FAILED:{MSG_KEY:"IOT_CONSOLE.PPK_AUTH_CRT_API_FAILED"},IOT_CONSOLE_PPK_DIST_CRT_API_FAILED:{MSG_KEY:"IOT_CONSOLE.PPK_DIST_CRT_API_FAILED"},IOT_CONSOLE_PRJ_API_FAILED:{MSG_KEY:"IOT_CONSOLE.PRJ_API_FAILED"},IOT_CONSOLE_AUTH_API_FAILED:{MSG_KEY:"IOT_CONSOLE.AUTH_API_FAILED"},IOT_CONSOLE_SDK_LOGIN_API_FAILED:{MSG_KEY:"IOT_CONSOLE.SDK_LOGIN_API_FAILED"},IOT_CONSOLE_SDK_AUTHCODE_API_FAILED:{MSG_KEY:"IOT_CONSOLE.SDK_AUTHCODE_API_FAILED"},IOT_CONSOLE_PLUGIN_API_FAILED:{MSG_KEY:"IOT_CONSOLE.PLUGIN_API_FAILED"},SIGN_UP_NO_LOGIN:{MSG_KEY:"SIGN_UP.NO_LOGIN"},SIGN_IN_NO_LOGIN:{MSG_KEY:"SIGN_IN.NO_LOGIN"},SIGN_IN_EXPIRED_TOKEN:{MSG_KEY:"SIGN_IN.EXPIRED_TOKEN"},SIGN_IN_NO_SIGN_UP:{MSG_KEY:"SIGN_IN.NO_SIGN_UP"},CREATE_PROJECT_PRJ_ALREADY_EXISTS:{MSG_KEY:"CREATE_PROJECT.PRJ_ALREADY_EXISTS"},CREATE_PROJECT_INVAID_VID:{MSG_KEY:"CREATE_PROJECT.INVAID_VID"},CREATE_PROJECT_INVALID_LAMBDA_ARN:{MSG_KEY:"CREATE_PROJECT.INVALID_LAMBDA_ARN"},CREATE_PROJECT_INVALID_WEBHOOK_URL:{MSG_KEY:"CREATE_PROJECT.INVALID_WEBHOOK_URL"},CREATE_PROJECT_VID_EXCEEDS_MAX_LENGTH:{MSG_KEY:"CREATE_PROJECT.VID_EXCEEDS_MAX_LENGTH"},CREATE_PROJECT_DEVICE_PLUGIN_OPTION_REQUIRED:{MSG_KEY:"CREATE_PROJECT.DEVICE_PLUGIN_OPTION_REQUIRED"},CREATE_PROJECT_UNSUPPORTED_DEVICE_MODEL:{MSG_KEY:"CREATE_PROJECT.UNSUPPORTED_DEVICE_MODEL"},CREATE_PROJECT_APP_NAME_OPT_REQUIRED:{MSG_KEY:"CREATE_PROJECT.APP_NAME_OPT_REQUIRED"},CREATE_PROJECT_APP_TYPE_OPT_REQUIRED:{MSG_KEY:"CREATE_PROJECT.APP_TYPE_OPT_REQUIRED"},CREATE_PROJECT_LAMBDA_ARN_OPT_REQUIRED:{MSG_KEY:"CREATE_PROJECT.LAMBDA_ARN_OPT_REQUIRED"},CREATE_PROJECT_TARGET_URL_OPT_REQUIRED:{MSG_KEY:"CREATE_PROJECT.TARGET_URL_OPT_REQUIRED"},CREATE_PROJECT_PLUGIN_ID_OPT_REQUIRED:{MSG_KEY:"CREATE_PROJECT.PLUGIN_ID_OPT_REQUIRED"},PROJECT_NAME_EMPTY:{MSG_KEY:"CREATE_PROJECT.PROJECT_NAME_EMPTY"},PROJECT_NAME_LENGTH_EXCEEDS_MAX_LENGTH:{MSG_KEY:"CREATE_PROJECT.PROJECT_NAME_LENGTH_EXCEEDS_MAX_LENGTH"},PROJECT_NAME_INVALID_CHAR:{MSG_KEY:"CREATE_PROJECT.PROJECT_NAME_INVALID_CHAR"},PROJECT_NAME_START_WITH_INVALID_CHAR:{MSG_KEY:"CREATE_PROJECT.PROJECT_NAME_START_WITH_INVALID_CHAR"},PROJECT_NAME_END_WITH_INVALID_CHAR:{MSG_KEY:"CREATE_PROJECT.PROJECT_NAME_END_WITH_INVALID_CHAR"},THINGS_SDK_PROPERTY_TYPE_MAPPING_NOT_FOUND:{MSG_KEY:"EXPORT_PROJECT.THINGS_SDK_PROPERTY_TYPE_MAPPING_NOT_FOUND"},INVALID_PLUGIN_ID_REGEX:{MSG_KEY:"PROJECT.INVALID_PLUGIN_ID_REGEX"},DEVICE_PLUGIN_PACKAGE_NAME_NOT_MATCHED:{MSG_KEY:"PROJECT.DEVICE_PLUGIN_PACKAGE_NAME_NOT_MATCHED"},PLUGIN_PACKAGE_NAME_NOT_MATCHED_SMART_APP_PLUGIN_ID:{MSG_KEY:"PROJECT.PLUGIN_PACKAGE_NAME_NOT_MATCHED_SMART_APP_PLUGIN_ID"},VERIFY_PPK_NO_IN:{MSG_KEY:"VERIFY_PPK.NO_IN_OPTION"},VERIFY_PPK_FAIL:{MSG_KEY:"VERIFY_PPK.FAIL"},VERIFY_PPK_UNKNOWN_FAIL:{MSG_KEY:"VERIFY_PPK.UNKNOWN_FAIL"},VERIFY_PPK_VERIFY_FAIL:{MSG_KEY:"VERIFY_PPK.VERIFY_FAIL"},VERIFY_PPK_FILE_NOT_FOUND_FAIL:{MSG_KEY:"VERIFY_PPK.FILE_NOT_FOUND_FAIL"},VERIFY_PPK_ZIP_FORMAT_FAIL:{MSG_KEY:"VERIFY_PPK.ZIP_FORMAT_FAIL"},SIGN_PPK_NO_AUTH_KEY:{MSG_KEY:"SIGN_PPK.NO_AUTH_KEY"},SIGN_PPK_NO_AUTH_CERT:{MSG_KEY:"SIGN_PPK.NO_AUTH_CERT"},SIGN_PPK_NO_DIST_KEY:{MSG_KEY:"SIGN_PPK.NO_DIST_KEY"},SIGN_PPK_NO_DIST_CERT:{MSG_KEY:"SIGN_PPK.NO_DIST_CERT"},SIGN_PPK_NO_AUTH_PASS:{MSG_KEY:"SIGN_PPK.NO_AUTH_PASS"},SIGN_PPK_NO_DIST_PASS:{MSG_KEY:"SIGN_PPK.NO_DIST_PASS"},SIGN_PPK_NO_PASSWD:{MSG_KEY:"SIGN_PPK.NO_PASSWD"},SIGN_PPK_INVALID_KEY:{MSG_KEY:"SIGN_PPK.INVALID_KEY"},SIGN_PPK_FILE_NOTFOUND:{MSG_KEY:"ONEAPP.CANNOT_FIND_PPK_FILE"},SIGN_PPK_FAIL:{MSG_KEY:"SIGN_PPK.FAIL"},SIGN_PPK_NO_REQUIRED:{MSG_KEY:"SIGN_PPK.NO_REQUIRED"},EXTRACT_PPK_NO_OUT:{MSG_KEY:"EXTRACT_PPK.NO_OUT"},INSTALL_APP_FAIL:{MSG_KEY:"INSTALL_APP.FAIL"},INSTALL_APP_FAIL_ON_SIM:{MSG_KEY:"INSTALL_APP.FAIL_ON_SIM"},INSTALL_APP_NO_OPT:{MSG_KEY:"INSTALL_APP.NO_OPT"},INSTALL_APP_FAIL_PUSH:{MSG_KEY:"INSTALL_APP.FAIL_PUSH"},INSTALL_APP_FAIL_CMD:{MSG_KEY:"INSTALL_APP.FAIL_CMD"},LAUNCH_ONEAPP_SIM_FAIL:{MSG_KEY:"LAUNCH_ONEAPP_SIMULATOR.FAIL"},LAUNCH_ONEAPP_SIM_FAIL_BY_MEMORY:{MSG_KEY:"LAUNCH_ONEAPP_SIMULATOR.MEMORYFAIL"},KILL_ONEAPP_SIM_FAIL:{MSG_KEY:"KILL_ONEAPP_SIMULATOR.FAIL"},LAUNCH_VD_FAIL:{MSG_KEY:"LAUNCH_VIRTUAL_DEVICE.FAIL"},CANNOT_FIND_VIRTUAL_DEVICE:{MSG_KEY:"ONEAPP.CANNOT_FIND_VIRTUAL_DEVICE"},DESCRIBE_MANIFEST_FAIL:{MSG_KEY:"DESCRIBE_MANIFEST.FAIL"},REGISTER_MANIFEST_FAIL:{MSG_KEY:"REGISTER_MANIFEST.FAIL"},DELETE_MANIFEST_FAIL:{MSG_KEY:"DELETE_MANIFEST.FAIL"},UPDATE_MANIFEST_FAIL:{MSG_KEY:"UPDATE_MANIFEST.FAIL"},PUBLISH_DEVICE_NO_TOKEN:{MSG_KEY:"PUBLISH_DEVICE.NO_TOKEN"},CREATE_LOCATION_NO_LATITUDE:{MSG_KEY:"CREATE_LOCATION.NO_LATITUDE"},CREATE_LOCATION_NO_LONGITUDE:{MSG_KEY:"CREATE_LOCATION.NO_LONGITUDE"},CREATE_LOCATION_NO_RADIUS:{MSG_KEY:"CREATE_LOCATION.NO_RADIUS"},CREATE_LOCATION_NO_RADIUS_FLOAT:{MSG_KEY:"CREATE_LOCATION.NO_RADIUS_FLOAT"},UPDATE_LOCATION_NO_LATITUDE:{MSG_KEY:"UPDATE_LOCATION.NO_LATITUDE"},UPDATE_LOCATION_NO_LONGITUDE:{MSG_KEY:"UPDATE_LOCATION.NO_LONGITUDE"},UPDATE_LOCATION_NO_RADIUS:{MSG_KEY:"UPDATE_LOCATION.NO_RADIUS"},UPDATE_LOCATION_NO_RADIUS_FLOAT:{MSG_KEY:"UPDATE_LOCATION.NO_RADIUS_FLOAT"},DELETE_LOCATION_NO_ID:{MSG_KEY:"DELETE_LOCATION.NO_ID"},REGISTER_ENDPOINT_APP_NO_CONFIG:{MSG_KEY:"REGISTER_ENDPOINT_APP.NO_CONFIG"},REGISTER_ENDPOINT_APP_NO_LAMBDA:{MSG_KEY:"REGISTER_ENDPOINT_APP.NO_LAMBDA"},UPDATE_ENDPOINT_APP_FAIL:{MSG_KEY:"UPDATE_ENDPOINT_APP.FAIL"},CREATE_SUBSCRIPTION_NO_NAME:{MSG_KEY:"CREATE_SUBSCRIPTION.NO_NAME"},CREATE_SUBSCRIPTION_NO_LOCATION:{MSG_KEY:"CREATE_SUBSCRIPTION.NO_LOCATION"},CREATE_SUBSCRIPTION_NO_DEVICE:{MSG_KEY:"CREATE_SUBSCRIPTION.NO_DEVICE"},CREATE_SUBSCRIPTION_NO_SOURCE:{MSG_KEY:"CREATE_SUBSCRIPTION.NO_SOURCE"},CREATE_DEVICE_PROFILE_NO_INPUT:{MSG_KEY:"CREATE_DEVICE_PROFILE.NO_INPUT"},UPDATE_DEVICE_PROFILE_NO_INPUT:{MSG_KEY:"UPDATE_DEVICE_PROFILE.NO_INPUT"},SET_CONFIG_NO_KEY:{MSG_KEY:"SET_CONFIG.NO_KEY"},CAPABILITY_OR_DEVICE_PROFILE_PATH_REQUIRED:{MSG_KEY:"GENERATE_MANIFEST.CAPABILITY_OR_DEVICE_PROFILE_PATH_REQUIRED"},ONLY_ONE_OF_CAPABILITY_AND_DEVICE_PROFILE_PATH_REQUIRED:{MSG_KEY:"GENERATE_MANIFEST.ONLY_ONE_OF_CAPABILITY_AND_DEVICE_PROFILE_PATH_REQUIRED"},NOT_IN_PROJECT_DIRECTORY:{MSG_KEY:"GENERATE_MANIFEST.NOT_IN_PROJECT_DIRECTORY"},NO_WEB_CONSOLE_PROJECT_CONFIG:{MSG_KEY:"DESCRIBE_WEB_CONSOLE_PROJECT.NO_WEB_CONSOLE_PROJECT_CONFIG"},WEB_CONSOLE_PROJECT_NOT_FOUND:{MSG_KEY:"DESCRIBE_WEB_CONSOLE_PROJECT.WEB_CONSOLE_PROJECT_NOT_FOUND"},WEB_CONSOLE_URI_NOT_MATCHED:{MSG_KEY:"DESCRIBE_WEB_CONSOLE_PROJECT.WEB_CONSOLE_URI_NOT_MATCHED"},WEB_CONSOLE_PROJECT_CONFIG_NOT_FOUND:{MSG_KEY:"DESCRIBE_WEB_CONSOLE_PROJECT.WEB_CONSOLE_PROJECT_CONFIG_NOT_FOUND"},WEB_CONSOLE_PROJECT_MNNM_MISMATCH:{MSG_KEY:"REGISTER_WEB_CONSOLE_PROJECT.MNNM_MISMATCH"},UI_CLOSED:{MSG_KEY:"UI.CLOSED"},CANNOT_REFRESH_ACCESS_TOKEN:{MSG_KEY:"AUTH.CANNOT_REFRESH_ACCESS_TOKEN"},CANNOT_GET_AUTH_CODE:{MSG_KEY:"AUTH.CANNOT_GET_AUTH_CODE"},CANNOT_GET_ACCESS_TOKEN:{MSG_KEY:"AUTH.CANNOT_GET_ACCESS_TOKEN"},REFRESH_TOKEN_EXPIRED:{MSG_KEY:"AUTH.REFRESH_TOKEN_EXPIRED"},INVALID_SSO_TOKEN:{MSG_KEY:"AUTH.INVALID_SSO_TOKEN"},LOGIN_ERROR:{MSG_KEY:"AUTH.LOGIN_ERROR"},NO_LOGIN:{MSG_KEY:"AUTH.NO_LOGIN"},UNSUPPORTED_REGION:{MSG_KEY:"AWS.UNSUPPORTED_REGION"},NO_LAMBDA_NAME:{MSG_KEY:"AWS.NO_LAMBDA_NAME"},NO_LAMBDA_RUNTIME:{MSG_KEY:"AWS.NO_LAMBDA_RUNTIME"},NO_LAMBDA_ROLE:{MSG_KEY:"AWS.NO_LAMBDA_ROLE"},NO_LAMBDA_HANDLER:{MSG_KEY:"AWS.NO_LAMBDA_HANDLER"},NO_APP_NAME:{MSG_KEY:"SMART_APP.NO_APP_NAME"},NO_APP_TYPE:{MSG_KEY:"SMART_APP.NO_APP_TYPE"},NO_APP_IMPLEMENTATION:{MSG_KEY:"SMART_APP.NO_APP_IMPLEMENTATION"},NO_APP_DISPLAY_NAME:{MSG_KEY:"SMART_APP.NO_APP_DISPLAY_NAME"},NO_APP_DESCRIPTION:{MSG_KEY:"SMART_APP.NO_APP_DESCRIPTION"},INVALID_APP_TYPE:{MSG_KEY:"SMART_APP.INVALID_APP_TYPE"},NO_APP_NAME_OR_NO_APP_ID:{MSG_KEY:"SMART_APP.NO_APP_NAME_OR_NO_APP_ID"},INVALID_SCOPE:{MSG_KEY:"SMART_APP.INVALID_SCOPE"},INVALID_SETTINGS:{MSG_KEY:"SMART_APP.INVALID_SETTINGS"},APP_NOT_FOUND:{MSG_KEY:"SMART_APP.APP_NOT_FOUND"},NO_DEVICE_PROFILE_ID:{MSG_KEY:"C2C.NO_DEVICE_PROFILE_ID"},NO_DEVICE_PROFILE_NAME:{MSG_KEY:"C2C.NO_NAME"},NO_COMPONENTS:{MSG_KEY:"C2C.NO_COMPONENTS"},NO_META_DATA:{MSG_KEY:"C2C.NO_META_DATA"},TOO_MANY_COMPONENTS:{MSG_KEY:"C2C.TOO_MANY_COMPONENTS"},TOO_MANY_CAPABILITIES:{MSG_KEY:"C2C.TOO_MANY_CAPABILITIES"},AT_LEAST_ONE_MAIN_COMPONENT_REQUIRED:{MSG_KEY:"C2C.AT_LEAST_ONE_MAIN_COMPONENT_REQUIRED"},CANNOT_FIND_INPUT_PATH:{MSG_KEY:"C2C.CANNOT_FIND_INPUT_PATH"},NO_APP_ID:{MSG_KEY:"C2C.NO_APP_ID"},NO_LOCATION_ID:{MSG_KEY:"C2C.NO_LOCATION_ID"},NO_CONFIGURATION_STATUS:{MSG_KEY:"C2C.NO_CONFIGURATION_STATUS"},NO_INSTALLED_APP_ID:{MSG_KEY:"C2C.NO_INSTALLED_APP_ID"},NO_APP_CONFIGURATION_ID:{MSG_KEY:"C2C.NO_APP_CONFIGURATION_ID"},NO_SCHEDULE_NAME:{MSG_KEY:"C2C.NO_SCHEDULE_NAME"},NO_SCHEDULE:{MSG_KEY:"C2C.NO_SCHEDULE"},NO_SOURCE_TYPE:{MSG_KEY:"C2C.NO_SOURCE_TYPE"},NO_SUBSCRIPTION_ID:{MSG_KEY:"C2C.NO_SUBSCRIPTION_ID"},CANNOT_FIND_MAP_TO_RESOURCES:{MSG_KEY:"CAPABILITY.CANNOT_FIND_MAP_TO_RESOURCES"},CANNOT_FIND_COMPONENTS:{MSG_KEY:"CAPABILITY.CANNOT_FIND_COMPONENTS"},CANNOT_FIND_CAPABILITY:{MSG_KEY:"CAPABILITY.CANNOT_FIND_CAPABILITY"},UNSUPPORTED_PROTOCOL:{MSG_KEY:"COAP.UNSUPPORTED_PROTOCOL"},COAP_API_FAILED:{MSG_KEY:"COAP.API_FAILED"},NOT_CONNECTED:{MSG_KEY:"COAP.NOT_CONNECTED"},NO_COMMAND:{MSG_KEY:"COMMAND.NO_COMMAND"},NO_COMMAND_OPTION:{MSG_KEY:"COMMAND.NO_COMMAND_OPTION"},NO_COMMAND_DESCRIPTION:{MSG_KEY:"COMMAND.NO_COMMAND_DESCRIPTION"},NO_COMMAND_RUNNER:{MSG_KEY:"COMMAND.NO_COMMAND_RUNNER"},COMMAND_ALREADY_ADDED:{MSG_KEY:"COMMAND.COMMAND_ALREADY_ADDED"},CANNOT_LOAD_CONFIGURATION_FILE:{MSG_KEY:"CONFIGURATOR.CANNOT_LOAD_CONFIGURATION_FILE"},NO_DEVICE_ID:{MSG_KEY:"DEVICE.NO_DEVICE_ID"},NO_DEVICE_COMMAND:{MSG_KEY:"DEVICE.NO_DEVICE_COMMAND"},NO_RESOURCE_HREF:{MSG_KEY:"DEVICE.NO_RESOURCE_HREF"},DEVICE_NOT_FOUND:{MSG_KEY:"DEVICE.DEVICE_NOT_FOUND"},CANNOT_FIND_CUSTOM_DEVICE_PROFILE:{MSG_KEY:"DEVICE_PROFILE.CANNOT_FIND_CUSTOM_DEVICE_PROFILE"},UNSUPPORTED_CAPABILITY:{MSG_KEY:"DEVICE_PROFILE.UNSUPPORTED_CAPABILITY"},INVALID_DEVICE_PROFILE:{MSG_KEY:"DEVICE_PROFILE.INVALID_DEVICE_PROFILE"},EXCEEDED_DEVICE_NAME:{MSG_KEY:"DEVICE_PROFILE.EXCEEDED_DEVICE_NAME"},EXCEEDED_VID:{MSG_KEY:"DEVICE_PROFILE.EXCEEDED_VID"},INVALID_VID:{MSG_KEY:"DEVICE_PROFILE.INVALID_VID"},EXCEEDED_META_VID:{MSG_KEY:"DEVICE_PROFILE.EXCEEDED_META_VID"},INVALID_VID_REGEX:{MSG_KEY:"DEVICE_PROFILE.INVALID_VID_REGEX"},INVALID_META_VID:{MSG_KEY:"DEVICE_PROFILE.INVALID_META_VID"},INVALID_META_VID_REGEX:{MSG_KEY:"DEVICE_PROFILE.INVALID_META_VID_REGEX"},UNSUPPORTED_DEVICE_PROFILE_MODEL:{MSG_KEY:"DEVICE_PROFILE.UNSUPPORTED_DEVICE_PROFILE_MODEL"},UNSUPPORTED_METADATA_DEVICE_TYPE:{MSG_KEY:"DEVICE_PROFILE.UNSUPPORTED_METADATA_DEVICE_TYPE"},CANNOT_FIND_DEVICE_PROFILE:{MSG_KEY:"DEVICE_PROFILE.CANNOT_FIND_DEVICE_PROFILE"},NOT_CAPABILITY_MODEL:{MSG_KEY:"DEVICE_PROFILE.NOT_CAPABILITY_MODEL"},CANNOT_MAP_CAPABILITY:{MSG_KEY:"DEVICE_PROFILE.CANNOT_MAP_CAPABILITY"},NO_RESOURCES_TO_MAP:{MSG_KEY:"DEVICE_PROFILE.NO_RESOURCES_TO_MAP"},UNSUPPORTED_DEVICE_PROFILE_TYPE:{MSG_KEY:"DEVICE_PROFILE.UNSUPPORTED_DEVICE_PROFILE_TYPE"},NO_MNMN_OR_NO_MNID:{MSG_KEY:"DEVICE_PROFILE.NO_MNMN_OR_NO_MNID"},CAPABILITY_MAPPING_NOT_FOUND:{MSG_KEY:"DEVICE_PROFILE.CAPABILITY_MAPPING_NOT_FOUND"},CAPABILITY_MAPPING_ALREADY_EXISTS:{MSG_KEY:"DEVICE_PROFILE.CAPABILITY_MAPPING_ALREADY_EXISTS"},DEVICE_TYPE_MAPPING_NOT_FOUND:{MSG_KEY:"DEVICE_PROFILE.DEVICE_TYPE_MAPPING_NOT_FOUND"},CANNOT_FIND_MNID:{MSG_KEY:"DEV_PORTAL.CANNOT_FIND_MNID"},NO_DEV_PORTAL:{MSG_KEY:"DEV_PORTAL.NO_DEV_PORTAL"},NO_PROGRAM_ID:{MSG_KEY:"DEV_PORTAL.NO_PROGRAM_ID"},CANNOT_PARSE_JSON:{MSG_KEY:"IOT_CLOUD.CANNOT_PARSE_JSON"},IOT_CLOUD_DEVICE_NOT_FOUND:{MSG_KEY:"IOT_CLOUD.DEVICE_NOT_FOUND"},IOT_CLOUD_CLIENT_DEVICE_NOT_FOUND:{MSG_KEY:"IOT_CLOUD.CLIENT_DEVICE_NOT_FOUND"},INVALID_EVENT_TYPES:{MSG_KEY:"IOT_CLOUD.INVALID_EVENT_TYPES"},CANNOT_FIND_TEMPLATE:{MSG_KEY:"IOT_CONSOLE.CANNOT_FIND_TEMPLATE"},NO_LOCATION_NAME:{MSG_KEY:"LOCATION.NO_LOCATION_NAME"},NO_COUNTRY_CODE:{MSG_KEY:"LOCATION.NO_COUNTRY_CODE"},INVALID_LATITUDE:{MSG_KEY:"LOCATION.INVALID_LATITUDE"},INVALID_LATITUDE_NUMBER:{MSG_KEY:"LOCATION.INVALID_LATITUDE_NUMBER"},INVALID_LONGITUDE:{MSG_KEY:"LOCATION.INVALID_LONGITUDE"},INVALID_LONGITUDE_NUMBER:{MSG_KEY:"LOCATION.INVALID_LONGITUDE_NUMBER"},INVALID_REGION_RADIUS:{MSG_KEY:"LOCATION.INVALID_REGION_RADIUS"},INVALID_TEMPERATURE_SCALE:{MSG_KEY:"LOCATION.INVALID_TEMPERATURE_SCALE"},INVALID_LOCATION_ID:{MSG_KEY:"LOCATION.INVALID_LOCATION_ID"},EMPTY_PARAMETER:{MSG_KEY:"LOCATION.EMPTY_PARAMETER"},CANNOT_DELETE_DEFAULT_LOCATION:{MSG_KEY:"LOCATION.CANNOT_DELETE_DEFAULT_LOCATION"},INVALID_RESPONSE:{MSG_KEY:"MANIFEST.INVALID_RESPONSE"},INVALID_STATUS:{MSG_KEY:"MANIFEST.INVALID_STATUS"},FAILED_TO_RETRIEVE_MANIFEST:{MSG_KEY:"MANIFEST.FAILED_TO_RETRIEVE_MANIFEST"},FAILED_TO_RETRIEVE_MANIFEST_LIST:{MSG_KEY:"MANIFEST.FAILED_TO_RETRIEVE_MANIFEST_LIST"},CANNOT_FIND_MANIFEST:{MSG_KEY:"MANIFEST.CANNOT_FIND_MANIFEST"},NO_READABLE_PROPERTY:{MSG_KEY:"METADATA.NO_READABLE_PROPERTY"},NO_WRITABLE_PROPERTY:{MSG_KEY:"METADATA.NO_WRITABLE_PROPERTY"},INVALID_COMPONENT_ID:{MSG_KEY:"METADATA.INVALID_COMPONENT_ID"},CANNOT_FIND_RESOURCE_IN_DEVICE_PROFILE:{MSG_KEY:"METADATA.CANNOT_FIND_RESOURCE_IN_DEVICE_PROFILE"},INVALID_CAPABILITY:{MSG_KEY:"METADATA.INVALID_CAPABILITY"},INVALID_MAIN_STATE_CAPABILITY:{MSG_KEY:"METADATA.INVALID_MAIN_STATE_CAPABILITY"},INVALID_MAIN_ACTION_CAPABILITY:{MSG_KEY:"METADATA.INVALID_MAIN_ACTION_CAPABILITY"},CANNOT_FIND_MAPPER_FILE:{MSG_KEY:"METADATA.CANNOT_FIND_MAPPER_FILE"},CANNOT_FIND_CAPABILITY_MAPPER_FILE:{MSG_KEY:"METADATA.CANNOT_FIND_CAPABILITY_MAPPER_FILE"},CANNOT_FIND_RESOURCE:{MSG_KEY:"DEVICE.CANNOT_FIND_RESOURCE"},TOO_MANY_RESOURCES:{MSG_KEY:"DEVICE.TOO_MANY_RESOURCES"},NO_GROUP_NAME:{MSG_KEY:"GROUP.NO_GROUP_NAME"},INVALID_MEMBERS_TYPE:{MSG_KEY:"GROUP.INVALID_MEMBERS_TYPE"},NO_GROUP_ID:{MSG_KEY:"GROUP.NO_GROUP_ID"},INVALID_OPERATION:{MSG_KEY:"GROUP.INVALID_OPERATION"},CANNOT_DELETE_DEVICE_FROM_GROUP:{MSG_KEY:"GROUP.CANNOT_DELETE_DEVICE_FROM_GROUP"},CANNOT_DELETE_DEFAULT_GROUP:{MSG_KEY:"GROUP.CANNOT_DELETE_DEFAULT_GROUP"},CANNOT_FIND_UI_MANIFEST_FILE:{MSG_KEY:"ONEAPP.CANNOT_FIND_UI_MANIFEST_FILE"},CANNOT_FIND_UI_MANIFEST_FILE_BY_PATH:{MSG_KEY_:"ONEAPP.CANNOT_FIND_UI_MANIFEST_FILE_BY_PATH"},CANNOT_FIND_UI_MANIFEST_FILE_BY_NAME:{MSG_KEY_:"ONEAPP.CANNOT_FIND_UI_MANIFEST_FILE_BY_NAME"},CANNOT_FIND_SIMULATOR:{MSG_KEY:"ONEAPP.CANNOT_FIND_SIMULATOR"},CANNOT_FIND_PLUGINFOLDER:{MSG_KEY:"ONEAPP.CANNOT_FIND_PLUGINFOLDER"},NO_USER_ID:{MSG_KEY:"ONEAPP.NO_USER_ID"},NO_SSO_TOKEN:{MSG_KEY:"ONEAPP.NO_SSO_TOKEN"},NO_AUTH_PROVIDER_URI:{MSG_KEY:"ONEAPP.NO_AUTH_PROVIDER_URI"},NO_MNID:{MSG_KEY:"ONEAPP.NO_MNID"},NO_ADB_PATH:{MSG_KEY:"ONEAPP.NO_ADB_PATH"},UNMATCHED_MNID:{MSG_KEY:"ONEAPP.UNMATCHED_MNID"},UNMATCHED_VID:{MSG_KEY:"ONEAPP.UNMATCHED_VID"},NO_VID_IN_MANIFEST:{MSG_KEY:"ONEAPP.NO_VID_IN_MANIFEST"},CANNOT_FIND_MANIFEST_XML:{MSG_KEY:"ONEAPP.CANNOT_FIND_MANIFEST_XML"},INVALID_MANIFEST_XML:{MSG_KEY:"ONEAPP.INVALID_MANIFEST_XML"},CANNOT_FIND_PPK_FILE:{MSG_KEY:"ONEAPP.CANNOT_FIND_PPK_FILE"},CANNOT_FIND_CATALOG_FILE:{MSG_KEY:"ONEAPP.CANNOT_FIND_CATALOG_FILE"},CANNOT_FIND_ADB_FILE:{MSG_KEY:"ONEAPP.CANNOT_FIND_ADB_FILE"},NO_DEVICE_PROFILE_OR_IN:{MSG_KEY:"C2C.NO_DEVICE_PROFILE_OR_IN"},CANNOT_PARSE_SCHEMA:{MSG_KEY:"RESOURCE_TYPE.CANNOT_PARSE_SCHEMA"},CANNOT_PARSE_EXAMPLE:{MSG_KEY:"RESOURCE_TYPE.CANNOT_PARSE_EXAMPLE"},AVOID_TIME_OUT:{MSG_KEY:"RESOURCE_TYPE.AVOID_TIME_OUT"},CANNOT_PARSE_RAML:{MSG_KEY:"RESOURCE_TYPE.CANNOT_PARSE_RAML"},INVALID_CONFIGURATION_STATUS:{MSG_KEY:"C2C.INVALID_CONFIGURATION_STATUS"},INVALID_INSTALLED_APP_TYPE:{MSG_KEY:"SMART_APP.INVALID_INSTALLED_APP_TYPE"},INVALID_SOURCE_TYPE:{MSG_KEY:"SMART_APP.INVALID_SOURCE_TYPE"},NO_SUBSCRIPTION_DETAIL:{MSG_KEY:"SMART_APP.NO_SUBSCRIPTION_DETAIL"},NO_COMPANY_INFORMATION:{MSG_KEY:"SET_MNID.NO_COMPANY_INFORMATION"},NO_INDIVIDUAL_INFORMATION:{MSG_KEY:"SET_MNID.NO_INDIVIDUAL_INFORMATION"},UNSUPPORTED_MNID_TYPE:{MSG_KEY:"SET_MNID.UNSUPPORTED_MNID_TYPE"},CANNOT_CHANGE_COMPANY_MNID:{MSG_KEY:"SET_MNID.CANNOT_CHANGE_COMPANY_MNID"},UNSUPPORTED_CONTENT_FORMAT:{MSG_KEY:"COAP.UNSUPPORTED_CONTENT_FORMAT"},UNSUPPORTED_OPTION_NUMBER:{MSG_KEY:"COAP.UNSUPPORTED_OPTION_NUMBER"},TOO_LARGE_TCP_BODY:{MSG_KEY:"COAP.TOO_LARGE_TCP_BODY"},INVALID_OPTION_DELTA:{MSG_KEY:"COAP.INVALID_OPTION_DELTA"},INVALID_OPTION_LENGTH:{MSG_KEY:"COAP.INVALID_OPTION_LENGTH"},INVALID_PAYLOAD:{MSG_KEY:"COAP.INVALID_PAYLOAD"},INVALID_OBSERVE_OPTION:{MSG_KEY:"COAP.INVALID_OBSERVE_OPTION"},INVALID_URI_PATH:{MSG_KEY:"COAP.INVALID_URI_PATH"},INVALID_URI_QUERY:{MSG_KEY:"COAP.INVALID_URI_QUERY"},INVALID_CATALOG_SETUPID:{MSG_KEY:"PROJECT.INVALID_CATALOG_SETUP_ID"},CANNOT_FIND_RESOURCE_IN_DEVICE:{MSG_KEY:"OCF.CANNOT_FIND_RESOURCE_IN_DEVICE"},CANNOT_FIND_TYPE_OF_RESOURCE:{MSG_KEY:"OCF.CANNOT_FIND_TYPE_OF_RESOURCE"},CANNOT_FIND_PROPERTY_DEFINITION:{MSG_KEY:"OCF.CANNOT_FIND_PROPERTY_DEFINITION"},INVALID_PROPERTY:{MSG_KEY:"OCF.INVALID_PROPERTY"},INVALID_DEVICE_PLUGIN_ID_LONG:{MSG_KEY:"PROJECT.INVALID_DEVICE_PLUGIN_ID_LONG"},INVALID_DEVICE_PLUGIN_ID_URI:{MSG_KEY:"PROJECT.INVALID_DEVICE_PLUGIN_ID_URI"},UNDEFINED_PO_CODE:{MSG_KEY:"PROJECT.UNDEFINED_PO_CODE"},BAD_REQUEST:{MSG_KEY:"STCLOUD.BAD_REQUEST"},NOT_AUTHENTICATED:{MSG_KEY:"STCLOUD.NOT_AUTHENTICATED"},NOT_AUTHORIZED:{MSG_KEY:"STCLOUD.NOT_AUTHORIZED"},NOT_FOUND:{MSG_KEY:"STCLOUD.NOT_FOUND"},UNPROCESSABLE_ENTITY:{MSG_KEY:"STCLOUD.UNPROCESSABLE_ENTITY"},TOO_MANY_REQUESTS:{MSG_KEY:"STCLOUD.TOO_MANY_REQUESTS"},INVALID_OCF_DEVICE_TYPE:{MSG_KEY:"DEVICE_PROFILE.INVALID_OCF_DEVICE_TYPE"},NO_RESOURCE_OPTION:{MSG_KEY:"DESCRIBE_DEVICE_STATUS.NO_RESOURCE_OPTION"},CERT_INVALID_CERTIFICATE:{MSG_KEY:"CERT.INVALID_CERTIFICATE"},CERT_INVALID_DISTRIBUTOR:{MSG_KEY:"CERT.INVALID_DISTRIBUTOR"},CERT_EXPIRED_CERTIFICATE:{MSG_KEY:"CERT.EXPIRED_CERTIFICATE"},DESCRIBE_DEVICE_PROFILE_NO_BOTH_OPTION:{MSG_KEY:"DESCRIBE_DEVICE_PROFILE.NO_BOTH_OPTION"},REQUESTING_AUTH_CODE_FAILED:{MSG_KEY:"REQUEST_TOKEN.REQUESTING_AUTH_CODE_FAILED"},REQUESTING_ACCESS_TOKEN_FAILED:{MSG_KEY:"REQUEST_TOKEN.REQUESTING_ACCESS_TOKEN_FAILED"},REQUESTING_AUTHENTICATION_FAILED:{MSG_KEY:"REQUEST_TOKEN.REQUESTING_AUTHENTICATION_FAILED"},GETTING_MNID_FAILED:{MSG_KEY:"REQUEST_TOKEN.GETTING_MNID_FAILED"},REQUESTING_DEVICE_CERT_FAILED:{MSG_KEY:"REQUEST_TOKEN.REQUESTING_DEVICE_CERT_FAILED"},SIGNING_UP_TO_IOT_CLOUD_FAILED:{MSG_KEY:"REQUEST_TOKEN.SIGNING_UP_TO_IOT_CLOUD_FAILED"},INVALID_LOGGER_TYPE:{MSG_KEY:"GET_LOG.INVALID_LOGGER_TYPE"},MUTUALLY_EXCLUSIVE_OPTIONS:{MSG_KEY:"GET_LOG.MUTUALLY_EXCLUSIVE_OPTIONS"},NO_OPTIONS:{MSG_KEY:"GET_LOG.NO_OPTIONS"},NO_AUTHCODE:{MSG_KEY:"GET_LOG.NO_AUTHCODE"},AUTHCODE_OR_SHOWUI_REQUIRED:{MSG_KEY:"GET_LOG.AUTHCODE_OR_SHOWUI_REQUIRED"},UNSUPPORTED_MODE:{MSG_KEY:"CONFIGURATOR.UNSUPPORTED_MODE"},CANNOT_CREATE_SECURITY:{MSG_KEY:"CONFIGURATOR.CANNOT_CREATE_SECURITY"},PATH_IS_EMPTY:{MSG_KEY:"CONFIGURATOR.PATH_IS_EMPTY"},PATH_WITHOUT_VOLUME:{MSG_KEY:"CONFIGURATOR.PATH_WITHOUT_VOLUME"},PATH_LENGTH_EXCEEDED:{MSG_KEY:"CONFIGURATOR.PATH_LENGTH_EXCEEDED"},PATH_INCLUDES_ILLEGAL_CHAR:{MSG_KEY:"CONFIGURATOR.PATH_INCLUDES_ILLEGAL_CHAR"},PATH_IS_NOT_AN_ABSOLUTE_PATH:{MSG_KEY:"CONFIGURATOR.PATH_IS_NOT_AN_ABSOLUTE_PATH"},EXCEEDED_CAPABILITIES:{MSG_KEY:"DEVICE_PROFILE.EXCEEDED_CAPABILITIES"}};function i(e){return n[e]}e.exports={getError:i}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("cbor")},function(e,t){e.exports=require("log4js")},function(e,t){e.exports=require("source-map")},function(e,t){e.exports=require("cycle")},function(e,t){e.exports=require("request-promise")},function(e,t){e.exports=require("request-promise/errors")},function(e,t){e.exports=require("async-lock")},function(e,t,n){const i=n(26);const r=n(0);const s={MNID:"/api/v1/mnid",ENROLLMENT_DATA:"/api/v1/enrollmentData"};class o{constructor(e){const{uri:t,proxy:n,rejectUnauthorized:r}=e;this.requestManager=new i(t,n,r)}requestMnid(e,t){const n={type:"Contact",saguid:e,programId:t};return this.requestManager.request(i.METHODS.GET,s.MNID,n)}requestAccount(e,t){const n={saguid:e,programId:t};return this.requestManager.request(i.METHODS.GET,s.ENROLLMENT_DATA,n)}}e.exports=new Proxy(o,r())},function(e,t){e.exports=require("x509.js")},function(e,t){e.exports=require("https-proxy-agent")},function(e,t){e.exports=require("aws-sdk")},function(e,t,n){const i=n(10);const r=n(11);const s=n(16);const o=n(101);const{getServerConfig:c}=n(2);const a=n(4);const u=n(5);const l=n(0);const h=20;const p=n(1);function d(e){if(!e.name)return Promise.reject(new p("NO_DEVICE_PROFILE_NAME"));if(!e.components)return Promise.reject(new p("NO_COMPONENTS"));if(!e.metadata)return Promise.reject(new p("NO_META_DATA"));const t=e.components[0];if(t.capabilities.length>h){return Promise.reject(new p("TOO_MANY_CAPABILITIES",h))}if(!e.components.find(e=>e.id==="main")){return Promise.reject(new p("AT_LEAST_ONE_MAIN_COMPONENT_REQUIRED"))}return Promise.resolve()}function E(e){const t={};t.name=e.name;t.components=e.components.map(e=>({id:e.id,capabilities:e.capabilities.map(e=>({id:e.id,version:e.version}))}));t.metadata=e.metadata;return t}class _{constructor(e){this.config=e;this.deviceProfileMgr=new s(this.config)}init(e){const{accessToken:t}=this.config;const n=c(this.config,"stCloud");this.agent=e||new r(t,n)}registerDeviceProfile(e){return this.deviceProfileMgr.retrieveDeviceProfile(e).then(e=>{const t=i(e);if(t.id)delete t.id;return d(t).then(()=>this.agent.createDeviceProfile(t))})}registerDeviceProfileByJsonFile(e){const t=a.resolve(e);return u.exists(t).then(e=>{if(e){return u.readFile(t,"utf-8").then(e=>{const t=JSON.parse(e);const n=E(t);return d(n).then(()=>this.agent.createDeviceProfile(n))})}throw new p("CANNOT_FIND_INPUT_PATH",t)})}retrieveDeviceProfileList(){const e=this.agent;function t(n,i,r){const s=r?e.get(i):e.getDeviceProfileList();return s.then(({items:e,_links:i})=>{if(e){e.forEach(e=>n.push(new o(e)))}if(i&&i.next&&i.next.href){return t(n,i.next.href,true)}return n})}return t([])}retrieveDeviceProfile(e){if(!e)return Promise.reject(new p("NO_DEVICE_PROFILE_ID"));return this.agent.getDeviceProfile(e).then(e=>new o(e))}updateDeviceProfile(e,t){return this.deviceProfileMgr.retrieveDeviceProfile(t).then(t=>{const n=i(t);if(n.id)delete n.id;return d(n).then(()=>{delete n.name;return this.agent.updateDeviceProfile(e,n)})})}updateDeviceProfileByJsonFile(e,t){const n=a.resolve(t);return u.exists(n).then(t=>{if(t){return u.readFile(n,"utf-8").then(t=>{const n=JSON.parse(t);const i=E(n);return d(i).then(()=>{delete i.name;return this.agent.updateDeviceProfile(e,i)})})}throw new p("CANNOT_FIND_INPUT_PATH",n)})}deleteDeviceProfile(e){if(!e)return Promise.reject(new p("NO_DEVICE_PROFILE_ID"));return this.agent.deleteDeviceProfile(e)}}e.exports=new Proxy(_,l())},function(e,t,n){const i=n(19);const r=n(96);function s(e,t){const n=new i;if(e)n.id=e.id;n.name=t.name;n.metadata=t.metadata;n.components=t.components;return n}function o(e){const t=new r;t.id=e.id;t.name=e.name;t.type=e.type;t.path=e.path;t.category=e.category;return t}function c(e,t,n,i,s){const o=new r;o.id=e;o.name=t;o.type=n;o.path=i;o.category=s;return o}e.exports={mapToDeviceProfile:s,mapToDeviceProfileEntry:o,createDeviceProfileEntry:c}},function(e,t){class n{constructor(){this.id=null;this.name="-";this.category="test";this.path="-"}}e.exports=n},function(e,t){e.exports=require("lodash/union")},function(e,t){e.exports=require("raml-1-parser")},function(e,t){class n{constructor(e,t,n,i,r,s,o){this.id=e;this.mainAction=t;this.mainState=n;this.mapToResources=i;this.supportedComponents=r;this.version=s;this.status=o}}e.exports=n},function(e,t){class n{constructor(){this.device=null;this.platform=null;this.resources=null}toCreateDeviceProfileBody(e,t){let n=this.device.rt.find(e=>e!=="oic.wk.d");if(!n){n="oic.wk.d"}return{devices:[{di:e,n:this.device.n,nick:t||this.device.n,mnmn:this.platform.mnmn,vid:this.platform.vid,rt:n}]}}toPublishDeviceBody(e){return{di:e,n:this.device.n,links:this.resources}}}e.exports=n},function(e,t){class n{constructor(e){this.id=e.id;this.name=e.name;this.owner=e.owner;this.components=e.components;this.metadata=e.metadata}}e.exports=n},function(e,t){e.exports=require("data-store")},function(e,t,n){const i=n(10);class r{constructor(e){const t=Object.keys(e);t.forEach(t=>{this[t]=i(e[t])})}}e.exports=r},function(e,t,n){const i=n(11);const r=n(10);const s=n(3);const o=n(105);const{getListIterator:c,getServerConfig:a}=n(2);const u=n(1);const l=n(0);class h{constructor(e){this.config=e}init(e){const{accessToken:t}=this.config;const n=a(this.config,"stCloud");this.agent=e||new i(t,n)}retrieveDeviceList(){return c([],"",false,this.agent,"getDeviceList")}retrieveDevice(e){if(!e)return s.reject(new u("NO_DEVICE_ID"));const t=this.agent.getDevice(e);const n=c([],"",false,this.agent,"getDeviceComponentList",e);return s.join(t,n,(e,t)=>{const n=new o(e);n.components=r(t);return n})}retrieveDeviceComponentStatus(e,t="main"){if(!e)return s.reject(new u("NO_DEVICE_ID"));return this.agent.getDeviceComponentStatus(e,t)}deleteDevice(e){if(!e)return s.reject(new u("NO_DEVICE_ID"));return this.agent.deleteDevice(e)}commandDevice(e,t){if(!e)return s.reject(new u("NO_DEVICE_ID"));if(!t)return s.reject(new u("NO_DEVICE_COMMAND"));return this.agent.commandDevice(e,[t])}}e.exports=new Proxy(h,l())},function(e,t,n){const i=n(10);class r{constructor({deviceId:e,label:t,name:n,locationId:r,deviceTypeId:s,deviceTypeName:o,deviceNetworkType:c,deviceManufacturerCode:a,components:u}){this.deviceId=e;this.label=t;this.name=n;this.locationId=r;this.deviceTypeId=s;this.deviceTypeName=o;this.deviceNetworkType=c;this.deviceManufacturerCode=a;this.components=i(u)}}e.exports=r},function(e,t,n){const i=n(39);function r(e){return new i(e)}function s(e){return e.map(e=>new i(e))}e.exports={mapToGroup:r,mapToGroupList:s}},function(e,t,n){const i=n(11);const r=n(108);const s=n(37);const o=n(39);const c=n(48);const{getListIterator:a,getServerConfig:u,filterFloat:l}=n(2);const h=n(1);const p=n(0);const d=/^(?:([0-9a-fA-F]{32})|([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}))$/;class E{constructor(e){this.config=e;this.validIdRegExp=d}init(e){const{accessToken:t}=this.config;const n=u(this.config,"stCloud");this.agent=e||new i(t,n)}isValidId(e){return this.validIdRegExp.test(e)}createLocation(e,t,n,i,s,o){if(!e)return Promise.reject(new h("NO_LOCATION_NAME"));if(!t)return Promise.reject(new h("NO_COUNTRY_CODE"));if(n&&!l(n))return Promise.reject(new h("INVALID_LATITUDE"));if(n>90||n<-90)return Promise.reject(new h("INVALID_LATITUDE_NUMBER"));if(i&&!l(i))return Promise.reject(new h("INVALID_LONGITUDE"));if(i>180||i<-180)return Promise.reject(new h("INVALID_LONGITUDE_NUMBER"));if(s&&!Number.isInteger(s))return Promise.reject(new h("INVALID_REGION_RADIUS"));if(o&&o!=="C"&&o!=="F"){return Promise.reject(new h("INVALID_TEMPERATURE_SCALE"))}const c={name:e,countryCode:t};if(n)c.latitude=n;if(i)c.longitude=i;if(s)c.regionRadius=s;if(o)c.temperatureScale=o;return this.agent.createLocation(c).then(e=>new r(e))}updateLocation(e,t,n,i,r,s){if(!e)return Promise.reject(new h("NO_LOCATION_ID"));if(!this.isValidId(e))return Promise.reject(new h("INVALID_LOCATION_ID"));if(n&&!l(n))return Promise.reject(new h("INVALID_LATITUDE"));if(n>90||n<-90)return Promise.reject(new h("INVALID_LATITUDE_NUMBER"));if(i&&!l(i))return Promise.reject(new h("INVALID_LONGITUDE"));if(i>180||i<-180)return Promise.reject(new h("INVALID_LONGITUDE_NUMBER"));if(r&&!Number.isInteger(r))return Promise.reject(new h("INVALID_REGION_RADIUS"));if(s&&s!=="C"&&s!=="F"){return Promise.reject(new h("INVALID_TEMPERATURE_SCALE"))}return this.retrieveLocation(e).then(o=>{const a={};a.name=t||o.name;a.latitude=typeof n==="number"&&!Number.isNaN(n)?n:o.latitude;a.longitude=typeof i==="number"&&!Number.isNaN(i)?i:o.longitude;a.regionRadius=typeof r==="number"&&!Number.isNaN(r)?r:o.regionRadius;a.temperatureScale=s||o.temperatureScale;if(c(a))return Promise.reject(new h("EMPTY_PARAMETER"));return this.agent.updateLocation(e,a)})}retrieveLocationList(){return a([],"",false,this.agent,"getLocationList")}retrieveLocation(e){if(!e)return Promise.reject(new h("NO_LOCATION_ID"));if(!this.isValidId(e))return Promise.reject(new h("INVALID_LOCATION_ID"));return this.agent.getLocation(e).then(e=>new r(e))}deleteLocation(e){if(!e)return Promise.reject(new h("NO_LOCATION_ID"));if(!this.isValidId(e))return Promise.reject(new h("INVALID_LOCATION_ID"));const t=new s(this.config);t.init();return t.retrieveGroup(e).catch(()=>undefined).then(t=>{if(t&&t.type===o.TYPE.PRIVATE)throw new h("CANNOT_DELETE_DEFAULT_LOCATION",t.name);return this.agent.deleteLocation(e)}).then(()=>undefined)}}e.exports=new Proxy(E,p())},function(e,t){class n{constructor(e){this.locationId=e.locationId;this.name=e.name;this.latitude=e.latitude;this.longitude=e.longitude;this.regionRadius=e.regionRadius;this.temperatureScale=e.temperatureScale;this.timeZoneId=e.timeZoneId}}e.exports=n},function(e,t,n){const i=n(110);const r=n(111);function s(e){if(!e)return null;return new i(e)}function o(e){if(!e)return null;return new r(e)}function c(e,t,n){if(!e||e.length<1)return null;const i=[];let r=t;if(t==="ui"||t==="presentation")r="presentation";e.forEach(e=>{const t=JSON.parse(e.userData);const s={mnmn:t.mnmn,vid:t.vid,version:t.version,type:t.type,workflowId:e.workflowId,uid:e.uid,status:e.status,region:t.region};if(!r||r===t.type){if(e.status&&e.status!==n)i.push(s)}});return i.sort((e,t)=>{const n=e.vid.toUpperCase();const i=t.vid.toUpperCase();let r=0;if(n>i){r=1}else if(n<i){r=-1}return r})}e.exports={mapToPresentationManifest:s,mapToManifestResourceList:c,mapToVoiceResource:o}},function(e,t){class n{constructor(e){this.n=e.n;this.mnmn=e.mnmn;this.vid=e.vid;this.version=e.version;this.type=e.type;this.dpResources=e.dpResources;this.dpInfo=e.dpInfo;this.language=e.language;this.ms=e.ms;this.ma=e.ma;this.iconUrl=e.iconUrl;this.workflowId=e.workflowId;this.uid=e.uid;this.status=e.status;this.region=e.region}}e.exports=n},function(e,t){class n{constructor(e){this.n=e.n;this.mnmn=e.mnmn;this.vid=e.vid;this.version=e.version;this.dalias=e.dalias;this.dtype=e.dtype;this.cts=e.cts;this.sml=e.sml}}e.exports=n},function(e,t,n){const i=n(3);const r=n(35);const s=n(38);const o=n(16);const c=n(19);const a=n(8);const{getServerConfig:u}=n(2);const l=n(15);const h=n(1);const p=n(58);const d=n(54);const E=n(5);const _=n(4);const I=n(20);const f=n(0);const P=n(6);const T={UNKNOWN:"UNKNOWN",SDK:"SDK",LOGGER:"LOGGER"};class g extends P{constructor(e){super();this.config=e||{}}init(e,t,n){if(e){this.client=e;return}const i=u(this.config,"iotCloud");const r=u(this.config,"iotConsole");const o=u(this.config,"authProvider");if(t&&n){i.clientKey=E.readFileSync(_.resolve(t));i.clientCert=E.readFileSync(_.resolve(n))}else{const e=new l(this.config);e.init();const{key:t,cert:n}=e.getDeviceKeyCert();i.clientKey=t;i.clientCert=n}const c={iotCloud:i,iotConsole:r,authProvider:o,ssoToken:this.config.ssoToken,authCode:this.config.authCode,accessToken:this.config.accessToken,userId:this.config.userId,deviceId:this.config.deviceId};this.client=new s(c);this.client.on("debug",e=>this.emit("debug",e));this.clientKey=i.clientKey;this.clientCert=i.clientCert}commandDevice(e,t,n,i,r,s){return this.client.connect().then(()=>this.client.commandDevice(e,t,n,i,r,s)).finally(()=>this.client.disconnect())}deleteDevice(e,t){return this.client.connect().then(()=>this.client.deleteDevice(e,t)).finally(()=>this.client.disconnect())}retrieveDevice(e,t){return this.client.connect().then(()=>this.client.retrieveDevice(e,t)).finally(()=>this.client.disconnect())}retrieveStatus(e,t){return this.client.connect().then(()=>this.client.retrieveStatus(e,t)).finally(()=>this.client.disconnect())}retrieveDeviceList(e,t){return this.client.connect().then(()=>this.client.retrieveDeviceList(e,t)).finally(()=>this.client.disconnect())}retrieveClientDeviceList(){return this.client.connect().then(()=>this.client.retrieveClientDeviceList()).then(e=>{const{userId:t,deviceId:n}=this.config;return p.getLogDeviceList(t).then(t=>e.map(e=>{const i={id:e,type:T.UNKNOWN};if(i.id===n)i.type=T.SDK;if(t.includes(i.id))i.type=T.LOGGER;return i}))}).finally(()=>this.client.disconnect())}publishDeviceBySsoToken(e,t,n,s){const o=t?this.deleteDevice(t):i.resolve();const c=t||r();const l=u(this.config,"iotConsole");const h=new a(this.config,l);h.init();h.on("debug",e=>this.emit("debug",e));return o.then(()=>h.getAuthCodeBySsoToken(e,c)).then(e=>this.publishDevice(e,c,n,s))}static generateDeviceProfile(e,t,n,i){const r={devices:[]};if(e instanceof c){let s;if(e.metadata.ocfDeviceType){s=e.metadata.ocfDeviceType}else if(e.metadata.deviceType){const t=I.retrieveDeviceType(e.metadata.deviceType);s=t?t.ocfDeviceType:e.name}else{s=e.name}const o={di:t,n:n||e.name,nick:n||e.name,mnmn:i||e.metadata.mnmn,vid:e.metadata.vid,rt:s};if(e.metadata.mnmo)o.mnmo=e.metadata.mnmo;if(e.metadata.mnpv)o.mnpv=e.metadata.mnpv;if(e.metadata.mnos)o.mnos=e.metadata.mnos;if(e.metadata.mnhw)o.mnhw=e.metadata.mnhw;if(e.metadata.mnfv)o.mnfv=e.metadata.mnfv;r.devices.push(o)}else{throw new h("UNSUPPORTED_DEVICE_PROFILE_TYPE")}return r}publishDevice(e,t,n,i){const s=this.config.mnid;const c=t||r();return o.generateOcfDeviceTypeFromDeviceProfile(n,s).then(t=>{const n=u(this.config,"iotCloud");const r=u(this.config,"iotConsole");const s=u(this.config,"authProvider");n.clientKey=this.clientKey;n.clientCert=this.clientCert;const o={iotCloud:n,authProvider:s,iotConsole:r,ssoToken:this.config.ssoToken,authCode:e};const a={deviceId:c,ocfDeviceType:t};if(i)a.nick=i;const l=new d(a,o);l.on("debug",e=>this.emit("debug",e));return l.publish().then(()=>l.stop())}).then(()=>({id:c,name:n.name}))}}e.exports=new Proxy(g,f())},function(e,t){class n{constructor(e,t,n){this.time=e;this.di=t;this.message=n}}e.exports=n},function(e,t,n){const i=n(12);const r=n(4);const s=n(27);const o=n(30);const c=n(3);const a=n(59);const u=n(2).getRoot;const l=n(5);const h=n(7);const{getServerConfig:p}=n(2);const d=n(8);const E=n(1);const _=n(115);const I=n(0);const f=n(52);const P=n(60);const T="/sdcard/sideloading";const g=`${T}/manifest`;const A=`${T}/plugin`;const O=`${A}/ppks`;const N="st-sim";const m="st-vdl";const C="/data/local/tmp/samsung.iot.test_enable";const S="com.samsung.android.oneconnect.dev_restart";function D(){let e=r.resolve(u(),"../../../launcher/simulator");if(!l.existsSync(e)){e=r.resolve(i.homedir(),".iotcloud/tools/launcher/simulator")}return e}function v(){let e=r.resolve(u(),"../../../launcher/virtual-device");if(!l.existsSync(e)){e=r.resolve(i.homedir(),".iotcloud/tools/launcher/virtual-device")}return e}function L(e){return i.platform()==="win32"?`${e}.cmd`:`./${e}`}function R(e,t){return l.readDir(e).then(e=>e.filter(e=>e.includes(h.UI_MANIFEST_FILE))).then(e=>{if(!e){if(t)return c.resolve();throw new E("CANNOT_FIND_UI_MANIFEST_FILE")}return e[0]})}class y{constructor(e){this.config=e||{}}static terminateSimulator(e=D()){const t=L(N);const n=r.resolve(e,t);return l.exists(n).then(i=>{if(!i)return c.reject(new E("CANNOT_FIND_SIMULATOR",n));return s.spawn(t,["terminate"],{cwd:e})})}static terminateVirtualDevice(e=v()){const t=L(m);const n=r.resolve(e,t);return l.exists(n).then(i=>{if(!i)return c.reject(new E("CANNOT_FIND_VIRTUAL_DEVICE",n));return s.spawn(t,["terminate"],{cwd:e})})}installApplicationToSimulator(e="cli",t=process.cwd(),n=D()){const a=this.config.userId;if(!a)return c.reject(new E("NO_USER_ID"));const u=L(N);const p=r.resolve(n,u);let d;const _=new P(this.config);function I(){return R(r.resolve(t,"out")).then(o=>{const a=o.split("_");const p=a[0];const _=a.slice(1,a.length-1).join("_");if(!_||!p)return c.reject(new E("CANNOT_FIND_UI_MANIFEST_FILE_BY_NAME"));const I=`${p}_${_}_${h.UI_MANIFEST_FILE}`;const f=r.resolve(t,"out",I);return l.readFile(f).then(e=>{const t=JSON.parse(e);d=t.dpInfo.find(e=>e.os==="android").dpUri}).then(()=>{if(i.platform()==="win32"){return s.spawn(u,["install","--config-name",e,"--ui-manifest",`"${f}"`],{cwd:n,windowsVerbatimArguments:true})}return s.spawn(u,["install","--config-name",e,"--ui-manifest",f],{cwd:n})})})}function f(){const a=r.resolve(t,h.PLUGIN_DIR,h.PLUGIN_MANIFEST_FILE);return l.readFile(a).then(e=>{const t=new o.Parser;const n=c.promisify(t.parseString);return n(e)}).then(o=>{const c=o.manifest.$;const a=r.resolve(t,"out",`${c.package}_${c.versionName}.ppk`);return l.exists(a).then(t=>{if(!t)throw new E("CANNOT_FIND_PPK_FILE",a);if(i.platform()==="win32"){return s.spawn(u,["install","--config-name",e,"--ppk",`"${a}"`],{cwd:n,windowsVerbatimArguments:true})}return s.spawn(u,["install","--config-name",e,"--ppk",a],{cwd:n})})})}return h.retrieveConfig(t).then(e=>{_.initForOneAppController(t,e);return _.isbuiltProject()}).then(e=>{if(!e)return _.buildProject(t);return c.resolve()}).then(()=>{const e=r.resolve(t,h.PLUGIN_DIR);let n={};return l.exists(p).then(e=>{if(!e)throw new E("CANNOT_FIND_SIMULATOR",p);return I()}).then(t=>{n=t;return l.exists(e)}).then(t=>{if(t)return f();if(d===h.ANDROID_GENERIC_DEVICE_PLUGIN_URI){return n}throw new E("CANNOT_FIND_PLUGINFOLDER",e)})})}launchSimulator(e="cli",t=D()){const n=L(N);const o=r.resolve(t,n);const a=r.resolve(i.homedir(),`.iotcloud/${e}/config.json`);const u=new f(a);u.init();if(!l.existsSync(o))return c.reject(new E("CANNOT_FIND_SIMULATOR",o));if(!l.existsSync(a))return c.reject(new E("CANNOT_FIND_CONFIG_FILE",a));const h=u.getConfig();if(!h.userId)return c.reject(new E("NO_USER_ID"));if(!h.deviceId)return c.reject(new E("NO_DEVICE_ID"));if(!this.config.authProvider.uri)return c.reject(new E("NO_AUTH_PROVIDER_URI"));return s.spawn(n,["run","--config-name",e],{cwd:t})}launchVirtualDevice(e="cli",t=v()){const n=L(m);const o=r.resolve(t,n);const a=r.resolve(i.homedir(),`.iotcloud/${e}/config.json`);const u=new f(a);u.init();if(!l.existsSync(o))return c.reject(new E("CANNOT_FIND_VIRTUAL_DEVICE",o));if(!l.existsSync(a))return c.reject(new E("CANNOT_FIND_CONFIG_FILE",a));const h=u.getConfig();if(!h.userId)return c.reject(new E("NO_USER_ID"));if(!h.deviceId)return c.reject(new E("NO_DEVICE_ID"));if(!this.config.authProvider.uri)return c.reject(new E("NO_AUTH_PROVIDER_URI"));return s.spawn(n,["run","--config-name",e],{cwd:t})}installApplicationToDevice(e=process.cwd(),t,n,i,s){const u=this.config.mnid;let p=false;let d;const I=new _(this.config);const T=new P(this.config);function N(t,n){return R(r.resolve(e,"out"),p).then(i=>{if(!i&&p)return c.resolve();const s=i.split("_");const o=s[0];const a=s.slice(1,s.length-1).join("_");if(o!==u)throw new E("UNMATCHED_MNID");if(!a)throw new E("NO_VID_IN_MANIFEST");const _=`${u}_${a}_${h.UI_MANIFEST_FILE}`;const I=`${u}_${a}_${h.VOICE_MANIFEST_FILE}`;const f=r.resolve(e,"out",_);const P=r.resolve(e,"out",I);return l.exists(f).then(e=>{if(!e){if(p)return c.resolve();throw new E("CANNOT_FIND_UI_MANIFEST_FILE_BY_PATH",f)}return l.readFile(f)}).then(e=>{if(!e&&p)return c.resolve();const i=JSON.parse(e);if(i.vid!==a)throw new E("UNMATCHED_VID");d=i.dpInfo.find(e=>e.os==="android").dpUri;return n.push(t.id,f,`${g}/${_}`).then(e=>new c((t,n)=>{e.on("end",()=>t());e.on("error",()=>n(new E("INSTALL_APP_FAIL_PUSH",f)))}))}).then(()=>l.exists(P)).then(e=>{if(!e)return c.resolve();return n.push(t.id,P,`${g}/${I}`).then(e=>new c((t,n)=>{e.on("end",()=>t());e.on("error",()=>n(new E("INSTALL_APP_FAIL_PUSH",P)))}))})})}function m(t,n){const i=r.resolve(e,h.PLUGIN_DIR,h.PLUGIN_MANIFEST_FILE);return l.exists(i).then(s=>{if(!s){if(p)return c.resolve();throw new E("CANNOT_FIND_MANIFEST_XML")}return l.readFile(i).then(e=>{const t=new o.Parser;const n=c.promisify(t.parseString);return n(e)}).then(i=>{if(!i||!i.manifest||!i.manifest.plugin){throw new E("INVALID_MANIFEST_XML",h.PLUGIN_DIR)}const s=i.manifest.$;const o=`${s.package}_${s.versionName}.ppk`;const a=r.resolve(e,"out",o);const u=`${s.package}.plugin`;const d=r.resolve(e,"out",u);if(!l.existsSync(a)){if(!p)throw new E("CANNOT_FIND_PPK_FILE",a);return c.resolve()}return n.push(t.id,d,`${A}/${u}`).then(e=>new c((t,n)=>{e.on("end",()=>t());e.on("error",()=>n(new E("INSTALL_APP_FAIL_PUSH",d)))})).then(()=>n.push(t.id,a,`${O}/${o}`)).then(e=>new c((t,n)=>{e.on("end",()=>t());e.on("error",()=>n(new E("INSTALL_APP_FAIL_PUSH",a)))}))})})}return h.retrieveConfig(e).then(t=>{T.initForOneAppController(e,t);return T.isbuiltProject()}).then(t=>{if(!t)return T.buildProject(e);return c.resolve()}).then(()=>{const t=r.resolve(e,h.PLUGIN_DIR);return l.exists(t)}).then(t=>{if(!t)return c.resolve();const n=l.readDirSync(r.resolve(e,"out"));const i=n.find(e=>e.includes(".ppk"));return T.verifyPackage(r.resolve(e,"out",i),true)}).then(()=>l.exists(I.getAdbCmd()).then(e=>{if(!e)return c.reject(new E("CANNOT_FIND_ADB_FILE",I.getAdbCmd()));const r=I.getClient();let o=null;return c.resolve().then(()=>I.getDevice(t).then(e=>{o=e;return c.resolve()})).then(()=>{if(!n&&!i&&!s){p=true}else{p=false}return c.resolve().then(()=>{if(!i&&!p)return c.resolve();return N(o,r)}).then(()=>{if(!n&&!p)return c.resolve();if(d===h.ANDROID_GENERIC_DEVICE_PLUGIN_URI){return c.resolve()}return m(o,r)})}).then(()=>{if(!f.isProductionMode(this.config)){return r.shell(o.id,`mkdir ${C}`)}return c.resolve()}).then(()=>{let e="";if(u){e=`am broadcast -a ${S} --es MN-ID ${u}`}else{e=`am broadcast -a ${S}`}return r.shell(o.id,`${e} 1> /dev/null 2> /dev/null && echo $?`).then(a.util.readAll).then(t=>{const n=t.toString().split("\n");if(n.indexOf("0")===-1){throw new E("INSTALL_APP_FAIL_CMD",e)}return c.resolve()})})}))}}e.exports=new Proxy(y,I())},function(e,t,n){const i=n(59);const r=n(12);const s=n(4);const o=n(1);const c=n(0);function a(e){const t=e.adbPath;if(!t)return Promise.reject(new o("NO_ADB_PATH"));const n=r.platform()==="win32"?"adb.exe":"./adb";const i=s.resolve(t,n);return i}class u{constructor(e){this.config=e;this.adbCmd=a(e);this.client=i.createClient({bin:this.adbCmd})}getDevice(e=""){return this.client.listDevices().then(t=>{const n=t.length;if(e){const n=t.find(t=>t.id===e);if(n){return n}throw new o("ADB_CONTROLLER_NO_DEVICE_SERIAL")}if(n===1){return t[0]}else if(n===0){throw new o(new Error("ADB_CONTROLLER_NO_DEVICE"))}throw new o(new Error("ADB_CONTROLLER_MANY_DEVICE"))})}getAdbCmd(){return this.adbCmd}getClient(){return this.client}}e.exports=new Proxy(u,c())},function(e,t){class n{constructor(e,t,n,i){this.id=e;this.name=t;this.description=n;this.deviceProfile=i}}e.exports=n},function(e,t){e.exports=require("jszip")},function(e,t,n){const i=n(4);const r=n(3);const s=n(6);const o=n(27);const c=n(5);const a=n(7);const u=n(40);const{getSmallUuid:l}=n(2);const h=n(0);const p="lambda.zip";class d extends s{constructor(e,t,n){super();this.parent=e;this.config=e.config;this.lambdaPath=t;this.outputPath=n||i.resolve(process.cwd())}build(){const e=this.emit.bind(this);const t=i.join(this.outputPath,`build_${l()}`);e("progress","Processing Lambda Smart-App files...");return c.remove(this.outputPath).then(()=>c.makeDir(this.outputPath)).then(()=>{e("progress","> Copying files to output directory...");c.copy(this.lambdaPath,t)}).then(()=>this.parent.retrieveLambdaConfig(i.dirname(this.lambdaPath))).then(n=>{e("progress",`> Lambda Runtime: ${n.runtime}`);if(n.runtime.indexOf("nodejs")>=0){e("progress","> Installing dependent NPM modules...");return o.spawn("npm",["install"],{cwd:t})}return r.resolve()}).then(()=>c.readDir(t)).then(n=>{const r=n.filter(e=>e!==a.LAMBDA_CONFIG_FILE).map(e=>i.join(t,e));if(r.length===0)throw new Error("no lambda function files");e("progress",`> Archiving files into ${p}...`);return u.zip(this.outputPath,p,r)}).finally(()=>{e("progress","> Cleaning up temporary build files...");if(c.existsSync(t))return c.remove(t);return r.resolve()})}clean(){const e=this.emit.bind(this);e("progress","Cleaning up Lambda Smart-App output files...");if(c.existsSync(this.outputPath))return c.remove(this.outputPath);return r.resolve()}}d.LAMBDA_ZIP_FILE_NAME=p;e.exports=new Proxy(d,h())},function(e,t){class n{constructor(e,t){this.package=e;this.versionName=t;this.manifestVersionCode="0";this.versionCode="1";this.minPluginSdkVersion="1.0.0";this.plugin={label:e,icon:"icon.png",device:{type:"none",subType:"none",manufacturer:"none",manufacturerID:"none"}};this.privilegeLevel={level:"public"}}static createFromIotConsoleResp(e){const t=new n(e.pkgNm,e.verNm);t.versionCode=e.verCd;t.minPluginSdkVersion=e.ppkPlfVer;t.plugin.device.type=e.dvcType;t.plugin.device.subType=e.dvcSubType;return t}static createFromManifestDoc(e){const t=e.manifest.$;const i=new n(t.package,t.versionName);i.versionCode=t.versionCode;i.manifestVersionCode=t.manifestVersionCode;i.minPluginSdkVersion=t.minPluginSdkVersion;const r=e.manifest.plugin[0].$;i.plugin.label=r.label;i.plugin.icon=r.icon;const s=e.manifest.plugin[0].device[0].$;i.plugin.device.type=s.type;i.plugin.device.subType=s.subType;i.plugin.device.manufacturer=s.manufacturer;i.plugin.device.manufacturerID=s.manufacturerID;const o=e.manifest.privilegeLevel[0].$;i.privilegeLevel.level=o.level;return i}}e.exports=n},function(e,t,n){const i=n(13);class r{constructor(e,t){this.id=e;this.appData=t}static createFromResp(e){const t=new i({appName:e.appNm,appId:e.appId,appType:e.appTypeCd==="SAT-LAMBDA"?i.APP_TYPE.LAMBDA:i.APP_TYPE.WEBHOOK,displayName:"",description:e.appDsc,singleInstance:e.multInstanceTypeCd!=="SAM-MULTI",owner:{ownerId:e.ownrId}});if(e.appScopeList){t.oauth={scope:e.appScopeList.map(e=>e.scopeNm)}}if(t.appType===i.APP_TYPE.LAMBDA){t.lambdaSmartApp={functions:e.tgtArnList.map(e=>e.tgtArn)}}else if(t.appType===i.APP_TYPE.WEBHOOK){t.webhookSmartApp={targetUrl:e.rgtUrl,publicKey:e.pubKey}}if(e.appUi){t.ui={pluginId:e.appUi.plgnId,dashboardCardsEnabled:e.appUi.dasbdCardYn==="Y",preInstallDashboardCardsEnabled:e.appUi.preInstDasbdCardYn==="Y"}}const n=new r(e.appInfoId,t);if(e.appSettingList){n.appSettings={};e.appSettingList.forEach(e=>{n.appSettings[e.settingKey]=e.settingValue})}n.status=e.devStatNm;return n}static createFromAutomationResp(e){const t=new i({appName:e.appNm,appId:e.appRefUuId,appType:e.appTypeCd==="SAT-LAMBDA"?i.APP_TYPE.LAMBDA:i.APP_TYPE.WEBHOOK,displayName:"",description:e.appDsc,singleInstance:e.multInstanceTypeCd!=="SAM-MULTI",owner:{ownerId:e.ownrId}});if(e.appScopeList){t.oauth={scope:e.appScopeList.map(e=>e.scopeNm)}}if(t.appType===i.APP_TYPE.LAMBDA){t.lambdaSmartApp={functions:e.tgtArnList.map(e=>e.tgtArn)}}else if(t.appType===i.APP_TYPE.WEBHOOK){t.webhookSmartApp={targetUrl:e.rgtUrl}}return new r(e.appId,t)}toCreateAutomationRequestBody(){const e=this.singleInstance?"SAM-SINGLE":"SAM-MULTI";let t=null;let n=null;let r=null;if(this.appType===i.APP_TYPE.LAMBDA){t="SAT-LAMBDA";n=(this.lambdaSmartApp?this.lambdaSmartApp.functions:[]).map(e=>({tgtArn:e}))}else if(this.appType===i.APP_TYPE.WEBHOOK){t="SAT-WEBHOOK";r=this.webhookSmartApp?this.tgtUrl.targetUrl:""}const s={refAppId:this.appId,appNm:this.appName,appDsc:this.description,appTypeCd:t,multInstanceTypeCd:e,tgtArnList:n,tgtUrl:r,appScopeList:this.oauth.scope.map(e=>({scopeNm:e})),ownerId:this.owner.ownerId,publicKey:""};return s}toUpdateRequestBodyIotConsole(){return this.toCreateRequestBodyIotConsole()}}e.exports=r},function(e,t){class n{constructor(e,t,n,i,r,s){this.id=e;this.n=t;this.version=n;this.mnmn=i;this.vid=r;this.type=s||"CIT-UI";this.status=null;this.jsonData=null}static createFromCloudConnectedResp(e){const t=new n(e.mtdtId,"",e.verNm,e.mnmn,e.vid);t.status=e.devStatNm;t.jsonData=JSON.parse(e.mtdtJson);t.n=t.jsonData.n;return t}}e.exports=n},function(e,t,n){const i=n(4);const r=n(6);const s=n(3);const o=n(1);const c=n(7);const a=n(22);const u=n(21);const l=n(9);const h=n(13);const p=n(42);const d=n(5);const E=n(0);class _ extends r{constructor(e){super();this.config=e.config;this.projectGenerator=e.projectGenerator}createProject(e,t,n,r,o,a,u,h,p){const E=new l(e,l.PROJ_TYPE.C2C);const _=i.join(t,e);try{this.validateProjectInfo(e,_,n)}catch(e){return s.reject(e)}return d.makeDir(_).then(()=>this.generateSmartAppFile(_,n)).then(()=>this.projectGenerator.generateDeviceProfileFile(_,r,u)).then(e=>this.projectGenerator.generateManifestFiles(_,e,o,a,h)).then(()=>p?this.projectGenerator.generateDevicePluginFiles(_,h):null).then(()=>this.generateCatalogFile(_,n.appName,e)).then(()=>c.generateConfig(_,E)).catch(e=>{if(d.existsSync(_))d.removeSync(_);throw e})}createDefaultProject(e,t,n,i,r,s,c,a,u,l,p,d){_.validateProjectOptions(u,l,p,d);let E=null;if(l===h.APP_TYPE.LAMBDA){E=new h({appName:u,displayName:u,description:u,singleInstance:false,appType:l,lambdaSmartApp:{functions:p},ui:{pluginId:c,dashboardCardsEnabled:true}})}else if(l===h.APP_TYPE.WEBHOOK){E=new h({appName:u,displayName:u,description:u,singleInstance:false,appType:h.APP_TYPE.WEBHOOK,webhookSmartApp:{targetUrl:d},ui:{pluginId:c,dashboardCardsEnabled:true}})}else{throw new o("INVALID_APP_TYPE",l)}return this.createProject(e,t,E,n,i,r,s,c,a)}buildProject(e,t){const n=this.emit.bind(this);const r=i.join(e,t.outputPath);const o=new u(this,e,t);o.on("progress",e=>n("progress",e));if(!this.config.mnid)throw new Error("Login or Requesting MNID required!");n("start",t.name);if(!o.isUpdatedDeviceProfile())n("progress","Warning: device-profile was updated, please generate manifest if you need");return d.remove(r).then(()=>d.makeDir(r)).then(()=>o.buildDeviceProfileFile()).then(e=>o.buildManifestFiles(e.metadata.vid)).then(()=>d.exists(i.join(e,c.PLUGIN_DIR))).then(e=>{if(e)return o.buildPluginFiles();return s.resolve()})}generateSmartAppFile(e,t){const n=i.join(e,c.SMART_APP_FILE);return d.writeFile(n,JSON.stringify(t,null,2))}generateCatalogFile(e,t,n){const r=i.join(e,c.PROD_CATALOG_FILE);const s=i.join(e,c.APP_CATALOG_FILE);const o={modelCd:n};const a=new p({appInternalName:t,appType:p.APP_TYPE.C2C,localizations:{"en-US":{metadataDisplayName:t}}});return d.writeFile(r,JSON.stringify(o,null,2)).then(()=>d.writeFile(s,JSON.stringify(a,null,2)))}static validateProjectOptions(e,t,n,i){if(!e){throw new o("CREATE_PROJECT_APP_NAME_OPT_REQUIRED")}if(!t){throw new o("CREATE_PROJECT_APP_TYPE_OPT_REQUIRED")}if(!h.isValidAppType(t)){throw new o("INVALID_APP_TYPE",t)}if(t===h.APP_TYPE.LAMBDA&&!n){throw new o("CREATE_PROJECT_LAMBDA_ARN_OPT_REQUIRED")}if(t===h.APP_TYPE.WEBHOOK&&!i){throw new o("CREATE_PROJECT_TARGET_URL_OPT_REQUIRED")}}validateProjectInfo(e,t,n){a.validateProjectInput(e,t)}}e.exports=new Proxy(_,E())},function(e,t,n){const i=n(3);const r=n(124);const s=n(71);const o=n(11);const{getListIterator:c,getServerConfig:a}=n(2);const u=n(1);const l=n(0);class h{constructor(e){this.config=e}init(e){const{accessToken:t}=this.config;const n=a(this.config,"stCloud");this.agent=e||new o(t,n)}installApp(e,t,n,o,c,a,l){if(!e)return i.reject(new u("NO_APP_ID"));if(!l)return i.reject(new u("NO_LOCATION_ID"));if(!t)return i.reject(new u("NO_APP_TYPE"));if(!n)return i.reject(new u("NO_CONFIGURATION_STATUS"));const h=new r({installedAppType:t,displayName:c,appId:e,referenceId:a,locationId:l,configurationStatus:n});const p=h.toCreateRequestBody(o);return this.agent.createInstalledApp(p).then(({installedApp:e,configurationDetail:t})=>{const n={installedApp:new r(e),configurationDetail:new s(t)};return n})}retrieveInstalledAppList(e,t){let n;if(e){n=i.resolve([e])}else{n=c([],"",false,this.agent,"getLocationList").then(e=>e.map(e=>e.locationId))}return n.reduce((e,n)=>c([],"",false,this.agent,"getInstalledAppList",n,t).then(t=>e.concat(t.map(e=>new r(e)))),[])}retrieveInstalledApp(e){if(!e)return i.reject(new u("NO_APP_NAME_OR_NO_APP_ID"));return i.join(this.agent.getInstalledApp(e),c([],"",false,this.agent,"getInstalledAppConfigList",e),(e,t)=>new r(e,t))}uninstallApp(e){if(!e)return i.reject(new u("NO_INSTALLED_APP_ID"));return this.agent.deleteInstalledApp(e)}retrieveInstalledAppConfig(e,t){if(!e)return i.reject(new u("NO_APP_ID"));if(!t)return i.reject(new u("NO_APP_CONFIGURATION_ID"));return this.agent.getInstalledAppConfig(e,t)}}e.exports=new Proxy(h,l())},function(e,t,n){const i=n(13).isValidAppType;const r=n(71).isValidConfigStatus;const s=n(1);class o{constructor({installedAppId:e,installedAppType:t,installedAppStatus:n,displayName:o,appId:c,referenceId:a,locationId:u,configurationStatus:l,owner:h,createdDate:p,lastUpdatedDate:d},E){if(t&&!i(t)){throw new s("INVALID_INSTALLED_APP_TYPE",t)}if(l&&!r(l)){throw new s("INVALID_CONFIGURATION_STATUS",l)}this.installedAppId=e;this.installedAppType=t;this.installedAppStatus=n;this.displayName=o;this.appId=c;this.referenceId=a;this.locationId=u;this.configurationStatus=l;this.owner=h;this.createdDate=p;this.lastUpdatedDate=d;this.configs=E||[]}toCreateRequestBody(e){const t={appId:this.appId,installedAppType:this.installedAppType,configurationStatus:this.configurationStatus};if(this.displayName)t.displayName=this.displayName;if(this.referenceId)t.referenceId=this.referenceId;if(this.locationId)t.locationId=this.locationId;if(e)t.config=e;return t}}e.exports=o},function(e,t,n){const i=n(126);const r=n(11);const{getServerConfig:s}=n(2);const o=n(1);const c=n(0);class a{constructor(e){this.config=e}init(e){const{accessToken:t}=this.config;const n=s(this.config,"stCloud");this.agent=e||new r(t,n)}createSchedule(e,t,n,r,s,c){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));if(!t)return Promise.reject(new o("NO_SCHEDULE_NAME"));let a;if(n){const e={expression:n,timezone:r||"UTC"};a=new i({name:t,cron:e})}else if(s){const e={time:s,overwrite:c||true};a=new i({name:t,once:e})}else{return Promise.reject(new o("NO_SCHEDULE"))}return this.agent.createSchedule(e,a.toCreateRequestBody()).then(e=>new i(e))}retrieveScheduleList(e){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));const t=this.agent;function n(r,s,o){const c=o?t.get(s):t.getScheduleList(e);return c.then(({items:e,_links:t})=>{if(e){e.forEach(e=>r.push(new i(e)))}if(t&&t.next&&t.next.href){return n(r,t.next.href,true)}return r})}return n([])}retrieveSchedule(e,t){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));if(!t)return Promise.reject(new o("NO_SCHEDULE_NAME"));return this.agent.getSchedule(e,t).then(e=>new i(e))}deleteSchedule(e,t){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));if(!t)return Promise.reject(new o("NO_SCHEDULE_NAME"));return this.agent.deleteSchedule(e,t)}}e.exports=new Proxy(a,c())},function(e,t){class n{constructor({installedAppId:e,name:t,scheduledExecutions:n,cron:i,once:r}){this.name=t;this.installedAppId=e;this.scheduledExecutions=n;if(i)this.cron=i;if(r)this.once=r}toCreateRequestBody(){const e={name:this.name};if(this.cron)e.cron=this.cron;if(this.once)e.once=this.once;return e}}e.exports=n},function(e,t,n){const i=n(72);const r=n(11);const{getServerConfig:s}=n(2);const o=n(1);const c=n(0);class a{constructor(e){this.config=e}init(e){const{accessToken:t}=this.config;const n=s(this.config,"stCloud");this.agent=e||new r(t,n)}subscribe(e,t,n){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));if(!t)return Promise.reject(new o("NO_SOURCE_TYPE"));const r=new i({installedAppId:e,sourceType:t,details:n});return this.agent.createSubscription(e,r.toCreateRequestBody()).then(e=>new i(e))}unsubscribe(e,t){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));if(!t)return Promise.reject(new o("NO_SUBSCRIPTION_ID"));return this.agent.deleteSubscription(e,t).then(({count:e})=>e)}retrieveSubscriptionList(e){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));const t=this.agent;function n(r,s,o){const c=o?t.get(s):t.getSubscriptionList(e);return c.then(({items:e,_links:t})=>{if(e){e.forEach(e=>r.push(new i(e)))}if(t&&t.next&&t.next.href){return n(r,t.next.href,true)}return r})}return n([])}retrieveSubscription(e,t){if(!e)return Promise.reject(new o("NO_INSTALLED_APP_ID"));if(!t)return Promise.reject(new o("NO_SUBSCRIPTION_ID"));return this.agent.getSubscription(e,t).then(e=>new i(e))}}e.exports=new Proxy(a,c())},function(e,t,n){const i=n(8);const{getServerConfig:r}=n(2);const s=n(0);const o=n(4);const c="PTC-";const a="CDS-";class u{constructor(e){this.config=e}init(e){this.agent=e||new i(this.config,r(this.config,"iotConsole"))}registerPlugin(e,t){const n=c.concat(t.toUpperCase());return this.agent.createPlugin(o.resolve(e),n,"CDS-ALPHA")}unregisterPlugin(e){return this.agent.removePlugin(e)}retrievePluginList(e,t,n){const i=t?c.concat(t.toUpperCase()):undefined;const r=n?a.concat(n.toUpperCase()):undefined;return this.agent.getPluginList(e,i,r)}retrievePlugin(e){return this.agent.getPlugin(e)}}e.exports=new Proxy(u,s())},function(e,t,n){const i=n(130);const r=n(0);const s=n(11);const o=n(1);const c=n(6);const{getServerConfig:a}=n(2);const u=["MODE_EVENT","SECURITY_ARM_STATE_EVENT","SECURITY_ARM_FAILURE_EVENT","LOCATION_LIFECYCLE_EVENT","PAID_SUBSCRIPTIONS_EVENT","HUB_HEALTH_EVENT","HUB_LIFECYCLE_EVENT","HUB_ZWAVE_STATUS","HUB_ZWAVE_EXCEPTION","HUB_ZWAVE_S2_AUTH_REQUEST","HUB_ZWAVE_SECURE_JOIN_RESULT","DEVICE_EVENT","DEVICE_LIFECYCLE_EVENT","DEVICE_JOIN_EVENT","DEVICE_HEALTH_EVENT","SMART_APP_EVENT","SMART_APP_DASHBOARD_CARD_EVENT","INSTALLED_APP_LIFECYCLE_EVENT","EXECUTION_RESULT_EVENT"];const l=["DEVICE_EVENT","DEVICE_LIFECYCLE_EVENT","DEVICE_JOIN_EVENT","DEVICE_HEALTH_EVENT"];const h=["SMART_APP_EVENT","SMART_APP_DASHBOARD_CARD_EVENT","INSTALLED_APP_LIFECYCLE_EVENT","EXECUTION_RESULT_EVENT"];const p=["INSTALLED_APP_LIFECYCLE_EVENT","EXECUTION_RESULT_EVENT"];function d(){const e=new Date;return`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`}class E extends c{constructor(e){super();this.config=e}init(e){const t=a(this.config,"stCloud");this.agent=e||new s(this.config.accessToken,t)}emitLog(e){const t=`${d()} ${e.type} ${e.data}`;this.emit("log",e,t)}registerEventHandlers(e,t){e.addEventListener("error",e=>{if(e.readyState===i.CLOSED){this.emitLog({type:"SDK",data:"connection closed"})}else{this.emitLog({type:"SDK",data:JSON.stringify(e)})}});e.addEventListener("CONTROL_EVENT",e=>this.emitLog(e));e.addEventListener("message",e=>this.emitLog(e));switch(t){case"LOCATIONIDS":u.forEach(t=>e.addEventListener(t,e=>this.emitLog(e)));break;case"DEVICEIDS":l.forEach(t=>e.addEventListener(t,e=>this.emitLog(e)));break;case"INSTALLEDSMARTAPPIDS":h.forEach(t=>e.addEventListener(t,e=>this.emitLog(e)));break;case"SMARTAPPIDS":p.forEach(t=>e.addEventListener(t,e=>this.emitLog(e)));break;default:throw new o("INVALID_LOGGER_TYPE",t)}}createRealtimeLogs(e,t){return this.agent.createClientSubscription(e,t).then(({registrationUrl:t})=>this.getRealtimeLogs(e,t))}getRealtimeLogs(e,t){const n=this.config.accessToken;const r=new i(t,{headers:{Authorization:`Bearer ${n}`}});this.registerEventHandlers(r,e);return r}}E.CLOSED=i.CLOSED;e.exports=new Proxy(E,r())},function(e,t){e.exports=require("eventsource")},function(e,t,n){const i=n(4);const r=n(3);const s=n(6);const o=n(5);const c=n(16);const a=n(41);const u=n(7);const l=n(132);const h=n(28);const p=n(63);const d=n(68);const E=n(69);const _=n(8);const{getServerConfig:I}=n(2);const f=n(9);const P=n(31);const T=n(65);const g=n(67);const A=n(66);const O=n(1);const{getText:N}=n(25);const m=n(0);class C extends s{constructor(e){super();this.config=e||{};this.deviceProfileMgr=new c(this.config);this.smartAppMgr=new a(this.config);this.configurator=new l(this.config);this.servicePlugin=null}init(e,t){this.agent=e||new _(this.config,I(this.config,"iotConsole"));this.smartAppMgr.init(t);this.servicePlugin=new d(this);this.servicePlugin.on("progress",e=>this.emit("progress",e));this.cloudConnected=new p(this);this.cloudConnected.on("progress",e=>this.emit("progress",e));this.automation=new E(this);this.automation.on("progress",e=>this.emit("progress",e))}createProject(e=process.cwd(),t,n){let i=null;this.emit("progress",N("REGISTER_WEB_CONSOLE_PROJECT.CHECKING_MNID"));return this.checkAuthenticationStatus().then(()=>u.retrieveConfig(e)).then(i=>{switch(i.type){case f.PROJ_TYPE.OCF:{return this.cloudConnected.readProject(e).then(e=>this.cloudConnected.createWebConsoleProject(e,t,n,true))}case f.PROJ_TYPE.SERVICE:{return this.servicePlugin.readProject(e).then(e=>this.servicePlugin.createWebConsoleProject(e,t,n,true))}default:throw new O("INVALID_PROJECT_TYPE",i.type)}}).then(t=>{i=t;const n={id:t.id,name:t.name,description:t.description};this.emit("progress",N("REGISTER_WEB_CONSOLE_PROJECT.UPDATING_CONFIG"));return this.configurator.updateConfig(e,n)}).then(()=>i)}readProject(e){return this.cloudConnected.existsWebConsoleProject(e).then(t=>{if(t)return this.cloudConnected.readWebConsoleProject(e);return this.servicePlugin.existsWebConsoleProject(e).then(t=>{if(t)return this.servicePlugin.readWebConsoleProject(e);throw new O("WEB_CONSOLE_PROJECT_NOT_FOUND",e)})})}readProjectInLocalProject(e=process.cwd()){return this.configurator.retrieveConfig(e).then(t=>u.retrieveConfig(e).then(e=>{switch(e.type){case f.PROJ_TYPE.OCF:return this.cloudConnected.readWebConsoleProject(t.id);case f.PROJ_TYPE.SERVICE:return this.servicePlugin.readWebConsoleProject(t.id);default:throw new O("INVALID_PROJECT_TYPE",e.type)}}))}existsProject(e){return this.cloudConnected.existsWebConsoleProject(e).then(t=>{if(t)return true;return this.servicePlugin.existsWebConsoleProject(e)})}readProjectList(e){let t=[];return r.resolve().then(()=>{if(!e||!e.type||e.type===f.PROJ_TYPE.OCF){return this.cloudConnected.readWebConsoleProjectList()}return[]}).then(e=>{t=t.concat(e)}).then(()=>{if(!e||!e.type||e.type===f.PROJ_TYPE.SERVICE){return this.servicePlugin.readWebConsoleProjectList()}return[]}).then(e=>{t=t.concat(e)}).then(()=>t)}updateProject(e=process.cwd(),t,n,i){let r=null;let s=null;this.emit("progress",N("UPDATE_WEB_CONSOLE_PROJECT.CHECKING_MNID"));return this.checkAuthenticationStatus().then(()=>this.configurator.retrieveConfig(e).then(t=>{s=t;return u.retrieveConfig(e)})).then(r=>{const o=t||s.id;const c=n||s.name;const a=i||s.description;switch(r.type){case f.PROJ_TYPE.OCF:return this.cloudConnected.readProject(e).then(e=>this.cloudConnected.updateWebConsoleProject(o,e,c,a));case f.PROJ_TYPE.SERVICE:return this.servicePlugin.readProject(e).then(e=>this.servicePlugin.updateWebConsoleProject(o,e,c,a));default:throw new O("INVALID_PROJECT_TYPE",r.type)}}).then(t=>{r=t;s={id:t.id,name:t.name,description:t.description};this.emit("progress",N("UPDATE_WEB_CONSOLE_PROJECT.UPDATING_CONFIG"));return this.configurator.updateConfig(e,s)}).then(()=>r)}deleteProject(e){return this.cloudConnected.existsWebConsoleProject(e).then(t=>{if(t)return this.cloudConnected.deleteWebConsoleProject(e);return this.servicePlugin.existsWebConsoleProject(e).then(t=>{if(t)return this.servicePlugin.deleteWebConsoleProject(e);throw new O("WEB_CONSOLE_PROJECT_NOT_FOUND",e)})})}deleteProjectInLocalProject(e=process.cwd(),t={}){let n=null;return this.checkAuthenticationStatus().then(()=>this.configurator.retrieveConfig(e).then(t=>{n=t;return u.retrieveConfig(e)})).then(e=>{switch(e.type){case f.PROJ_TYPE.OCF:{return this.cloudConnected.existsWebConsoleProject(n.id).then(e=>{if(e)return this.cloudConnected.deleteWebConsoleProject(n.id);if(t.force)return r.resolve();throw new O("WEB_CONSOLE_PROJECT_NOT_FOUND",n.id)})}case f.PROJ_TYPE.SERVICE:{return this.servicePlugin.existsWebConsoleProject(n.id).then(e=>{if(e)return this.servicePlugin.deleteWebConsoleProject(n.id);if(t.force)return r.resolve();throw new O("WEB_CONSOLE_PROJECT_NOT_FOUND",n.id)})}default:throw new O("INVALID_PROJECT_TYPE",e.type)}}).then(()=>this.configurator.deleteConfig(e))}publishProject(e){return this.cloudConnected.existsWebConsoleProject(e).then(t=>{if(t)return this.cloudConnected.publishWebConsoleProject(e);return this.servicePlugin.existsWebConsoleProject(e).then(t=>{if(t)return this.servicePlugin.publishWebConsoleProject(e);throw new O("WEB_CONSOLE_PROJECT_NOT_FOUND",e)})})}publishProjectInLocalProject(e=process.cwd()){return this.configurator.retrieveConfig(e).then(t=>u.retrieveConfig(e).then(e=>{switch(e.type){case f.PROJ_TYPE.OCF:{return this.cloudConnected.publishWebConsoleProject(t.id)}case f.PROJ_TYPE.SERVICE:{return this.servicePlugin.publishWebConsoleProject(t.id)}default:throw new O("INVALID_PROJECT_TYPE",e.type)}}))}unpublishProject(e){return this.cloudConnected.existsWebConsoleProject(e).then(t=>{if(t)return this.cloudConnected.unpublishWebConsoleProject(e);return this.servicePlugin.existsWebConsoleProject(e).then(t=>{if(t)return this.servicePlugin.unpublishWebConsoleProject(e);throw new O("WEB_CONSOLE_PROJECT_NOT_FOUND",e)})})}unpublishProjectInLocalProject(e=process.cwd()){return this.configurator.retrieveConfig(e).then(t=>u.retrieveConfig(e).then(e=>{switch(e.type){case f.PROJ_TYPE.OCF:{return this.cloudConnected.unpublishWebConsoleProject(t.id)}case f.PROJ_TYPE.SERVICE:{return this.servicePlugin.unpublishWebConsoleProject(t.id)}default:throw new O("INVALID_PROJECT_TYPE",e.type)}}))}checkAuthenticationStatus(){return this.agent.getAuthenticationStatus().then(e=>{if(e.mnId!==this.config.mnid){throw new O("WEB_CONSOLE_PROJECT_MNNM_MISMATCH",e.mnId,this.config.mnid)}})}createAutomationProject(e,t,n,i){const s=new P(null,t,n);return this.agent.postAutomationProject(s.toCreateRequestBody()).then(e=>{s.id=e.pjtId}).then(()=>this.createAutomationApp(i,s.id)).then(t=>{const n=t.appId;return this.createAutomationCatalog(e,s.id,n)}).then(()=>this.readAutomationProject(s.id)).catch(e=>r.resolve().then(()=>{if(!s.id)return r.resolve();return this.deleteAutomationProject(s.id)}).then(()=>r.reject(e)))}readAutomationProject(e){return this.agent.getAutomationProject(e).then(e=>P.createFromAutomationResp(e))}readAutomationProjectList(){return this.agent.getAutomationProjectList().then(e=>P.createListFromAutomationResp(e))}existsAutomationProject(e){return this.readAutomationProjectList().then(t=>!!t.find(t=>t.id===e))}updateAutomationProjectStatusToLocked(e){return this.agent.putAutomationProjectStatusToLocked(e)}updateAutomationProjectStatusToUnlocked(e){return this.agent.putAutomationProjectStatusToUnlocked(e)}updateAutomationProject(e,t,n,i){const r=new P(null,n,i,P.TYPE.AUTOMATION);return this.agent.putAutomationProject(t,r.toUpdateRequestBody()).then(n=>{const i=n.app.appNm;const r=n.app.appId;const s=n.ctlg.ctlgId;return this.updateAutomationApp(i,t,r).then(()=>this.updateAutomationCatalog(e,t,r,s))}).then(()=>this.readAutomationProject(t))}deleteAutomationProject(e){return this.agent.deleteAutomationProject(e)}createCloudConnectedDeviceProfile(e,t){const n=i.join(e,u.DEVICE_PROFILE_FILE);let r=null;return this.deviceProfileMgr.retrieveDeviceProfileFromFile(n).then(e=>{r=e}).then(()=>this.readUiManifestFile(e)).then(e=>{const n=e?h.getMainAction(e):null;const i=e?h.getMainState(e):null;const s=T.createFromDeviceProfile(r,{mainAction:n,mainState:i});return this.agent.postCloudConnectedDeviceProfile(t,s.toCreateRequestBody())})}readCloudConnectedDeviceProfile(e,t){return this.agent.getCloudConnectedDeviceProfile(e,t).then(e=>T.createFromCloudConnectedResp(e))}updateCloudConnectedDeviceProfile(e,t,n){const r=i.join(e,u.DEVICE_PROFILE_FILE);let s=null;return this.deviceProfileMgr.retrieveDeviceProfileFromFile(r).then(e=>{s=e}).then(()=>this.readUiManifestFile(e)).then(e=>{const i=e?h.getMainAction(e):null;const r=e?h.getMainState(e):null;const o=T.createFromDeviceProfile(s,{mainAction:i,mainState:r});return this.agent.putCloudConnectedDeviceProfile(t,n,o.toUpdateRequestBody())})}deleteCloudConnectedDeviceProfile(e,t){return this.agent.deleteCloudConnectedDeviceProfile(e,t)}createCloudConnectedUiManifest(e,t,n){return this.readUiManifestFile(e).then(e=>{if(!e)return r.resolve();return this.agent.postCloudConnectedMetadata(t,n,e,"CIT-UI")})}readUiManifestFile(e){return o.readDir(e).then(e=>e.find(e=>e.endsWith(u.UI_MANIFEST_FILE))).then(t=>{if(!t)return r.resolve(null);const n=i.join(e,t);return o.readJson(n)})}createCloudConnectedVoiceManifest(e,t,n){return o.readDir(e).then(e=>e.find(e=>e.endsWith(u.VOICE_MANIFEST_FILE))).then(s=>{if(!s)return r.resolve();const c=i.join(e,s);return o.readJson(c).then(e=>this.agent.postCloudConnectedMetadata(t,n,e,"CIT-VOICE"))})}updateCloudConnectedUiManifest(e,t,n,s){return o.readDir(e).then(e=>e.find(e=>e.endsWith(u.UI_MANIFEST_FILE))).then(c=>{if(!c)return r.resolve();const a=i.join(e,c);return o.readJson(a).then(e=>this.agent.putCloudConnectedMetadata(t,n,s,e,"CIT-UI"))})}updateCloudConnectedVoiceManifest(e,t,n,s){return o.readDir(e).then(e=>e.find(e=>e.endsWith(u.VOICE_MANIFEST_FILE))).then(c=>{if(!c)return r.resolve();const a=i.join(e,c);return o.readJson(a).then(e=>this.agent.putCloudConnectedMetadata(t,n,s,e,"CIT-VOICE"))})}deleteCloudConnectedManfest(e,t,n){return this.agent.deleteCloudConnectedManfest(e,t,n)}createCloudConnectedCatalog(e,t,n){const r=i.join(e,u.CATALOG_FILE);return o.readJson(r).then(e=>{const i={modelCd:e.items[0].name,setupId:e.items[0].versions[0].appData.setupAppData.ocf.setupId};return this.agent.postCloudConnectedCatalog(t,n,i)})}readCloudConnectedCatalog(e,t,n){return this.agent.getCloudConnectedCatalog(e,t,n).then(e=>g.createFromCloudConnectedResp(e))}updateCloudConnectedCatalog(e,t,n,i){return this.deleteCloudConnectedCatalog(t,n,i).then(()=>this.createCloudConnectedCatalog(e,t,n))}deleteCloudConnectedCatalog(e,t,n){return this.agent.deleteCloudConnectedCatalog(e,t,n)}createCloudConnectedDevicePlugin(e,t,n,r){const s=i.join(e,r);return this.agent.postCloudConnectedDevicePlugin(t,n,s)}static findDevicePluginFile(e){return o.readDir(e).then(e=>e.find(e=>e.endsWith(".ppk")))}readCloudConnectedDevicePlugin(e,t,n){return this.agent.getCloudConnectedDevicePlugin(e,t,n).then(e=>A.createFromCloudConnectedResp(e))}updateCloudConnectedDevicePlugin(e,t,n,s){return o.readDir(e).then(e=>e.find(e=>e.endsWith(".ppk"))).then(o=>{if(!o)return r.resolve();const c=i.join(e,o);return this.agent.postCloudConnectedDevicePluginForUpdate(t,n,s,c)})}deleteCloudConnectedDevicePlugin(e,t,n){return this.agent.deleteCloudConnectedDevicePlugin(e,t,n)}createAutomationApp(e,t){let n=null;return this.smartAppMgr.retrieveSmartApp(e).then(e=>{n=e}).then(()=>this.smartAppMgr.retrieveSmartAppOauth(e)).then(e=>{n.oauth=e;return this.agent.postAutomationApp(t,n.toCreateRequestBodyIotConsole())})}updateAutomationApp(e,t,n){let i=null;return this.smartAppMgr.retrieveSmartApp(e).then(e=>{i=e}).then(()=>this.smartAppMgr.retrieveSmartAppOauth(e)).then(e=>{i.oauth=e;return this.agent.putAutomationApp(t,n,i.toUpdateRequestBodyIotConsole())})}createAutomationCatalog(e,t,n){const r=i.join(e,u.CATALOG_FILE);return o.readJson(r).then(e=>{const i={dispNm:e.items[0].name};return this.agent.postAutomationCatalog(t,n,i)})}readAutomationCatalog(e,t,n){return this.agent.getAutomationCatalog(e,t,n).then(e=>g.createFromAutomationResp(e))}updateAutomationCatalog(e,t,n,r){const s=i.join(e,u.CATALOG_FILE);return o.readJson(s).then(e=>{const i={dispNm:e.items[0].name};return this.agent.putAutomationCatalog(t,n,r,i)})}deleteAutomationCatalog(e,t,n){return this.agent.deleteAutomationCatalog(e,t,n)}}e.exports=new Proxy(C,m())},function(e,t,n){const i=n(4);const r=n(62);const s=n(5);const o=n(1);const c=n(0);const a=".web-console-project";class u{constructor(e){this.config=e}retrieveConfig(e){const t=i.join(e,a);return s.exists(t).then(e=>{if(!e)throw new o("WEB_CONSOLE_PROJECT_CONFIG_NOT_FOUND",t);return s.readJson(t)}).then(e=>{if(e.uri!==this.config.iotConsole.uri){throw new o("WEB_CONSOLE_URI_NOT_MATCHED",e.uri)}return e})}updateConfig(e,t){const n=r(t);n.uri=this.config.iotConsole.uri;const o=JSON.stringify(n,null,2);const c=i.join(e,a);return s.writeFile(c,o)}deleteConfig(e){const t=i.join(e,a);return s.remove(t)}}u.CONFIG_FILE=a;e.exports=new Proxy(u,c())}]);
//# sourceMappingURL=stlib.js.map